!function(){const e="undefined"!=typeof exports&&exports||"undefined"!=typeof define&&{}||this||window;"undefined"!=typeof define&&define("save-svg-as-png",[],()=>e),e["default"]=e;const t="http://www.w3.org/2000/xmlns/",n="http://www.w3.org/1999/xhtml",r="http://www.w3.org/2000/svg",o='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>',i=/url\(["']?(.+?)["']?\)/,s={woff2:"font/woff2",woff:"font/woff",otf:"application/x-font-opentype",ttf:"application/x-font-ttf",eot:"application/vnd.ms-fontobject",sfnt:"application/font-sfnt",svg:"image/svg+xml"},a=e=>e instanceof HTMLElement||e instanceof SVGElement,l=e=>{if(!a(e))throw new Error(`an HTMLElement or SVGElement is required; got ${e}`)},c=e=>new Promise((t,n)=>{a(e)?t(e):n(new Error(`an HTMLElement or SVGElement is required; got ${e}`))}),d=e=>e&&0===e.lastIndexOf("http",0)&&-1===e.lastIndexOf(window.location.host),h=e=>{const t=Object.keys(s).filter(t=>e.indexOf(`.${t}`)>0).map(e=>s[e]);return t?t[0]:(console.error(`Unknown font format for ${e}. Fonts may not be working correctly.`),"application/octet-stream")},u=e=>{let t="";const n=new Uint8Array(e);for(let e=0;e<n.byteLength;e++)t+=String.fromCharCode(n[e]);return window.btoa(t)},w=(e,t,n)=>{const r=e.viewBox&&e.viewBox.baseVal&&e.viewBox.baseVal[n]||null!==t.getAttribute(n)&&!t.getAttribute(n).match(/%$/)&&parseInt(t.getAttribute(n))||e.getBoundingClientRect()[n]||parseInt(t.style[n])||parseInt(window.getComputedStyle(e).getPropertyValue(n));return null==r||isNaN(parseFloat(r))?0:r},f=(e,t,n,r)=>{if("svg"===e.tagName)return{width:n||w(e,t,"width"),height:r||w(e,t,"height")};if(e.getBBox){const{x:t,y:n,width:r,height:o}=e.getBBox();return{width:t+r,height:n+o}}},g=e=>decodeURIComponent(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(e,t)=>{const n=String.fromCharCode(`0x${t}`);return"%"===n?"%25":n})),p=e=>{const t=window.atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),o=new Uint8Array(r);for(let e=0;e<t.length;e++)o[e]=t.charCodeAt(e);return new Blob([r],{type:n})},m=(e,t)=>{if(t)try{return e.querySelector(t)||e.parentNode&&e.parentNode.querySelector(t)}catch(n){console.warn(`Invalid CSS selector "${t}"`,n)}},v=(e,t)=>{const n=e.cssText.match(i),r=n&&n[1]||"";if(!r||r.match(/^data:/)||"about:blank"===r)return;const o=r.startsWith("../")?`${t}/../${r}`:r.startsWith("./")?`${t}/.${r}`:r;return{text:e.cssText,format:h(o),url:o}},b=e=>Promise.all(Array.from(e.querySelectorAll("image")).map(e=>{let t=e.getAttributeNS("http://www.w3.org/1999/xlink","href")||e.getAttribute("href");return t?(d(t)&&(t+=(-1===t.indexOf("?")?"?":"&")+"t="+(new Date).valueOf()),new Promise((n,r)=>{const o=document.createElement("canvas"),i=new Image;i.crossOrigin="anonymous",i.src=t,i.onerror=(()=>r(new Error(`Could not load ${t}`))),i.onload=(()=>{o.width=i.width,o.height=i.height,o.getContext("2d").drawImage(i,0,0),e.setAttributeNS("http://www.w3.org/1999/xlink","href",o.toDataURL("image/png")),n(!0)})})):Promise.resolve(null)})),y={},x=e=>Promise.all(e.map(e=>new Promise(t=>{if(y[e.url])return t(y[e.url]);const n=new XMLHttpRequest;n.addEventListener("load",()=>{const r=u(n.response),o=e.text.replace(i,`url("data:${e.format};base64,${r}")`)+"\n";y[e.url]=o,t(o)}),n.addEventListener("error",n=>{console.warn(`Failed to load font from: ${e.url}`,n),y[e.url]=null,t(null)}),n.addEventListener("abort",n=>{console.warn(`Aborted loading font from: ${e.url}`,n),t(null)}),n.open("GET",e.url),n.responseType="arraybuffer",n.send()}))).then(e=>e.filter(e=>e).join(""));let A=null;const S=()=>A||(A=Array.from(document.styleSheets).map(e=>{try{return{rules:e.cssRules,href:e.href}}catch(t){return console.warn(`Stylesheet could not be loaded: ${e.href}`,t),{}}})),E=(e,t)=>{const{selectorRemap:n,modifyStyle:r,modifyCss:o,fonts:i}=t||{},s=o||((e,t)=>{return`${n?n(e):e}{${r?r(t):t}}\n`}),a=[],l=void 0===i,c=i||[];return S().forEach(({rules:t,href:n})=>{t&&Array.from(t).forEach(t=>{if("undefined"!=typeof t.style)if(m(e,t.selectorText))a.push(s(t.selectorText,t.style.cssText));else if(l&&t.cssText.match(/^@font-face/)){const e=v(t,n);e&&c.push(e)}else a.push(t.cssText)})}),x(c).then(e=>a.join("\n")+e)},C=()=>{if(!(navigator.msSaveOrOpenBlob||"download"in document.createElement("a")))return{popup:window.open()}};e.prepareSvg=((e,o,i)=>{l(e);const{left:s=0,top:a=0,width:c,height:d,scale:h=1,responsive:u=!1}=o||{};return b(e).then(()=>{let l=e.cloneNode(!0);l.style.backgroundColor=(o||{}).backgroundColor||e.style.backgroundColor;const{width:w,height:g}=f(e,l,c,d);if("svg"!==e.tagName){if(!e.getBBox)return void console.error("Attempted to render non-SVG element",e);{null!=l.getAttribute("transform")&&l.setAttribute("transform",l.getAttribute("transform").replace(/translate\(.*?\)/,""));const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.appendChild(l),l=e}}return l.setAttribute("version","1.1"),l.setAttribute("viewBox",[s,a,w,g].join(" ")),l.getAttribute("xmlns")||l.setAttributeNS(t,"xmlns",r),l.getAttribute("xmlns:xlink")||l.setAttributeNS(t,"xmlns:xlink","http://www.w3.org/1999/xlink"),u?(l.removeAttribute("width"),l.removeAttribute("height"),l.setAttribute("preserveAspectRatio","xMinYMin meet")):(l.setAttribute("width",w*h),l.setAttribute("height",g*h)),Array.from(l.querySelectorAll("foreignObject > *")).forEach(e=>{e.setAttributeNS(t,"xmlns","svg"===e.tagName?r:n)}),E(e,o).then(e=>{const t=document.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=`<![CDATA[\n${e}\n]]>`;const n=document.createElement("defs");n.appendChild(t),l.insertBefore(n,l.firstChild);const r=document.createElement("div");r.appendChild(l);const o=r.innerHTML.replace(/NS\d+:href/gi,'xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href');if("function"!=typeof i)return{src:o,width:w,height:g};i(o,w,g)})})}),e.svgAsDataUri=((t,n,r)=>(l(t),e.prepareSvg(t,n).then(({src:e,width:t,height:n})=>{const i=`data:image/svg+xml;base64,${window.btoa(g(o+e))}`;return"function"==typeof r&&r(i,t,n),i}))),e.svgAsPngUri=((t,n,r)=>{l(t);const{encoderType:o="image/png",encoderOptions:i=.8,canvg:s}=n||{},a=({src:e,width:t,height:n})=>{const a=document.createElement("canvas"),l=a.getContext("2d"),c=window.devicePixelRatio||1;let d;a.width=t*c,a.height=n*c,a.style.width=`${a.width}px`,a.style.height=`${a.height}px`,l.setTransform(c,0,0,c,0,0),s?s(a,e):l.drawImage(e,0,0);try{d=a.toDataURL(o,i)}catch(h){if("undefined"!=typeof SecurityError&&h instanceof SecurityError||"SecurityError"===h.name)return void console.error("Rendered SVG images cannot be downloaded in this browser.");throw h}return"function"==typeof r&&r(d,a.width,a.height),Promise.resolve(d)};return s?e.prepareSvg(t,n).then(a):e.svgAsDataUri(t,n).then(e=>new Promise((t,n)=>{const r=new Image;r.onload=(()=>t(a({src:r,width:r.width,height:r.height}))),r.onerror=(()=>{n(`There was an error loading the data URI as an image on the following SVG\n${window.atob(e.slice(26))}Open the following link to see browser's diagnosis\n${e}`)}),r.src=e}))}),e.download=((e,t,n)=>{if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(p(t),e);else{const o=document.createElement("a");if("download"in o){o.download=e,o.style.display="none",document.body.appendChild(o);try{const e=p(t),n=URL.createObjectURL(e);o.href=n,o.onclick=(()=>requestAnimationFrame(()=>URL.revokeObjectURL(n)))}catch(r){console.error(r),console.warn("Error while getting object URL. Falling back to string URL."),o.href=t}o.click(),document.body.removeChild(o)}else n&&n.popup&&(n.popup.document.title=e,n.popup.location.replace(t))}}),e.saveSvg=((t,n,r)=>{const o=C();return c(t).then(t=>e.svgAsDataUri(t,r||{})).then(t=>e.download(n,t,o))}),e.saveSvgAsPng=((t,n,r)=>{const o=C();return c(t).then(t=>e.svgAsPngUri(t,r||{})).then(t=>e.download(n,t,o))})}();