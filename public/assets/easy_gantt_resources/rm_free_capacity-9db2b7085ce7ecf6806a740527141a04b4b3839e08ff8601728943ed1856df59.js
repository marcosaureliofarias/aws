window.ysy=window.ysy||{},ysy.pro=ysy.pro||{},ysy.pro.resource=ysy.pro.resource||{},ysy.pro.resource.features=EasyGem.extend(ysy.pro.resource.features,{freeCapacity:"freeCapacity"}),ysy.pro.resource.freeCapacity=ysy.pro.resource.freeCapacity||{},EasyGem.extend(ysy.pro.resource.freeCapacity,{patch:function(){ysy.settings.resource.buttons=ysy.settings.resource.buttons||{},ysy.settings.resource.buttons.showFreeCapacity=JSON.parse(ysy.data.storage.getPersistentData("showFreeCapacity")),ysy.pro.toolPanel.registerButton({id:"rm_free_capacity",bind:function(){this.model=ysy.settings.resource,this.buttons=this.model.buttons,this.buttons.showFreeCapacity&&(this.model.setSilent({freeCapacity:!this.model.freeCapacity}),this.model._fireChanges(this,"free capacity"))},func:function(){this.buttons.showFreeCapacity=!this.buttons.showFreeCapacity,ysy.data.storage.savePersistentData("showFreeCapacity",this.buttons.showFreeCapacity),this.model.setSilent({freeCapacity:!this.model.freeCapacity}),this.model._fireChanges(this,"free capacity")},isOn:function(){return this.model.freeCapacity},isHidden:function(){return!this.model.open}})},assignee_day_renderer:function(e,t,s,a){for(var r=ysy.pro.resource,i=r.freeCapacity.getGanttLimits(),o="day",n=i.start_date.startOf(o),y=i.end_date.startOf(o).add(1,o);n.isBefore(y);){var d=n.format("YYYY-MM-DD"),c=s.allocations[d]||0,u=t.getMaxHours(d,n);c=u-c,r.assignee_one_day_renderer.call(this,d,n,u,c,t.getEvents(d),s.types[d],a),n.add(1,"days")}},assignee_week_renderer:function(e,t,s,a){for(var r=ysy.pro.resource,i=ysy.settings.zoom.zoom,o=r._weekAllocationSummer(s,i,this._min_date,this._max_date,t),n=o.allocations,y=o.types,d=o.events,c=r.freeCapacity.getGanttLimits(),u=c.start_date.startOf("week"===i?"isoWeek":i);u.isBefore(c.end_date);){var p=u.toISOString(),_=t.getMaxHoursInterval(p,u,i),f=_-(n[p]||0);r.assignee_one_week_renderer.call(this,p,u,_,f,d[p],y[p],a),u.add(1,i)}},getGanttLimits:function(){var e=ysy.data.limits;e.start_date,e.end_date;return{start_date:e.start_date.isBefore(gantt._min_date)?moment(gantt._min_date):moment(e.start_date),end_date:e.end_date.isAfter(gantt._max_date)?moment(gantt._max_date):moment(e.end_date)}}});