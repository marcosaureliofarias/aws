EASY.schedule.require(function(t){"use strict";t(function(){function e(){var e=t(".calculation-header-setting, .calculation-title-editable").editable().wrap('<span class="editable-parent"></span>'),i=t(".calculation-date").editable({emptytext:moment().format(momentjsFormat),emptyclass:""}).wrap('<span class="editable-parent"></span>'),a=t(".calculation-project-discount-editable").editable({type:"discount",params:function(t){return t.value},success:n}).wrap('<span class="editable-parent"></span>');t("<span/>").addClass("icon icon-edit").insertAfter(i).insertAfter(t.merge(t.merge(e,i),a)).click(function(){return t(this).prev().editable("toggle"),!1}),t(".issue-solution-row, .item-solution-row").each(function(){var e=t(this).data(),i=t(".solution-editable",this).editable(t.extend(e,{success:n})).wrap('<span class="editable-parent"></span>'),a=(e=t(this).data(),t(".calculation-discount-editable",this).editable(t.extend(e,{type:"discount",params:function(t){return t.value},success:n})).wrap('<span class="editable-parent"></span>')),s=(e=t(this).data(),t(".calculation-unit-editable",this).editable(t.extend(e,{type:"unit",params:function(t){return t.value},success:n})).wrap('<span class="editable-parent"></span>'));t("<span/>").addClass("icon-edit").insertAfter(t.merge(t.merge(i,a),s)).click(function(){return t(this).prev().editable("toggle"),!1})}),EASY.dragAndDrop.initReorders()}function n(){t("#calculation_container").load(window.location.href+" #calculation_container",function(){t("#calculation_container").children().unwrap(),e()})}function i(){t("#easy_page_layout_service_box").load(window.location.href+" #easy_page_layout_service_box")}function a(){s&&(s.cancel(),s=null)}var s=null;e(),t("#project_is_planned").change(function(){t(this).is(":checked")&&(t("#project-settings-form").submit(),t("#project-settings-container").remove())}),t("#calculation-actions > form").submit(function(){t(this).removeAttr("data-submitted")}),t("a.save-to-revenues").click(function(){var e=t("<div/>"),n={};return e.load(t(this).attr("href")+" .easy-money-expected-revenue-container",function(){t("#money-type-select, p.links, h2",e).hide(),t("form",e).submit(function(){var n=t(this),i=n.serializeArray();return i.push({name:"format",value:"json"}),t.ajax({url:n.attr("action"),type:n.attr("method"),data:i,complete:function(n){if(t(".flash").remove(),422===n.status)t("<div/>").addClass("flash error").html(t.parseJSON(n.responseText).errors.join("\n")).prependTo(e);else e.dialog("close"),t("<div/>").addClass("flash notice").html(window.I18n.saveSuccess).prependTo(t("#content"))}}),!1}),n[window.I18n.buttonCreate]=function(){t("form",e).submit()},n[window.I18n.buttonCancel]=function(){e.dialog("close")},e.dialog({width:700,title:t("h2",e).text(),buttons:n,open:function(){}})}),!1}),t("a.edit-client").on("click",function(){return t("#clicker_easy_contacts_toolbar_container").click(),!1}),t(document).on("click","a.save-calculation",function(){var e=t(this).closest("tr"),a=t("input",e).serializeArray();return t.ajax({url:t(this).attr("href"),type:t(this).attr("data-save-method"),data:a,complete:function(e){var a;e.status>300?(a=t.parseJSON(e.responseText),alert(a.errors.join("\n"))):(s=null,i(),n())}}),!1}),t("a.edit-calculation").on("click",function(){var e=t(this).closest("tr");return a(),t.get(t(this).attr("href"),function(n){var i=t(n);e.replaceWith(i),s={cancel:function(){i.replaceWith(e)}},t("a.cancel-calculation-edit").click(function(){return a(),s=null,!1})}),!1}),t(document).on("click","a.destroy-calculation",function(){return t.ajax({url:t(this).attr("href"),type:"DELETE",complete:function(){n()}}),!1}),t(document).on("click","a.add-calculation",function(){return t.ajax({url:t(this).attr("href"),type:"POST",complete:function(){n()}}),!1}),t("a.edit-issue-calculation").on("click",function(){var e,i,c=t(this).closest("tr"),l=c.html(),r=t(this).attr("href");return a(),s={cancel:function(){c.html(l)}},i=(e=t("td:nth-child(3)",c)).text(),e.empty(),t("<input/>").val(i).attr("id","easy_calculation_item_hours").appendTo(e),i=(e=t("td:nth-child(4)",c)).hasClass("custom-rate")?e.text():"",e.empty(),t("<input/>").val(i).attr("id","easy_calculation_item_rate").appendTo(e),e=t("td:last",c).empty(),t("<a/>").addClass("icon icon-save").appendTo(e).click(function(){return t.ajax({url:r,type:"PUT",data:{issue:{estimated_hours:t("#easy_calculation_item_hours",c).val(),calculation_rate:t("#easy_calculation_item_rate",c).val()}},complete:function(e){var i;e.status>300?(i=t.parseJSON(e.responseText),alert(i.errors.join("\n"))):n()}}),!1}),t("<a>").addClass("icon icon-cancel").appendTo(e).click(function(){return a(),s=null,!1}),!1})});var e=function(t){this.init("discount",t,e.defaults)},n=function(t){this.init("unit",t,n.defaults)};t.fn.editableutils.inherit(e,t.fn.editabletypes.abstractinput),t.fn.editableutils.inherit(n,t.fn.editabletypes.abstractinput),t.extend(e.prototype,{render:function(){var e=t(this.options.scope).data("name").split(","),n=t("#discount_editable");t.each(n.find("input"),function(n,i){t(i).prop("name",e[n].trim())}),this.$tpl.html(t("#discount_editable").html())},input2value:function(){return t("input",this.$input).serialize()},value2input:function(t){var e=t.split(",");return 2===e.length&&(this.$input.find("input.discount-text").val(e[0].trim()),this.$input.find("input.discount-radio1").prop("checked","true"===e[1]),this.$input.find("input.discount-radio2").prop("checked","false"===e[1])),this.$input},value2html:function(){return""}}),t.extend(n.prototype,{render:function(){var e=t(this.options.scope).data("name").split(","),n=t("#unit_editable");t.each(n.find("input"),function(n,i){t(i).prop("name",e[n].trim())}),this.$tpl.html(t("#unit_editable").html())},input2value:function(){return t("input",this.$input).serialize()},value2input:function(t){var e=t.split(",");return 2===e.length&&(this.$input.find("input.value-text").val(e[0].trim()),this.$input.find("input.unit-text").val(e[1].trim())),this.$input},value2html:function(){return""}}),e.defaults=t.extend({},t.fn.editabletypes.abstractinput.defaults,{tpl:'<div class="editable-discount"></div>'}),n.defaults=t.extend({},t.fn.editabletypes.abstractinput.defaults,{tpl:'<div class="editable-unit"></div>'}),t.fn.editabletypes.discount=e,t.fn.editabletypes.unit=n},"jQuery");