(function(){var t=this;(function(){(function(){var t=[].slice;this.ActionCable={INTERNAL:{message_types:{welcome:"welcome",ping:"ping",confirmation:"confirm_subscription",rejection:"reject_subscription"},default_mount_path:"/cable",protocols:["actioncable-v1-json","actioncable-unsupported"]},WebSocket:window.WebSocket,logger:window.console,createConsumer:function(t){var e;return null==t&&(t=null!=(e=this.getConfig("url"))?e:this.INTERNAL.default_mount_path),new n.Consumer(this.createWebSocketURL(t))},getConfig:function(t){var n;return null!=(n=document.head.querySelector("meta[name='action-cable-"+t+"']"))?n.getAttribute("content"):void 0},createWebSocketURL:function(t){var n;return t&&!/^wss?:/i.test(t)?((n=document.createElement("a")).href=t,n.href=n.href,n.protocol=n.protocol.replace("http","ws"),n.href):t},startDebugging:function(){return this.debugging=!0},stopDebugging:function(){return this.debugging=null},log:function(){var n,e;if(n=1<=arguments.length?t.call(arguments,0):[],this.debugging)return n.push(Date.now()),(e=this.logger).log.apply(e,["[ActionCable]"].concat(t.call(n)))}}}).call(this)}).call(t);var n=t.ActionCable;(function(){(function(){var t=function(t,n){return function(){return t.apply(n,arguments)}};n.ConnectionMonitor=function(){function e(n){this.connection=n,this.visibilityDidChange=t(this.visibilityDidChange,this),this.reconnectAttempts=0}var i,o,r;return e.pollInterval={min:3,max:30},e.staleThreshold=6,e.prototype.start=function(){if(!this.isRunning())return this.startedAt=o(),delete this.stoppedAt,this.startPolling(),document.addEventListener("visibilitychange",this.visibilityDidChange),n.log("ConnectionMonitor started. pollInterval = "+this.getPollInterval()+" ms")},e.prototype.stop=function(){if(this.isRunning())return this.stoppedAt=o(),this.stopPolling(),document.removeEventListener("visibilitychange",this.visibilityDidChange),n.log("ConnectionMonitor stopped")},e.prototype.isRunning=function(){return null!=this.startedAt&&null==this.stoppedAt},e.prototype.recordPing=function(){return this.pingedAt=o()},e.prototype.recordConnect=function(){return this.reconnectAttempts=0,this.recordPing(),delete this.disconnectedAt,n.log("ConnectionMonitor recorded connect")},e.prototype.recordDisconnect=function(){return this.disconnectedAt=o(),n.log("ConnectionMonitor recorded disconnect")},e.prototype.startPolling=function(){return this.stopPolling(),this.poll()},e.prototype.stopPolling=function(){return clearTimeout(this.pollTimeout)},e.prototype.poll=function(){return this.pollTimeout=setTimeout((t=this,function(){return t.reconnectIfStale(),t.poll()}),this.getPollInterval());var t},e.prototype.getPollInterval=function(){var t,n,e,o;return e=(o=this.constructor.pollInterval).min,n=o.max,t=5*Math.log(this.reconnectAttempts+1),Math.round(1e3*i(t,e,n))},e.prototype.reconnectIfStale=function(){if(this.connectionIsStale())return n.log("ConnectionMonitor detected stale connection. reconnectAttempts = "+this.reconnectAttempts+", pollInterval = "+this.getPollInterval()+" ms, time disconnected = "+r(this.disconnectedAt)+" s, stale threshold = "+this.constructor.staleThreshold+" s"),this.reconnectAttempts++,this.disconnectedRecently()?n.log("ConnectionMonitor skipping reopening recent disconnect"):(n.log("ConnectionMonitor reopening"),this.connection.reopen())},e.prototype.connectionIsStale=function(){var t;return r(null!=(t=this.pingedAt)?t:this.startedAt)>this.constructor.staleThreshold},e.prototype.disconnectedRecently=function(){return this.disconnectedAt&&r(this.disconnectedAt)<this.constructor.staleThreshold},e.prototype.visibilityDidChange=function(){if("visible"===document.visibilityState)return setTimeout((t=this,function(){if(t.connectionIsStale()||!t.connection.isOpen())return n.log("ConnectionMonitor reopening stale connection on visibilitychange. visbilityState = "+document.visibilityState),t.connection.reopen()}),200);var t},o=function(){return(new Date).getTime()},r=function(t){return(o()-t)/1e3},i=function(t,n,e){return Math.max(n,Math.min(e,t))},e}()}).call(this),function(){var t,e,i,o,r,s=[].slice,c=function(t,n){return function(){return t.apply(n,arguments)}},u=[].indexOf||function(t){for(var n=0,e=this.length;n<e;n++)if(n in this&&this[n]===t)return n;return-1};o=n.INTERNAL,e=o.message_types,i=o.protocols,r=2<=i.length?s.call(i,0,t=i.length-1):(t=0,[]),i[t++],n.Connection=function(){function t(t){this.consumer=t,this.open=c(this.open,this),this.subscriptions=this.consumer.subscriptions,this.monitor=new n.ConnectionMonitor(this),this.disconnected=!0}return t.reopenDelay=500,t.prototype.send=function(t){return!!this.isOpen()&&(this.webSocket.send(JSON.stringify(t)),!0)},t.prototype.open=function(){return this.isActive()?(n.log("Attempted to open WebSocket, but existing socket is "+this.getState()),!1):(n.log("Opening WebSocket, current state is "+this.getState()+", subprotocols: "+i),null!=this.webSocket&&this.uninstallEventHandlers(),this.webSocket=new n.WebSocket(this.consumer.url,i),this.installEventHandlers(),this.monitor.start(),!0)},t.prototype.close=function(t){var n;if((null!=t?t:{allowReconnect:!0}).allowReconnect||this.monitor.stop(),this.isActive())return null!=(n=this.webSocket)?n.close():void 0},t.prototype.reopen=function(){var t;if(n.log("Reopening WebSocket, current state is "+this.getState()),!this.isActive())return this.open();try{return this.close()}catch(e){return t=e,n.log("Failed to reopen WebSocket",t)}finally{n.log("Reopening WebSocket in "+this.constructor.reopenDelay+"ms"),setTimeout(this.open,this.constructor.reopenDelay)}},t.prototype.getProtocol=function(){var t;return null!=(t=this.webSocket)?t.protocol:void 0},t.prototype.isOpen=function(){return this.isState("open")},t.prototype.isActive=function(){return this.isState("open","connecting")},t.prototype.isProtocolSupported=function(){var t;return t=this.getProtocol(),u.call(r,t)>=0},t.prototype.isState=function(){var t,n;return n=1<=arguments.length?s.call(arguments,0):[],t=this.getState(),u.call(n,t)>=0},t.prototype.getState=function(){var t,n;for(n in WebSocket)if(WebSocket[n]===(null!=(t=this.webSocket)?t.readyState:void 0))return n.toLowerCase();return null},t.prototype.installEventHandlers=function(){var t,n;for(t in this.events)n=this.events[t].bind(this),this.webSocket["on"+t]=n},t.prototype.uninstallEventHandlers=function(){var t;for(t in this.events)this.webSocket["on"+t]=function(){}},t.prototype.events={message:function(t){var n,i,o;if(this.isProtocolSupported())switch(n=(o=JSON.parse(t.data)).identifier,i=o.message,o.type){case e.welcome:return this.monitor.recordConnect(),this.subscriptions.reload();case e.ping:return this.monitor.recordPing();case e.confirmation:return this.subscriptions.notify(n,"connected");case e.rejection:return this.subscriptions.reject(n);default:return this.subscriptions.notify(n,"received",i)}},open:function(){if(n.log("WebSocket onopen event, using '"+this.getProtocol()+"' subprotocol"),this.disconnected=!1,!this.isProtocolSupported())return n.log("Protocol is unsupported. Stopping monitor and disconnecting."),this.close({allowReconnect:!1})},close:function(){if(n.log("WebSocket onclose event"),!this.disconnected)return this.disconnected=!0,this.monitor.recordDisconnect(),this.subscriptions.notifyAll("disconnected",{willAttemptReconnect:this.monitor.isRunning()})},error:function(){return n.log("WebSocket onerror event")}},t}()}.call(this),function(){var t=[].slice;n.Subscriptions=function(){function e(t){this.consumer=t,this.subscriptions=[]}return e.prototype.create=function(t,e){var i,o,r;return o="object"==typeof(i=t)?i:{channel:i},r=new n.Subscription(this.consumer,o,e),this.add(r)},e.prototype.add=function(t){return this.subscriptions.push(t),this.consumer.ensureActiveConnection(),this.notify(t,"initialized"),this.sendCommand(t,"subscribe"),t},e.prototype.remove=function(t){return this.forget(t),this.findAll(t.identifier).length||this.sendCommand(t,"unsubscribe"),t},e.prototype.reject=function(t){var n,e,i,o,r;for(o=[],n=0,e=(i=this.findAll(t)).length;n<e;n++)r=i[n],this.forget(r),this.notify(r,"rejected"),o.push(r);return o},e.prototype.forget=function(t){var n;return this.subscriptions=function(){var e,i,o,r;for(r=[],e=0,i=(o=this.subscriptions).length;e<i;e++)(n=o[e])!==t&&r.push(n);return r}.call(this),t},e.prototype.findAll=function(t){var n,e,i,o,r;for(o=[],n=0,e=(i=this.subscriptions).length;n<e;n++)(r=i[n]).identifier===t&&o.push(r);return o},e.prototype.reload=function(){var t,n,e,i,o;for(i=[],t=0,n=(e=this.subscriptions).length;t<n;t++)o=e[t],i.push(this.sendCommand(o,"subscribe"));return i},e.prototype.notifyAll=function(){var n,e,i,o,r,s,c;for(e=arguments[0],n=2<=arguments.length?t.call(arguments,1):[],s=[],i=0,o=(r=this.subscriptions).length;i<o;i++)c=r[i],s.push(this.notify.apply(this,[c,e].concat(t.call(n))));return s},e.prototype.notify=function(){var n,e,i,o,r,s,c;for(s=arguments[0],e=arguments[1],n=3<=arguments.length?t.call(arguments,2):[],r=[],i=0,o=(c="string"==typeof s?this.findAll(s):[s]).length;i<o;i++)s=c[i],r.push("function"==typeof s[e]?s[e].apply(s,n):void 0);return r},e.prototype.sendCommand=function(t,n){var e;return e=t.identifier,this.consumer.send({command:n,identifier:e})},e}()}.call(this),function(){n.Subscription=function(){function t(t,e,i){this.consumer=t,null==e&&(e={}),this.identifier=JSON.stringify(e),n(this,i)}var n;return t.prototype.perform=function(t,n){return null==n&&(n={}),n.action=t,this.send(n)},t.prototype.send=function(t){return this.consumer.send({command:"message",identifier:this.identifier,data:JSON.stringify(t)})},t.prototype.unsubscribe=function(){return this.consumer.subscriptions.remove(this)},n=function(t,n){var e,i;if(null!=n)for(e in n)i=n[e],t[e]=i;return t},t}()}.call(this),function(){n.Consumer=function(){function t(t){this.url=t,this.subscriptions=new n.Subscriptions(this),this.connection=new n.Connection(this)}return t.prototype.send=function(t){return this.connection.send(t)},t.prototype.connect=function(){return this.connection.open()},t.prototype.disconnect=function(){return this.connection.close({allowReconnect:!1})},t.prototype.ensureActiveConnection=function(){if(!this.connection.isActive())return this.connection.open()},t}()}.call(this)}).call(this),"object"==typeof module&&module.exports?module.exports=n:"function"==typeof define&&define.amd&&define(n)}).call(this),document.addEventListener("DOMContentLoaded",function(){App.easy_user_channel=App.cable.subscriptions.create({channel:"EasyUserChannel"},{received:function(t){(new window.EasyChannelHelper).doSomething(t)},initialized:function(){this.update=this.update.bind(this)},connected:function(){this.install(),this.update(),easyUserChannelConnected&&easyUserChannelConnected(this)},disconnected:function(){this.uninstall()},rejected:function(){this.uninstall()},update:function(){this.documentIsActive()&&this.appear()},appear:function(){this.perform("appear",{appearing_on:this.appearingOn()})},away:function(){this.perform("away")},dnd:function(){this.perform("dnd")},invisible:function(){this.perform("invisible")},install:function(){window.addEventListener("focus",this.update),window.addEventListener("blur",this.update)},uninstall:function(){window.removeEventListener("focus",this.update),window.removeEventListener("blur",this.update)},documentIsActive:function(){return"visible"==document.visibilityState&&document.hasFocus()},appearingOn:function(){const t=document.querySelector("[data-appearing-on]");return t?t.getAttribute("data-appearing-on"):null}})}),function(){this.App||(this.App={}),App.cable=ActionCable.createConsumer()}.call(this);