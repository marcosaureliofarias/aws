!function(e){var i="input, select, textarea";window.prepareFields=function(){e(".field").each(function(){var n=e(this),t=n.find(".value, .actions"),s=n.find(".mode").find(i),a=function(){var n=s.val(),a=["any","some","none","is_me","is_not_me","is_public","for_me"];e.inArray(n,a)>=0?(t.hide(),t.find(i).attr("disabled","disabled")):(t.show(),t.find(i).removeAttr("disabled"))};a(),s.change(function(){a()});var d=n.find(".value").find(i);t.filter(".actions").find("a.select_all, a.unselect_all").click(function(){var i=e(this),n=d.children();if(!d.is(":disabled")){var t=!1;n.each(function(){var n=e(this),s=n.is(":selected");i.is(".select_all")?s||(n.attr("selected","selected"),t=!0):s&&(n.removeAttr("selected"),t=!0)}),t&&d.trigger("change")}return!1})})},window.determineOtherFieldsVisibility=function(n,t){var s=e(n),a=s.closest(".field"),d=(t?e(t):a).closest(".fields").find(".field").not(a),l=function(){switch(s.val()){case"any":case"none":d.find(i).filter(":visible").attr("disabled","disabled"),d.hide();break;default:d.show(),d.find(i).filter(":visible").removeAttr("disabled")}};l(),s.change(function(){l()})},window.suggestibleOptions=function(i){return{ajax:{suggestions:{url:i.suggestionsUrl,dataType:"json",data:function(e,i){var n={query:e},t=i.recordIdsInBits(i.elements.bitsBox);return t.length>0&&(n.except_ids=t),n},loading:function(i){e("#ajax-indicator").show(),i.elements.textBox.attr("disabled","disabled")},loaded:function(i){e("#ajax-indicator").hide(),i.elements.textBox.removeAttr("disabled")}},bits:{url:i.bitsUrl,dataType:"json",data:function(e){return{ids:e.val()}},loading:function(){},loaded:function(e){e.elements.bitsBox.hide().fadeIn("fast")},allLoaded:function(){}}},dependencies:function(e){var i=e.elements.inputContainer.closest(".fields").find(".field.type"),n=i.find(".column.mode select"),t=i.find(".column.value select"),s=[];return n&&s.push(n),t&&s.push(t),s},layout:{containers:function(e,i){return new SuggestBoxContainers(e,i)},items:i.suggestionsLayout},primaryKeyFromRecord:function(e){return e.id},primaryKeyFromSelectOption:function(e){return e.val()}}}}(jQuery);