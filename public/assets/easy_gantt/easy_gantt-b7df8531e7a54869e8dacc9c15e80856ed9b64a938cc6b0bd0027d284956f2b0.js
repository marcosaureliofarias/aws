function dhtmlxDetachEvent(t,e,n){t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent&&t.detachEvent("on"+e,n)}function dhtmlxDnD(t,e){e&&(this._settings=e),dhtmlxEventable(this),dhtmlxEvent(t,"mousedown",dhtmlx.bind(function(n){e.original_target={target:n.target||n.srcElement},this.dragStart(t,n)},this))}function dataProcessor(t){return this.serverProcessor=t,this.action_param="!nativeeditor_status",this.object=null,this.updatedRows=[],this.autoUpdate=!0,this.updateMode="cell",this._tMode="GET",this._headers=null,this._payload=null,this.post_delim="_",this._waitMode=0,this._in_progress={},this._invalid={},this.mandatoryFields=[],this.messages=[],this.styles={updated:"font-weight:bold;",inserted:"font-weight:bold;",deleted:"text-decoration : line-through;",invalid:"background-color:FFE0E0;",invalid_cell:"border-bottom:2px solid red;",error:"color:red;",clear:"font-weight:normal;text-decoration:none;"},this.enableUTFencoding(!0),dhx4._eventable(this),this}!function(t,e){"object"==typeof exports&&exports?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Mustache={})}(this,function(t){function e(t){return"function"==typeof t}function n(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(t,e){return g.call(t,e)}function s(t){return!i(f,t)}function a(t){return String(t).replace(/[&<>"'\/]/g,function(t){return p[t]})}function r(e,i){function a(){if(x&&!b)for(;p.length;)delete f[p.pop()];else p=[];x=!1,b=!1}function r(t){if("string"==typeof t&&(t=t.split(m,2)),!_(t)||2!==t.length)throw new Error("Invalid tags: "+t);h=new RegExp(n(t[0])+"\\s*"),c=new RegExp("\\s*"+n(t[1])),u=new RegExp("\\s*"+n("}"+t[1]))}if(!e)return[];var h,c,u,g=[],f=[],p=[],x=!1,b=!1;r(i||t.tags);for(var T,D,M,C,E,S,$=new l(e);!$.eos();){if(T=$.pos,M=$.scanUntil(h))for(var P=0,j=M.length;P<j;++P)s(C=M.charAt(P))?p.push(f.length):b=!0,f.push(["text",C,T,T+1]),T+=1,"\n"===C&&a();if(!$.scan(h))break;if(x=!0,D=$.scan(k)||"name",$.scan(y),"="===D?(M=$.scanUntil(v),$.scan(v),$.scanUntil(c)):"{"===D?(M=$.scanUntil(u),$.scan(w),$.scanUntil(c),D="&"):M=$.scanUntil(c),!$.scan(c))throw new Error("Unclosed tag at "+$.pos);if(E=[D,M,T,$.pos],f.push(E),"#"===D||"^"===D)g.push(E);else if("/"===D){if(!(S=g.pop()))throw new Error('Unopened section "'+M+'" at '+T);if(S[1]!==M)throw new Error('Unclosed section "'+S[1]+'" at '+T)}else"name"===D||"{"===D||"&"===D?b=!0:"="===D&&r(M)}if(S=g.pop())throw new Error('Unclosed section "'+S[1]+'" at '+$.pos);return d(o(f))}function o(t){for(var e,n,i=[],s=0,a=t.length;s<a;++s)(e=t[s])&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(i.push(e),n=e));return i}function d(t){for(var e,n=[],i=n,s=[],a=0,r=t.length;a<r;++a)switch((e=t[a])[0]){case"#":case"^":i.push(e),s.push(e),i=e[4]=[];break;case"/":s.pop()[5]=e[2],i=s.length>0?s[s.length-1][4]:n;break;default:i.push(e)}return n}function l(t){this.string=t,this.tail=t,this.pos=0}function h(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function c(){this.cache={}}var u=Object.prototype.toString,_=Array.isArray||function(t){return"[object Array]"===u.call(t)},g=RegExp.prototype.test,f=/\S/,p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},y=/\s*/,m=/\s+/,v=/\s*=/,w=/\s*\}/,k=/#|\^|\/|>|\{|&|=|!/;l.prototype.eos=function(){return""===this.tail},l.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},l.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=e.length,e},h.prototype.push=function(t){return new h(t,this)},h.prototype.lookup=function(t){var n,i=this.cache;if(t in i)n=i[t];else{for(var s,a,r=this,o=!1;r;){if(t.indexOf(".")>0)for(n=r.view,s=t.split("."),a=0;null!=n&&a<s.length;)a===s.length-1&&null!=n&&(o="object"==typeof n&&n.hasOwnProperty(s[a])),n=n[s[a++]];else null!=r.view&&"object"==typeof r.view&&(n=r.view[t],o=r.view.hasOwnProperty(t));if(o)break;r=r.parent}i[t]=n}return e(n)&&(n=n.call(this.view)),n},c.prototype.clearCache=function(){this.cache={}},c.prototype.parse=function(t,e){var n=this.cache,i=n[t];return null==i&&(i=n[t]=r(t,e)),i},c.prototype.render=function(t,e,n){var i=this.parse(t),s=e instanceof h?e:new h(e);return this.renderTokens(i,s,n,t)},c.prototype.renderTokens=function(t,e,n,i){for(var s,a,r,o="",d=0,l=t.length;d<l;++d)r=undefined,"#"===(a=(s=t[d])[0])?r=this._renderSection(s,e,n,i):"^"===a?r=this._renderInverted(s,e,n,i):">"===a?r=this._renderPartial(s,e,n,i):"&"===a?r=this._unescapedValue(s,e):"name"===a?r=this._escapedValue(s,e):"text"===a&&(r=this._rawValue(s)),r!==undefined&&(o+=r);return o},c.prototype._renderSection=function(t,n,i,s){function a(t){return r.render(t,n,i)}var r=this,o="",d=n.lookup(t[1]);if(d){if(_(d))for(var l=0,h=d.length;l<h;++l)o+=this.renderTokens(t[4],n.push(d[l]),i,s);else if("object"==typeof d||"string"==typeof d||"number"==typeof d)o+=this.renderTokens(t[4],n.push(d),i,s);else if(e(d)){if("string"!=typeof s)throw new Error("Cannot use higher-order sections without the original template");null!=(d=d.call(n.view,s.slice(t[3],t[5]),a))&&(o+=d)}else o+=this.renderTokens(t[4],n,i,s);return o}},c.prototype._renderInverted=function(t,e,n,i){var s=e.lookup(t[1]);if(!s||_(s)&&0===s.length)return this.renderTokens(t[4],e,n,i)},c.prototype._renderPartial=function(t,n,i){if(i){var s=e(i)?i(t[1]):i[t[1]];return null!=s?this.renderTokens(this.parse(s),n,i,s):void 0}},c.prototype._unescapedValue=function(t,e){var n=e.lookup(t[1]);if(null!=n)return n},c.prototype._escapedValue=function(e,n){var i=n.lookup(e[1]);if(null!=i)return t.escape(i)},c.prototype._rawValue=function(t){return t[1]},t.name="mustache.js",t.version="2.0.0",t.tags=["{{","}}"];var x=new c;t.clearCache=function(){return x.clearCache()},t.parse=function(t,e){return x.parse(t,e)},t.render=function(t,e,n){return x.render(t,e,n)},t.to_html=function(n,i,s,a){var r=t.render(n,i,s);if(!e(a))return r;a(r)},t.escape=a,t.Scanner=l,t.Context=h,t.Writer=c}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Mustache=e()}(this,function(){"use strict";function t(t){return"function"==typeof t}function e(t){return f(t)?"array":typeof t}function n(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(t,e){return null!=t&&"object"==typeof t&&e in t}function s(t,e){return null!=t&&"object"!=typeof t&&t.hasOwnProperty&&t.hasOwnProperty(e)}function a(t,e){return p.call(t,e)}function r(t){return!a(y,t)}function o(t){return String(t).replace(/[&<>"'`=\/]/g,function(t){return m[t]})}function d(t,e){function i(){if(y&&!m)for(;p.length;)delete g[p.pop()];else p=[];y=!1,m=!1}function s(t){if("string"==typeof t&&(t=t.split(w,2)),!f(t)||2!==t.length)throw new Error("Invalid tags: "+t);a=new RegExp(n(t[0])+"\\s*"),o=new RegExp("\\s*"+n(t[1])),d=new RegExp("\\s*"+n("}"+t[1]))}if(!t)return[];var a,o,d,u=!1,_=[],g=[],p=[],y=!1,m=!1,D="",M=0;s(e||T.tags);for(var C,E,S,$,P,j,A=new c(t);!A.eos();){if(C=A.pos,S=A.scanUntil(a))for(var L=0,O=S.length;L<O;++L)r($=S.charAt(L))?(p.push(g.length),D+=$):(m=!0,u=!0,D+=" "),g.push(["text",$,C,C+1]),C+=1,"\n"===$&&(i(),D="",M=0,u=!1);if(!A.scan(a))break;if(y=!0,E=A.scan(b)||"name",A.scan(v),"="===E?(S=A.scanUntil(k),A.scan(k),A.scanUntil(o)):"{"===E?(S=A.scanUntil(d),A.scan(x),A.scanUntil(o),E="&"):S=A.scanUntil(o),!A.scan(o))throw new Error("Unclosed tag at "+A.pos);if(P=">"==E?[E,S,C,A.pos,D,M,u]:[E,S,C,A.pos],M++,g.push(P),"#"===E||"^"===E)_.push(P);else if("/"===E){if(!(j=_.pop()))throw new Error('Unopened section "'+S+'" at '+C);if(j[1]!==S)throw new Error('Unclosed section "'+j[1]+'" at '+C)}else"name"===E||"{"===E||"&"===E?m=!0:"="===E&&s(S)}if(i(),j=_.pop())throw new Error('Unclosed section "'+j[1]+'" at '+A.pos);return h(l(g))}function l(t){for(var e,n,i=[],s=0,a=t.length;s<a;++s)(e=t[s])&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(i.push(e),n=e));return i}function h(t){for(var e,n=[],i=n,s=[],a=0,r=t.length;a<r;++a)switch((e=t[a])[0]){case"#":case"^":i.push(e),s.push(e),i=e[4]=[];break;case"/":s.pop()[5]=e[2],i=s.length>0?s[s.length-1][4]:n;break;default:i.push(e)}return n}function c(t){this.string=t,this.tail=t,this.pos=0}function u(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function _(){this.templateCache={_cache:{},set:function(t,e){this._cache[t]=e},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}var g=Object.prototype.toString,f=Array.isArray||function(t){return"[object Array]"===g.call(t)},p=RegExp.prototype.test,y=/\S/,m={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},v=/\s*/,w=/\s+/,k=/\s*=/,x=/\s*\}/,b=/#|\^|\/|>|\{|&|=|!/;c.prototype.eos=function(){return""===this.tail},c.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},c.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=e.length,e},u.prototype.push=function(t){return new u(t,this)},u.prototype.lookup=function(e){var n,a=this.cache;if(a.hasOwnProperty(e))n=a[e];else{for(var r,o,d,l=this,h=!1;l;){if(e.indexOf(".")>0)for(r=l.view,o=e.split("."),d=0;null!=r&&d<o.length;)d===o.length-1&&(h=i(r,o[d])||s(r,o[d])),r=r[o[d++]];else r=l.view[e],h=i(l.view,e);if(h){n=r;break}l=l.parent}a[e]=n}return t(n)&&(n=n.call(this.view)),n},_.prototype.clearCache=function(){"undefined"!=typeof this.templateCache&&this.templateCache.clear()},_.prototype.parse=function(t,e){var n=this.templateCache,i=t+":"+(e||T.tags).join(":"),s=void 0!==n,a=s?n.get(i):undefined;return a==undefined&&(a=d(t,e),s&&n.set(i,a)),a},_.prototype.render=function(t,e,n,i){var s=this.parse(t,i),a=e instanceof u?e:new u(e,undefined);return this.renderTokens(s,a,n,t,i)},_.prototype.renderTokens=function(t,e,n,i,s){for(var a,r,o,d="",l=0,h=t.length;l<h;++l)o=undefined,"#"===(r=(a=t[l])[0])?o=this.renderSection(a,e,n,i):"^"===r?o=this.renderInverted(a,e,n,i):">"===r?o=this.renderPartial(a,e,n,s):"&"===r?o=this.unescapedValue(a,e):"name"===r?o=this.escapedValue(a,e):"text"===r&&(o=this.rawValue(a)),o!==undefined&&(d+=o);return d},_.prototype.renderSection=function(e,n,i,s){function a(t){return r.render(t,n,i)}var r=this,o="",d=n.lookup(e[1]);if(d){if(f(d))for(var l=0,h=d.length;l<h;++l)o+=this.renderTokens(e[4],n.push(d[l]),i,s);else if("object"==typeof d||"string"==typeof d||"number"==typeof d)o+=this.renderTokens(e[4],n.push(d),i,s);else if(t(d)){if("string"!=typeof s)throw new Error("Cannot use higher-order sections without the original template");null!=(d=d.call(n.view,s.slice(e[3],e[5]),a))&&(o+=d)}else o+=this.renderTokens(e[4],n,i,s);return o}},_.prototype.renderInverted=function(t,e,n,i){var s=e.lookup(t[1]);if(!s||f(s)&&0===s.length)return this.renderTokens(t[4],e,n,i)},_.prototype.indentPartial=function(t,e,n){for(var i=e.replace(/[^ \t]/g,""),s=t.split("\n"),a=0;a<s.length;a++)s[a].length&&(a>0||!n)&&(s[a]=i+s[a]);return s.join("\n")},_.prototype.renderPartial=function(e,n,i,s){if(i){var a=t(i)?i(e[1]):i[e[1]];if(null!=a){var r=e[6],o=e[5],d=e[4],l=a;return 0==o&&d&&(l=this.indentPartial(a,d,r)),this.renderTokens(this.parse(l,s),n,i,l,s)}}},_.prototype.unescapedValue=function(t,e){var n=e.lookup(t[1]);if(null!=n)return n},_.prototype.escapedValue=function(t,e){var n=e.lookup(t[1]);if(null!=n)return T.escape(n)},_.prototype.rawValue=function(t){return t[1]};var T={name:"mustache.js",version:"4.0.1",tags:["{{","}}"],clearCache:undefined,escape:undefined,parse:undefined,render:undefined,Scanner:undefined,Context:undefined,Writer:undefined,set templateCache(t){D.templateCache=t},get templateCache(){return D.templateCache}},D=new _;return T.clearCache=function(){return D.clearCache()},T.parse=function(t,e){return D.parse(t,e)},T.render=function(t,n,i,s){if("string"!=typeof t)throw new TypeError('Invalid template! Template should be a "string" but "'+e(t)+'" was given as the first argument for mustache#render(template, view, partials)');return D.render(t,n,i,s)},T.escape=o,T.Scanner=c,T.Context=u,T.Writer=_,T}),function(t,e){"function"==typeof define&&define.amd?define(function(){return e(t,t.document)}):"object"==typeof exports?module.exports=t.document?e(t,t.document):function(t){return e(t,t.document)}:t.SVG=e(t,t.document)}("undefined"!=typeof window?window:this,function(t,e){function n(t,e){return t instanceof e}function i(t,e){return(t.matches||t.matchesSelector||t.msMatchesSelector||t.mozMatchesSelector||t.webkitMatchesSelector||t.oMatchesSelector).call(t,e)}function s(t){return t.toLowerCase().replace(/-(.)/g,function(t,e){return e.toUpperCase()})}function a(t){return t.charAt(0).toUpperCase()+t.slice(1)}function r(t){return 4==t.length?["#",t.substring(1,2),t.substring(1,2),t.substring(2,3),t.substring(2,3),t.substring(3,4),t.substring(3,4)].join(""):t}function o(t){var e=t.toString(16);return 1==e.length?"0"+e:e}function d(t,e,n){if(null==e||null==n){var i=t.bbox();null==e?e=i.width/i.height*n:null==n&&(n=i.height/i.width*e)}return{width:e,height:n}}function l(t,e,n){return{x:e*t.a+n*t.c+0,y:e*t.b+n*t.d+0}}function h(t){return{a:t[0],b:t[1],c:t[2],d:t[3],e:t[4],f:t[5]}}function c(t){return t instanceof m.Matrix||(t=new m.Matrix(t)),t}function u(t,e){t.cx=null==t.cx?e.bbox().cx:t.cx,t.cy=null==t.cy?e.bbox().cy:t.cy}function _(t){return t=t.replace(m.regex.whitespace,"").replace(m.regex.matrix,"").split(m.regex.matrixElements),h(m.utils.map(t,function(t){return parseFloat(t)}))}function g(t){for(var e=0,n=t.length,i="";e<n;e++)i+=t[e][0],null!=t[e][1]&&(i+=t[e][1],null!=t[e][2]&&(i+=" ",i+=t[e][2],null!=t[e][3]&&(i+=" ",i+=t[e][3],i+=" ",i+=t[e][4],null!=t[e][5]&&(i+=" ",i+=t[e][5],i+=" ",i+=t[e][6],null!=t[e][7]&&(i+=" ",i+=t[e][7])))));return i+" "}function f(t){for(var e=t.childNodes.length-1;e>=0;e--)t.childNodes[e]instanceof SVGElement&&f(t.childNodes[e]);return m.adopt(t).id(m.eid(t.nodeName))}function p(t){return null==t.x&&(t.x=0,t.y=0,t.width=0,t.height=0),t.w=t.width,t.h=t.height,t.x2=t.x+t.width,t.y2=t.y+t.height,t.cx=t.x+t.width/2,t.cy=t.y+t.height/2,t}function y(t){var e=t.toString().match(m.regex.reference);if(e)return e[1]}var m=this.SVG=function(t){if(m.supported)return t=new m.Doc(t),m.parser.draw||m.prepare(),t};if(m.ns="http://www.w3.org/2000/svg",m.xmlns="http://www.w3.org/2000/xmlns/",m.xlink="http://www.w3.org/1999/xlink",m.svgjs="http://svgjs.com/svgjs",m.supported=!!e.createElementNS&&!!e.createElementNS(m.ns,"svg").createSVGRect,!m.supported)return!1;m.did=1e3,m.eid=function(t){return"Svgjs"+a(t)+m.did++},m.create=function(t){var n=e.createElementNS(this.ns,t);return n.setAttribute("id",this.eid(t)),n},m.extend=function(){var t,e,n,i;for(e=(t=[].slice.call(arguments)).pop(),i=t.length-1;i>=0;i--)if(t[i])for(n in e)t[i].prototype[n]=e[n];m.Set&&m.Set.inherit&&m.Set.inherit()},m.invent=function(t){var e="function"==typeof t.create?t.create:function(){this.constructor.call(this,m.create(t.create))};return t.inherit&&(e.prototype=new t.inherit),t.extend&&m.extend(e,t.extend),t.construct&&m.extend(t.parent||m.Container,t.construct),e},m.adopt=function(t){return t?t.instance?t.instance:((e="svg"==t.nodeName?t.parentNode instanceof SVGElement?new m.Nested:new m.Doc:"linearGradient"==t.nodeName?new m.Gradient("linear"):"radialGradient"==t.nodeName?new m.Gradient("radial"):m[a(t.nodeName)]?new(m[a(t.nodeName)]):new m.Element(t)).type=t.nodeName,e.node=t,t.instance=e,e instanceof m.Doc&&e.namespace().defs(),e.setData(JSON.parse(t.getAttribute("svgjs:data"))||{}),e):null;var e},m.prepare=function(){var t=e.getElementsByTagName("body")[0],n=(t?new m.Doc(t):new m.Doc(e.documentElement).nested()).size(2,0);m.parser={body:t||e.documentElement,draw:n.style("opacity:0;position:fixed;left:100%;top:100%;overflow:hidden"),poly:n.polyline().node,path:n.path().node,native:m.create("svg")}},m.parser={native:m.create("svg")},e.addEventListener("DOMContentLoaded",function(){m.parser.draw||m.prepare()},!1),m.regex={numberAndUnit:/^([+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?)([a-z%]*)$/i,hex:/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,rgb:/rgb\((\d+),(\d+),(\d+)\)/,reference:/#([a-z0-9\-_]+)/i,matrix:/matrix\(|\)/g,matrixElements:/,*\s+|,/,whitespace:/\s/g,isHex:/^#[a-f0-9]{3,6}$/i,isRgb:/^rgb\(/,isCss:/[^:]+:[^;]+;?/,isBlank:/^(\s+)?$/,isNumber:/^[+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,isPercent:/^-?[\d\.]+%$/,isImage:/\.(jpg|jpeg|png|gif|svg)(\?[^=]+.*)?/i,negExp:/e\-/gi,comma:/,/g,hyphen:/\-/g,pathLetters:/[MLHVCSQTAZ]/gi,isPathLetter:/[MLHVCSQTAZ]/i,whitespaces:/\s+/,X:/X/g},m.utils={map:function(t,e){var n,i=t.length,s=[];for(n=0;n<i;n++)s.push(e(t[n]));return s},filter:function(t,e){var n,i=t.length,s=[];for(n=0;n<i;n++)e(t[n])&&s.push(t[n]);return s},radians:function(t){return t%360*Math.PI/180},degrees:function(t){return 180*t/Math.PI%360},filterSVGElements:function(t){return this.filter(t,function(t){return t instanceof SVGElement})}},m.defaults={attrs:{"fill-opacity":1,"stroke-opacity":1,"stroke-width":0,"stroke-linejoin":"miter","stroke-linecap":"butt",fill:"#000000",stroke:"#000000",opacity:1,x:0,y:0,cx:0,cy:0,width:0,height:0,r:0,rx:0,ry:0,offset:0,"stop-opacity":1,"stop-color":"#000000","font-size":16,"font-family":"Helvetica, Arial, sans-serif","text-anchor":"start"}},m.Color=function(t){var e;this.r=0,this.g=0,this.b=0,t&&("string"==typeof t?m.regex.isRgb.test(t)?(e=m.regex.rgb.exec(t.replace(/\s/g,"")),this.r=parseInt(e[1]),this.g=parseInt(e[2]),this.b=parseInt(e[3])):m.regex.isHex.test(t)&&(e=m.regex.hex.exec(r(t)),this.r=parseInt(e[1],16),this.g=parseInt(e[2],16),this.b=parseInt(e[3],16)):"object"==typeof t&&(this.r=t.r,this.g=t.g,this.b=t.b))},m.extend(m.Color,{toString:function(){return this.toHex()},toHex:function(){return"#"+o(this.r)+o(this.g)+o(this.b)},toRgb:function(){return"rgb("+[this.r,this.g,this.b].join()+")"},brightness:function(){return this.r/255*.3+this.g/255*.59+this.b/255*.11},morph:function(t){return this.destination=new m.Color(t),this},at:function(t){return this.destination?(t=t<0?0:t>1?1:t,new m.Color({r:~~(this.r+(this.destination.r-this.r)*t),g:~~(this.g+(this.destination.g-this.g)*t),b:~~(this.b+(this.destination.b-this.b)*t)})):this}}),m.Color.test=function(t){return t+="",m.regex.isHex.test(t)||m.regex.isRgb.test(t)},m.Color.isRgb=function(t){return t&&"number"==typeof t.r&&"number"==typeof t.g&&"number"==typeof t.b},m.Color.isColor=function(t){return m.Color.isRgb(t)||m.Color.test(t)},m.Array=function(t,e){0==(t=(t||[]).valueOf()).length&&e&&(t=e.valueOf()),this.value=this.parse(t)},m.extend(m.Array,{morph:function(t){if(this.destination=this.parse(t),this.value.length!=this.destination.length){for(var e=this.value[this.value.length-1],n=this.destination[this.destination.length-1];this.value.length>this.destination.length;)this.destination.push(n);for(;this.value.length<this.destination.length;)this.value.push(e)}return this},settle:function(){for(var t=0,e=this.value.length,n=[];t<e;t++)-1==n.indexOf(this.value[t])&&n.push(this.value[t]);return this.value=n},at:function(t){if(!this.destination)return this;for(var e=0,n=this.value.length,i=[];e<n;e++)i.push(this.value[e]+(this.destination[e]-this.value[e])*t);return new m.Array(i)},toString:function(){return this.value.join(" ")},valueOf:function(){return this.value},parse:function(t){return t=t.valueOf(),Array.isArray(t)?t:this.split(t)},split:function(t){return t.trim().split(/\s+/)},reverse:function(){return this.value.reverse(),this}}),m.PointArray=function(t,e){this.constructor.call(this,t,e||[[0,0]])},m.PointArray.prototype=new m.Array,m.extend(m.PointArray,{toString:function(){for(var t=0,e=this.value.length,n=[];t<e;t++)n.push(this.value[t].join(","));return n.join(" ")},toLine:function(){return{x1:this.value[0][0],y1:this.value[0][1],x2:this.value[1][0],y2:this.value[1][1]}},at:function(t){if(!this.destination)return this;for(var e=0,n=this.value.length,i=[];e<n;e++)i.push([this.value[e][0]+(this.destination[e][0]-this.value[e][0])*t,this.value[e][1]+(this.destination[e][1]-this.value[e][1])*t]);return new m.PointArray(i)},parse:function(t){var e=[];if(t=t.valueOf(),Array.isArray(t))return t;(t=t.trim().split(/\s+|,/)).length%2!=0&&t.pop();for(var n=0,i=t.length;n<i;n+=2)e.push([parseFloat(t[n]),parseFloat(t[n+1])]);return e},move:function(t,e){var n=this.bbox();if(t-=n.x,e-=n.y,!isNaN(t)&&!isNaN(e))for(var i=this.value.length-1;i>=0;i--)this.value[i]=[this.value[i][0]+t,this.value[i][1]+e];return this},size:function(t,e){var n,i=this.bbox();for(n=this.value.length-1;n>=0;n--)this.value[n][0]=(this.value[n][0]-i.x)*t/i.width+i.x,this.value[n][1]=(this.value[n][1]-i.y)*e/i.height+i.y;return this},bbox:function(){return m.parser.poly.setAttribute("points",this.toString()),m.parser.poly.getBBox()}}),m.PathArray=function(t,e){this.constructor.call(this,t,e||[["M",0,0]])},m.PathArray.prototype=new m.Array,m.extend(m.PathArray,{toString:function(){return g(this.value)},move:function(t,e){var n=this.bbox();if(t-=n.x,e-=n.y,!isNaN(t)&&!isNaN(e))for(var i,s=this.value.length-1;s>=0;s--)"M"==(i=this.value[s][0])||"L"==i||"T"==i?(this.value[s][1]+=t,this.value[s][2]+=e):"H"==i?this.value[s][1]+=t:"V"==i?this.value[s][1]+=e:"C"==i||"S"==i||"Q"==i?(this.value[s][1]+=t,this.value[s][2]+=e,this.value[s][3]+=t,this.value[s][4]+=e,"C"==i&&(this.value[s][5]+=t,this.value[s][6]+=e)):"A"==i&&(this.value[s][6]+=t,this.value[s][7]+=e);return this},size:function(t,e){var n,i,s=this.bbox();for(n=this.value.length-1;n>=0;n--)"M"==(i=this.value[n][0])||"L"==i||"T"==i?(this.value[n][1]=(this.value[n][1]-s.x)*t/s.width+s.x,this.value[n][2]=(this.value[n][2]-s.y)*e/s.height+s.y):"H"==i?this.value[n][1]=(this.value[n][1]-s.x)*t/s.width+s.x:"V"==i?this.value[n][1]=(this.value[n][1]-s.y)*e/s.height+s.y:"C"==i||"S"==i||"Q"==i?(this.value[n][1]=(this.value[n][1]-s.x)*t/s.width+s.x,this.value[n][2]=(this.value[n][2]-s.y)*e/s.height+s.y,this.value[n][3]=(this.value[n][3]-s.x)*t/s.width+s.x,this.value[n][4]=(this.value[n][4]-s.y)*e/s.height+s.y,"C"==i&&(this.value[n][5]=(this.value[n][5]-s.x)*t/s.width+s.x,this.value[n][6]=(this.value[n][6]-s.y)*e/s.height+s.y)):"A"==i&&(this.value[n][1]=this.value[n][1]*t/s.width,this.value[n][2]=this.value[n][2]*e/s.height,this.value[n][6]=(this.value[n][6]-s.x)*t/s.width+s.x,this.value[n][7]=(this.value[n][7]-s.y)*e/s.height+s.y);return this},equalCommands:function(t){var e,n,i;for(t=new m.PathArray(t),i=this.value.length===t.value.length,e=0,n=this.value.length;i&&e<n;e++)i=this.value[e][0]===t.value[e][0];return i},morph:function(t){return t=new m.PathArray(t),this.equalCommands(t)?this.destination=t:this.destination=null,this},at:function(t){if(!this.destination)return this;var e,n,i,s,a=this.value,r=this.destination.value,o=[],d=new m.PathArray;for(e=0,n=a.length;e<n;e++){for(o[e]=[a[e][0]],i=1,s=a[e].length;i<s;i++)o[e][i]=a[e][i]+(r[e][i]-a[e][i])*t;"A"===o[e][0]&&(o[e][4]=+(0!=o[e][4]),o[e][5]=+(0!=o[e][5]))}return d.value=o,d},parse:function(t){if(t instanceof m.PathArray)return t.valueOf();var e,n,i,s,a,r=0,o=0,d={M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7};if("string"==typeof t){for(e=(t=t.replace(m.regex.negExp,"X").replace(m.regex.pathLetters," $& ").replace(m.regex.hyphen," -").replace(m.regex.comma," ").replace(m.regex.X,"e-").trim().split(m.regex.whitespaces)).length;--e;)if(t[e].indexOf(".")!=t[e].lastIndexOf(".")){var l=t[e].split("."),h=[l.shift(),l.shift()].join(".");t.splice.apply(t,[e,1].concat(h,l.map(function(t){return"."+t})))}}else t=t.reduce(function(t,e){return[].concat.apply(t,e)},[]);var c=[];do{for(m.regex.isPathLetter.test(t[0])?(s=t[0],t.shift()):"M"==s?s="L":"m"==s&&(s="l"),a=[s.toUpperCase()],e=0;e<d[a[0]];++e)a.push(parseFloat(t.shift()));s==a[0]?"M"==s||"L"==s||"C"==s||"Q"==s||"S"==s||"T"==s?(r=a[d[a[0]]-1],o=a[d[a[0]]]):"V"==s?o=a[1]:"H"==s?r=a[1]:"A"==s&&(r=a[6],o=a[7]):"m"==s||"l"==s||"c"==s||"s"==s||"q"==s||"t"==s?(a[1]+=r,a[2]+=o,null!=a[3]&&(a[3]+=r,a[4]+=o),null!=a[5]&&(a[5]+=r,a[6]+=o),r=a[d[a[0]]-1],o=a[d[a[0]]]):"v"==s?(a[1]+=o,o=a[1]):"h"==s?(a[1]+=r,r=a[1]):"a"==s&&(a[6]+=r,a[7]+=o,r=a[6],o=a[7]),"M"==a[0]&&(n=r,i=o),"Z"==a[0]&&(r=n,o=i),c.push(a)}while(t.length);return c},bbox:function(){return m.parser.path.setAttribute("d",this.toString()),m.parser.path.getBBox()}}),m.Number=m.invent({create:function(t,e){this.value=0,this.unit=e||"","number"==typeof t?this.value=isNaN(t)?0:isFinite(t)?t:t<0?-3.4e38:3.4e38:"string"==typeof t?(e=t.match(m.regex.numberAndUnit))&&(this.value=parseFloat(e[1]),"%"==e[5]?this.value/=100:"s"==e[5]&&(this.value*=1e3),this.unit=e[5]):t instanceof m.Number&&(this.value=t.valueOf(),this.unit=t.unit)},extend:{toString:function(){return("%"==this.unit?~~(1e8*this.value)/1e6:"s"==this.unit?this.value/1e3:this.value)+this.unit},toJSON:function(){return this.toString()},valueOf:function(){return this.value},plus:function(t){return new m.Number(this+new m.Number(t),this.unit)},minus:function(t){return this.plus(-new m.Number(t))},times:function(t){return new m.Number(this*new m.Number(t),this.unit)},divide:function(t){return new m.Number(this/new m.Number(t),this.unit)},to:function(t){var e=new m.Number(this);return"string"==typeof t&&(e.unit=t),e},morph:function(t){return this.destination=new m.Number(t),this},at:function(t){return this.destination?new m.Number(this.destination).minus(this).times(t).plus(this):this}}}),m.Element=m.invent({create:function(t){this._stroke=m.defaults.attrs.stroke,this.dom={},(this.node=t)&&(this.type=t.nodeName,this.node.instance=this,this._stroke=t.getAttribute("stroke")||this._stroke)},extend:{x:function(t){return this.attr("x",t)},y:function(t){return this.attr("y",t)},cx:function(t){return null==t?this.x()+this.width()/2:this.x(t-this.width()/2)},cy:function(t){return null==t?this.y()+this.height()/2:this.y(t-this.height()/2)},move:function(t,e){return this.x(t).y(e)},center:function(t,e){return this.cx(t).cy(e)},width:function(t){return this.attr("width",t)},height:function(t){return this.attr("height",t)},size:function(t,e){var n=d(this,t,e);return this.width(new m.Number(n.width)).height(new m.Number(n.height))},clone:function(t){var e=f(this.node.cloneNode(!0));return t?t.add(e):this.after(e),e},remove:function(){return this.parent()&&this.parent().removeElement(this),this},replace:function(t){return this.after(t).remove(),t},addTo:function(t){return t.put(this)},putIn:function(t){return t.add(this)},id:function(t){return this.attr("id",t)},inside:function(t,e){var n=this.bbox();return t>n.x&&e>n.y&&t<n.x+n.width&&e<n.y+n.height},show:function(){return this.style("display","")},hide:function(){return this.style("display","none")},visible:function(){return"none"!=this.style("display")},toString:function(){return this.attr("id")},classes:function(){var t=this.attr("class");return null==t?[]:t.trim().split(/\s+/)},hasClass:function(t){return-1!=this.classes().indexOf(t)},addClass:function(t){if(!this.hasClass(t)){var e=this.classes();e.push(t),this.attr("class",e.join(" "))}return this},removeClass:function(t){return this.hasClass(t)&&this.attr("class",this.classes().filter(function(e){return e!=t}).join(" ")),this},toggleClass:function(t){return this.hasClass(t)?this.removeClass(t):this.addClass(t)},reference:function(t){return m.get(this.attr(t))},parent:function(t){var e=this;if(!e.node.parentNode)return null;if(e=m.adopt(e.node.parentNode),!t)return e;for(;e&&e.node instanceof SVGElement;){if("string"==typeof t?e.matches(t):e instanceof t)return e;e=m.adopt(e.node.parentNode)}},doc:function(){return this instanceof m.Doc?this:this.parent(m.Doc)},parents:function(t){var e=[],n=this;do{if(!(n=n.parent(t))||!n.node)break;e.push(n)}while(n.parent);return e},matches:function(t){return i(this.node,t)},native:function(){return this.node},svg:function(t){var n=e.createElement("svg");if(!(t&&this instanceof m.Parent))return n.appendChild(t=e.createElement("svg")),this.writeDataToDom(),t.appendChild(this.node.cloneNode(!0)),n.innerHTML.replace(/^<svg>/,"").replace(/<\/svg>$/,"");n.innerHTML="<svg>"+t.replace(/\n/,"").replace(/<(\w+)([^<]+?)\/>/g,"<$1$2></$1>")+"</svg>";for(var i=0,s=n.firstChild.childNodes.length;i<s;i++)this.node.appendChild(n.firstChild.firstChild);return this},writeDataToDom:function(){(this.each||this.lines)&&(this.each?this:this.lines()).each(function(){this.writeDataToDom()});return this.node.removeAttribute("svgjs:data"),Object.keys(this.dom).length&&this.node.setAttribute("svgjs:data",JSON.stringify(this.dom)),this},setData:function(t){return this.dom=t,this},is:function(t){return n(this,t)}}}),m.easing={"-":function(t){return t},"<>":function(t){return-Math.cos(t*Math.PI)/2+.5},">":function(t){return Math.sin(t*Math.PI/2)},"<":function(t){return 1-Math.cos(t*Math.PI/2)}},m.morph=function(t){return function(e,n){return new m.MorphObj(e,n).at(t)}},m.Situation=m.invent({create:function(t){this.init=!1,this.reversed=!1,this.reversing=!1,this.duration=new m.Number(t.duration).valueOf(),this.delay=new m.Number(t.delay).valueOf(),this.start=+new Date+this.delay,this.finish=this.start+this.duration,this.ease=t.ease,this.loop=0,this.loops=!1,this.animations={},this.attrs={},this.styles={},this.transforms=[],this.once={}}}),m.FX=m.invent({create:function(t){this._target=t,this.situations=[],this.active=!1,this.situation=null,this.paused=!1,this.lastPos=0,this.pos=0,this.absPos=0,this._speed=1},extend:{animate:function(t,e,n){"object"==typeof t&&(e=t.ease,n=t.delay,t=t.duration);var i=new m.Situation({duration:t||1e3,delay:n||0,ease:m.easing[e||"-"]||e});return this.queue(i),this},delay:function(t){var e=new m.Situation({duration:t,delay:0,ease:m.easing["-"]});return this.queue(e)},target:function(t){return t&&t instanceof m.Element?(this._target=t,this):this._target},timeToAbsPos:function(t){return(t-this.situation.start)/(this.situation.duration/this._speed)},absPosToTime:function(t){return this.situation.duration/this._speed*t+this.situation.start},startAnimFrame:function(){this.stopAnimFrame(),this.animationFrame=requestAnimationFrame(function(){this.step()}.bind(this))},stopAnimFrame:function(){cancelAnimationFrame(this.animationFrame)},start:function(){return!this.active&&this.situation&&(this.active=!0,this.startCurrent()),this},startCurrent:function(){return this.situation.start=+new Date+this.situation.delay/this._speed,this.situation.finish=this.situation.start+this.situation.duration/this._speed,this.initAnimations().step()},queue:function(t){return("function"==typeof t||t instanceof m.Situation)&&this.situations.push(t),this.situation||(this.situation=this.situations.shift()),this},dequeue:function(){return this.situation&&this.situation.stop&&this.situation.stop(),this.situation=this.situations.shift(),this.situation&&(this.situation instanceof m.Situation?this.startCurrent():this.situation.call(this)),this},initAnimations:function(){var t,e=this.situation;if(e.init)return this;for(t in e.animations)"viewbox"==t?e.animations[t]=this.target().viewbox().morph(e.animations[t]):(e.animations[t].value="plot"==t?this.target().array().value:this.target()[t](),e.animations[t].value.value&&(e.animations[t].value=e.animations[t].value.value),e.animations[t].relative&&(e.animations[t].destination.value=e.animations[t].destination.value+e.animations[t].value));for(t in e.attrs)if(e.attrs[t]instanceof m.Color){var n=new m.Color(this.target().attr(t));e.attrs[t].r=n.r,e.attrs[t].g=n.g,e.attrs[t].b=n.b}else e.attrs[t].value=this.target().attr(t);for(t in e.styles)e.styles[t].value=this.target().style(t);return e.initialTransformation=this.target().matrixify(),e.init=!0,this},clearQueue:function(){return this.situations=[],this},clearCurrent:function(){return this.situation=null,this},stop:function(t,e){return this.active||this.start(),e&&this.clearQueue(),this.active=!1,t&&this.situation&&this.atEnd(),this.stopAnimFrame(),this.clearCurrent()},reset:function(){if(this.situation){var t=this.situation;this.stop(),this.situation=t,this.atStart()}return this},finish:function(){for(this.stop(!0,!1);this.dequeue().situation&&this.stop(!0,!1););return this.clearQueue().clearCurrent(),this},atStart:function(){return this.at(0,!0)},atEnd:function(){return!0===this.situation.loops?this.at(this.situation.loop+1,!0):"number"==typeof this.situation.loops?this.at(this.situation.loops,!0):this.at(1,!0)},at:function(t,e){var n=this.situation.duration/this._speed;return this.absPos=t,
e||(this.situation.reversed&&(this.absPos=1-this.absPos),this.absPos+=this.situation.loop),this.situation.start=+new Date-this.absPos*n,this.situation.finish=this.situation.start+n,this.step(!0)},speed:function(t){return 0===t?this.pause():t?(this._speed=t,this.at(this.absPos,!0)):this._speed},loop:function(t,e){var n=this.last();return n.loops=null==t||t,n.loop=0,e&&(n.reversing=!0),this},pause:function(){return this.paused=!0,this.stopAnimFrame(),this},play:function(){return this.paused?(this.paused=!1,this.at(this.absPos,!0)):this},reverse:function(t){var e=this.last();return e.reversed=void 0===t?!e.reversed:t,this},progress:function(t){return t?this.situation.ease(this.pos):this.pos},after:function(t){var e=this.last(),n=function i(n){n.detail.situation==e&&(t.call(this,e),this.off("finished.fx",i))};return this.target().on("finished.fx",n),this},during:function(t){var e=this.last(),n=function(n){n.detail.situation==e&&t.call(this,n.detail.pos,m.morph(n.detail.pos),n.detail.eased,e)};return this.target().off("during.fx",n).on("during.fx",n),this.after(function(){this.off("during.fx",n)})},afterAll:function(t){var e=function n(){t.call(this),this.off("allfinished.fx",n)};return this.target().off("allfinished.fx",e).on("allfinished.fx",e),this},duringAll:function(t){var e=function(e){t.call(this,e.detail.pos,m.morph(e.detail.pos),e.detail.eased,e.detail.situation)};return this.target().off("during.fx",e).on("during.fx",e),this.afterAll(function(){this.off("during.fx",e)})},last:function(){return this.situations.length?this.situations[this.situations.length-1]:this.situation},add:function(t,e,n){return this.last()[n||"animations"][t]=e,setTimeout(function(){this.start()}.bind(this),0),this},step:function(t){var e,n,i;(t||(this.absPos=this.timeToAbsPos(+new Date)),!1!==this.situation.loops)?(e=Math.max(this.absPos,0),n=Math.floor(e),!0===this.situation.loops||n<this.situation.loops?(this.pos=e-n,i=this.situation.loop,this.situation.loop=n):(this.absPos=this.situation.loops,this.pos=1,i=this.situation.loop-1,this.situation.loop=this.situation.loops),this.situation.reversing&&(this.situation.reversed=this.situation.reversed!=Boolean((this.situation.loop-i)%2))):(this.absPos=Math.min(this.absPos,1),this.pos=this.absPos);this.pos<0&&(this.pos=0),this.situation.reversed&&(this.pos=1-this.pos);var s=this.situation.ease(this.pos);for(var a in this.situation.once)a>this.lastPos&&a<=s&&(this.situation.once[a].call(this.target(),this.pos,s),delete this.situation.once[a]);return this.active&&this.target().fire("during",{pos:this.pos,eased:s,fx:this,situation:this.situation}),this.situation?(this.eachAt(),1==this.pos&&!this.situation.reversed||this.situation.reversed&&0==this.pos?(this.stopAnimFrame(),this.target().fire("finished",{fx:this,situation:this.situation}),this.situations.length||(this.target().fire("allfinished"),this.target().off(".fx"),this.active=!1),this.active?this.dequeue():this.clearCurrent()):!this.paused&&this.active&&this.startAnimFrame(),this.lastPos=s,this):this},eachAt:function(){var t,e,n=this,i=this.target(),s=this.situation;for(t in s.animations)e=[].concat(s.animations[t]).map(function(t){return"string"!=typeof t&&t.at?t.at(s.ease(n.pos),n.pos):t}),i[t].apply(i,e);for(t in s.attrs)e=[t].concat(s.attrs[t]).map(function(t){return"string"!=typeof t&&t.at?t.at(s.ease(n.pos),n.pos):t}),i.attr.apply(i,e);for(t in s.styles)e=[t].concat(s.styles[t]).map(function(t){return"string"!=typeof t&&t.at?t.at(s.ease(n.pos),n.pos):t}),i.style.apply(i,e);if(s.transforms.length){for(e=s.initialTransformation,t=0,len=s.transforms.length;t<len;t++){var a=s.transforms[t];a instanceof m.Matrix?e=a.relative?e.multiply((new m.Matrix).morph(a).at(s.ease(this.pos))):e.morph(a).at(s.ease(this.pos)):(a.relative||a.undo(e.extract()),e=e.multiply(a.at(s.ease(this.pos))))}i.matrix(e)}return this},once:function(t,e,n){return n||(t=this.situation.ease(t)),this.situation.once[t]=e,this}},parent:m.Element,construct:{animate:function(t,e,n){return(this.fx||(this.fx=new m.FX(this))).animate(t,e,n)},delay:function(t){return(this.fx||(this.fx=new m.FX(this))).delay(t)},stop:function(t,e){return this.fx&&this.fx.stop(t,e),this},finish:function(){return this.fx&&this.fx.finish(),this},pause:function(){return this.fx&&this.fx.pause(),this},play:function(){return this.fx&&this.fx.play(),this},speed:function(t){if(this.fx){if(null==t)return this.fx.speed();this.fx.speed(t)}return this}}}),m.MorphObj=m.invent({create:function(t,e){return m.Color.isColor(e)?new m.Color(t).morph(e):m.regex.numberAndUnit.test(e)?new m.Number(t).morph(e):(this.value=0,void(this.destination=e))},extend:{at:function(t,e){return e<1?this.value:this.destination},valueOf:function(){return this.value}}}),m.extend(m.FX,{attr:function(t,e){if("object"==typeof t)for(var n in t)this.attr(n,t[n]);else this.add(t,new m.MorphObj(null,e),"attrs");return this},style:function(t,e){if("object"==typeof t)for(var n in t)this.style(n,t[n]);else this.add(t,new m.MorphObj(null,e),"styles");return this},x:function(t,e){if(this.target()instanceof m.G)return this.transform({x:t},e),this;var n=(new m.Number).morph(t);return n.relative=e,this.add("x",n)},y:function(t,e){if(this.target()instanceof m.G)return this.transform({y:t},e),this;var n=(new m.Number).morph(t);return n.relative=e,this.add("y",n)},cx:function(t){return this.add("cx",(new m.Number).morph(t))},cy:function(t){return this.add("cy",(new m.Number).morph(t))},move:function(t,e){return this.x(t).y(e)},center:function(t,e){return this.cx(t).cy(e)},size:function(t,e){var n;this.target()instanceof m.Text?this.attr("font-size",t):(t&&e||(n=this.target().bbox()),t||(t=n.width/n.height*e),e||(e=n.height/n.width*t),this.add("width",(new m.Number).morph(t)).add("height",(new m.Number).morph(e)));return this},plot:function(t){return this.add("plot",this.target().array().morph(t))},leading:function(t){return this.target().leading?this.add("leading",(new m.Number).morph(t)):this},viewbox:function(t,e,n,i){return this.target()instanceof m.Container&&this.add("viewbox",new m.ViewBox(t,e,n,i)),this},update:function(t){if(this.target()instanceof m.Stop){if("number"==typeof t||t instanceof m.Number)return this.update({offset:arguments[0],color:arguments[1],opacity:arguments[2]});null!=t.opacity&&this.attr("stop-opacity",t.opacity),null!=t.color&&this.attr("stop-color",t.color),null!=t.offset&&this.attr("offset",t.offset)}return this}}),m.BBox=m.invent({create:function(t){if(t){var n;try{if(!e.documentElement.contains(t.node))throw new Exception("Element not in the dom");n=t.node.getBBox()}catch(s){if(t instanceof m.Shape){var i=t.clone(m.parser.draw).show();n=i.bbox(),i.remove()}else n={x:t.node.clientLeft,y:t.node.clientTop,width:t.node.clientWidth,height:t.node.clientHeight}}this.x=n.x,this.y=n.y,this.width=n.width,this.height=n.height}p(this)},parent:m.Element,construct:{bbox:function(){return new m.BBox(this)}}}),m.TBox=m.invent({create:function(t){if(t){var e=t.ctm().extract(),n=t.bbox();this.width=n.width*e.scaleX,this.height=n.height*e.scaleY,this.x=n.x+e.x,this.y=n.y+e.y}p(this)},parent:m.Element,construct:{tbox:function(){return new m.TBox(this)}}}),m.RBox=m.invent({create:function(e){if(e){var n=e.doc().parent(),i=e.node.getBoundingClientRect(),s=1;for(this.x=i.left,this.y=i.top,this.x-=n.offsetLeft,this.y-=n.offsetTop;n=n.offsetParent;)this.x-=n.offsetLeft,this.y-=n.offsetTop;for(n=e;n.parent&&(n=n.parent());)n.viewbox&&(s*=n.viewbox().zoom,this.x-=n.x()||0,this.y-=n.y()||0);this.width=i.width/=s,this.height=i.height/=s}p(this),this.x+=t.pageXOffset,this.y+=t.pageYOffset},parent:m.Element,construct:{rbox:function(){return new m.RBox(this)}}}),[m.BBox,m.TBox,m.RBox].forEach(function(t){m.extend(t,{merge:function(e){var n=new t;return n.x=Math.min(this.x,e.x),n.y=Math.min(this.y,e.y),n.width=Math.max(this.x+this.width,e.x+e.width)-n.x,n.height=Math.max(this.y+this.height,e.y+e.height)-n.y,p(n)}})}),m.Matrix=m.invent({create:function(t){var e,n=h([1,0,0,1,0,0]);for(t=t instanceof m.Element?t.matrixify():"string"==typeof t?_(t):6==arguments.length?h([].slice.call(arguments)):"object"==typeof t?t:n,e=w.length-1;e>=0;--e)this[w[e]]=t&&"number"==typeof t[w[e]]?t[w[e]]:n[w[e]]},extend:{extract:function(){var t=l(this,0,1),e=l(this,1,0),n=180/Math.PI*Math.atan2(t.y,t.x)-90;return{x:this.e,y:this.f,transformedX:(this.e*Math.cos(n*Math.PI/180)+this.f*Math.sin(n*Math.PI/180))/Math.sqrt(this.a*this.a+this.b*this.b),transformedY:(this.f*Math.cos(n*Math.PI/180)+this.e*Math.sin(-n*Math.PI/180))/Math.sqrt(this.c*this.c+this.d*this.d),skewX:-n,skewY:180/Math.PI*Math.atan2(e.y,e.x),scaleX:Math.sqrt(this.a*this.a+this.b*this.b),scaleY:Math.sqrt(this.c*this.c+this.d*this.d),rotation:n,a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f,matrix:new m.Matrix(this)}},clone:function(){return new m.Matrix(this)},morph:function(t){return this.destination=new m.Matrix(t),this},at:function(t){if(!this.destination)return this;var e=new m.Matrix({a:this.a+(this.destination.a-this.a)*t,b:this.b+(this.destination.b-this.b)*t,c:this.c+(this.destination.c-this.c)*t,d:this.d+(this.destination.d-this.d)*t,e:this.e+(this.destination.e-this.e)*t,f:this.f+(this.destination.f-this.f)*t});if(this.param&&this.param.to){var n={rotation:this.param.from.rotation+(this.param.to.rotation-this.param.from.rotation)*t,cx:this.param.from.cx,cy:this.param.from.cy};(e=e.rotate((this.param.to.rotation-2*this.param.from.rotation)*t,n.cx,n.cy)).param=n}return e},multiply:function(t){return new m.Matrix(this.native().multiply(c(t).native()))},inverse:function(){return new m.Matrix(this.native().inverse())},translate:function(t,e){return new m.Matrix(this.native().translate(t||0,e||0))},scale:function(t,e,n,i){return 1==arguments.length?e=t:3==arguments.length&&(i=n,n=e,e=t),this.around(n,i,new m.Matrix(t,0,0,e,0,0))},rotate:function(t,e,n){return t=m.utils.radians(t),this.around(e,n,new m.Matrix(Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0))},flip:function(t,e){return"x"==t?this.scale(-1,1,e,0):this.scale(1,-1,0,e)},skew:function(t,e,n,i){return 1==arguments.length?e=t:3==arguments.length&&(i=n,n=e,e=t),t=m.utils.radians(t),e=m.utils.radians(e),this.around(n,i,new m.Matrix(1,Math.tan(e),Math.tan(t),1,0,0))},skewX:function(t,e,n){return this.skew(t,0,e,n)},skewY:function(t,e,n){return this.skew(0,t,e,n)},around:function(t,e,n){return this.multiply(new m.Matrix(1,0,0,1,t||0,e||0)).multiply(n).multiply(new m.Matrix(1,0,0,1,-t||0,-e||0))},native:function(){for(var t=m.parser.native.createSVGMatrix(),e=w.length-1;e>=0;e--)t[w[e]]=this[w[e]];return t},toString:function(){return"matrix("+this.a+","+this.b+","+this.c+","+this.d+","+this.e+","+this.f+")"}},parent:m.Element,construct:{ctm:function(){return new m.Matrix(this.node.getCTM())},screenCTM:function(){return new m.Matrix(this.node.getScreenCTM())}}}),m.Point=m.invent({create:function(t,e){var n,i={x:0,y:0};n=Array.isArray(t)?{x:t[0],y:t[1]}:"object"==typeof t?{x:t.x,y:t.y}:null!=t?{x:t,y:null!=e?e:t}:i,this.x=n.x,this.y=n.y},extend:{clone:function(){return new m.Point(this)},morph:function(t,e){return this.destination=new m.Point(t,e),this},at:function(t){return this.destination?new m.Point({x:this.x+(this.destination.x-this.x)*t,y:this.y+(this.destination.y-this.y)*t}):this},native:function(){var t=m.parser.native.createSVGPoint();return t.x=this.x,t.y=this.y,t},transform:function(t){return new m.Point(this.native().matrixTransform(t.native()))}}}),m.extend(m.Element,{point:function(t,e){return new m.Point(t,e).transform(this.screenCTM().inverse())}}),m.extend(m.Element,{attr:function(t,e,n){if(null==t){for(t={},n=(e=this.node.attributes).length-1;n>=0;n--)t[e[n].nodeName]=m.regex.isNumber.test(e[n].nodeValue)?parseFloat(e[n].nodeValue):e[n].nodeValue;return t}if("object"==typeof t)for(e in t)this.attr(e,t[e]);else if(null===e)this.node.removeAttribute(t);else{if(null==e)return null==(e=this.node.getAttribute(t))?m.defaults.attrs[t]:m.regex.isNumber.test(e)?parseFloat(e):e;"stroke-width"==t?this.attr("stroke",parseFloat(e)>0?this._stroke:null):"stroke"==t&&(this._stroke=e),"fill"!=t&&"stroke"!=t||(m.regex.isImage.test(e)&&(e=this.doc().defs().image(e,0,0)),e instanceof m.Image&&(e=this.doc().defs().pattern(0,0,function(){this.add(e)}))),"number"==typeof e?e=new m.Number(e):m.Color.isColor(e)?e=new m.Color(e):Array.isArray(e)?e=new m.Array(e):e instanceof m.Matrix&&e.param&&(this.param=e.param),"leading"==t?this.leading&&this.leading(e):"string"==typeof n?this.node.setAttributeNS(n,t,e.toString()):this.node.setAttribute(t,e.toString()),!this.rebuild||"font-size"!=t&&"x"!=t||this.rebuild(t,e)}return this}}),m.extend(m.Element,{transform:function(t,e){var n,i=this;if("object"!=typeof t)return n=new m.Matrix(i).extract(),"string"==typeof t?n[t]:n;if(n=new m.Matrix(i),e=!!e||!!t.relative,null!=t.a)n=e?n.multiply(new m.Matrix(t)):new m.Matrix(t);else if(null!=t.rotation)u(t,i),n=e?n.rotate(t.rotation,t.cx,t.cy):n.rotate(t.rotation-n.extract().rotation,t.cx,t.cy);else if(null!=t.scale||null!=t.scaleX||null!=t.scaleY){if(u(t,i),t.scaleX=null!=t.scale?t.scale:null!=t.scaleX?t.scaleX:1,t.scaleY=null!=t.scale?t.scale:null!=t.scaleY?t.scaleY:1,!e){var s=n.extract();t.scaleX=1*t.scaleX/s.scaleX,t.scaleY=1*t.scaleY/s.scaleY}n=n.scale(t.scaleX,t.scaleY,t.cx,t.cy)}else if(null!=t.skew||null!=t.skewX||null!=t.skewY){if(u(t,i),t.skewX=null!=t.skew?t.skew:null!=t.skewX?t.skewX:0,t.skewY=null!=t.skew?t.skew:null!=t.skewY?t.skewY:0,!e){s=n.extract();n=n.multiply((new m.Matrix).skew(s.skewX,s.skewY,t.cx,t.cy).inverse())}n=n.skew(t.skewX,t.skewY,t.cx,t.cy)}else t.flip?n=n.flip(t.flip,null==t.offset?i.bbox()["c"+t.flip]:t.offset):null==t.x&&null==t.y||(e?n=n.translate(t.x,t.y):(null!=t.x&&(n.e=t.x),null!=t.y&&(n.f=t.y)));return this.attr("transform",n)}}),m.extend(m.FX,{transform:function(t,e){var n,i=this.target();return"object"!=typeof t?(n=new m.Matrix(i).extract(),"string"==typeof t?n[t]:n):(e=!!e||!!t.relative,null!=t.a?n=new m.Matrix(t):null!=t.rotation?(u(t,i),n=new m.Rotate(t.rotation,t.cx,t.cy)):null!=t.scale||null!=t.scaleX||null!=t.scaleY?(u(t,i),t.scaleX=null!=t.scale?t.scale:null!=t.scaleX?t.scaleX:1,t.scaleY=null!=t.scale?t.scale:null!=t.scaleY?t.scaleY:1,n=new m.Scale(t.scaleX,t.scaleY,t.cx,t.cy)):null!=t.skewX||null!=t.skewY?(u(t,i),t.skewX=null!=t.skewX?t.skewX:0,t.skewY=null!=t.skewY?t.skewY:0,n=new m.Skew(t.skewX,t.skewY,t.cx,t.cy)):t.flip?n=(new m.Matrix).morph((new m.Matrix).flip(t.flip,null==t.offset?i.bbox()["c"+t.flip]:t.offset)):null==t.x&&null==t.y||(n=new m.Translate(t.x,t.y)),n?(n.relative=e,this.last().transforms.push(n),setTimeout(function(){this.start()}.bind(this),0),this):this)}}),m.extend(m.Element,{untransform:function(){return this.attr("transform",null)},matrixify:function(){return(this.attr("transform")||"").split(/\)\s*,?\s*/).slice(0,-1).map(function(t){var e=t.trim().split("(");return[e[0],e[1].split(m.regex.matrixElements).map(function(t){return parseFloat(t)})]}).reduce(function(t,e){return"matrix"==e[0]?t.multiply(h(e[1])):t[e[0]].apply(t,e[1])},new m.Matrix)},toParent:function(t){if(this==t)return this;var e=this.screenCTM(),n=t.rect(1,1),i=n.screenCTM().inverse();return n.remove(),this.addTo(t).untransform().transform(i.multiply(e)),this},toDoc:function(){return this.toParent(this.doc())}}),m.Transformation=m.invent({create:function(t,e){if(arguments.length>1&&"boolean"!=typeof e)return this.create([].slice.call(arguments));if("object"==typeof t)for(var n=0,i=this.arguments.length;n<i;++n)this[this.arguments[n]]=t[this.arguments[n]];if(Array.isArray(t))for(n=0,i=this.arguments.length;n<i;++n)this[this.arguments[n]]=t[n];this.inversed=!1,!0===e&&(this.inversed=!0)},extend:{at:function(t){for(var e=[],n=0,i=this.arguments.length;n<i;++n)e.push(this[this.arguments[n]]);var s=this._undo||new m.Matrix;return s=(new m.Matrix).morph(m.Matrix.prototype[this.method].apply(s,e)).at(t),this.inversed?s.inverse():s},undo:function(t){for(var e=0,n=this.arguments.length;e<n;++e)t[this.arguments[e]]="undefined"==typeof this[this.arguments[e]]?0:t[this.arguments[e]];return t.cx=this.cx,t.cy=this.cy,this._undo=new(m[a(this.method)])(t,!0).at(1),this}}}),m.Translate=m.invent({parent:m.Matrix,inherit:m.Transformation,create:function(t,e){"object"==typeof t?this.constructor.call(this,t,e):this.constructor.call(this,[].slice.call(arguments))},extend:{arguments:["transformedX","transformedY"],method:"translate"}}),m.Rotate=m.invent({parent:m.Matrix,inherit:m.Transformation,create:function(t,e){"object"==typeof t?this.constructor.call(this,t,e):this.constructor.call(this,[].slice.call(arguments))},extend:{arguments:["rotation","cx","cy"],method:"rotate",at:function(t){var e=(new m.Matrix).rotate((new m.Number).morph(this.rotation-(this._undo?this._undo.rotation:0)).at(t),this.cx,this.cy);return this.inversed?e.inverse():e},undo:function(t){this._undo=t}}}),m.Scale=m.invent({parent:m.Matrix,inherit:m.Transformation,create:function(t,e){"object"==typeof t?this.constructor.call(this,t,e):this.constructor.call(this,[].slice.call(arguments))},extend:{arguments:["scaleX","scaleY","cx","cy"],method:"scale"}}),m.Skew=m.invent({parent:m.Matrix,inherit:m.Transformation,create:function(t,e){"object"==typeof t?this.constructor.call(this,t,e):this.constructor.call(this,[].slice.call(arguments))},extend:{arguments:["skewX","skewY","cx","cy"],method:"skew"}}),m.extend(m.Element,{style:function(t,e){if(0==arguments.length)return this.node.style.cssText||"";if(arguments.length<2)if("object"==typeof t)for(e in t)this.style(e,t[e]);else{if(!m.regex.isCss.test(t))return this.node.style[s(t)];t=t.split(";");for(var n=0;n<t.length;n++)e=t[n].split(":"),this.style(e[0].replace(/\s+/g,""),e[1])}else this.node.style[s(t)]=null===e||m.regex.isBlank.test(e)?"":e;return this}}),m.Parent=m.invent({create:function(t){this.constructor.call(this,t)},inherit:m.Element,extend:{children:function(){return m.utils.map(m.utils.filterSVGElements(this.node.childNodes),function(t){return m.adopt(t)})},add:function(t,e){return null==e?this.node.appendChild(t.node):t.node!=this.node.childNodes[e]&&this.node.insertBefore(t.node,this.node.childNodes[e]),this},put:function(t,e){return this.add(t,e),t},has:function(t){return this.index(t)>=0},index:function(t){return[].slice.call(this.node.childNodes).indexOf(t.node)},get:function(t){return m.adopt(this.node.childNodes[t])},first:function(){return this.get(0)},last:function(){return this.get(this.node.childNodes.length-1)},each:function(t,e){var n,i,s=this.children();for(n=0,i=s.length;n<i;n++)s[n]instanceof m.Element&&t.apply(s[n],[n,s]),e&&s[n]instanceof m.Container&&s[n].each(t,e);return this},removeElement:function(t){return this.node.removeChild(t.node),this},clear:function(){for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);return delete this._defs,this},defs:function(){return this.doc().defs()}}}),m.extend(m.Parent,{ungroup:function(t,e){return 0===e||this instanceof m.Defs?this:(t=t||(this instanceof m.Doc?this:this.parent(m.Parent)),e=e||Infinity,this.each(function(){return this instanceof m.Defs?this:this instanceof m.Parent?this.ungroup(t,e-1):this.toParent(t)}),this.node.firstChild||this.remove(),this)},flatten:function(t,e){return this.ungroup(t,e)}}),m.Container=m.invent({create:function(t){this.constructor.call(this,t)},inherit:m.Parent}),m.ViewBox=m.invent({create:function(t){var e,n,i,s,a,r,o,d=[0,0,0,0],l=1,h=1,c=/[+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?/gi;if(t instanceof m.Element){for(r=t,o=t,a=(t.attr("viewBox")||"").match(c),t.bbox,i=new m.Number(t.width()),s=new m.Number(t.height());"%"==i.unit;)l*=i.value,i=new m.Number(r instanceof m.Doc?r.parent().offsetWidth:r.parent().width()),r=r.parent();for(;"%"==s.unit;)h*=s.value,s=new m.Number(o instanceof m.Doc?o.parent().offsetHeight:o.parent().height()),o=o.parent();this.x=0,this.y=0,this.width=i*l,this.height=s*h,this.zoom=1,a&&(e=parseFloat(a[0]),n=parseFloat(a[1]),i=parseFloat(a[2]),s=parseFloat(a[3]),this.zoom=this.width/this.height>i/s?this.height/s:this.width/i,this.x=e,this.y=n,this.width=i,this.height=s)}else t="string"==typeof t?t.match(c).map(function(t){return parseFloat(t)}):Array.isArray(t)?t:"object"==typeof t?[t.x,t.y,t.width,t.height]:4==arguments.length?[].slice.call(arguments):d,this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]},extend:{toString:function(){return this.x+" "+this.y+" "+this.width+" "+this.height},morph:function(t){t=1==arguments.length?[t.x,t.y,t.width,t.height]:[].slice.call(arguments);return this.destination=new m.ViewBox(t),this},at:function(t){return this.destination?new m.ViewBox([this.x+(this.destination.x-this.x)*t,this.y+(this.destination.y-this.y)*t,this.width+(this.destination.width-this.width)*t,this.height+(this.destination.height-this.height)*t]):this}},parent:m.Container,construct:{viewbox:function(t){return 0==arguments.length?new m.ViewBox(this):(t=1==arguments.length?[t.x,t.y,t.width,t.height]:[].slice.call(arguments),this.attr("viewBox",t))}}}),["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","touchstart","touchmove","touchleave","touchend","touchcancel"].forEach(function(t){m.Element.prototype[t]=function(e){var n=this;return this.node["on"+t]="function"==typeof e?function(){return e.apply(n,arguments)}:null,this}}),m.listeners=[],m.handlerMap=[],m.listenerId=0,m.on=function(t,e,n,i){var s=n.bind(i||t.instance||t),a=(m.handlerMap.indexOf(t)+1||m.handlerMap.push(t))-1,r=e.split(".")[0],o=e.split(".")[1]||"*";m.listeners[a]=m.listeners[a]||{},m.listeners[a][r]=m.listeners[a][r]||{},m.listeners[a][r][o]=m.listeners[a][r][o]||{},n._svgjsListenerId||(n._svgjsListenerId=++m.listenerId),m.listeners[a][r][o][n._svgjsListenerId]=s,t.addEventListener(r,s,!1)},m.off=function(t,e,n){var i=m.handlerMap.indexOf(t),s=e&&e.split(".")[0],a=e&&e.split(".")[1];if(-1!=i)if(n){if("function"==typeof n&&(n=n._svgjsListenerId),!n)return;m.listeners[i][s]&&m.listeners[i][s][a||"*"]&&(t.removeEventListener(s,m.listeners[i][s][a||"*"][n],!1),delete m.listeners[i][s][a||"*"][n])}else if(a&&s){if(m.listeners[i][s]&&m.listeners[i][s][a]){for(n in m.listeners[i][s][a])m.off(t,[s,a].join("."),n);delete m.listeners[i][s][a]}}else if(a)for(e in m.listeners[i])for(namespace in m.listeners[i][e])a===namespace&&m.off(t,[e,a].join("."));else if(s){if(m.listeners[i][s]){for(namespace in m.listeners[i][s])m.off(t,[s,namespace].join("."));delete m.listeners[i][s]}}else{for(e in m.listeners[i])m.off(t,e);delete m.listeners[i]}},m.extend(m.Element,{on:function(t,e,n){return m.on(this.node,t,e,n),this},off:function(t,e){return m.off(this.node,t,e),this},fire:function(t,e){return t instanceof Event?this.node.dispatchEvent(t):this.node.dispatchEvent(new k(t,{detail:e})),this}}),m.Defs=m.invent({create:"defs",inherit:m.Container}),m.G=m.invent({create:"g",inherit:m.Container,extend:{x:function(t){return null==t?this.transform("x"):this.transform({x:t-this.x()},!0)},y:function(t){return null==t?this.transform("y"):this.transform({y:t-this.y()},!0)},cx:function(t){return null==t?this.gbox().cx:this.x(t-this.gbox().width/2)},cy:function(t){return null==t?this.gbox().cy:this.y(t-this.gbox().height/2)},gbox:function(){var t=this.bbox(),e=this.transform();return t.x+=e.x,t.x2+=e.x,t.cx+=e.x,t.y+=e.y,t.y2+=e.y,t.cy+=e.y,t}},construct:{group:function(){return this.put(new m.G)}}}),m.extend(m.Element,{siblings:function(){return this.parent().children()},position:function(){return this.parent().index(this)},next:function(){return this.siblings()[this.position()+1]},previous:function(){return this.siblings()[this.position()-1]},forward:function(){var t=this.position()+1,e=this.parent();return e.removeElement(this).add(this,t),e instanceof m.Doc&&e.node.appendChild(e.defs().node),this},backward:function(){var t=this.position();return t>0&&this.parent().removeElement(this).add(this,t-1),this},front:function(){var t=this.parent();return t.node.appendChild(this.node),t instanceof m.Doc&&t.node.appendChild(t.defs().node),this},back:function(){return this.position()>0&&this.parent().removeElement(this).add(this,0),this},before:function(t){t.remove();var e=this.position();return this.parent().add(t,e),this},after:function(t){t.remove();var e=this.position();return this.parent().add(t,e+1),this}}),m.Mask=m.invent({create:function(){this.constructor.call(this,m.create("mask")),this.targets=[]},inherit:m.Container,extend:{remove:function(){for(var t=this.targets.length-1;t>=0;t--)this.targets[t]&&this.targets[t].unmask();return this.targets=[],this.parent().removeElement(this),this}},construct:{mask:function(){return this.defs().put(new m.Mask)}}}),m.extend(m.Element,{maskWith:function(t){return this.masker=t instanceof m.Mask?t:this.parent().mask().add(t),this.masker.targets.push(this),this.attr("mask",'url("#'+this.masker.attr("id")+'")')},unmask:function(){return delete this.masker,this.attr("mask",null)}}),m.ClipPath=m.invent({create:function(){this.constructor.call(this,m.create("clipPath")),this.targets=[]},inherit:m.Container,extend:{remove:function(){for(var t=this.targets.length-1;t>=0;t--)this.targets[t]&&this.targets[t].unclip();return this.targets=[],this.parent().removeElement(this),this}},construct:{clip:function(){return this.defs().put(new m.ClipPath)}}}),m.extend(m.Element,{clipWith:function(t){return this.clipper=t instanceof m.ClipPath?t:this.parent().clip().add(t),this.clipper.targets.push(this),this.attr("clip-path",'url("#'+this.clipper.attr("id")+'")')},unclip:function(){return delete this.clipper,this.attr("clip-path",null)}}),m.Gradient=m.invent({create:function(t){this.constructor.call(this,m.create(t+"Gradient")),this.type=t},inherit:m.Container,extend:{at:function(t,e,n){return this.put(new m.Stop).update(t,e,n)},update:function(t){return this.clear(),"function"==typeof t&&t.call(this,this),this},fill:function(){return"url(#"+this.id()+")"},toString:function(){return this.fill()},attr:function(t,e,n){return"transform"==t&&(t="gradientTransform"),m.Container.prototype.attr.call(this,t,e,n)}},construct:{gradient:function(t,e){return this.defs().gradient(t,e)}}}),m.extend(m.Gradient,m.FX,{from:function(t,e){return"radial"==(this._target||this).type?this.attr({fx:new m.Number(t),fy:new m.Number(e)}):this.attr({x1:new m.Number(t),y1:new m.Number(e)})},to:function(t,e){return"radial"==(this._target||this).type?this.attr({cx:new m.Number(t),cy:new m.Number(e)}):this.attr({x2:new m.Number(t),y2:new m.Number(e)})}}),m.extend(m.Defs,{gradient:function(t,e){return this.put(new m.Gradient(t)).update(e)}}),m.Stop=m.invent({create:"stop",inherit:m.Element,extend:{update:function(t){return("number"==typeof t||t instanceof m.Number)&&(t={offset:arguments[0],color:arguments[1],opacity:arguments[2]}),null!=t.opacity&&this.attr("stop-opacity",t.opacity),null!=t.color&&this.attr("stop-color",t.color),null!=t.offset&&this.attr("offset",new m.Number(t.offset)),this}}}),m.Pattern=m.invent({create:"pattern",inherit:m.Container,extend:{fill:function(){return"url(#"+this.id()+")"},update:function(t){return this.clear(),"function"==typeof t&&t.call(this,this),this},toString:function(){return this.fill()},attr:function(t,e,n){return"transform"==t&&(t="patternTransform"),m.Container.prototype.attr.call(this,t,e,n)}},construct:{pattern:function(t,e,n){return this.defs().pattern(t,e,n)}}}),m.extend(m.Defs,{pattern:function(t,e,n){return this.put(new m.Pattern).update(n).attr({x:0,y:0,width:t,height:e,patternUnits:"userSpaceOnUse"})}}),m.Doc=m.invent({create:function(t){t&&("svg"==(t="string"==typeof t?e.getElementById(t):t).nodeName?this.constructor.call(this,t):(this.constructor.call(this,m.create("svg")),t.appendChild(this.node),this.size("100%","100%")),this.namespace().defs())},inherit:m.Container,extend:{namespace:function(){return this.attr({xmlns:m.ns,version:"1.1"}).attr("xmlns:xlink",m.xlink,m.xmlns).attr("xmlns:svgjs",m.svgjs,m.xmlns)},defs:function(){var t;this._defs||((t=this.node.getElementsByTagName("defs")[0])?this._defs=m.adopt(t):this._defs=new m.Defs,this.node.appendChild(this._defs.node));return this._defs},parent:function(){return"#document"==this.node.parentNode.nodeName?null:this.node.parentNode},spof:function(){var t=this.node.getScreenCTM();return t&&this.style("left",-t.e%1+"px").style("top",-t.f%1+"px"),this},remove:function(){return this.parent()&&this.parent().removeChild(this.node),this}}}),m.Shape=m.invent({create:function(t){this.constructor.call(this,t)},inherit:m.Element}),m.Bare=m.invent({create:function(t,e){if(this.constructor.call(this,m.create(t)),e)for(var n in e.prototype)"function"==typeof e.prototype[n]&&(this[n]=e.prototype[n])},inherit:m.Element,extend:{words:function(t){for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);return this.node.appendChild(e.createTextNode(t)),this}}}),m.extend(m.Parent,{element:function(t,e){return this.put(new m.Bare(t,e))},symbol:function(){return this.defs().element("symbol",m.Container)}}),m.Use=m.invent({create:"use",inherit:m.Shape,extend:{element:function(t,e){return this.attr("href",(e||"")+"#"+t,m.xlink)}},construct:{use:function(t,e){return this.put(new m.Use).element(t,e)}}}),m.Rect=m.invent({create:"rect",inherit:m.Shape,construct:{rect:function(t,e){return this.put(new m.Rect).size(t,e)}}}),m.Circle=m.invent({create:"circle",inherit:m.Shape,construct:{circle:function(t){return this.put(new m.Circle).rx(new m.Number(t).divide(2)).move(0,0)}}}),m.extend(m.Circle,m.FX,{rx:function(t){return this.attr("r",t)},ry:function(t){return this.rx(t)}}),m.Ellipse=m.invent({create:"ellipse",inherit:m.Shape,construct:{ellipse:function(t,e){return this.put(new m.Ellipse).size(t,e).move(0,0)}}}),m.extend(m.Ellipse,m.Rect,m.FX,{rx:function(t){return this.attr("rx",t)},ry:function(t){return this.attr("ry",t)}}),m.extend(m.Circle,m.Ellipse,{x:function(t){return null==t?this.cx()-this.rx():this.cx(t+this.rx())},y:function(t){return null==t?this.cy()-this.ry():this.cy(t+this.ry())},cx:function(t){return null==t?this.attr("cx"):this.attr("cx",t)},cy:function(t){return null==t?this.attr("cy"):this.attr("cy",t)},width:function(t){return null==t?2*this.rx():this.rx(new m.Number(t).divide(2))},height:function(t){return null==t?2*this.ry():this.ry(new m.Number(t).divide(2))},size:function(t,e){var n=d(this,t,e);return this.rx(new m.Number(n.width).divide(2)).ry(new m.Number(n.height).divide(2))}}),m.Line=m.invent({create:"line",inherit:m.Shape,extend:{array:function(){return new m.PointArray([[this.attr("x1"),this.attr("y1")],[this.attr("x2"),this.attr("y2")]])},plot:function(t,e,n,i){return t=void 0!==e?{x1:t,y1:e,x2:n,y2:i}:new m.PointArray(t).toLine(),this.attr(t)},move:function(t,e){return this.attr(this.array().move(t,e).toLine())},size:function(t,e){var n=d(this,t,e);return this.attr(this.array().size(n.width,n.height).toLine())}},construct:{line:function(t,e,n,i){return this.put(new m.Line).plot(t,e,n,i)}}}),m.Polyline=m.invent({create:"polyline",inherit:m.Shape,construct:{polyline:function(t){return this.put(new m.Polyline).plot(t)}}}),m.Polygon=m.invent({create:"polygon",inherit:m.Shape,construct:{polygon:function(t){return this.put(new m.Polygon).plot(t)}}}),m.extend(m.Polyline,m.Polygon,{array:function(){return this._array||(this._array=new m.PointArray(this.attr("points")))},plot:function(t){return this.attr("points",this._array=new m.PointArray(t))},move:function(t,e){return this.attr("points",this.array().move(t,e))},size:function(t,e){var n=d(this,t,e);return this.attr("points",this.array().size(n.width,n.height))}}),m.extend(m.Line,m.Polyline,m.Polygon,{morphArray:m.PointArray,x:function(t){return null==t?this.bbox().x:this.move(t,this.bbox().y)},y:function(t){return null==t?this.bbox().y:this.move(this.bbox().x,t)},width:function(t){var e=this.bbox();return null==t?e.width:this.size(t,e.height)},height:function(t){var e=this.bbox();return null==t?e.height:this.size(e.width,t)}}),m.Path=m.invent({create:"path",inherit:m.Shape,extend:{morphArray:m.PathArray,array:function(){return this._array||(this._array=new m.PathArray(this.attr("d")))},plot:function(t){return this.attr("d",this._array=new m.PathArray(t))},move:function(t,e){return this.attr("d",this.array().move(t,e))},x:function(t){return null==t?this.bbox().x:this.move(t,this.bbox().y)},y:function(t){return null==t?this.bbox().y:this.move(this.bbox().x,t)},size:function(t,e){var n=d(this,t,e);return this.attr("d",this.array().size(n.width,n.height))},width:function(t){return null==t?this.bbox().width:this.size(t,this.bbox().height)},height:function(t){return null==t?this.bbox().height:this.size(this.bbox().width,t)}},construct:{path:function(t){return this.put(new m.Path).plot(t)}}}),m.Image=m.invent({create:"image",inherit:m.Shape,extend:{load:function(t){if(!t)return this
;var n=this,i=e.createElement("img");return i.onload=function(){var e=n.parent(m.Pattern);null!==e&&(0==n.width()&&0==n.height()&&n.size(i.width,i.height),e&&0==e.width()&&0==e.height()&&e.size(n.width(),n.height()),"function"==typeof n._loaded&&n._loaded.call(n,{width:i.width,height:i.height,ratio:i.width/i.height,url:t}))},i.onerror=function(t){"function"==typeof n._error&&n._error.call(n,t)},this.attr("href",i.src=this.src=t,m.xlink)},loaded:function(t){return this._loaded=t,this},error:function(t){return this._error=t,this}},construct:{image:function(t,e,n){return this.put(new m.Image).load(t).size(e||0,n||e||0)}}}),m.Text=m.invent({create:function(){this.constructor.call(this,m.create("text")),this.dom.leading=new m.Number(1.3),this._rebuild=!0,this._build=!1,this.attr("font-family",m.defaults.attrs["font-family"])},inherit:m.Shape,extend:{x:function(t){return null==t?this.attr("x"):(this.textPath||this.lines().each(function(){this.dom.newLined&&this.x(t)}),this.attr("x",t))},y:function(t){var e=this.attr("y"),n="number"==typeof e?e-this.bbox().y:0;return null==t?"number"==typeof e?e-n:e:this.attr("y","number"==typeof t?t+n:t)},cx:function(t){return null==t?this.bbox().cx:this.x(t-this.bbox().width/2)},cy:function(t){return null==t?this.bbox().cy:this.y(t-this.bbox().height/2)},text:function(t){if(void 0===t){t="";for(var e=this.node.childNodes,n=0,i=e.length;n<i;++n)0!=n&&3!=e[n].nodeType&&1==m.adopt(e[n]).dom.newLined&&(t+="\n"),t+=e[n].textContent;return t}if(this.clear().build(!0),"function"==typeof t)t.call(this,this);else{n=0;for(var s=(t=t.split("\n")).length;n<s;n++)this.tspan(t[n]).newLine()}return this.build(!1).rebuild()},size:function(t){return this.attr("font-size",t).rebuild()},leading:function(t){return null==t?this.dom.leading:(this.dom.leading=new m.Number(t),this.rebuild())},lines:function(){var t=(this.textPath&&this.textPath()||this).node,e=m.utils.map(m.utils.filterSVGElements(t.childNodes),function(t){return m.adopt(t)});return new m.Set(e)},rebuild:function(t){if("boolean"==typeof t&&(this._rebuild=t),this._rebuild){var e=this,n=0,i=this.dom.leading*new m.Number(this.attr("font-size"));this.lines().each(function(){this.dom.newLined&&(this.textPath||this.attr("x",e.attr("x")),"\n"==this.text()?n+=i:(this.attr("dy",i+n),n=0))}),this.fire("rebuild")}return this},build:function(t){return this._build=!!t,this},setData:function(t){return this.dom=t,this.dom.leading=new m.Number(t.leading||1.3),this}},construct:{text:function(t){return this.put(new m.Text).text(t)},plain:function(t){return this.put(new m.Text).plain(t)}}}),m.Tspan=m.invent({create:"tspan",inherit:m.Shape,extend:{text:function(t){return null==t?this.node.textContent+(this.dom.newLined?"\n":""):("function"==typeof t?t.call(this,this):this.plain(t),this)},dx:function(t){return this.attr("dx",t)},dy:function(t){return this.attr("dy",t)},newLine:function(){var t=this.parent(m.Text);return this.dom.newLined=!0,this.dy(t.dom.leading*t.attr("font-size")).attr("x",t.x())}}}),m.extend(m.Text,m.Tspan,{plain:function(t){return!1===this._build&&this.clear(),this.node.appendChild(e.createTextNode(t)),this},tspan:function(t){var e=(this.textPath&&this.textPath()||this).node,n=new m.Tspan;return!1===this._build&&this.clear(),e.appendChild(n.node),n.text(t)},clear:function(){for(var t=(this.textPath&&this.textPath()||this).node;t.hasChildNodes();)t.removeChild(t.lastChild);return this},length:function(){return this.node.getComputedTextLength()}}),m.TextPath=m.invent({create:"textPath",inherit:m.Parent,parent:m.Text,construct:{path:function(t){for(var e=new m.TextPath,n=this.doc().defs().path(t);this.node.hasChildNodes();)e.node.appendChild(this.node.firstChild);return this.node.appendChild(e.node),e.attr("href","#"+n,m.xlink),this},plot:function(t){var e=this.track();return e&&e.plot(t),this},track:function(){var t=this.textPath();if(t)return t.reference("href")},textPath:function(){if(this.node.firstChild&&"textPath"==this.node.firstChild.nodeName)return m.adopt(this.node.firstChild)}}}),m.Nested=m.invent({create:function(){this.constructor.call(this,m.create("svg")),this.style("overflow","visible")},inherit:m.Container,construct:{nested:function(){return this.put(new m.Nested)}}}),m.A=m.invent({create:"a",inherit:m.Container,extend:{to:function(t){return this.attr("href",t,m.xlink)},show:function(t){return this.attr("show",t,m.xlink)},target:function(t){return this.attr("target",t)}},construct:{link:function(t){return this.put(new m.A).to(t)}}}),m.extend(m.Element,{linkTo:function(t){var e=new m.A;return"function"==typeof t?t.call(e,e):e.to(t),this.parent().put(e).put(this)}}),m.Marker=m.invent({create:"marker",inherit:m.Container,extend:{width:function(t){return this.attr("markerWidth",t)},height:function(t){return this.attr("markerHeight",t)},ref:function(t,e){return this.attr("refX",t).attr("refY",e)},update:function(t){return this.clear(),"function"==typeof t&&t.call(this,this),this},toString:function(){return"url(#"+this.id()+")"}},construct:{marker:function(t,e,n){return this.defs().marker(t,e,n)}}}),m.extend(m.Defs,{marker:function(t,e,n){return this.put(new m.Marker).size(t,e).ref(t/2,e/2).viewbox(0,0,t,e).attr("orient","auto").update(n)}}),m.extend(m.Line,m.Polyline,m.Polygon,m.Path,{marker:function(t,e,n,i){var s=["marker"];return"all"!=t&&s.push(t),s=s.join("-"),t=arguments[1]instanceof m.Marker?arguments[1]:this.doc().marker(e,n,i),this.attr(s,t)}});var v={stroke:["color","width","opacity","linecap","linejoin","miterlimit","dasharray","dashoffset"],fill:["color","opacity","rule"],prefix:function(t,e){return"color"==e?t:t+"-"+e}};["fill","stroke"].forEach(function(t){var e,n={};n[t]=function(n){if(void 0===n)return this;if("string"==typeof n||m.Color.isRgb(n)||n&&"function"==typeof n.fill)this.attr(t,n);else for(e=v[t].length-1;e>=0;e--)null!=n[v[t][e]]&&this.attr(v.prefix(t,v[t][e]),n[v[t][e]]);return this},m.extend(m.Element,m.FX,n)}),m.extend(m.Element,m.FX,{rotate:function(t,e,n){return this.transform({rotation:t,cx:e,cy:n})},skew:function(t,e,n,i){return 1==arguments.length||3==arguments.length?this.transform({skew:t,cx:e,cy:n}):this.transform({skewX:t,skewY:e,cx:n,cy:i})},scale:function(t,e,n,i){return 1==arguments.length||3==arguments.length?this.transform({scale:t,cx:e,cy:n}):this.transform({scaleX:t,scaleY:e,cx:n,cy:i})},translate:function(t,e){return this.transform({x:t,y:e})},flip:function(t,e){return this.transform({flip:t,offset:e})},matrix:function(t){return this.attr("transform",new m.Matrix(t))},opacity:function(t){return this.attr("opacity",t)},dx:function(t){return this.x((this instanceof m.FX?0:this.x())+t,!0)},dy:function(t){return this.y((this instanceof m.FX?0:this.y())+t,!0)},dmove:function(t,e){return this.dx(t).dy(e)}}),m.extend(m.Rect,m.Ellipse,m.Circle,m.Gradient,m.FX,{radius:function(t,e){var n=(this._target||this).type;return"radial"==n||"circle"==n?this.attr("r",new m.Number(t)):this.rx(t).ry(null==e?t:e)}}),m.extend(m.Path,{length:function(){return this.node.getTotalLength()},pointAt:function(t){return this.node.getPointAtLength(t)}}),m.extend(m.Parent,m.Text,m.FX,{font:function(t){for(var e in t)"leading"==e?this.leading(t[e]):"anchor"==e?this.attr("text-anchor",t[e]):"size"==e||"family"==e||"weight"==e||"stretch"==e||"variant"==e||"style"==e?this.attr("font-"+e,t[e]):this.attr(e,t[e]);return this}}),m.Set=m.invent({create:function(t){Array.isArray(t)?this.members=t:this.clear()},extend:{add:function(){var t,e,n=[].slice.call(arguments);for(t=0,e=n.length;t<e;t++)this.members.push(n[t]);return this},remove:function(t){var e=this.index(t);return e>-1&&this.members.splice(e,1),this},each:function(t){for(var e=0,n=this.members.length;e<n;e++)t.apply(this.members[e],[e,this.members]);return this},clear:function(){return this.members=[],this},length:function(){return this.members.length},has:function(t){return this.index(t)>=0},index:function(t){return this.members.indexOf(t)},get:function(t){return this.members[t]},first:function(){return this.get(0)},last:function(){return this.get(this.members.length-1)},valueOf:function(){return this.members},bbox:function(){var t=new m.BBox;if(0==this.members.length)return t;var e=this.members[0].rbox();return t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,this.each(function(){t=t.merge(this.rbox())}),t}},construct:{set:function(t){return new m.Set(t)}}}),m.FX.Set=m.invent({create:function(t){this.set=t}}),m.Set.inherit=function(){var t=[];for(var e in m.Shape.prototype)"function"==typeof m.Shape.prototype[e]&&"function"!=typeof m.Set.prototype[e]&&t.push(e);for(var e in t.forEach(function(t){m.Set.prototype[t]=function(){for(var e=0,n=this.members.length;e<n;e++)this.members[e]&&"function"==typeof this.members[e][t]&&this.members[e][t].apply(this.members[e],arguments);return"animate"==t?this.fx||(this.fx=new m.FX.Set(this)):this}}),t=[],m.FX.prototype)"function"==typeof m.FX.prototype[e]&&"function"!=typeof m.FX.Set.prototype[e]&&t.push(e);t.forEach(function(t){m.FX.Set.prototype[t]=function(){for(var e=0,n=this.set.members.length;e<n;e++)this.set.members[e].fx[t].apply(this.set.members[e].fx,arguments);return this}})},m.extend(m.Element,{data:function(t,e,n){if("object"==typeof t)for(e in t)this.data(e,t[e]);else if(arguments.length<2)try{return JSON.parse(this.attr("data-"+t))}catch(i){return this.attr("data-"+t)}else this.attr("data-"+t,null===e?null:!0===n||"string"==typeof e||"number"==typeof e?e:JSON.stringify(e));return this}}),m.extend(m.Element,{remember:function(t,e){if("object"==typeof arguments[0])for(var e in t)this.remember(e,t[e]);else{if(1==arguments.length)return this.memory()[t];this.memory()[t]=e}return this},forget:function(){if(0==arguments.length)this._memory={};else for(var t=arguments.length-1;t>=0;t--)delete this.memory()[arguments[t]];return this},memory:function(){return this._memory||(this._memory={})}}),m.get=function(t){var n=e.getElementById(y(t)||t);return m.adopt(n)},m.select=function(t,n){return new m.Set(m.utils.map((n||e).querySelectorAll(t),function(t){return m.adopt(t)}))},m.extend(m.Parent,{select:function(t){return m.select(t,this.node)}});var w="abcdef".split("");if("function"!=typeof k){var k=function(t,n){n=n||{bubbles:!1,cancelable:!1,detail:undefined};var i=e.createEvent("CustomEvent");return i.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),i};k.prototype=t.Event.prototype,t.CustomEvent=k}return function(e){for(var n=0,i=["moz","webkit"],s=0;s<i.length&&!t.requestAnimationFrame;++s)e.requestAnimationFrame=e[i[s]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[i[s]+"CancelAnimationFrame"]||e[i[s]+"CancelRequestAnimationFrame"];e.requestAnimationFrame=e.requestAnimationFrame||function(t){var i=(new Date).getTime(),s=Math.max(0,16-(i-n)),a=e.setTimeout(function(){t(i+s)},s);return n=i+s,a},e.cancelAnimationFrame=e.cancelAnimationFrame||e.clearTimeout}(t),m}),window.ysy=window.ysy||{},ysy.main=ysy.main||{},EasyGem.extend(ysy.main,{extender:function(t,e,n){function i(){}i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e,EasyGem.extend(e.prototype,n)},getModal:function(t,e){var n=$("#"+t);return 0===n.length&&((n=$("<div id="+t+">")).dialog({width:e,appendTo:document.body,modal:!0,resizable:!1,dialogClass:"modal",position:{my:"top",at:"top"}}),n.dialog("close")),n},toMomentFormat:function(t){switch(t){case"%Y-%m-%d":return"YYYY-MM-DD";case"%Y/%m/%d":return"YYYY/MM/DD";case"%d/%m/%Y":return"DD/MM/YYYY";case"%d.%m.%Y":return"DD.MM.YYYY";case"%d-%m-%Y":return"DD-MM-YYYY";case"%m/%d/%Y":return"MM/DD/YYYY";case"%d %b %Y":return"DD MMM YYYY";case"%d %B %Y":return"DD MMMM YYYY";case"%b %d, %Y":return"MMM DD, YYYY";case"%B %d, %Y":return"MMMM DD, YYYY";default:return"D. M. YYYY"}},startsWith:function(t,e){return t.startsWith?t.startsWith(e):t.toString().charAt(0)===e},isSameMoment:function(t,e){return!!moment.isMoment(t)&&(!!moment.isMoment(e)&&t.isSame(e))},createPerformanceMeter:function(t){var e=window.performance.now(),n=!1,i=e,s=function(i){if(!n){var s=window.performance.now(),a=t+" "+i+":                                  ";a=a.substr(0,30);var r="        "+(s-e).toFixed(3);r=r.substr(r.length-10),console.debug(a+r+" ms"),e=s}};return s.whole=function(){if(!n){var e=window.performance.now(),s=t+":                                  ";s=s.substr(0,30);var a="        "+(e-i).toFixed(3);a=a.substr(a.length-10),console.debug(s+a+" ms")}},s.silence=function(t){n=!t},s},formToJson:function(t){for(var e={},n=function(t,e,i){var s=e.shift();if(""===s)t.push(i);else if(e.length>0){var a=e[0];t[s]||(t[s]=""===a?[]:{}),n(t[s],e,i)}else!isNaN(i)&&i.length&&(i=+i),t[s]=i},i=0;i<t.length;i++){var s=t[i].name.split(/]\[|\[|]/);s.length>1&&s.pop(),n(e,s,t[i].value)}return e},escapeText:function(t){var e=document.createElement("div");return e.appendChild(document.createTextNode(t)),e.innerHTML},setFirstDayOfWeek:function(){moment.updateLocale(moment().locale(),{week:{dow:EASY.datepickerOptions.firstDay||1}})},_resourcesStringToFloat:function(t){if(0!==t.length)for(var e in t)t.hasOwnProperty(e)&&(t[e]=parseFloat(t[e]))},_resourcesObjectToFloat:function(t){if(0!==t.length)for(var e in t)t.hasOwnProperty(e)&&t[e].hasOwnProperty("hours")&&(t[e].hours=parseFloat(t[e].hours))},checkForStorageValue:function(t,e){let n=e;return JSON.parse(ysy.data.storage.getPersistentData(t))&&(n=JSON.parse(ysy.data.storage.getPersistentData(t))),n}}),window.ysy=window.ysy||{},ysy.data=ysy.data||{},ysy.data.Data=function(){this._onChange=[],this._deleted=!1,this._created=!1,this._changed=!1,this._cache=null},ysy.data.Data.prototype={permissions:null,problems:{},init:function(t,e){return this._old=t,EasyGem.extend(this,t),this._parent=e,this._postInit(),this},_postInit:function(){},set:function(t,e){let n=!0;if("object"==typeof t){t.hasOwnProperty("history")&&(n=t.history,delete t.history);var i=t}else(i={})[t]=e;var s={};for(var a in i)if(i.hasOwnProperty(a)){var r=i[a],o=this[a];if(r!==o){if(ysy.main.isSameMoment(o,r)){ysy.log.debug("date filtered as same","set");continue}s[a]=o,s[a]===undefined&&(s[a]=null)}else ysy.log.debug(a+"="+r+" filtered as same","set")}return!$.isEmptyObject(s)&&(s._changed=this._changed,$.extend(this,i),this._fireChanges(this,"set"),!n||(ysy.history.add(s,this),this._changed=!0,!0))},register:function(t,e){for(var n=0;n<this._onChange.length;n++){if(this._onChange[n].ctx===e)return void(this._onChange[n]={func:t,ctx:e})}this._onChange.push({func:t,ctx:e})},unregister:function(t){for(var e=[],n=0;n<this._onChange.length;n++){var i=this._onChange[n];i.ctx!==t&&e.push(i)}this._onChange=e},setSilent:function(t,e){if("object"==typeof t){var n,i,s;for(var a in t)t.hasOwnProperty(a)&&(i=t[a])!==(s=this[a])&&(ysy.main.isSameMoment(s,i)||(this[a]=i,n=!0));return n||!1}return this[t]!==e&&(this[t]=e,!0)},_fireChanges:function(t,e,n){if(t){var i="";if(e&&(i=" because of "+e),t===this)var s="itself";else s=this._name;var a=t._name;a||(a=t.name),a||ysy.log.warning(t),ysy.log.log("* "+a+" ordered repaint on "+s+i)}if(n)var r=this._onChildChange;else r=this._onChange,this._cache=null;r.length>0?ysy.log.log("- "+this._name+(n?" on ChildChange":" onChange")+" fired for "+r.length+" widgets"):ysy.log.log("- no "+(n?"childChange":"change")+" for "+this._name);for(var o=0;o<r.length;o++){var d=r[o].ctx;d&&!d.deleted?(ysy.log.log("-- changes to "+(d.name?d.name:d._name)+" widget"),r[o].func.call(d,e)):r.splice(o,1)}},remove:function(){if(!this._deleted){var t=this._changed;this._changed=!0,this._deleted=!0,this._parent&&this._parent.isArray&&this._parent.pop(this),ysy.history.add(function(){this._changed=t,this._deleted=!1,this._parent&&this._parent.isArray&&this._parent._fireChanges(this,"revert parent")},this),this._fireChanges(this,"remove")}},removeSilent:function(){this._deleted||(this._deleted=!0)},clearCache:function(){this._cache=null},getDiff:function(t){var e={},n=!1;for(var i in t)if(t.hasOwnProperty(i)){var s=t[i];if(s!=this._old[i]){if(moment.isMoment(s)&&s.format("YYYY-MM-DD")===this._old[i])continue;e[i]=t[i],n=!0}}return n?e:null},isEditable:function(){return!!this.permissions&&!!this.permissions.editable},getProblems:function(){if(this._cache&&this._cache.problems!==undefined)return this._cache.problems;var t=[];for(var e in this.problems)if(this.problems.hasOwnProperty(e)){var n=this.problems[e].call(this);n&&t.push(n)}return 0===t.length&&(t=!1),this._cache||(this._cache={}),this._cache.problems=t,t}},ysy.data.Array=function(){ysy.data.Data.call(this),this.array=[],this.dict={},this._onChildChange=[]},ysy.main.extender(ysy.data.Data,ysy.data.Array,{isArray:!0,get:function(t){return t<0||t>=this.array.length?null:this.array[t]},getArray:function(){if(!this._cache){for(var t=[],e=0;e<this.array.length;e++)this.array[e]._deleted||t.push(this.array[e]);this._cache=t}return this._cache},getByID:function(t){if(t===undefined||null===t)return null;var e=this.dict[t];if(e)return e;for(var n=0;n<this.array.length;n++)if(t===this.array[n].id)return this.dict[t]=this.array[n],this.array[n]},pushSilent:function(t){if(t.id){var e=this.getByID(t.id);if(e){var n=!1;return e._deleted!==t._deleted&&(n=!0),t._onChange=e._onChange,e.setSilent(t),e._fireChanges(this,"pushSame"),n&&this._fireChanges(this,"pushSame"),e}}return t._parent||(t._parent=this),t.register(function(){this.orderFireChildChange(t)},this),this.array.push(t),t.id&&(this.dict[t.id]=t),t},childRegister:function(t,e){for(var n=0;n<this._onChildChange.length;n++){if(this._onChildChange[n].ctx===e)return void(this._onChildChange[n]={func:t,ctx:e})}this._onChildChange.push({func:t,ctx:e})},push:function(t){t._changed=!0,t._created=!0,t=this.pushSilent(t),this._fireChanges(this,"push"),ysy.history.add(function(){this._deleted=!0,this._parent._fireChanges(this,"push revert")},t)},pop:function(t){return t!==undefined&&(t._deleted?void this._fireChanges(this,"pop"):(t.remove(),!0))},clear:function(){this.array=[],this.dict={},this._fireChanges(this,"clear all")},clearSilent:function(){this.array=[],this.dict={},this._cache=null},orderFireChildChange:function(t){if(!this.childChangeTimeout){var e=this;this.childChangeTimeout=setTimeout(function(){e._fireChanges(t,"child updated",!0),e.childChangeTimeout=null},0)}}}),ysy.data.IssuesArray={_name:"IssuesArray"},ysy.data.Issue=function(){ysy.data.Data.call(this)},ysy.main.extender(ysy.data.Data,ysy.data.Issue,{_name:"Issue",ganttType:"task",isIssue:!0,closed:!1,css:"",_postInit:function(){this.start_date&&("string"==typeof this.start_date?this.start_date=moment(this.start_date,"YYYY-MM-DD"):this.start_date._isAMomentObject||(console.error("start_date is not string"),this.start_date=moment(this.start_date).startOf("day"))),this.due_date&&(this.end_date=moment(this.due_date,"YYYY-MM-DD"),delete this.due_date),this.start_date?this._start_date=this.start_date:this.end_date&&this.end_date.isBefore(moment())?this._start_date=moment(this.end_date):this._start_date=moment().startOf("day"),this.end_date?this._end_date=this.end_date:this.start_date&&this.start_date.isAfter(moment())?this._end_date=moment(this.start_date):this._end_date=moment().startOf("day"),this._end_date._isEndDate=!0,this.soonest_start&&(this.soonest_start=moment(this.soonest_start,"YYYY-MM-DD")),this.latest_due&&(this.latest_due=moment(this.latest_due,"YYYY-MM-DD"),this.latest_due._isEndDate=!0),this._transformColumns()},_transformColumns:function(){var t=this.columns;if(t){for(var e={},n=0;n<t.length;n++){var i=t[n],s=i.name.replace(/\./g,"_");e[s]=i.value,i.value_id!==undefined&&(e[s+"_id"]=i.value_id)}this.columns=e}},set:function(t,e){if("object"==typeof t)var n=t;else(n={})[t]=e;return n=this._dateSetHelper(n),ysy.data.Data.prototype.set.call(this,n)},setSilent:function(t,e){if("object"==typeof t)var n=t;else(n={})[t]=e;return n=this._dateSetHelper(n),ysy.data.Data.prototype.setSilent.call(this,n)},_dateSetHelper:function(t){return t.start_date&&(t.start_date.isSame(this._start_date)?delete t.start_date:t._start_date=t.start_date),t.end_date&&(t.end_date.isSame(this._end_date)?delete t.end_date:t._end_date=t.end_date),t},getID:function(){return this.id},getParent:function(){var t=ysy.data.issues.getByID(this.parent_issue_id);if(t&&this.project_id===t.project_id)return this.parent_issue_id;if(this.fixed_version_id){if(t=ysy.data.milestones.getByID(this.fixed_version_id+"p"+this.project_id))return"m"+this.fixed_version_id+"p"+this.project_id;if((t=ysy.data.milestones.getByID(this.fixed_version_id))&&this.project_id===t.project_id)return"m"+this.fixed_version_id}return!!ysy.data.projects.getByID(this.project_id)&&"p"+this.project_id},problems:{checkOverMile:function(){if(ysy.settings.milestonePush&&this.fixed_version_id){var t=ysy.data.milestones.getByID(this.fixed_version_id);if(t&&!t._noDate)return t.start_date.diff(this._end_date,"days")<0?ysy.settings.labels.problems.overMilestone.replace("%{effective_date}",t.start_date.format(gantt.config.date_format)):void 0}},overDue:function(){if(!this.closed&&this.end_date&&this.end_date.isBefore(moment().subtract(1,"day")))return ysy.settings.labels.problems.overdue}},getDuration:function(t){if(t=t||"days",this._cache&&this._cache.duration)return this._cache.duration[t];var e=gantt._working_time_helper.get_work_units_between(this._start_date,this._end_date,"all");return this._cache||(this._cache={}),this._cache.duration=e,e[t]},isOpened:function(){var t=ysy.data.limits.openings[this.getID()];return t===undefined||t}}),ysy.data.Relation=function(){ysy.data.Data.call(this)},ysy.main.extender(ysy.data.Data,ysy.data.Relation,{_name:"Relation",_unlocked:!1,_postInit:function(){},getID:function(){return"r"+this.id},getActDelay:function(){var t=this.getSourceDate(),e=this.getTargetDate();if(!t||!e)return this.delay;var n=0;return t._isEndDate&&(n-=1),e._isEndDate&&(n+=1),e.diff(t,"days")+n},getSourceDate:function(t){return t||(t=this.getSource()),t?"precedes"===this.type?t._end_date:"finish_to_finish"===this.type?t._end_date:"start_to_start"===this.type?t._start_date:"start_to_finish"===this.type?t._start_date:null:null},getTargetDate:function(t){return t||(t=this.getTarget()),t?"precedes"===this.type?t._start_date:"finish_to_finish"===this.type?t._end_date:"start_to_start"===this.type?t._start_date:"start_to_finish"===this.type?t._end_date:null:null},getSourceCorrection:function(){return"precedes"===this.type?1:"finish_to_finish"===this.type?1:0},getTargetCorrection:function(){return"start_to_finish"===this.type?-1:"finish_to_finish"===this.type?-1:0},getProblems:function(){var t=this.getActDelay();if(t<0&&this.checkNegativeDelay())return[];var e=(this.delay||0)-t;return e>0?[ysy.settings.labels.problems.shortDelay.replace("%{diff}",e.toFixed(0))]:[]},checkDelay:function(){var t=this.getActDelay();return!!(t<0&&this.checkNegativeDelay())||t>=(this.delay||0)},checkNegativeDelay:function(){var t=this.getSourceDate(),e=this.getTargetDate();if(!t||!e)return!0;var n=gantt._working_time_helper.get_work_units_between(t,e,"days");return this.delay<=n},getSource:function(){return ysy.data.issues.getByID(this.source_id)},getTarget:function(){return ysy.data.issues.getByID(this.target_id)},isEditable:function(){var t=this.getSource();if(!t)return!1;if(t.isEditable())return!0;var e=this.getTarget();return!!e&&(!!e.isEditable()||void 0)},isHalfLink:function(){return!(ysy.data.issues.getByID(this.source_id)&&ysy.data.issues.getByID(this.target_id))}}),ysy.data.SimpleRelation=function(){ysy.data.Data.call(this)},ysy.main.extender(ysy.data.Relation,ysy.data.SimpleRelation,{_name:"SimpleRelation",isSimple:!0,sendMoveRequest:function(){return!1},isEditable:function(){return!1}}),ysy.data.Milestone=function(){ysy.data.Data.call(this)},ysy.main.extender(ysy.data.Data,ysy.data.Milestone,{_name:"Milestone",ganttType:"milestone",milestone:!0,_postInit:function(){this.start_date&&("string"==typeof this.start_date?this.start_date=moment(this.start_date,"YYYY-MM-DD"):this.start_date=moment(this.start_date).startOf("day")),this.start_date||(this._noDate=!0,this.start_date=moment().startOf("day"))},getID:function(){return"m"+this.id},getIssues:function(){for(var t=[],e=ysy.data.issues.getArray(),n=0;n<e.length;n++)e[n].fixed_version_id===this.id&&t.push(e[n]);return t},_fireChanges:function(t,e){ysy.data.Data.prototype._fireChanges.call(this,t,e);for(var n=this.getIssues(),i=0;i<n.length;i++)n[i]._fireChanges(this,"milestone change")},getProblems:function(){return!1},getParent:function(){return!!ysy.data.projects.getByID(this.project_id)&&"p"+this.project_id},isOpened:function(){var t=ysy.data.limits.openings[this.getID()];return t===undefined||t}}),ysy.data.SharedMilestone=function(){ysy.data.Milestone.call(this)},ysy.main.extender(ysy.data.Milestone,ysy.data.SharedMilestone,{_name:"SharedMilestone",isShared:!0,ganttSubtype:"shared_milestone",_postInit:function(){this.real_id=this.id,this.id=this.id+"p"+this.project_id,this.css="gantt_milestone_shared",this.__proto__.__proto__._postInit.call(this),this.real_milestone.register(function(t){"revert"!==t&&(this.start_date.isSame(this.real_milestone.start_date)||this.set({start_date:moment(this.real_milestone.start_date)}))},this)},isEditable:function(){return!1}}),ysy.data.Project=function(){ysy.data.Data.call(this)},ysy.main.extender(ysy.data.Data,ysy.data.Project,{_name:"Project",ganttType:"project",isProject:!0,needLoad:!0,issues_count:0,has_subprojects:!1,_shift:0,_postInit:function(){this.start_date=this.start_date?moment(this.start_date,"YYYY-MM-DD"):null,this.due_date&&(this.end_date=moment(this.due_date,"YYYY-MM-DD"),this.end_date._isEndDate=!0),delete this.due_date,this.is_baseline&&(this._ignore=!0),this.project_id=this.id,this.hadIssue=!!this.issues_count,ysy.settings.projectID===this.id&&(ysy.data.limits.openings[this.getID()]=!0,this.needLoad=!1),ysy.settings.global&&(this.needLoad=this.needLoad&&this.has_subprojects),this._transformColumns()},_transformColumns:function(){var t=this.columns;if(t){for(var e={},n=0;n<t.length;n++){var i=t[n],s=i.name.replace(/\./g,"_");e[s]=i.value,i.value_id!==undefined&&(e[s+"_id"]=i.value_id)}this.columns=e}},getID:function(){return"p"+this.id},problems:{},getProgress:function(){return this.done_ratio/100||0},getParent:function(){return!!ysy.data.projects.getByID(this.parent_id)&&"p"+this.parent_id},isOpened:function(){return ysy.data.limits.openings[this.getID()]||!1}}),window.ysy=window.ysy||{},ysy.view=ysy.view||{},ysy.view.Widget=function(){this.$target=null,this.parent=null,this.children=[],this.repaintRequested=!0,this.keepPaintedState=!1,this.deleted=!1,this.regs=[null,null,null,null]},ysy.view.Widget.prototype={name:"Widget",init:function(t){if(t instanceof Array&&ysy.log.error("Array Model"),this.model&&this.model.unregister(this),arguments.length>1)for(var e=1;e<arguments.length;e++)arguments[e]&&this._register(arguments[e],e);return t&&(this.model=t,this._register(t)),this._updateChildren(),this._postInit(),this},requestRepaint:function(){this.repaintRequested=!0},_updateChildren:function(){},_postInit:function(){},_register:function(t,e){t&&(e&&(this.regs[e]&&this.regs[e].unregister(this),this.regs[e]=t),t.register(function(){this._updateChildren(),this.requestRepaint()},this))},out:function(){},repaint:function(t){if(this.hidden)this.repaintRequested=!0;else if(this.keepPaintedState)this.onNoRepaint();else if(this.repaintRequested||t)ysy.log.log("--- RepaintCore in "+this.name),this.repaintRequested=!!this._repaintCore();else{this.onNoRepaint();for(var e=0;e<this.children.length;e++)this.children[e].repaint()}},_repaintCore:function(){if(!this.template){var t=ysy.view.getTemplate(this.templateName);if(!t)return!0;this.template=t}if(null===this.$target)throw"Target is null for "+this.templateName;this.$target.html(Mustache.render(this.template,this.out())),this.tideFunctionality();for(var e=0;e<this.children.length;e++){var n=this.children[e];this.setChildTarget(n,e),n.repaint(!0)}return!1},onNoRepaint:function(){},tideFunctionality:function(){},setChildTarget:function(){},destroy:function(){this.deleted=!0},_getChildByID:function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].id===t)return this.children[e];return null},_getChildByName:function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].name===t)return this.children[e];return null}},ysy.view.Main=function(){ysy.view.Widget.call(this),this.name="MainWidget"},ysy.main.extender(ysy.view.Widget,ysy.view.Main,{init:function(t){this.$target=$("#easy_gantt"),this.model=t,ysy.view.onRepaint.push($.proxy(this.repaint,this)),this._register(null),this._updateChildren(),ysy.view.mainWidget=this},_updateChildren:function(){if(!(this.children.length>0)){var t=new ysy.view.Toolbars;t.init(),t.$target=$("#content"),this.children.push(t);var e=new ysy.view.Gantt;e.$target=$("#gantt_cont")[0],e.init(ysy.data.baselines),this.children.push(e)}},_repaintCore:function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];this.setChildTarget(e,t),e.repaint(!0)}},setChildTarget:function(){}}),ysy.view.LinkPopup=function(){ysy.view.Widget.call(this)},ysy.main.extender(ysy.view.Widget,ysy.view.LinkPopup,{name:"PopupWidget",templateName:"LinkConfigPopup",init:function(t,e){return this.model&&this.model.unregister(this),this.model=t,this.dhtml=e,this._register(t),this},requestRepaint:function(){ysy.log.debug("Popup requestRepaint()","link_config")},out:function(){ysy.log.debug("Popup out()","link_config");var t=ysy.view.getLabel("delay"),e=ysy.view.getLabel("buttons");return{readonly:this.dhtml.readonly,title:t.title,delay:this.dhtml.delay,label_delay:t.label,button_delete:e.button_delete,button_submit:e.button_submit}},tideFunctionality:function(){var t=this.model,e=this.dhtml,n=this.$target;const i=gantt.getTask(e.source),s=gantt.getTask(e.target);ysy.settings.easyRedmine||n.addClass("redmine");var a=function(){ysy.log.debug("close link popup","link_config"),hideModal()};n.find("#link_delete").on("click",function(){t.remove(),a()}),n.keyup(function(t){13===t.keyCode&&$("#link_close").click()}),n.find("#link_close").on("click",function(){var t=parseInt(n.find("#link_delay_input").val());!isNaN(t)&&t<-1&&(t=-1,showFlashMessage("warning",Mustache.render(ysy.settings.labels.warnings.change_link_length,{source_task:i.text,target_task:s.text,minimum_link_length:-1}),15e3)),a(),isNaN(t)||t===e.delay||(e.delay=t||0,e.widget.update(e))}),n.find("#link_use_current").on("click",function(){var n=t.getActDelay();a(),e.delay=n||0,e.widget.update(e)}),n.find("#link_remove_delay").on("click",function(){a(),e.delay=0,e.widget.update(e)})}}),window.ysy=window.ysy||{},ysy.view=ysy.view||{},ysy.view.getGanttBackground=function(){function t(){var t="rgba(200, 200, 200, 0.25)";if(!window.getComputedStyle)return t;var e=window.getComputedStyle(document.getElementsByTagName("body")[0]).getPropertyValue("background-color")||"";if(!e.match(/rgba?\([0-9, ]+\)/))return t;for(var n=e.replace(/^rgba?\(|\s+|\)$/g,"").split(","),i=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2])],s=[],a=3,r=0;r<3;r++){var o=i[r];o>255*(a-1)/a?s.push(255-(255-o)*a):s.push(Math.floor(o/a))}return"rgba("+s.join(", ")+", 0.25)"}var e=ysy.settings.styles.backgrounds,n=t();return{fullCanvasRender:!1,container:gantt.$task_bg,renderer:!0,filter:gantt._create_filter(["_filter_task","_is_chart_visible","_is_std_background"]),lastItems:null,lastPos:null,svg:null,lastElements:{},_render_bg_canvas:function(t,i,s){for(var a,r,o=gantt.config.row_height,d=gantt._tasks,l=d.width,h=o*(s.toY-s.fromY),c=0,u=s.fromX;u<s.toX;u++)c+=l[u];for(t.size(c,h),t.node.style.left=d.left[s.fromX]+"px",t.node.style.top=o*s.fromY+"px",t.clear(),u=s.fromY;u<s.toY;u++)if(gantt.getState().selected_task==i[u].id){t.rect(c,o).x(0).y((u-s.fromY)*o).attr("fill",e.selected);break}var _=[],g="l "+c+" 0";for(u=1;u<=s.toY-s.fromY;u++)_.push("M 0 "+(u*o-.5)),_.push(g);for(r=-.5,g="l 0 "+h,u=s.fromX;u<s.toX;u++)(a=l[u])<=0||(r+=a,_.push("M "+r+" 0"),_.push(g));if(t.path(_.join("")).attr("stroke",e.line),"day"===gantt.config.scale_unit){var f=t.group().attr("fill",n);if(ysy.settings.resource.open)for(r=0,u=s.fromX;u<s.toX;u++){a=l[u];var p=0,y=moment(d.trace_x[u]),m=y.format("YYYY-MM-DD"),v=!1,w=i[s.fromY];if("assignee"!==w.type){var k=ysy.data.assignees.getByID(w.widget.model.assigned_to_id||"unassigned");k&&(v=0===k.getMaxHours(m,y))}for(var x=s.fromY;x<s.toY;x++){if("assignee"===i[x].type)0===i[x].widget.model.getMaxHours(m,y)!==v&&(v?f.rect(a,(x-s.fromY)*o-p).x(r).y(p):p=(x-s.fromY)*o,v=!v)}v&&f.rect(a,(s.toY+1)*o).x(r).y(p),r+=a}else{if(!d.weekends){d.weekends=[];for(var b=0;b<d.trace_x.length;b++)d.weekends.push(!gantt._working_time_helper.is_working_day(d.trace_x[b]))}for(r=0,u=s.fromX;u<s.toX;u++)a=l[u],d.weekends[u]&&f.rect(a,h).x(r),r+=a}}if(ysy.settings.resource.open){
var T=t.group().attr("fill",n);for(u=s.fromY;u<s.toY;u++)"assignee"===i[u].type&&T.rect(c,o).y((u-s.fromY)*o);var D=t.group().attr("fill",n.replace("0.25)","0.5)")),M=ysy.data.limits;if(M.start_date){var C=gantt.posFromDate(M.start_date)-gantt.posFromDate(d.trace_x[s.fromX]);C>0&&D.rect(C,h)}if(M.end_date){var E=gantt.posFromDate(M.end_date)-gantt.posFromDate(d.trace_x[s.fromX]);E>0&&E<c&&D.rect(c-E,h).x(E)}}if("day"===gantt.config.scale_unit){for(r=-.5,_=[],g="l 0 "+h,u=s.fromX;u<s.toX;u++){a=d.width[u],1===moment(d.trace_x[u]).date()&&(_.push("M "+r+" 0"),_.push(g)),r+=a}t.path(_.join("")).attr("stroke",e.line_month)}},render_bg_line:function(){},render_item:function(){ysy.log.debug("render_item BG","canvas_bg")},render_items:function(t,e){if(ysy.log.debug("render_items FULL BG","canvas_bg"),e=e||this.node,t)this.lastItems=t;else if(!(t=this.lastItems))return;this.fullCanvasRender?this.render_full_svg(t,e):this.render_shrunken_svg(t,e);var n,i=gantt.config.row_height*t.length;e.style.height=i+"px",$(e).off("mousedown.bg").on("mousedown.bg",function(t){n=t}).off("click.bg").on("click.bg",function(t){if(n&&!(Math.abs(n.pageX-t.pageX)>2||Math.abs(n.pageY-t.pageY)>2)){var i=gantt._order,s=$(e).offset().top,a=Math.floor((t.pageY-s)/gantt.config.row_height);if(!(a<0||a>=i.length)){var r=i[a];gantt.isTaskExists(r)&&(gantt._selected_task==r?gantt.unselectTask():gantt.selectTask(r))}}})},render_shrunken_svg:function(t,e){var n=gantt._tasks,i=gantt.getCachedScroll();this.lastPos=i;var s=gantt.config.row_height,a=n.col_width,r=n.count,o=t.length,d=this.getCanvasLimits(),l=Math.ceil(d.x/a),h=Math.ceil(d.y/s),c=Math.max(i.x-(d.x-window.innerWidth)/2,0),u=Math.max(i.y-(d.y-window.innerHeight)/2,0),_=Math.floor(c/a),g=Math.floor(u/s);_+l>r&&(_=r-l),g+h>o&&(g=o-h);var f=this.svg;f||(f=this._createSvg(e)),this._render_bg_canvas(f,t,{fromX:Math.max(_,0),toX:_+l,fromY:Math.max(g,0),toY:g+h})},render_full_svg:function(t,e){ysy.log.debug("render_items FULL BG","canvas_bg");var n=gantt._tasks.count,i=t.length,s=this.svg;s||(s=this._createSvg(e)),this._render_bg_canvas(s,t,{fromX:0,toX:n,fromY:0,toY:i})},_createSvg:function(t){var e=SVG(t);return $(e.node).css({position:"absolute"}),this.svg=e,e},switchFullRender:function(t){this.fullCanvasRender!==t&&(this.fullCanvasRender=t,this.render_items())},isScrolledOut:function(t,e){if(this.fullCanvasRender)return!1;if(this.forceRender)return!0;var n=this.lastPos;if(!n)return!0;var i=this.getCanvasLimits();if(t!==undefined){var s=(i.x-window.innerWidth)/2;if(Math.abs(t-n.x)>s)return!0}if(e!==undefined){var a=(i.y-window.innerHeight)/2;if(Math.abs(e-n.y)>a)return!0}},getCanvasLimits:function(){return{x:window.innerWidth+600,y:window.innerHeight+600}}}},window.ysy=window.ysy||{},ysy.view=ysy.view||{},ysy.view.bars=ysy.view.bars||{},EasyGem.extend(ysy.view.bars,{_dateCache:{},_rendererStack:{},registerRenderer:function(t,e){this._rendererStack[t]===undefined&&(this._rendererStack[t]=[]);for(var n=this._rendererStack[t],i=!1,s=0;s<n.length;s++)n[s]===e&&(i=!0);i||(n.push(e),this.reconstructRenderer(t))},removeRenderer:function(t,e){var n=this._rendererStack[t];if(n)for(var i=0;i<n.length;i++)if(n[i]===e)return n.splice(i,1),void this.reconstructRenderer(t)},reconstructRenderer:function(t){var e=this._rendererStack[t];0!==e.length?gantt.config.type_renderers[t]=function(t){var n=e.length-1,i=function(){return n<0?gantt._task_default_render:e[n--]};return i().call(this,t,i)}:gantt.config.type_renderers[t]=gantt._task_default_render},getFromDateCache:function(t){var e=this._dateCache[t];return e===undefined&&(e=moment(t),this._dateCache[t]=e),e},insertCanvas:function(t,e){var n=e.getElementsByClassName("task_left");0===n.length?e.appendChild(t):e.insertBefore(t,n[0])},canvasListBuilder:function(){return{__proto__:this.canvasListPrototype}},canvasListPrototype:{limit:8170,build:function(t,e,n,i){this.canvases=[],this.contexts=[],this.starts=[],this.gantt=e,this.isAssignee="assignee"===t.type,this.el=null,this.height=this.isAssignee?e.config.row_height:e._tasks.bar_height,this.columnWidth=e._tasks.col_width;var s=e.posFromDate(n||t.start_date),a=e.posFromDate(i||t.end_date)-s;this.startX=s,this.fullWidth=a;var r=e._tasks;if(a<this.limit)this.el=this.createCanvas(a),this.starts.push(s),this.staticPack={ctx:this.contexts[0],canvas:this.el,start:s,end:s+a};else{this.el=document.createElement("div");for(var o=r.left,d=0;d<o.length&&!(o[d]>=s);d++);for(var l=s;d<o.length&&!(o[d]>a+s);d++)if(o[d]>=l+this.limit){var h=this.createCanvas(o[d-1]-l);this.el.appendChild(h),this.starts.push(l),l=o[d-1]}h=this.createCanvas(s+a-l),this.el.appendChild(h),this.starts.push(l)}if(this.el.className+=" gantt-task-bar-line",this.isAssignee){var c=this.gantt.getTaskTop(t.id);this.el.style.left=s+"px",this.el.style.top=c+"px"}},createCanvas:function(t){var e=document.createElement("canvas");t=Math.round(t),e.style.width=t+"px",e.width=t,e.height=this.height-1,e.className="gantt-task-bar-canvas",this.canvases.push(e);var n=e.getContext("2d");return n.textAlign="center",n.textBaseline="middle",this.contexts.push(n),e},getElement:function(){return this.el},inRange:function(t){var e=gantt.posFromDateCached(t);return e+this.columnWidth>=this.startX&&e<this.fullWidth+this.startX},fillTextAt:function(t,e,n){var i=gantt.posFromDateCached(t),s=this.getPack(i),a=this.getPosPack(i,s),r=s.ctx;n.backgroundColor&&this.fillRectAtPosPack(a,s,n.backgroundColor),r.font=n.fontStyle,r.fillStyle=n.textColor,e=this.fitTextInWidth(e,a.width,r),r.fillText(e,a.middle,this.height/2+1)},fillFormattedTextAt:function(t,e,n,i){var s=gantt.posFromDateCached(t),a=this.getPack(s),r=this.getPosPack(s,a),o=a.ctx;i.backgroundColor&&this.fillRectAtPosPack(r,a,i.backgroundColor,i.shrink),o.font=i.fontStyle,o.fillStyle=i.textColor;var d=e(n,r.width);d=this.fitTextInWidth(d,r.width,o),o.fillText(d,r.middle,this.height/2+1)},fillTwoTextAt:function(t,e,n,i){var s=gantt.posFromDateCached(t),a=this.getPack(s),r=this.getPosPack(s,a),o=a.ctx;i.backgroundColor&&this.fillRectAtPosPack(r,a,i.backgroundColor,i.shrink);var d=this.height/2+1;o.fillStyle=i.textColor,e&&(o.font=i.fontStyle.replace("12px","9px"),d=13*d/10,e=this.fitTextInWidth(e,r.width,o),o.fillText(e,r.middle,3*this.height/12)),n&&(o.font=i.fontStyle,n=this.fitTextInWidth(n,r.width,o),o.fillText(n,r.middle,d))},fillRectAtPosPack:function(t,e,n,i){e.ctx.fillStyle=n,i?e.ctx.fillRect(t.start+1,1,t.width-3,this.height-3):e.ctx.fillRect(t.start,0,t.width,this.height)},roundTo1:function(t){if(t===undefined)return"";var e=t%1;return e<0&&(e+=1),e<this.MARGIN||e>1-this.MARGIN?t.toFixed():t.toFixed(1)},fitTextInWidth:function(t,e,n){if(e-=2,7.2*t.length<e)return t;if(n.font=n.font.replace("12px","9px"),5.3*t.length<e)return t;var i=Math.floor(e/5.3-1);return t.substring(0,i)+".."},getPosPack:function(t,e){var n,i,s=this.columnWidth;return e?(n=t-e.start,t<e.start||t>e.end-s?(i=n+s+Math.min(0,e.end-s-t),{start:n=Math.max(n,0),end:i,middle:Math.floor((n+i)/2),width:i-n}):{start:n,end:n+s,middle:Math.floor(n+s/2),width:s}):null},getPack:function(t){if(this.staticPack)return this.staticPack;for(var e=t+this.columnWidth/2,n=1;n<this.starts.length&&!(this.starts[n]>e);n++);if(n>=this.starts.length){n=this.starts.length;var i=this.startX+this.fullWidth}else i=this.starts[n];return{ctx:this.contexts[n-1],canvas:this.canvases[n-1],start:this.starts[n-1],end:i}}}}),window.ysy=window.ysy||{},ysy.pro=ysy.pro||{},ysy.pro.collapsor=ysy.pro.collapsor||{},EasyGem.extend(ysy.pro.collapsor,{templateHtml:null,patch:function(){var t=$("#close_all_something");this.templateHtml='<div id="gantt_grid_collapsors" class="gantt_grid_head_buttons_collapse hidden">'+t.html()+"</div>",t.remove()},extendees:[{id:"toggle_level_open",bind:function(){const t=!!ysy.settings.project;this.model=ysy.data.limits,this.model.currentLevel=0,this.model.maxLevel=0,t&&(this.model.currentLevel=1,this.model.maxLevel=1)},func:function(){const t=this.model.openings,e=ysy.data.projects.getArray();if(e.find(t=>t.needLoad)&&this.model.maxLevel++,this.model.projectsClosed)for(let n=0;n<e.length;n++){const i=e[n].getID(),s=gantt._pull[i];this.model.currentLevel===s.$level&&(e[n].needLoad||(t[i]=!0),gantt.open(i))}else for(let t=0;t<e.length;t++){const n=e[t].getID(),i=gantt._pull[n];this.model.currentLevel===i.$level&&gantt.open(n)}return this.model.currentLevel<this.model.maxLevel&&this.model.currentLevel++,this.model.projectsClosed=!1,this.model._fireChanges(this,"close_all_projects"),!1}},{id:"toggle_level_close",bind:function(){this.model=ysy.data.limits,this.model.projectsClosed=!0},func:function(){const t=this.model.openings,e=ysy.data.projects.getArray();for(i=0;i<e.length;i++){const n=e[i].getID(),s=gantt._pull[n];this.model.currentLevel-1===s.$level&&(delete t[e[i].getID()],gantt.close(n))}this.model.currentLevel>0&&this.model.currentLevel--,this.model.projectsClosed=!0}},{id:"close_all_parent_issues",bind:function(){this.model=ysy.data.limits},func:function(){var t=this.model.openings,e=ysy.data.issues.getArray();if(this.model.parentsIssuesClosed=!this.model.parentsIssuesClosed,this.model.parentsIssuesClosed)for(var n=0;n<e.length;n++)t[e[n].getID()]=!1;else for(n=0;n<e.length;n++)delete t[e[n].getID()];return this.model._fireChanges(this,"close_all_parent_issues"),!1},isOn:function(){return this.model.parentsIssuesClosed}},{id:"close_all_milestones",bind:function(){this.model=ysy.data.limits},func:function(){var t=this.model.openings,e=ysy.data.milestones.getArray();if(this.model.milestonesClosed=!this.model.milestonesClosed,this.model.milestonesClosed)for(var n=0;n<e.length;n++)t[e[n].getID()]=!1;else for(n=0;n<e.length;n++)delete t[e[n].getID()];return this.model._fireChanges(this,"close_all_milestones"),!1},isOn:function(){return this.model.milestonesClosed}},{id:"close_all_projects",bind:function(){this.model=ysy.data.limits},func:function(){var t=this.model.openings,e=ysy.data.projects.getArray();if(this.model.projectsClosed=!this.model.projectsClosed,this.model.projectsClosed)for(var n=0;n<e.length;n++)e[n].id!==ysy.settings.projectID&&delete t[e[n].getID()];else for(n=0;n<e.length;n++)e[n].needLoad||(t[e[n].getID()]=!0);return this.model._fireChanges(this,"close_all_projects"),!1},isOn:function(){return this.model.projectsClosed}}]}),ysy.view.Collapsors=function(){ysy.view.Widget.call(this)},ysy.main.extender(ysy.view.Widget,ysy.view.Collapsors,{name:"CollapsorsWidget",_postInit:function(){this.model=ysy.settings.resource,this.model.unregister(this),this.model.register(this.requestRepaint,this)},_updateChildren:function(){for(var t=0;t<this.children.length;t++)this.children.destroy();this.children=[];var e=ysy.pro.collapsor;for(t=0;t<e.extendees.length;t++){var n=e.extendees[t],i=new ysy.view.Button;$.extend(i,n),i.init(),this.children.push(i)}},repaint:function(t){var e=$("#gantt_grid_collapsors");if(this.repaintRequested){if(this.model.open)return void e.hide();e.show(),e.off("click").on("click",function(){return!1})}for(var n=0;n<this.children.length;n++){var i=this.children[n];i.$target=this.getChildTarget(i),i.$target.length&&i.repaint(t||this.repaintRequested)}this.repaintRequested=!1},getChildTarget:function(t){return this.$target.find("#"+t.elementPrefix+t.id)}}),window.ysy=window.ysy||{},ysy.view=ysy.view||{},ysy.view.addGanttAddons=function(){gantt.getLinkSourceDate=function(t,e){return"precedes"===e?t.end_date:"finish_to_finish"===e?t.end_date:"start_to_start"===e?t.start_date:"start_to_finish"===e?t.start_date:null},gantt.getLinkTargetDate=function(t,e){return"precedes"===e?t.start_date:"finish_to_finish"===e?t.end_date:"start_to_start"===e?t.start_date:"start_to_finish"===e?t.end_date:null},gantt.getLinkCorrection=function(t){return"precedes"===t?1:"start_to_finish"===t?-1:0},gantt.refreshOnlyTask=function(t){this.refresher.refreshTask(t)},gantt.mergeStopOptions=function(t,e){return e?(e.soonestStart&&(t.soonestStart&&!e.soonestStart.isAfter(t.soonestStart)||(t.soonestStart=e.soonestStart)),e.soonestEnd&&(t.soonestEnd&&!e.soonestEnd.isAfter(t.soonestEnd)||(t.soonestEnd=e.soonestEnd)),e.latestStart&&(t.latestStart&&!e.latestStart.isBefore(t.latestStart)||(t.latestStart=e.latestStart)),e.latestEnd&&(t.latestEnd&&!e.latestEnd.isBefore(t.latestEnd)||(t.latestEnd=e.latestEnd)),t):t},gantt.updateAllTask=function(){ysy.history.openBrack();var t={},e={};ysy.pro.relations.clearRelationData();for(var n=Object.getOwnPropertyNames(gantt._pull).sort().reverse(),i=0;i<n.length;i++){var s=gantt._pull[n[i]];if(s._changed){gantt._tasks_dnd._fix_working_times(s,{mode:s._changed}),gantt._update_parents(s.id,!1);for(var a=gantt.getParent(s.id);a;){var r=gantt._pull[a];if(!r||"task"!==r.type)break;t[a]=r,a=gantt.getParent(a)}t[s.id]=s;for(var o=0;o<s.$source.length;o++)e[s.$source[o]]=!0;for(o=0;o<s.$target.length;o++)e[s.$target[o]]=!0;s._changed=!1}}for(var d in t)t.hasOwnProperty(d)&&(s=t[d],ysy.log.debug("UpdateAllTask update "+s.text,"task_drag"),s.widget.update(s));ysy.settings.milestonePush||gantt.updateMilestoneByChildren(t),ysy.pro.relations.freezeAllRelations(e),ysy.history.closeBrack()},gantt.applyMoveRequests=function(t){for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];n.entity.set({start_date:n.softStart,end_date:n.softEnd})||n.entity._fireChanges({_name:"applyMoveRequests"},"applyMoveRequests")}},gantt.checkLoopedLink=function(t,e,n,i){if(n.indexOf(t.id)>-1)return!1;var s=n.concat([t]);if(t.id===i)return s;for(var a=0;a<t.$target.length;a++){var r=gantt.getLink(t.$target[a]),o=gantt._pull[r.source];if(o){var d=gantt.checkLoopedLink(o,"all",s,i);if(d)return d}}if(ysy.settings.parentIssueDates){if("notUp"!==e){var l=gantt._pull[t.parent];if(l&&"task"===gantt._get_safe_type(l.type)&&(d=gantt.checkLoopedLink(l,"notDown",s,i)))return d}if("notDown"!==e){var h=gantt._branches[t.id];if(h)for(a=0;a<h.length;a++){var c=gantt._pull[h[a]];if(c&&(d=gantt.checkLoopedLink(c,"notUp",s,i)))return d}}}return!1},gantt.isSpaceForLink=function(t,e,n){var i,s=gantt.prepareStop(n,"all");return ysy.pro.relations.clearRelationData(),!s.latestStart&&!s.latestEnd||(i="precedes"===t||"finish_to_finish"===t?e.end_date:e.start_date,"precedes"===t||"start_to_start"===t?(s.latestStart||gantt._working_time_helper.add_worktime(s.latestEnd,-n.duration,"day",!1)).diff(i,"days")>=gantt.getLinkCorrection(t):"finish_to_finish"!==t&&"start_to_finish"!==t||(s.latestEnd||gantt._working_time_helper.add_worktime(s.latestStart,n.duration,"day",!0)).diff(i,"days")>=gantt.getLinkCorrection(t))},gantt.updateMilestoneByChildren=function(t){var e={};for(var n in t)if(t.hasOwnProperty(n)){var i=t[n].widget.model;if(i.fixed_version_id){if(!e[i.fixed_version_id]){var s=ysy.data.milestones.getByID(i.fixed_version_id);if(!s)continue;e[s.id]=s.start_date}e[i.fixed_version_id].isBefore(i.end_date)&&(e[i.fixed_version_id]=i.end_date)}}for(var a in e)e.hasOwnProperty(a)&&(s=gantt._pull["m"+a])&&(s.start_date.add(e[a]-s.start_date),s.widget.update(s))},gantt.render_delay_element=function(t,e){var n=ysy.settings;if(n.resource_on)return!1;if(n.resource.ggrm)return!1;if(t.widget&&t.widget.model.isSimple)return null;var i=gantt.getLinkSourceDate(gantt._pull[t.source],t.type),s=gantt.getLinkTargetDate(gantt._pull[t.target],t.type).diff(i,"hours")/24;s=Math.round(s)-gantt.getLinkCorrection(t.type);var a=(t.delay?t.delay:"")+(s!==t.delay?" ("+s+")":"");return $("<div>").css({position:"absolute",left:e.x,top:e.y}).html(a)[0]},gantt.allowedParent=function(t,e){if(t===e)return!1;var n=t.type;n||(n="task");var i=gantt.config["allowedParent_"+n];if(!i)return!1;if(e.real_id>1e12)return!1;var s=e.type||"task";return i.indexOf(s)>=0},gantt.getShowDate=function(){var t=gantt._restore_scroll_state();return t?this.dateFromPos(t.x+this.config.task_scroll_offset):null},gantt.silentMoveTask=function(t,e){ysy.log.debug("silentMoveTask","move_task");var n=t.id,i=this.getParent(n);if(i!=e){this._replace_branch_child(i,n);var s=this.getChildren(e);s.push(n),this.setParent(t,e),this._branches[e]=s;for(var a=this._getTaskTree(n),r=0;r<a.length;r++){var o=this._pull[a[r]];o&&(o.$level=this.calculateTaskLevel(o))}t.$level=gantt.calculateTaskLevel(t),this.refreshData()}},gantt.getCachedScroll=function(){return gantt._cached_scroll_pos?{x:gantt._cached_scroll_pos.x||0,y:gantt._cached_scroll_pos.y||0}:{x:0,y:0}},gantt.reconstructTree=function(){for(var t=gantt._pull,e=Object.getOwnPropertyNames(t),n=0;n<e.length;n++){var i=t[e[n]];i.realParent!==undefined&&(gantt.silentMoveTask(i,i.realParent),delete i.realParent)}},gantt.getIssuesOfMilestone=function(t){return ysy.data.issues.array.filter(function(e){return e.fixed_version_id===t.real_id})}},window.ysy=window.ysy||{},ysy.view=ysy.view||{},ysy.view.initGantt=function(){function t(t,e){return window.ERUI&&ERUI.sassData!==undefined&&ERUI.sassData[t]!==undefined?parseInt(ERUI.sassData[t]):e}EasyGem.extend(gantt.config,{details_on_dblclick:!1,readonly_project:!0,drag_empty:!0,work_time:!0,correct_work_time:!0,date_format:ysy.main.toMomentFormat(ysy.settings.dateFormat),date_grid:"%j.%n.%Y",links:{finish_to_start:"precedes",start_to_start:"start_to_start",start_to_finish:"start_to_finish",finish_to_finish:"finish_to_finish"},step:1,duration_unit:"day",fit_tasks:!0,row_height:t("gantt-row-height",25),task_height:t("gantt-task-height",20),min_column_width:36,autosize:"y",link_line_width:0,scale_height:60,start_on_monday:!0,order_branch:!0,rearrange_branch:!0,grid_resize:!0,grid_width:ysy.data.limits.columnsWidth.grid_width,task_scroll_offset:250,controls_task:{progress:!0,resize:!0,links:!0},controls_milestone:{},start_date:ysy.data.limits.start_date,end_date:ysy.data.limits.end_date,controls_project:{show_progress:!0,resize:!1},allowedParent_task:["project","milestone","empty"],allowedParent_task_global:["project","milestone"],allowedParent_milestone:["project"],allowedParent_project:["empty"]}),gantt.config.columns=ysy.view.leftGrid.constructColumns(ysy.data.columns),ysy.proManager.fireEvent("ganttConfig",gantt.config),gantt._pull.empty={type:"empty",id:"empty",$target:[],$source:[],columns:{},text:"",start_date:moment()}},ysy.view.applyGanttPatch=function(){function t(){const t=EASY.currentUser.time_zone,e=gantt.date.date_to_str(gantt.config.task_date),n=new Date((new Date).getTime()+6e4*(new Date).getTimezoneOffset()+6e4*t),i=gantt.addMarker({start_date:n,css:"today",title:e(n)});setInterval(function(){const t=gantt.getMarker(i);t.start_date=new Date,t.title=e(t.start_date),gantt.updateMarker(i)},36e5)}var e;ysy.view.leftGrid.patch(),gantt.locale.date=ysy.settings.labels.date,$.extend(gantt.templates,{task_cell_class:function(t,e){return"day"===gantt.config.scale_unit&&1===moment(e).date()},scale_cell_class:function(t){if("day"===gantt.config.scale_unit){var e="";return gantt._working_time_helper.is_working_day(t)||(e+=" weekend"),1===moment(t).date()&&(e+=" first-date"),e}},task_text:function(){return""},task_class:function(t,e,n){const i=n.widget.model;let s="";(n.css&&(s=n.css),s+=" "+(n.type||"task")+"-type",n.widget&&n.widget.model)&&(n.widget.model.getProblems()&&(s+=" wrong"));return s+=` ${i.hasOwnProperty("start_date")&&i.start_date?"":"no-start-date"} ${i.hasOwnProperty("end_date")&&i.end_date?"":"no-due-date"}`},grid_row_class:function(t,e,n){var i="";(n.css&&(i=n.css),n.widget&&n.widget.model)&&(n.widget.model.getProblems()&&(i+=" wrong"));return i+=" "+(n.type||"task")+"-type"},link_class:function(t){var e="type-"+t.type;if(t.widget){var n=t.widget.model;n&&(n.checkDelay()||(e+=" wrong"),n.isSimple&&(e+=" gantt-relation-simple"),t.unlocked&&(e+=" gantt-relation-unlocked"))}return e},drag_link:function(t,e,n,i){var s=ysy.view.getLabel("links");if(gantt._get_link_type(e,i))a=t===n?"loop_link":n&&n.length>12?"link_target_new":n&&gantt.getTask(n).readonly?"link_target_readonly":n&&"project"===gantt.getTask(n).$rendered_type?"project_link":"other";else var a="unsupported_link_type";var r={errorReason:ysy.view.getLabel("errors2")[a],from:gantt.getTask(t).text};if(n){r.to=gantt.getTask(n).text;var o=(e?"start":"finish")+"_to_"+(i?"start":"finish");r.type=s[gantt.config.links[o]]}return Mustache.render(ysy.view.templates.linkDragModal,r)},scale_row_class:function(t){return t.className||""}}),gantt.attachEvent("onRowDragStart",function(t){var e=gantt.getTask(t);return $(".gantt_row").each(function(){var t=gantt._pull[$(this).attr("task_id")];t&&gantt.allowedParent(e,t)&&$(this).addClass("gantt_drag_to_allowed")}),!0}),gantt.attachEvent("onRowDragEnd",function(){$(".gantt_drag_to_allowed").removeClass("gantt_drag_to_allowed")}),t(),gantt.attachEvent("onAfterLinkDelete",function(t,e){e.deleted||e.widget.model._deleted||e.widget.model.remove()}),gantt.attachEvent("onBeforeLinkAdd",function(t,e){if(e.widget)return!0;for(var n,i=ysy.data.relations,s=parseInt(e.source),a=parseInt(e.target),r=i.getArray(),o=0;o<r.length;o++){var d=r[o];if(d.source_id===s&&d.target_id===a)return dhtmlx.message(ysy.view.getLabel("errors2","duplicate_link"),"error"),!1}var l=gantt.getTask(s);if(n=gantt.checkLoopedLink(l,"all",[],a))return n.push(l),n.reverse(),dhtmlx.message(ysy.view.getLabel("errors2","loop_link")+" ("+n.map(function(t){return t.text}).join(" -> ")+")","error"),!1;var h=gantt.getTask(a);return!!gantt.isSpaceForLink(e.type,l,h)||(dhtmlx.message("Cannot create link, milestone would be crossed","error"),!1)}),gantt.attachEvent("onAfterLinkAdd",function(t,e){if(e.widget)return!0;var n={id:t,source_id:parseInt(e.source),target_id:parseInt(e.target),delay:0,permissions:{editable:!0},type:e.type},i=ysy.data.relations,s=new ysy.data.Relation;s.init(n,i),ysy.pro.relations.moveByCreatedLink(e,s,!0)}),ysy.view.taskTooltip.taskTooltipInit(),dhtmlx.message=function(t,e,n){e||(e=t.type,n=(t=t.text).delay),window.showFlashMessage(e,t,n&&n>0?n:undefined)},window.showFlashMessage||(window.showFlashMessage=function(t,e){var n=$("#content");n.find(".flash").remove();var i='<div class="flash {{type}}"><a href="javascript:void(0)" class="close-icon close_button" style="float:right"></a><span>{{{message}}}</span></div>',s=function(){$(this).closest(".flash").fadeOut(500,function(){$(this).remove()})},a=Mustache.render(i,{message:e,type:t});n.prepend($(a)),n.find(".close_button").click(s)}),dhtmlx.dragScroll=function(){var t=$(".gantt_task_bg");if(!t.hasClass("inited")){t.addClass("inited");var e,n=new dhtmlxDnD(t[0],{marker:!0});n.attachEvent("onDragStart",function(){e={},ysy.proManager.forLastPro(function(t){return t(e,n)},"onDragStart")}),n.attachEvent("onDragMove",function(){ysy.proManager.forLastPro(function(t){return t(e,n)},"onDragMove")}),n.attachEvent("onDragEnd",function(){ysy.proManager.forLastPro(function(t){return t(e,n)},"onDragEnd")})}},ysy.proManager.register("onDragStart",function(t,e){return e.destroyMarker(),t.lastScroll=gantt.getCachedScroll(),!0}),ysy.proManager.register("onDragMove",function(t,e){return gantt.scrollTo(Math.max(t.lastScroll.x-e.getDiff().x,0),undefined),!0}),gantt.attachEvent("onTaskOpened",function(t){ysy.data.limits.openings[t]=!0;var e=gantt._pull[t];if(!e||!e.widget)return!0;var n=e.widget.model;n.needLoad&&(n.needLoad=!1,ysy.data.loader.loadSubEntity(e.type,n.id))}),gantt.attachEvent("onTaskClosed",function(t){ysy.data.limits.openings[t]=!1}),gantt.attachEvent("onTaskSelected",function(){var t=gantt._get_tasks_data();gantt._backgroundRenderer.render_items(t)}),gantt.attachEvent("onTaskUnselected",function(t,e){if(!e){var n=gantt._get_tasks_data();gantt._backgroundRenderer.render_items(n)}}),gantt.attachEvent("onLinkValidation",function(t){if(t.source.length>12)return!1;if(t.target.length>12)return!1;var e=gantt.getTask(t.source),n=gantt.getTask(t.target);if(e.readonly&&n.readonly)return!1;for(var i=e.id;0!==i;){var s=gantt.getTask(i);if(s===n)return!1;i=s.parent}for(i=n.id;0!==i;){if((s=gantt.getTask(i))===e)return!1;i=s.parent}return!0}),gantt.attachEvent("onAfterTaskMove",function(t,e){return this.open(e),!0}),gantt._filter_task=function(t,e){return ysy.proManager.eventFilterTask(t,e)},gantt.posFromDate=function(t){var e=this._tasks;"string"==typeof t&&(t=moment(t));var n=t.valueOf(),i={day:864e5,week:6048e5,month:26298e5};if(t._isEndDate&&(n+=i.day),n<=this._min_date)return 0;if(n>=this._max_date)return e.full_width;var s=(n-e.trace_x[0])/i[e.unit],a=Math.floor(s);if(a=Math.min(e.count-1,Math.max(0,a)),e.count===a+1)return e.left[a]+e.width[a]*(n-e.trace_x[a])/(gantt._max_date-e.trace_x[a]);if(n>e.trace_x[a+1]){if(a++,e.count===a+1)return e.left[a]+e.width[a]*(n-e.trace_x[a])/(gantt._max_date-e.trace_x[a])}else for(;0!==a&&n<e.trace_x[a];)a--;var r=(n-e.trace_x[a])/(e.trace_x[a+1]-e.trace_x[a]);return e.left[a]+e.width[a]*r},gantt.dateFromPos2=function(t){var e=this._tasks;if((t<0||t>e.full_width||!e.full_width)&&(e.needRescale=!0,ysy.log.debug("needRescale","outer")),!e.trace_x.length)return 0;var n=t/(e.full_width/e.count),i=Math.floor(n);return(i=Math.min(e.count-1,Math.max(0,i)))===e.count-1?gantt.date.Date(e.trace_x[i].valueOf()+(gantt._max_date-e.trace_x[i])*(t-e.left[i])/e.width[i]):t>e.left[i+1]&&++i===e.count-1?gantt.date.Date(e.trace_x[i].valueOf()+(gantt._max_date-e.trace_x[i])*(t-e.left[i])/e.width[i]):gantt.date.Date(e.trace_x[i].valueOf()+(e.trace_x[i+1]-e.trace_x[i])*(t-e.left[i])/e.width[i])},ysy.view.bars.registerRenderer("task",function(t,e){var n=$(e().call(this,t,e));if(this.hasChild(t.id)||n.hasClass("parent")){n.addClass("gantt_parent_task-subtype");var i=$("<div class='gantt_task_ticks'></div>"),s=1;"week"===gantt._tasks.unit?s=7:"month"===gantt._tasks.unit&&(s=30);var a=t.duration*gantt._tasks.col_width/s;a<20&&i.css({borderLeftWidth:a/2,borderRightWidth:a/2}),n.append(i)}if(t.latest_due){var r=this.posFromDate(t.widget.model.latest_due)-this.posFromDate(t.start_date),o=$(ysy.view.templates.endBlocker.replace("{{pos_x}}",r.toString()));n.prepend(o)}if(t.soonest_start){r=this.posFromDate(t.widget.model.soonest_start)-this.posFromDate(t.start_date),o=$(ysy.view.templates.preBlocker.replace("{{pos_x}}",r.toString()));n.prepend(o)}return n[0]}),gantt._default_task_date=function(){return moment()},gantt.attachEvent("onScrollTo",function(t,e){var n=gantt._backgroundRenderer;n.isScrolledOut(t,e)&&n.render_items()}),$(document).add("#content").on("scroll",function(){if(!e){if(!gantt.$task)return;e=$(gantt.$task).offset().top}var t=$(this).scrollTop();gantt.scrollTo(undefined,t-e)}),gantt.showTask=function(t){var e=this.getTaskNode(t);if(e){var n=Math.max(e.offsetLeft-this.config.task_scroll_offset,0),i=$(e).offset().top-200;$(window).scrollTop(i),this.scrollTo(n,i)}},gantt.getScrollState=function(){return this.$task&&this.$task_data?{x:this.$task.scrollLeft,y:$(window).scrollTop()}:null},gantt._path_builder.get_endpoint=function(t){var e=gantt.config.links,n=!1,i=!1;t.type==e.start_to_start?n=i=!0:t.type==e.finish_to_finish?n=i=!1:t.type==e.finish_to_start?(n=!1,i=!0):t.type==e.start_to_finish?(n=!0,i=!1):dhtmlx.assert(!1,"Invalid link type");var s=gantt._pull[t.source],a=gantt._pull[t.target],r=0,o=0,d=n?s.$startMount:s.$endMount,l=i?a.$startMount:a.$endMount;if(d.length>1){for(var h=0;h<d.length&&t.id!=d[h];h++);r=2*h/(d.length-1)*6-6}if(l.length>1){for(h=0;h<l.length&&t.id!=l[h];h++);o=2*h/(l.length-1)*6-6}var c=gantt._get_task_visible_pos(gantt._pull[t.source],n),u=gantt._get_task_visible_pos(gantt._pull[t.target],i);return{x:c.x,e_x:u.x,y:c.y+r,e_y:u.y+o}},gantt._sync_links=function(){for(var t in this._pull)if(this._pull.hasOwnProperty(t)){var e=this._pull[t];e.$source=[],e.$target=[],e.$startMount=[],e.$endMount=[]}for(t in this._lpull)if(this._lpull.hasOwnProperty(t)){var n=this._lpull[t],i=gantt.config.links;this._pull[n.source]&&(this._pull[n.source].$source.push(t),n.type==i.start_to_start||n.type==i.start_to_finish?this._pull[n.source].$startMount.push(t):this._pull[n.source].$endMount.push(t)),this._pull[n.target]&&(this._pull[n.target].$target.push(t),n.type==i.start_to_start||n.type==i.finish_to_start?this._pull[n.target].$startMount.push(t):this._pull[n.target].$endMount.push(t))}},gantt._has_children=function(t){var e=gantt._pull[t];return!!(e.widget&&e.widget.model&&e.widget.model.needLoad)||this.getChildren(t).length>0},gantt.setParent=function(t,e){if(ysy.settings.parentIssueDates){var n=this._pull[e];n&&"task"===gantt._get_safe_type(n.type)&&(n.$no_start=!0,n.$no_end=!0)}t.parent=e},gantt.attachEvent("onAfterTaskMove",function(t){var e=gantt._pull[t];e&&(e._parentChanged=!0)}),$("#main").on("resize",function(){gantt.render()}),$(document).on("easySidebarToggled",function(){gantt.render()}),$(document).on("erui_interface_change_vertical",function(t,e,n){!e&&n&&document.getElementById(n).querySelector("#easy_gantt")&&gantt.render()})},window.ysy=window.ysy||{},ysy.pro=ysy.pro||{},ysy.pro.relations={name:"Relation mover",connectedTasks:{},connectedForAsc:{},patch:function(){this.execute()},makeDelayFixedForSave:function(t){var e=this.getMinimizedDelay(t);let n=!1;ysy.settings.hasOwnProperty("unfixRelations")&&(n=ysy.settings.unfixRelations.active),!t._unlocked&&e<=t.delay||n||t.set({delay:e,_unlocked:!1})&&t._fireChanges(this,"makeDelayFixedForSave()")},getMinimizedDelay:function(t){var e=t.getActDelay();if(0===e)return t.delay;if(e<0)return-1;var n=t.getTarget();if(!n)return t.delay;if("precedes"===t.type||"start_to_start"===t.type){if(e>0)for(var i=moment(n.start_date).subtract(1,"days");!gantt._working_time_helper.is_working_day(i);)if(e--,i.subtract(1,"days"),e<=t.delay)return t.delay}else if(e>0){if(i=moment(n.end_date).subtract(1,"days"),!gantt._working_time_helper.is_working_day(i)&&(e-=2,i.subtract(1,"days"),e<=t.delay))return t.delay;for(;!gantt._working_time_helper.is_working_day(i);)if(e--,i.subtract(1,"days"),e<=t.delay)return t.delay}return e},freezeAllRelations:function(t){var e=ysy.data.relations;for(var n in t)t.hasOwnProperty(n)&&ysy.pro.relations.makeDelayFixedForSave(e.getByID(n))},clearRelationData:function(){for(var t=Object.getOwnPropertyNames(this.connectedTasks),e=0;e<t.length;e++){var n=this.connectedTasks[t[e]];delete n._parent_offset,delete n._limits}this.connectedTasks={},this.connectedForAsc={}},findConnectedForAsc:function(t,e){this.connectedForAsc[t.id]=t;for(var n=0;n<t.$source.length;n++){var i=t.$source[n],s=gantt._lpull[i];if(!s.isSimple){var a=gantt.getTask(s.target);this.findConnectedForAsc(a)}}if("notDown"!==e){var r=gantt._branches[t.id];if(r)for(n=0;n<r.length;n++){var o=r[n],d=gantt.getTask(o);this.findConnectedForAsc(d,"notUp")}}if("notUp"!==e){var l=gantt.getParent(t.id),h=gantt.getTask(l,!1);h&&"task"===gantt._get_safe_type(h.type)&&this.findConnectedForAsc(h,"notDown")}},moveByCreatedLink:function(t,e,n){var i=gantt.getTask(e.source_id);this.findConnectedForAsc(i),gantt.prepareStop(i,"all"),ysy.history.openBrack(),n&&(ysy.data.relations.push(e),this.makeDelayFixedForSave(e),t.delay=e.delay),gantt.moveDependent(i),this.clearRelationData(),gantt.updateAllTask(i),ysy.history.closeBrack()}},ysy.pro.relations.execute=function(){var t=function(t,e){return e.central.id===t?e.central:gantt._pull[t]};gantt.prepareParentOffset=function(t){if((ysy.settings.parentIssueDates||!t.$open)&&gantt._branches[t.id]){for(var e=gantt._branches[t.id],n=0;n<e.length;n++){var i=gantt._pull[e[n]];i&&(i._parent_offset=gantt._working_time_helper.get_work_units_between(t.start_date,i.start_date,"day"))}ysy.pro.relations.connectedTasks[t.id]=t}},gantt.prepareMultiStop=function(t){if("project"===t.type)return null;if("milestone"===t.type){if(ysy.settings.milestonePush)return null;for(var e,n=gantt.getIssuesOfMilestone(t),i=0;i<n.length;i++){var s=n[i],a=gantt._pull[s.id];if(a){var r=a.end_date;e&&!e.isBefore(r)||(e=r)}}t._limits={soonestStart:e}}return ysy.pro.relations.findConnectedForAsc(t),gantt.prepareStop(t,"all"),t._limits},gantt.prepareStop=function(t,e){if(t._limits)return t._limits;var n;if(t._limits=n={},ysy.pro.relations.connectedTasks[t.id]=t,gantt.prepareParentOffset(t),t.soonest_start&&gantt.mergeStopOptions(n,{soonestStart:t.soonest_start}),t.latest_due&&gantt.mergeStopOptions(n,{latestEnd:t.latest_due}),gantt.mergeStopOptions(n,gantt.ascStop(t,"all")),gantt.mergeStopOptions(n,gantt.descStop(t)),"notUp"!==e&&gantt.mergeStopOptions(n,gantt.parentStop(t,e)),"notDown"!==e&&gantt.mergeStopOptions(n,gantt.childStop(t,e)),ysy.settings.milestonePush){var i=gantt.milestoneDate(t);i&&gantt.mergeStopOptions(n,{latestEnd:i})}return t._limits},gantt.ascStop=function(t,e,n){for(var i={},s=0;s<t.$target.length;s++){var a=t.$target[s],r=gantt._lpull[a];if(!r.isSimple){var o=gantt._pull[r.source];if(!(n&&gantt.inParentTree(o,n)||ysy.pro.relations.connectedForAsc[o.id])){var d,l;switch(r.type){case"precedes":d=moment(o.end_date).add(r.delay+1,"day"),gantt._working_time_helper.round_date(d,"future");break;case"finish_to_finish":
l=moment(o.end_date).add(r.delay,"day"),gantt._working_time_helper.round_date(l,"past");break;case"start_to_finish":l=moment(o.start_date).add(r.delay-1,"day"),gantt._working_time_helper.round_date(l,"past");break;case"start_to_start":d=moment(o.start_date).add(r.delay,"day"),gantt._working_time_helper.round_date(d,"future")}gantt.mergeStopOptions(i,{soonestStart:d,soonestEnd:l})}}}return i},gantt.childStop=function(t,e){if(!ysy.settings.parentIssueDates&&t.$open)return null;if("notDown"===e||!gantt._branches[t.id])return null;for(var n=gantt._branches[t.id],i={},s=0;s<n.length;s++){var a,r=n[s],o=gantt.getTask(r),d=gantt.prepareStop(o,"notUp");d.soonestStart&&(a=gantt._working_time_helper.add_worktime(d.soonestStart,-o._parent_offset,"day",!1),gantt.mergeStopOptions(i,{soonestStart:a})),d.soonestEnd&&(a=gantt._working_time_helper.add_worktime(d.soonestEnd,-o._parent_offset-o.duration,"day",!1),gantt.mergeStopOptions(i,{soonestStart:a})),d.latestStart&&(a=gantt._working_time_helper.add_worktime(d.latestStart,t.duration-o._parent_offset,"day",!0),gantt.mergeStopOptions(i,{latestEnd:a})),d.latestEnd&&(a=gantt._working_time_helper.add_worktime(d.latestEnd,t.duration-o._parent_offset-o.duration,"day",!0),gantt.mergeStopOptions(i,{latestEnd:a}))}return i},gantt.parentStop=function(t){if(!ysy.settings.parentIssueDates&&gantt.isTaskVisible(t.id))return null;var e=gantt.getParent(t.id),n=gantt.getTask(e,!1);if(n&&"task"===gantt._get_safe_type(n.type)){var i=gantt.prepareStop(n,"notDown");if(i.soonestEnd){for(var s,a=gantt._branches[e],r=0;r<a.length;r++){var o=a[r];if(!ysy.pro.relations.connectedForAsc[o]){var d=gantt.getTask(o);s&&!s.isBefore(d.end_date)||(s=d.end_date)}}s&&s.isBefore(i.soonestEnd)||delete i.soonestEnd}return i}},gantt.inParentTree=function(t,e){return!(!t||t.parent===gantt.config.root_id)&&(t.parent===e||gantt.inParentTree(gantt._pull[t.parent],e))},gantt.milestoneDate=function(t){var e=t.widget&&t.widget.model;if(e||(e=(t=gantt.getTask(t.id)).widget&&t.widget.model)){var n=ysy.data.milestones.getByID(e.fixed_version_id);if(n&&!n._noDate){var i=gantt._pull[n.getID()];if(i)var s=i.end_date;else s=n.start_date;return s}}},gantt.descStop=function(t){for(var e={},n=0;n<t.$source.length;n++){var i=t.$source[n],s=gantt._lpull[i];if(!s.isSimple){var a,r=gantt.getTask(s.target),o=gantt.prepareStop(r,"all");if(o.latestStart)switch(s.type){case"precedes":(a=moment(o.latestStart).subtract(s.delay+1,"days"))._isEndDate=!0,gantt._working_time_helper.round_date(a,"past"),gantt.mergeStopOptions(e,{latestEnd:a});break;case"finish_to_finish":(a=gantt._working_time_helper.add_worktime(o.latestStart,r.duration,"day",!0)).subtract(s.delay+1,"days"),gantt._working_time_helper.round_date(a,"past"),gantt.mergeStopOptions(e,{latestEnd:a});break;case"start_to_finish":(a=gantt._working_time_helper.add_worktime(o.latestStart,r.duration,"day",!0)).subtract(s.delay-1,"days"),gantt._working_time_helper.round_date(a,"past"),gantt.mergeStopOptions(e,{latestStart:a});break;case"start_to_start":a=moment(o.latestStart).subtract(s.delay,"days"),gantt._working_time_helper.round_date(a,"past"),gantt.mergeStopOptions(e,{latestStart:a});break;default:throw"unprepared type of link "+s.type}if(o.latestEnd)switch(s.type){case"precedes":(a=gantt._working_time_helper.add_worktime(o.latestEnd,-r.duration,"day",!0)).subtract(s.delay,"days"),gantt._working_time_helper.round_date(a,"past"),gantt.mergeStopOptions(e,{latestEnd:a});break;case"finish_to_finish":(a=moment(o.latestEnd).subtract(s.delay,"days"))._isEndDate=!0,gantt._working_time_helper.round_date(a,"past"),gantt.mergeStopOptions(e,{latestEnd:a});break;case"start_to_finish":a=moment(o.latestEnd).subtract(s.delay-1,"days"),gantt._working_time_helper.round_date(a,"past"),gantt.mergeStopOptions(e,{latestStart:a});break;case"start_to_start":(a=gantt._working_time_helper.add_worktime(o.latestEnd,-r.duration,"day",!1)).subtract(s.delay,"days"),gantt._working_time_helper.round_date(a,"past"),gantt.mergeStopOptions(e,{latestStart:a});break;default:throw"unprepared type of link "+s.type}}}return e},gantt.multiStop=function(t,e,n,i){var s,a,r;(i||(i=t._limits))&&(e&&(i.soonestStart&&e.isBefore(i.soonestStart)?r=i.soonestStart:i.latestStart&&e.isAfter(i.latestStart)&&(r=i.latestStart),r&&(s=r-e,e.add(s,"milliseconds"),n&&(a=gantt._working_time_helper.add_worktime(e,t.duration,"day",!0)-n,n.add(a,"milliseconds")),r=null)),n&&(i.soonestEnd&&n.isBefore(i.soonestEnd)?r=i.soonestEnd:i.latestEnd&&n.isAfter(i.latestEnd)&&(r=i.latestEnd),r&&(a=r-n,n.add(a,"milliseconds"),e&&(s=gantt._working_time_helper.add_worktime(n,-t.duration,"day",!1)-e,e.add(s,"milliseconds")))))},gantt.moveDependent=function(t,e,n){if(n=n||"all",e||(e={central:t,origin:gantt.getTask(t.id),visited:{}}),ysy.settings.parentIssueDates||!t.$open){if("notDown"!==n){var i=gantt.shouldMoveChildren(t);i.move?gantt.moveChildren(t,e):i.milestoneMove&&gantt.moveMilestoneChildren(t,e)}"notUp"!==n&&gantt.moveParent(t,e)}"left"===n?gantt.moveAscendants(t,e):gantt.moveDescendants(t,e),e.visited[t.id]=!0},gantt.moveDescendants=function(e,n){for(var i=0;i<e.$source.length;i++){var s=e.$source[i],a=gantt._lpull[s];if(!a.isSimple){var r=t(a.target,n),o=this.moveOneDescendant(e,r.duration,a);if(r._limits){var d=r._limits;if(d.soonestStart&&d.soonestStart.isAfter(o)&&(o=d.soonestStart),d.soonestEnd){var l=gantt._working_time_helper.add_worktime(d.soonestEnd,-r.duration,"day",!1);l.isAfter(o)&&(o=l)}}a.unlocked?r.start_date.isBefore(o)&&gantt.safeMoveToStartDate(r,o):gantt.safeMoveToStartDate(r,o),gantt.moveDependent(r,n,"all")}}},gantt.moveOneDescendant=function(t,e,n){var i,s;switch(n.type){case"precedes":i=moment(t.end_date).add(n.delay+1,"day"),i=gantt._working_time_helper.get_closest_worktime({date:i,dir:"future"});break;case"finish_to_finish":if(s=moment(t.end_date).add(n.delay,"day"),gantt._working_time_helper.is_working_day(s)){if(s.add(1,"day"),!gantt._working_time_helper.is_working_day(s)){var a=s-moment(s).startOf("day");s=gantt._working_time_helper.get_closest_worktime({date:s,dir:"future"}).add(a,"milliseconds")}}else(s=gantt._working_time_helper.get_closest_worktime({date:s,dir:"future"})).add(1,"day");i=gantt._working_time_helper.add_worktime(s,-e,"day",!1);break;case"start_to_finish":s=moment(t.start_date).add(n.delay-1,"day"),gantt._working_time_helper.is_working_day(s)?(s.add(1,"day"),gantt._working_time_helper.is_working_day(s)||(a=s-moment(s).startOf("day"),s=gantt._working_time_helper.get_closest_worktime({date:s,dir:"future"}).add(a,"milliseconds"))):(s=gantt._working_time_helper.get_closest_worktime({date:s,dir:"future"})).add(1,"day"),i=gantt._working_time_helper.add_worktime(s,-e,"day",!1);break;case"start_to_start":i=moment(t.start_date).add(n.delay,"day"),gantt._working_time_helper.get_closest_worktime({date:i,dir:"future"})}return i},gantt.moveChildren=function(e,n){var i=gantt._branches[e.id];if(!i||0===i.length)return null;for(var s=0;s<i.length;s++){var a=i[s],r=t(a,n),o=gantt._working_time_helper.add_worktime(e.start_date,r._parent_offset,"day",!1);n.visited[a]||(gantt.safeMoveToStartDate(r,o),r._changed=gantt.config.drag_mode.move,gantt.moveDependent(r,n,"notUp"),gantt.refreshOnlyTask(a))}},gantt.moveParent=function(e,n){var i=e.parent||0,s=t(i,n);if("task"===gantt._get_safe_type(s.type)&&(ysy.settings.parentIssueDates||!s.$open)){var a=gantt.getChildDates(s,e,n);s.start_date.isSame(a.start)||(s.start_date.add(a.start-s.start_date,"milliseconds"),s._changed=gantt.config.drag_mode.move,gantt.refreshOnlyTask(s.id)),s.end_date.isSame(a.end)||(s.end_date.add(a.end-s.end_date,"milliseconds"),s._changed=gantt.config.drag_mode.move,gantt.refreshOnlyTask(s.id)),gantt.moveDependent(s,n,"notDown")}},gantt.getChildDates=function(e,n,i){for(var s=gantt._branches[e.id],a=n.start_date,r=n.end_date,o=0;o<s.length;o++){var d=s[o];if(d!==n.id){var l=t(d,i);a.isAfter(l.start_date)&&(a=l.start_date),r.isBefore(l.end_date)&&(r=l.end_date)}}return{start:a,end:r}},gantt.shouldMoveChildren=function(t){return"milestone"===t.type&&ysy.settings.milestonePush?{milestoneMove:!0}:"task"===gantt._get_safe_type(t.type)&&ysy.settings.parentIssueDates?{move:!0,adjust:!0}:!(t.$open||!gantt.isTaskVisible(t.id))&&{move:!0}},gantt.safeMoveToStartDate=function(t,e){if(t.start_date.isSame(e))return 0;var n=gantt._working_time_helper.add_worktime(e,t.duration,"day",!0);return t.start_date.add(e-t.start_date,"milliseconds"),t.end_date.add(n-t.end_date,"milliseconds"),t._changed=gantt.config.drag_mode.move,gantt.refreshOnlyTask(t.id),0},gantt.moveMilestoneChildren=function(e,n){var i=gantt.getIssuesOfMilestone(e);if(0===i.length)return 0;for(var s=0;s<i.length;s++){var a=t(i[s].id,n);if(a.end_date.isAfter(e.end_date)){a.end_date.add(e.end_date-a.end_date,"milliseconds");var r=gantt._working_time_helper.add_worktime(a.end_date,-a.duration,"day",!1);a.start_date.add(r-a.start_date,"milliseconds"),a._changed=gantt.config.drag_mode.move,gantt.refreshOnlyTask(a.id),gantt.moveDependent(a,n,"left")}}return 0},gantt.moveAscendants=function(e,n){for(var i=0;i<e.$target.length;i++){var s=e.$target[i],a=gantt._lpull[s];if(!a.isSimple){var r,o=t(a.source,n);switch(a.type){case"precedes":r=moment(e.start_date).subtract(a.delay,"day"),r=gantt._working_time_helper.add_worktime(r,-o.duration,"day",!1);break;case"finish_to_finish":r=moment(e.end_date).subtract(a.delay-1,"day"),r=gantt._working_time_helper.add_worktime(r,-o.duration,"day",!1);break;case"start_to_finish":r=moment(e.end_date).subtract(a.delay-1,"day"),gantt._working_time_helper.get_closest_worktime({date:r,dir:"past"});break;case"start_to_start":r=moment(e.start_date).subtract(a.delay,"day"),gantt._working_time_helper.get_closest_worktime({date:r,dir:"past"})}r.isBefore(o.start_date)&&(gantt.safeMoveToStartDate(o,r),gantt.moveDependent(o,n,"left"))}}},gantt.attachEvent("onLinkClick",function(t){ysy.log.debug("LinkClick on "+t,"link_config");var e=gantt.getLink(t);if(gantt._is_readonly(e))return;var n=gantt._pull[e.source];if(!n)return;var i=gantt._pull[e.target];if(!i)return;if(n.readonly&&i.readonly)return;var s=e.widget.model;let a=!1;return ysy.settings.hasOwnProperty("unfixRelations")&&(a=ysy.settings.unfixRelations.active),s._unlocked&&!a?s.set({delay:ysy.pro.relations.getMinimizedDelay(s),_unlocked:!1}):s.set({delay:0,_unlocked:!0}),!1}),gantt.attachEvent("onContextMenu",function(t,e){if(!t&&gantt.config.drag_links&&gantt.isLinkExists(e)){ysy.log.debug("LinkClick on "+e,"link_config");var n=gantt.getLink(e);if(!gantt._is_readonly(n)){var i=gantt._pull[n.source];if(i){var s=gantt._pull[n.target];if(s&&(!i.readonly||!s.readonly)){var a=(new ysy.view.LinkPopup).init(n.widget.model,n);a.$target=$("#ajax-modal"),a.repaint(),showModal("ajax-modal","auto")}}}}})},window.ysy=window.ysy||{},ysy.view=ysy.view||{},ysy.view.applyGanttRewritePatch=function(){ysy.view.initNonworkingDays=function(){var t,e=gantt._working_time_helper;e.defHours=ysy.settings.hoursPerDay;var n=ysy.settings.nonWorkingWeekDays;for(t in n)e.set_time({day:n[t]%7,hours:!1});var i=ysy.settings.holidays;if(i)for(t=0;t<i.length;t++)e.set_time({date:moment(i[t]),hours:!1});e._cache={}},gantt._working_time_helper={defHours:8,timeformat:"YYYY-MM-DD",days:{0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0},dates:{},_cache:{},oneDaySeconds:864e5,oneHourSeconds:36e5,toMoment:function(t){return t._isAMomentObject?t:moment(t)},set_time:function(t){var e=t.hours===undefined||t.hours;t.day!==undefined?this.days[t.day]=e:t.date!==undefined&&(this.dates[+t.date]=e)},is_weekend:function(t){return t=this.toMoment(t),!this.days[t.day()]},is_working_day:function(t){return t=this.toMoment(t),!!this.days[t.day()]&&this.get_working_hours(t)>0},get_working_hours:function(t){var e=+(t=this.toMoment(t)),n=!0;return this.dates[e]!==undefined?n=this.dates[e]:this.days[t.day()]!==undefined&&(n=this.days[t.day()]),!0===n?this.defHours:n||0},is_working_unit:function(t){return!gantt.config.work_time||this.is_working_day(t)},save_working_unit:function(t,e){var n=t.isoWeek(),i=this.get_work_units_between(t,e,"day"),s=this.get_work_units_between(t,e,"hour");this.weeks[n]={days:i,hours:s}},_work_times_between:function(t,e){var n=t.valueOf()+"_"+e.valueOf();if(this._cache[n])return this._cache[n].cached=!0,this._cache[n];if(t.isBefore(e))var i=this._work_times_forward(t,e);else i=this._work_times_backward(t,e);return this._cache[n]=i,i},_work_times_forward:function(t,e){var n=0,i=0;if(+t%this.oneHourSeconds!=0||0!==t.hours())var s=moment(t).startOf("day"),a=!0;else s=t;for(var r=0;s.isBefore(e);){if(r++>3e3){ysy.log.error("_work_times_forward: Probably task with start_date="+t.format("YYYY-MM-DD")+" and end_date="+e.format("YYYY-MM-DD")+" is too long");break}var o=this.get_working_hours(s);if(o>0)if(a){var d=1-(t-s)/this.oneDaySeconds;i+=d,n+=o*d}else i++,n+=o;a=!1,s.add(1,"days")}return o>0&&s.isAfter(e)&&(i-=d=(s-e)/this.oneDaySeconds,n-=o*d),{days:i,hours:n}},_work_times_backward:function(t,e){var n=0,i=0;if(+t%this.oneHourSeconds!=0||0!==t.hours()){var s=moment(t).startOf("day"),a=!0;s.add(1,"day")}else s=t;for(var r=0;s.isAfter(e);){if(s.subtract(1,"days"),r++>3e3){ysy.log.error("_work_times_backward: Probably task with start_date="+e.format("YYYY-MM-DD")+" and end_date="+t.format("YYYY-MM-DD")+" is too long");break}var o=this.get_working_hours(s);if(o>0)if(a){var d=(t-s)/this.oneDaySeconds;i+=d,n+=o*d}else i++,n+=o;a=!1}if(o>0&&s.isBefore(e)){var l=(e-s)/this.oneDaySeconds;i-=l,n-=o*l}return{days:-1*i,hours:-1*n}},get_work_units_between:function(t,e,n){if(!n)return ysy.log.error("missing unit"),0;var i=moment(t);if(e._isEndDate)var s=moment(e).add(1,"days");else s=moment(e);t._isEndDate&&(i=i.add(1,"days"));var a=this._work_times_between(i,s);return ysy.log.debug("get_work_units_between: "+this.toMoment(t).format("DD.MM.YYYY")+"("+t._isEndDate+") "+this.toMoment(e).format("DD.MM.YYYY")+"("+e._isEndDate+") "+n+" "+(a.cached?"(cached)":""),"date_helper"),"day"===n?a.days:"all"===n?a:a.hours},is_work_units_between:function(t,e,n){return!!n&&this.get_work_units_between(t,e,n)>0},add_worktime:function(t,e,n,i){var s;if(ysy.log.debug("add_worktime: "+t.toString()+" "+e+" "+n,"date_helper"),!n)throw"Missing unit";n+="s";var a=0,r=moment(t);if(t._isEndDate&&r.add(1,"days"),+t%this.oneHourSeconds!=0||0!==r.hours())var o=moment(r).startOf("day"),d=r-o,l=!0;else o=r;if(!gantt.config.work_time||"days"!==n&&"hours"!==n)o.add(e,n);else{var h=0;if(0===e)for(;;){if(h++>3e3){ysy.log.error("_add_worktime: Probably task with start_date="+moment(t).format("YYYY-MM-DD")+" and duration "+e+" is too long");break}if(s=this.get_working_hours(o)){l&&o.add(d,"milliseconds");break}l=!1,o.add(1,"days")}else if(e>0){for(;a<e;){if(h++>3e3){ysy.log.error("_add_worktime: Probably task with start_date="+moment(t).format("YYYY-MM-DD")+" and duration "+e+" is too long");break}if((s=this.get_working_hours(o))>0){var c=1;l&&(c=1-d/this.oneDaySeconds),a+="hours"===n?c*s:c}l=!1,o.add(1,"days")}s&&a>e&&o.subtract((a-e)*("hours"===n?3600:86400),"seconds")}else{for(;a<-e;){if(h++>3e3){ysy.log.error("_add_worktime: Probably task with end_date="+moment(t).format("YYYY-MM-DD")+" and duration "+e+" is too long");break}l&&d||o.add(-1,"days"),(s=this.get_working_hours(o))>0&&(c=1,l&&(c=d/this.oneDaySeconds),a+="hours"===n?c*s:c),l=!1}s&&a>-e&&o.add((a+e)*("hours"===n?3600:86400),"seconds")}}return(i||!t._isEndDate&&i===undefined)&&(o.add(-1,"days"),o._isEndDate=!0),moment.isMoment(t)?o:o.toDate()},round_date:function(t,e){if(ysy.log.debug("round_date: "+t.toString(),"date_helper"),t._isAMomentObject)var n=t;else n=moment(t);n.add(12,"hours").startOf("day");var i=0;if(gantt.config.work_time)if("past"===e)for(;!this.is_working_day(n)&&i++<1e3;)n.subtract(1,"days");else for(;!this.is_working_day(n)&&i++<1e3;)n.add(1,"days");t._isAMomentObject||t.setTime(n.valueOf())},get_closest_worktime:function(t){ysy.log.debug("get_closest_worktime: "+t.date.toString(),"date_helper");var e=moment.isMoment(t.date),n=t.unit||"day",i=moment(t.date).startOf(n),s=t.date-i,a="any"===t.dir||"future"===t.dir,r="any"===t.dir||"past"===t.dir;if(!t.length&&this.is_working_day(i))return i.add(s,"milliseconds"),e?i:i.toDate();if(r){var o=moment(i);t.length&&o.add(t.length,"days")}if(a){var d=i;0!==s&&d.add(1,n)}if(r){if(this.is_working_day(o)){if(!t.length)return o.add(s,"milliseconds"),e?o:o.toDate();if(o.subtract(1,"days"),this.is_working_day(o))return o.add(s,"milliseconds"),e?o:o.toDate()}o.add(-1,"days")}for(var l=0;l<3e3;l++){if(r){if(this.is_working_day(o))return e?o:o.toDate();o.add(-1,"days")}if(a){if(this.is_working_day(d))return e?d:d.toDate();d.add(1,"days")}}return dhtmlx.assert(!1,"Invalid working time check"),!1}},gantt.date={now:function(){return moment()},Date:function(t,e){if(!t)return new Date;if(t._isAMomentObject){var n=moment(t);e===undefined&&(e=t._isEndDate)}else n=moment(t).toDate();return n._isEndDate=e,n},toMoment:function(t){if(t)return t._isAMomentObject?t:moment(t);ysy.log.error("No date to convert to Moment")},fromMoment:function(t,e){return t._isAMomentObject?t:(t.setTime(e.valueOf()),t)},init:function(){},_startOf:function(t,e){var n=this.toMoment(t);return n.startOf(e),this.fromMoment(t,n)},date_part:function(t){return this._startOf(t,"day")},time_part:function(t){return alert("Forbidden function"),(t.valueOf()/1e3-60*t.getTimezoneOffset())%86400},week_start:function(t){return this._startOf(t,"isoweek")},month_start:function(t){return this._startOf(t,"month")},year_start:function(t){return this._startOf(t,"year")},day_start:function(t){return this._startOf(t,"day")},hour_start:function(t){return alert("Forbidden function"),t.getMinutes()&&t.setMinutes(0),this.minute_start(t),t},minute_start:function(t){return alert("Forbidden function"),t.getSeconds()&&t.setSeconds(0),t.getMilliseconds()&&t.setMilliseconds(0),t},add:function(t,e,n){var i=this.toMoment(t);return i.add(e,n+"s"),i.toDate()},to_fixed:function(t){return t<10?"0"+t:t},copy:function(t){var e=moment(t);return t._isAMomentObject?e:e.toDate()},date_to_str:function(t,e){return ysy.log.debug("date_to_str "+t,"date_format"),t=t.replace(/%[a-zA-Z]/g,function(t){switch(t){case"%d":return'"+gantt.date.to_fixed(date.getDate())+"';case"%m":return'"+gantt.date.to_fixed((date.getMonth()+1))+"';case"%j":return'"+date.getDate()+"';case"%n":return'"+(date.getMonth()+1)+"';case"%y":return'"+gantt.date.to_fixed(date.getFullYear()%100)+"';case"%Y":return'"+date.getFullYear()+"';case"%D":return'"+gantt.locale.date.day_short[date.getDay()]+"';case"%l":return'"+gantt.locale.date.day_full[date.getDay()]+"';case"%M":return'"+gantt.locale.date.month_short[date.getMonth()]+"';case"%F":return'"+gantt.locale.date.month_full[date.getMonth()]+"';case"%h":return'"+gantt.date.to_fixed((date.getHours()+11)%12+1)+"';case"%g":return'"+((date.getHours()+11)%12+1)+"';case"%G":return'"+date.getHours()+"';case"%H":return'"+gantt.date.to_fixed(date.getHours())+"';case"%i":return'"+gantt.date.to_fixed(date.getMinutes())+"';case"%a":return'"+(date.getHours()>11?"pm":"am")+"';case"%A":return'"+(date.getHours()>11?"PM":"AM")+"';case"%s":return'"+gantt.date.to_fixed(date.getSeconds())+"';case"%W":return'"+gantt.date.to_fixed(gantt.date.getISOWeek(date))+"';default:return t}}),e&&(t=t.replace(/date\.get/g,"date.getUTC")),new Function("date",'return "'+t+'";')},str_to_date:function(t,e){ysy.log.debug("str_to_date "+t,"date_format");for(var n="var temp=date.match(/[a-zA-Z]+|[0-9]+/g);",i=t.match(/%[a-zA-Z]/g),s=0;s<i.length;s++)switch(i[s]){case"%j":case"%d":n+="set[2]=temp["+s+"]||1;";break;case"%n":case"%m":n+="set[1]=(temp["+s+"]||1)-1;";break;case"%y":n+="set[0]=temp["+s+"]*1+(temp["+s+"]>50?1900:2000);";break;case"%g":case"%G":case"%h":case"%H":n+="set[3]=temp["+s+"]||0;";break;case"%i":n+="set[4]=temp["+s+"]||0;";break;case"%Y":n+="set[0]=temp["+s+"]||0;";break;case"%a":case"%A":n+="set[3]=set[3]%12+((temp["+s+"]||'').toLowerCase()=='am'?0:12);";break;case"%s":n+="set[5]=temp["+s+"]||0;";break;case"%M":n+="set[1]=gantt.locale.date.month_short_hash[temp["+s+"]]||0;";break;case"%F":n+="set[1]=gantt.locale.date.month_full_hash[temp["+s+"]]||0;"}var a="set[0],set[1],set[2],set[3],set[4],set[5]";return e&&(a=" Date.UTC("+a+")"),new Function("date","var set=[0,0,1,0,0,0]; "+n+" return new Date("+a+");")},getISOWeek:function(t){return!!t&&this.toMoment(t).week()},getUTCISOWeek:function(t){return this.getISOWeek(t)},convert_to_utc:function(t){var e=this.toMoment(t);return e.utc(),this.fromMoment(t,e)},parseDate:function(t,e){return"string"==typeof t&&(ysy.log.debug("parseDate() "+t+" "+e,"date_format"),dhtmlx.defined(e)&&(e="string"==typeof e?dhtmlx.defined(gantt.templates[e])?gantt.templates[e]:gantt.date.str_to_date(e):gantt.templates.xml_date),t=t?e(t):null),this.toMoment(t)}},ysy.view.initNonworkingDays()},"undefined"==typeof window.dhx4&&(window.dhx4={version:"4.1.3",skin:null,skinDetect:function(t){return{10:"dhx_skyblue",20:"dhx_web",30:"dhx_terrace"}[this.readFromCss(t+"_skin_detect")]||null},readFromCss:function(t,e){var n=document.createElement("DIV");n.className=t,null!=document.body.firstChild?document.body.insertBefore(n,document.body.firstChild):document.body.appendChild(n);var i=n[e||"offsetWidth"];return n.parentNode.removeChild(n),n=null,i},lastId:1,newId:function(){return this.lastId++},zim:{data:{},step:5,first:function(){return 100},last:function(){var t=this.first();for(var e in this.data)t=Math.max(t,this.data[e]);return t},reserve:function(t){return this.data[t]=this.last()+this.step,this.data[t]},clear:function(t){null!=this.data[t]&&(this.data[t]=null,delete this.data[t])}},s2b:function(t){return"string"==typeof t&&(t=t.toLowerCase()),1==t||1==t||"true"==t||"1"==t||"yes"==t||"y"==t},s2j:function(s){var obj=null;dhx4.temp=null;try{eval("dhx4.temp="+s)}catch(e){dhx4.temp=null}return obj=dhx4.temp,dhx4.temp=null,obj},absLeft:function(t){return"string"==typeof t&&(t=document.getElementById(t)),this.getOffset(t).left},absTop:function(t){return"string"==typeof t&&(t=document.getElementById(t)),this.getOffset(t).top},_aOfs:function(t){for(var e=0,n=0;t;)e+=parseInt(t.offsetTop),n+=parseInt(t.offsetLeft),t=t.offsetParent;return{top:e,left:n}},_aOfsRect:function(t){var e=t.getBoundingClientRect(),n=document.body,i=document.documentElement,s=window.pageYOffset||i.scrollTop||n.scrollTop,a=window.pageXOffset||i.scrollLeft||n.scrollLeft,r=i.clientTop||n.clientTop||0,o=i.clientLeft||n.clientLeft||0,d=e.top+s-r,l=e.left+a-o;return{top:Math.round(d),left:Math.round(l)}},getOffset:function(t){return t.getBoundingClientRect?this._aOfsRect(t):this._aOfs(t)},_isObj:function(t){return null!=t&&"object"==typeof t&&"undefined"==typeof t.length},_copyObj:function(t){if(this._isObj(t)){var e={};for(var n in t)"object"==typeof t[n]&&null!=t[n]?e[n]=this._copyObj(t[n]):e[n]=t[n]}else for(e=[],n=0;n<t.length;n++)"object"==typeof t[n]&&null!=t[n]?e[n]=this._copyObj(t[n]):e[n]=t[n];return e},screenDim:function(){var t=navigator.userAgent.indexOf("MSIE")>=0,e={};return e.left=document.body.scrollLeft,e.right=e.left+(window.innerWidth||document.body.clientWidth),e.top=Math.max((t?document.documentElement:document.getElementsByTagName("html")[0]).scrollTop,document.body.scrollTop),e.bottom=e.top+(t?Math.max(document.documentElement.clientHeight||0,document.documentElement.offsetHeight||0):window.innerHeight),e},selectTextRange:function(t,e,n){var i=(t="string"==typeof t?document.getElementById(t):t).value.length;if(e=Math.max(Math.min(e,i),0),n=Math.min(n,i),t.setSelectionRange)try{t.setSelectionRange(e,n)}catch(a){}else if(t.createTextRange){var s=t.createTextRange();s.moveStart("character",e),s.moveEnd("character",n-i);try{s.select()}catch(a){}}},transData:null,transDetect:function(){if(null==this.transData){this.transData={transProp:!1,transEv:null};var t={MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd",msTransition:"transitionend",transition:"transitionend"};for(var e in t)0==this.transData.transProp&&null!=document.documentElement.style[e]&&(this.transData.transProp=e,this.transData.transEv=t[e]);t=null}return this.transData},_xmlNodeValue:function(t){for(var e="",n=0;n<t.childNodes.length;n++)e+=null!=t.childNodes[n].nodeValue?t.childNodes[n].nodeValue.toString().replace(/^[\n\r\s]{0,}/,"").replace(/[\n\r\s]{0,}$/,""):"";return e}},window.dhx4.isIE=navigator.userAgent.indexOf("MSIE")>=0||navigator.userAgent.indexOf("Trident")>=0,window.dhx4.isIE6=null==window.XMLHttpRequest&&navigator.userAgent.indexOf("MSIE")>=0,window.dhx4.isIE7=navigator.userAgent.indexOf("MSIE 7.0")>=0&&navigator.userAgent.indexOf("Trident")<0,window.dhx4.isIE8=navigator.userAgent.indexOf("MSIE 8.0")>=0&&navigator.userAgent.indexOf("Trident")>=0,window.dhx4.isOpera=navigator.userAgent.indexOf("Opera")>=0,window.dhx4.isChrome=navigator.userAgent.indexOf("Chrome")>=0,window.dhx4.isKHTML=navigator.userAgent.indexOf("Safari")>=0||navigator.userAgent.indexOf("Konqueror")>=0,window.dhx4.isFF=navigator.userAgent.indexOf("Firefox")>=0,window.dhx4.isIPad=navigator.userAgent.search(/iPad/gi)>=0),"undefined"==typeof window.dhx4._eventable&&(window.dhx4._eventable=function(t,e){if("clear"==e)return t.detachAllEvents(),t.dhxevs=null,t.attachEvent=null,t.detachEvent=null,t.checkEvent=null,t.callEvent=null,t.detachAllEvents=null,void(t=null);t.dhxevs={data:{}},t.attachEvent=function(t,e){t=String(t).toLowerCase(),this.dhxevs.data[t]||(this.dhxevs.data[t]={});var n=window.dhx4.newId();return this.dhxevs.data[t][n]=e,n},t.detachEvent=function(t){for(var e in this.dhxevs.data){var n=0;for(var i in this.dhxevs.data[e])i==t?(this.dhxevs.data[e][i]=null,delete this.dhxevs.data[e][i]):n++;0==n&&(this.dhxevs.data[e]=null,delete this.dhxevs.data[e])}},t.checkEvent=function(t){return t=String(t).toLowerCase(),null!=this.dhxevs.data[t]},t.callEvent=function(t,e){if(t=String(t).toLowerCase(),null==this.dhxevs.data[t])return!0;var n=!0;for(var i in this.dhxevs.data[t])n=this.dhxevs.data[t][i].apply(this,e)&&n;return n},t.detachAllEvents=function(){for(var t in this.dhxevs.data){for(var e in this.dhxevs.data[t])this.dhxevs.data[t][e]=null,delete this.dhxevs.data[t][e];this.dhxevs.data[t]=null,delete this.dhxevs.data[t]}},t=null},dhx4._eventable(dhx4)),"undefined"==typeof window.dhtmlx&&(window.dhtmlx={extend:function(t,e){for(var n in e)t[n]||(t[n]=e[n]);return t},extend_api:function(t,e,n){var i=window[t];i&&(window[t]=function(t){if(t&&"object"==typeof t&&!t.tagName){var n=i.apply(this,e._init?e._init(t):arguments);for(var s in dhtmlx)e[s]&&this[e[s]](dhtmlx[s]);for(var s in t)e[s]?this[e[s]](t[s]):0===s.indexOf("on")&&this.attachEvent(s,t[s])}else n=i.apply(this,arguments);return e._patch&&e._patch(this),n||this},window[t].prototype=i.prototype,n&&dhtmlx.extend(window[t].prototype,n))},url:function(t){return-1!=t.indexOf("?")?"&":"?"}});var _isFF=!1,_isIE=!1,_isOpera=!1,_isKHTML=!1,_isMacOS=!1,_isChrome=!1,_FFrv=!1,_KHTMLrv=!1,_OperaRv=!1;-1!=navigator.userAgent.indexOf("Macintosh")&&(_isMacOS=!0),navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(_isChrome=!0),-1!=navigator.userAgent.indexOf("Safari")||-1!=navigator.userAgent.indexOf("Konqueror")?(_KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Safari")+7,5)),_KHTMLrv>525?(_isFF=!0,_FFrv=1.9):_isKHTML=!0):-1!=navigator.userAgent.indexOf("Opera")?(_isOpera=!0,_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Opera")+6,3))):-1!=navigator.appName.indexOf("Microsoft")?(_isIE=!0,(-1!=navigator.appVersion.indexOf("MSIE 8.0")||-1!=navigator.appVersion.indexOf("MSIE 9.0")||-1!=navigator.appVersion.indexOf("MSIE 10.0")||document.documentMode>7)&&"BackCompat"!=document.compatMode&&(_isIE=8)):"Netscape"==navigator.appName&&-1!=navigator.userAgent.indexOf("Trident")?_isIE=8:(_isFF=!0,_FFrv=parseFloat(navigator.userAgent.split("rv:")[1])),"undefined"==typeof window.dhtmlxEvent&&(window.dhtmlxEvent=function(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,n)}),null==dhtmlxEvent.touchDelay&&(dhtmlxEvent.touchDelay=2e3),"undefined"==typeof dhtmlxEvent.initTouch&&(dhtmlxEvent.initTouch=function(){function t(){if(n){var t=document.createEvent("HTMLEvents");t.initEvent("dblclick",!0,!0),n.dispatchEvent(t),e=n=null}}var e,n,i,s;dhtmlxEvent(document.body,"touchstart",function(a){n=a.touches[0].target,i=a.touches[0].clientX,s=a.touches[0].clientY,e=window.setTimeout(t,dhtmlxEvent.touchDelay)}),dhtmlxEvent(document.body,"touchmove",function(t){e&&(Math.abs(t.touches[0].clientX-i)>50||Math.abs(t.touches[0].clientY-s)>50)&&(window.clearTimeout(e),e=n=!1)}),dhtmlxEvent(document.body,"touchend",function(){e&&(window.clearTimeout(e),e=n=!1)}),dhtmlxEvent.initTouch=function(){}}),window.dhtmlx||(window.dhtmlx={}),function(){function t(t,e){var i=t.callback;n(!1),t.box.parentNode.removeChild(t.box),u=t.box=null,i&&i(e)}function e(e){if(u){var n=(e=e||event).which||event.keyCode;return dhtmlx.message.keyboard&&(13!=n&&32!=n||t(u,!0),27==n&&t(u,!1)),e.preventDefault&&e.preventDefault(),!(e.cancelBubble=!0)}}function n(t){n.cover||(n.cover=document.createElement("DIV"),n.cover.onkeydown=e,n.cover.className="dhx_modal_cover",document.body.appendChild(n.cover));document.body.scrollHeight;n.cover.style.display=t?"inline-block":"none"}function i(t,e){return"<div class='dhtmlx_popup_button "+("dhtmlx_"+t.toLowerCase().replace(/ /g,"_")+"_button")+"' result='"+e+"' ><div>"+t+"</div></div>"}function s(t){_.area||(_.area=document.createElement("DIV"),_.area.className="dhtmlx_message_area",_.area.style[_.position]="5px",document.body.appendChild(_.area)),_.hide(t.id);var e=document.createElement("DIV");return e.innerHTML="<div>"+t.text+"</div>",e.className="dhtmlx-message dhtmlx-"+t.type,e.onclick=function(){_.hide(t.id),t=null},"bottom"==_.position&&_.area.firstChild?_.area.insertBefore(e,_.area.firstChild):_.area.appendChild(e),t.expire>0&&(_.timers[t.id]=window.setTimeout(function(){_.hide(t.id)},t.expire)),_.pull[t.id]=e,e=null,t.id}function a(e,n,s){var a=document.createElement("DIV");a.className=" dhtmlx_modal_box dhtmlx-"+e.type,a.setAttribute("dhxbox",1);var r="";if(e.width&&(a.style.width=e.width),e.height&&(a.style.height=e.height),e.title&&(r+='<div class="dhtmlx_popup_title">'+e.title+"</div>"),r+='<div class="dhtmlx_popup_text"><span>'+(e.content?"":e.text)+'</span></div><div  class="dhtmlx_popup_controls">',n&&(r+=i(e.ok||"OK",!0)),s&&(r+=i(e.cancel||"Cancel",!1)),e.buttons)for(var o=0;o<e.buttons.length;o++)r+=i(e.buttons[o],o);if(r+="</div>",a.innerHTML=r,e.content){var d=e.content;"string"==typeof d&&(d=document.getElementById(d)),"none"==d.style.display&&(d.style.display=""),a.childNodes[e.title?1:0].appendChild(d)}return a.onclick=function(n){var i=(n=n||event).target||n.srcElement;if(i.className||(i=i.parentNode),"dhtmlx_popup_button"==i.className.split(" ")[0]){var s=i.getAttribute("result");t(e,s="true"==s||"false"!=s&&s)}},e.box=a,(n||s)&&(u=e),a}function r(t,i,s){var r=t.tagName?t:a(t,i,s);t.hidden||n(!0),document.body.appendChild(r);var o=Math.abs(Math.floor(((window.innerWidth||document.documentElement.offsetWidth)-r.offsetWidth)/2)),d=Math.abs(Math.floor(((window.innerHeight||document.documentElement.offsetHeight)-r.offsetHeight)/2));return"top"==t.position?r.style.top="-3px":r.style.top=d+"px",r.style.left=o+"px",r.onkeydown=e,r.focus(),t.hidden&&dhtmlx.modalbox.hide(r),r}function o(t){return r(t,!0,!1)}function d(t){return r(t,!0,!0)}function l(t){return r(t)}function h(t,e,n){return"object"!=typeof t&&("function"==typeof e&&(n=e,e=""),t={text:t,type:e,callback:n}),t}function c(t,e,n,i){return"object"!=typeof t&&(t={text:t,type:e,expire:n,id:i}),t.id=t.id||_.uid(),t.expire=t.expire||_.expire,t}var u=null;document.attachEvent?document.attachEvent("onkeydown",e):document.addEventListener("keydown",e,!0),dhtmlx.alert=function(){var t=h.apply(this,arguments);return t.type=t.type||"confirm",o(t)},dhtmlx.confirm=function(){var t=h.apply(this,arguments);return t.type=t.type||"alert",d(t)},dhtmlx.modalbox=function(){var t=h.apply(this,arguments);return t.type=t.type||"alert",l(t)},dhtmlx.modalbox.hide=function(t){for(;t&&t.getAttribute&&!t.getAttribute("dhxbox");)t=t.parentNode;t&&(t.parentNode.removeChild(t),n(!1))};var _=dhtmlx.message=function(t){switch((t=c.apply(this,arguments)).type=t.type||"info",t.type.split("-")[0]){case"alert":return o(t);case"confirm":return d(t);case"modalbox":return l(t);default:return s(t)}};_.seed=(new Date).valueOf(),_.uid=function(){return _.seed++},_.expire=4e3,_.keyboard=!0,_.position="top",_.pull={},_.timers={},_.hideAll=function(){for(var t in _.pull)_.hide(t)},_.hide=function(t){var e=_.pull[t];e&&e.parentNode&&(window.setTimeout(function(){e.parentNode.removeChild(e),e=null},2e3),
e.className+=" hidden",_.timers[t]&&window.clearTimeout(_.timers[t]),delete _.pull[t])}}(),window.gantt={version:"3.2.1"},window.dhtmlxEventable=function(obj){obj._silent_mode=!1,obj._silentStart=function(){this._silent_mode=!0},obj._silentEnd=function(){this._silent_mode=!1},obj.attachEvent=function(t,e,n){return this[t="ev_"+t.toLowerCase()]||(this[t]=new this._eventCatcher(n||this)),t+":"+this[t].addEvent(e)},obj.callEvent=function(t,e){return!!this._silent_mode||(!this[t="ev_"+t.toLowerCase()]||this[t].apply(this,e))},obj.checkEvent=function(t){return!!this["ev_"+t.toLowerCase()]},obj._eventCatcher=function(obj){var dhx_catch=[],z=function(){for(var t=!0,e=0;e<dhx_catch.length;e++)if(dhx_catch[e]){var n=dhx_catch[e].apply(obj,arguments);t=t&&n}return t};return z.addEvent=function(ev){return"function"!=typeof ev&&(ev=eval(ev)),!!ev&&dhx_catch.push(ev)-1},z.removeEvent=function(t){dhx_catch[t]=null},z},obj.detachEvent=function(t){if(t){var e=t.split(":");this[e[0]].removeEvent(e[1])}},obj.detachAllEvents=function(){for(var t in this)0===t.indexOf("ev_")&&delete this[t]},obj=null},dhtmlx.copy=function(t){var e,n,i;if(t&&"object"==typeof t){for(i={},n=[Array,Date,Number,String,Boolean],e=0;e<n.length;e++)t instanceof n[e]&&(i=e?new n[e](t):new n[e]);if(moment.isMoment(t))return(i=moment(t))._isEndDate=t._isEndDate,i;for(e in t)"model"!==e&&"widget"!==e&&"columns"!==e&&Object.prototype.hasOwnProperty.apply(t,[e])&&(i[e]=dhtmlx.copy(t[e]))}return i||t},dhtmlx.mixin=function(t,e,n){for(var i in e)t[i]&&!n||(t[i]=e[i]);return t},dhtmlx.defined=function(t){return void 0!==t},dhtmlx.uid=function(){return this._seed||(this._seed=gantt.date.now().valueOf()),this._seed++,this._seed},dhtmlx.bind=function(t,e){return t.bind?t.bind(e):function(){return t.apply(e,arguments)}},gantt._get_position=function(t){var e=0,n=0;if(t.getBoundingClientRect){var i=t.getBoundingClientRect(),s=document.body,a=document.documentElement,r=window.pageYOffset||a.scrollTop||s.scrollTop,o=window.pageXOffset||a.scrollLeft||s.scrollLeft,d=a.clientTop||s.clientTop||0,l=a.clientLeft||s.clientLeft||0;return e=i.top+r-d,n=i.left+o-l,{y:Math.round(e),x:Math.round(n),width:t.offsetWidth,height:t.offsetHeight}}for(;t;)e+=parseInt(t.offsetTop,10),n+=parseInt(t.offsetLeft,10),t=t.offsetParent;return{y:e,x:n,width:t.offsetWidth,height:t.offsetHeight}},gantt._detectScrollSize=function(){var t=document.createElement("div");t.style.cssText="visibility:hidden;position:absolute;left:-1000px;width:100px;padding:0px;margin:0px;height:110px;min-height:100px;overflow-y:scroll;",document.body.appendChild(t);var e=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),e},window.dhtmlx&&(dhtmlx.attaches||(dhtmlx.attaches={}),dhtmlx.attaches.attachGantt=function(t,e,n){var i=document.createElement("DIV");i.id="gantt_"+dhtmlx.uid(),i.style.width="100%",i.style.height="100%",i.cmp="grid",n=n||window.gantt,document.body.appendChild(i),this.attachObject(i.id);var s=this.vs[this.av];s.grid=n,n.init(i.id,t,e),i.firstChild.style.border="none",s.gridId=i.id,s.gridObj=i;var a="_viewRestore";return this.vs[this[a]()].grid}),"undefined"!=typeof window.dhtmlXCellObject&&(dhtmlXCellObject.prototype.attachGantt=function(t,e,n){var i=document.createElement("DIV");i.id="gantt_"+dhtmlx.uid(),i.style.width="100%",i.style.height="100%",i.cmp="grid",document.body.appendChild(i),this.attachObject(i.id),(n=n||window.gantt).init(i.id,t,e),i.firstChild.style.border="none";return i=null,this.callEvent("_onContentAttach",[]),this.dataObj}),dhtmlxEventable(gantt),gantt._click={},gantt._dbl_click={},gantt._context_menu={},gantt._on_click=function(t){var e=(t=t||window.event).target||t.srcElement,n=gantt.locate(t);if(null!==n?!gantt.checkEvent("onTaskClick")||gantt.callEvent("onTaskClick",[n,t]):gantt.callEvent("onEmptyClick",[t])){if(!gantt._find_ev_handler(t,e,gantt._click,n))return;if(n&&gantt.getTask(n)&&gantt.config.select_task){if(gantt._selected_task==n?gantt.unselectTask():gantt.selectTask(n),t.metaKey||t.ctrlKey)return;gantt.modalAdapter&&e.classList.contains("gantt_task_subject")&&(gantt.openGanttIssueModal(n),t.preventDefault());const i=e.classList;if(i.contains("gantt_level_toggler")){if(i.contains("open"))return void gantt.toggleLevel(n,"open");gantt.toggleLevel(n,"close"),t.preventDefault()}}}},gantt.toggleLevel=function(t,e){if(gantt._has_children(t)){Object.values(gantt._pull).filter(e=>e.parent==t).forEach(t=>{gantt[e](t.id)})}},gantt.addTogglersToEntity=function(t,e,n=""){const i=parseInt(t.real_id),s=gantt._has_children(t.id);if(t.$open){const a=Object.values(gantt._pull),r=(ysy.data.issues.getArray(),!!a.filter(e=>e.parent===t.id&&!e.$open).length);let o=!1,d=ysy.settings.labels.expander.open,l="open";r||o||(d=ysy.settings.labels.expander.close,l="close");const h=`<div class="gantt_level_toggle">\n        <a href="#" title="${d}" class="level_toggler">\n          <i class="easy-gantt__icon--${l} gantt_level_toggler ${l}"></i>\n        </a>\n      </div>`,c=a.filter(e=>e.parent===t.id&&gantt._has_children(e.id)),u=s&&c.length&&t.$open?h:"",_=ysy.main.escapeText(t.text);return`<a class="${n}" href="${e}${i}" title="${_}" target='_blank'>${_} ${u}</a>`}return""},gantt._on_contextmenu=function(t){var e=(t=t||window.event).target||t.srcElement,n=gantt.locate(e),i=gantt.locate(e,gantt.config.link_attribute),s=!gantt.checkEvent("onContextMenu")||gantt.callEvent("onContextMenu",[n,i,t]);return s||(t.preventDefault?t.preventDefault():t.returnValue=!1),s},gantt._find_ev_handler=function(t,e,n,i){for(var s=!0;e;){var a=e.className||"";if("string"==typeof a){a=a.split(" ");for(var r=0;r<a.length;r++)if(a[r]&&n[a[r]]){var o=n[a[r]].call(gantt,t,i,e);s=s&&!(void 0!==o&&!0!==o)}}e=e.parentNode}return s},gantt._on_dblclick=function(t){var e=(t=t||window.event).target||t.srcElement,n=gantt.locate(t);if(!gantt.checkEvent("onTaskDblClick")||gantt.callEvent("onTaskDblClick",[n,t])){if(!gantt._find_ev_handler(t,e,gantt._dbl_click,n))return;if(!n)return;const i=gantt.getTask(n);i&&"task"===i.$rendered_type&&gantt.openGanttIssueModal(n)}},gantt.openIssueModal=((t,e)=>{t&&gantt.modalAdapter&&gantt.modalAdapter.open("issue",t,e)}),gantt.openGanttIssueModal=function(t){function e(t){const e={id:t.id,assigned_to_id:t.assigned_to_id,done_ratio:t.done_ratio,due_date:t.end_date?t.end_date.format("YYYY-MM-DD"):"",start_date:t.start_date?t.start_date.format("YYYY-MM-DD"):"",estimated_hours:t.estimated_hours,subject:t.name,priority_id:t.priority_id,propject_id:t.project_id,spent_hours:t.spent_hours,status_id:t.status_id,tracker_id:t.tracker_id,easy_sprint_id:null==t.easy_sprint_id?null:t.easy_sprint_id,category_id:null==t.category_id?null:t.category_id,fixed_version_id:null==t.fixed_version_id?null:t.fixed_version_id};return Object.keys(e).forEach(t=>{null==e[t]&&delete e[t]}),e}const n=ysy.data.issues.array.find(e=>e.id===+t);if(n._created)return;document.addEventListener("vueModalIssueChanged",gantt.modalIssueChanged,!1);const i={localSave:!0,injectedIssue:e(n),rights:{project:!1,deletable:{start_date:!1,due_date:!1},addParentTasks:!1,addRelatedTasks:!1,addSubtasks:!1}};gantt.openIssueModal(t,i)},gantt.modalIssueChanged=function(t){const{id:e,buffer:n}=t.detail;if(n&&n["delete"])return void gantt.deleteTask(+e);const i=ysy.data.issues.array.find(t=>t.id===+e);n&&Object.keys(n).length&&e&&gantt.applyChanges(n,i)},gantt.applyChanges=function(t,e){function n(t,e,n){switch(t){case"due_date":return"end_date";case"subject":return n.set(t,e),"name";default:return t}}Object.entries(t).map(t=>{let[i,s]=t;e.hasOwnProperty(i)||(i=n(i,s,e)),i.includes("date")&&(i=n(i,s,e),s=moment(s)),e.set(i,s)}),document.removeEventListener("vueModalIssueChanged",gantt.modalIssueChanged)},gantt._on_mousemove=function(t){if(gantt.checkEvent("onMouseMove")){var e=gantt.locate(t);gantt._last_move_event=t,gantt.callEvent("onMouseMove",[e,t])}},dhtmlxDnD.prototype={dragStart:function(t,e){this.config={obj:t,marker:null,started:!1,pos:this.getPosition(e),sensitivity:4,offset:$(t).offset()},gantt.config.dateTooltipY=$(e.target).offset().top,this._settings&&dhtmlx.mixin(this.config,this._settings,!0),e.preventDefault();var n=dhtmlx.bind(function(e){return this.dragMove(t,e)},this),i=(dhtmlx.bind(function(e){return this.dragScroll(t,e)},this),!1),s=dhtmlx.bind(function(t){if(!i){i=!0;var e=n(t);return i=!1,e}},this),a=dhtmlx.bind(function(){return dhtmlxDetachEvent(document.body,"mousemove",s),dhtmlxDetachEvent(document.body,"mouseup",a),this.dragEnd(t)},this);if(this.config.marker){var r=this.config.marker=document.createElement("div");r.className="gantt_drag_marker",document.body.appendChild(r)}e.pos=this.getPosition(e),this.actPos=e.pos,dhtmlxEvent(document.body,"mousemove",s),dhtmlxEvent(document.body,"mouseup",a),this.callEvent("onDragStart",[t,e])},dragMove:function(t,e){if(!this.config.started){var n=this.getPosition(e),i=n.x-this.config.pos.x,s=n.y-this.config.pos.y;if(Math.sqrt(Math.pow(Math.abs(i),2)+Math.pow(Math.abs(s),2))>this.config.sensitivity){if(this.config.started=!0,this.config.ignore=!1,!1===this.callEvent("onBeforeDragStart",[t,this.config.original_target]))return this.config.ignore=!0,!0;this.callEvent("onAfterDragStart",[t,this.config.original_target])}else this.config.ignore=!0}this.config.ignore||(e.pos=this.getPosition(e),this.actPos=e.pos,this.config.marker&&(this.config.marker.style.left=e.pos.x+"px",this.config.marker.style.top=e.pos.y+"px"),this.callEvent("onDragMove",[t,e]))},dragEnd:function(){this.config.marker&&this.destroyMarker(),this.config.started&&!this.config.ignore&&this.callEvent("onDragEnd",[])},getDiff:function(){return{x:this.actPos.x-this.config.pos.x,y:this.actPos.y-this.config.pos.y}},getPosition:function(t){var e=0,n=0;return(t=t||window.event).pageX||t.pageY?(e=t.pageX,n=t.pageY):(t.clientX||t.clientY)&&(e=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:e,y:n}},destroyMarker:function(){this.config.marker.parentNode.removeChild(this.config.marker),this.config.marker=null},getRelativePos:function(){return{x:this.actPos.x-this.config.offset.left,y:this.actPos.y-this.config.offset.top}}},window.dhtmlxDnD=dhtmlxDnD,gantt._init_grid=function(){this._click.gantt_close=dhtmlx.bind(function(t,e){return this.close(e),!1},this),this._click.gantt_open=dhtmlx.bind(function(t,e){return this.open(e),!1},this),this._click.gantt_row=dhtmlx.bind(function(t,e,n){if(null!==e){this.getTask(e);this.callEvent("onTaskRowClick",[e,n])}},this),this._click.gantt_grid_head_cell=dhtmlx.bind(function(t,e,n){var i=n.getAttribute("column_id");if(this.callEvent("onGridHeaderClick",[i,t]))if("add"==i)this._click.gantt_add(t,this.config.root_id);else if(this.config.sort){var s=this._sort&&this._sort.direction&&this._sort.name==i?this._sort.direction:"desc";s="desc"==s?"asc":"desc",this._sort={name:i,direction:s},this.sort(i,"desc"==s)}},this),this.config.sort||!this.config.order_branch&&!this.config.rearrange_branch||this._init_dnd(this.config.rearrange_branch),this._click.gantt_add=dhtmlx.bind(function(t,e){if(!this.config.readonly){var n={};return this.createTask(n,e||this.config.root_id),!1}},this),this._init_resize&&this._init_resize()},gantt._render_grid=function(){this._is_grid_visible()&&(this._calc_grid_width(),this._render_grid_header())},gantt._calc_grid_width=function(){for(var t=this.getGridColumns(),e=0,n=[],i=[],s=0;s<t.length;s++){var a=parseInt(t[s].width,10);window.isNaN(a)&&(a=50,n.push(s)),i[s]=a,e+=a}if(this.config.autofit||n.length){var r=this._get_grid_width()-e;n.length>0?n.length:i.length>0&&i.length;if(n.length>0){var o=r/(n.length?n.length:1);for(s=0;s<n.length;s++){i[n[s]]+=o}}else for(o=r/(i.length?i.length:1),s=0;s<i.length;s++)i[s]+=o;for(s=0;s<i.length;s++)t[s].width=i[s]}else this.config.grid_width=e},gantt._render_grid_header=function(){for(var t=this.getGridColumns(),e=[],n=0,i=this.locale.labels,s=this.config.scale_height-2,a=0;a<t.length;a++){var r=a==t.length-1,o=t[a];r&&this._get_grid_width()>n+o.width&&(o.width=this._get_grid_width()-n),n+=o.width;var d=this._sort&&o.name==this._sort.name?"<div class='gantt_sort gantt_"+this._sort.direction+"'></div>":"",l=["gantt_grid_head_cell","gantt_grid_head_"+o.name,r?"gantt_last_cell":"",this.templates.grid_header_class(o.name,o)].join(" "),h="width:"+(o.width-(r?1:0))+"px;",c=o.label||i["column_"+o.name];c=c||"";var u="<div class='"+l+"' style='"+h+"' column_id='"+o.name+"'>"+c+d+"</div>";e.push(u)}this.$grid_scale.style.height=this.config.scale_height-1+"px",this.$grid_scale.style.lineHeight=s+"px",this.$grid_scale.style.width=n-1+"px",this.$grid_scale.innerHTML=e.join("")},gantt._render_grid_item=function(t){if(!gantt._is_grid_visible())return null;if(!t.columns)return gantt._render_grid_superitem(t);for(var e=this.getGridColumns(),n=[],i=0;i<e.length;i++){var s,a,r=i==e.length-1,o=e[i];"add"==o.name?a="<div class='gantt_add'></div>":((a=o.template?o.template(t):t[o.name])instanceof Date&&(a=this.templates.date_grid(a)),a="<div class='gantt_tree_content'>"+a+"</div>");var d="gantt_cell gantt_tree_cell"+(o.css?" "+o.css:"")+(r?" gantt_last_cell":""),l="";if(o.tree){for(var h=0;h<t.$level;h++)l+=this.templates.grid_indent(t);this._has_children(t.id)?(l+=this.templates.grid_open(t),l+=this.templates.grid_folder(t)):(l+=this.templates.grid_blank(t),l+=this.templates.grid_file(t))}var c="width:"+(o.width-(r?1:0))+"px;";dhtmlx.defined(o.align)&&(c+="text-align:"+o.align+";"),s="<div class='"+d+"' style='"+c+"'>"+l+a+"</div>",n.push(s)}d=t.$index%2==0?" odd":"";if(d+=t.$transparent?" gantt_transparent":"",this.templates.grid_row_class){var u=this.templates.grid_row_class.call(this,t.start_date,t.end_date,t);u&&(d+=" "+u)}this.getState().selected_task==t.id&&(d+=" gantt_selected");var _=document.createElement("div");return _.className="gantt_row gantt_tree_row"+d,_.setAttribute("data-url","/issues/"+t.id+".json"),_.style.height=this.config.row_height+"px",_.style.lineHeight=gantt.config.row_height+"px",_.setAttribute(this.config.task_attribute,t.id),_.setAttribute("data-level",t.$level),_.setAttribute("data-prev-count",t.$prev),_.innerHTML=n.join(""),_},gantt.open=function(t){!1!==this.callEvent("onBeforeTaskOpened",[t])&&(gantt._set_item_state(t,!0),this.callEvent("onTaskOpened",[t]))},gantt.close=function(t){gantt._set_item_state(t,!1),this.callEvent("onTaskClosed",[t])},gantt._set_item_state=function(t,e){t&&this._pull[t]&&(this._pull[t].$open=e,this.refreshData())},gantt._is_grid_visible=function(){return this.config.grid_width&&this.config.show_grid},gantt._get_grid_width=function(){return this._is_grid_visible()?this._is_chart_visible()?this.config.grid_width:this._x:0},gantt.getTaskIndex=function(t){for(var e=this.getChildren(this.getParent(t)),n=0;n<e.length;n++)if(e[n]==t)return n;return-1},gantt.getGlobalTaskIndex=function(t){for(var e=this._order,n=0;n<e.length;n++)if(e[n]==t)return n;return-1},gantt.moveTask=function(t,e,n){ysy.log.debug("moveTask","move_task");var i=arguments[3];if(i){if(i===t)return;n=this.getParent(i),e=this.getTaskIndex(i)}if(t!=n){n=n||this.config.root_id;var s=this.getTask(t),a=this.getParent(s.id),r=(this.getChildren(this.getParent(s.id)),this.getChildren(n));if(-1==e&&(e=r.length+1),a==n)if(this.getTaskIndex(t)==e)return;if(!1!==this.callEvent("onBeforeTaskMove",[t,n,e])){this._replace_branch_child(a,t),(r=this.getChildren(n))[e]?r=r.slice(0,e).concat([t]).concat(r.slice(e)):r.push(t),this.setParent(s,n),this._branches[n]=r;for(var o=this._getTaskTree(t),d=0;d<o.length;d++){var l=this._pull[o[d]];l&&(l.$level=this.calculateTaskLevel(l))}1*e>0?s.$drop_target=i?(this.getTaskIndex(t)>this.getTaskIndex(i)?"next:":"")+i:"next:"+gantt.getPrevSibling(t):r[1*e+1]?s.$drop_target=r[1*e+1]:s.$drop_target=n,this.callEvent("onAfterTaskMove",[t,n,e])&&(s.$level=gantt.calculateTaskLevel(s),this.refreshData())}}},gantt._init_dnd=function(t){var e=new dhtmlxDnD(this.$grid_data,{marker:!0,updates_per_second:60});dhtmlx.defined(this.config.dnd_sensitivity)&&(e.config.sensitivity=this.config.dnd_sensitivity),e.attachEvent("onBeforeDragStart",dhtmlx.bind(function(t,n){var i=n.target;if(ysy.log.debug("Grid onBeforeDragStart "+i.className,"move_task"),!$(i).hasClass("gantt_drag_handle"))return!1;if(!this._locateHTML(n))return!1;this.hideQuickInfo&&this._hideQuickInfo();var s=this.locate(n),a=gantt.getTask(s);return!gantt._is_readonly(a)&&(a.type!==gantt.config.types.milestone&&(e.config.initial_open_state=a.$open,!!this.callEvent("onRowDragStart",[s,n.target||n.srcElement,n])&&void 0))},this)),e.attachEvent("onAfterDragStart",dhtmlx.bind(function(t,n){var i=this._locateHTML(n);ysy.log.debug("Grid onAfterDragStart "+n.target.className,"move_task"),e.config.marker.innerHTML=i.outerHTML,e.config.id=this.locate(n);var s=this.getTask(e.config.id);e.config.index=this.getTaskIndex(e.config.id),e.config.parent=s.parent,s.$open=!1,s.$transparent=!0},this)),e.lastTaskOfLevel=function(t){for(var e=gantt._order,n=gantt._pull,i=null,s=0,a=e.length;s<a;s++)n[e[s]].$level==t&&(i=n[e[s]]);return i?i.id:null},e._getGridPos=dhtmlx.bind(function(t){var e=this._get_position(this.$grid_data),n=e.x,i=t.pos.y-10;return i<e.y&&(i=e.y),i>e.y+this.$grid_data.offsetHeight-this.config.row_height&&(i=e.y+this.$grid_data.offsetHeight-this.config.row_height),e.x=n,e.y=i,e},this),e.attachEvent("onDragMove",dhtmlx.bind(function(n,i){ysy.log.debug("Grid onDragMove","move_task");var s=e.config,a=e._getGridPos(i);s.marker.style.left=a.x+10+"px",s.marker.style.top=a.y+"px";(a=e._getGridPos(i)).x;var r=a.y,o=$(window),d=document.elementFromPoint(a.x-o.scrollLeft()+1,r-o.scrollTop()+9),l=this.locate(d),h=this.getTask(e.config.id);if(this.isTaskExists(l)||(l=e.lastTaskOfLevel(h.$level))==e.config.id&&(l=null),this.isTaskExists(l)){var c=gantt._get_position(d),u=this.getTask(l);if(t)return ysy.log.debug("over="+u.id+" "+u.text,"sort_over"),e.config.over!==u&&(e.config.over=u,$(d).closest(".gantt_grid_data").find(".gantt_drag_hover").removeClass("gantt_drag_hover"),$(d).closest(".gantt_row").addClass("gantt_drag_hover")),!0;if(c.y+d.offsetHeight/2<r){var _=this.getGlobalTaskIndex(u.id),g=this._pull[this._order[_+1]];if(g){if(g.id==h.id)return;u=g}else if((g=this._pull[this._order[_]]).$level==h.$level&&g.id!=h.id)return void this.moveTask(h.id,-1,this.getParent(g.id))}_=this.getGlobalTaskIndex(u.id);for(var f=this._pull[this._order[_-1]],p=1;(!f||f.id==u.id)&&_-p>=0;)f=this._pull[this._order[_-p]],p++;if(h.id==u.id)return;u.$level==h.$level&&h.id!=u.id?this.moveTask(h.id,0,0,u.id):u.$level!=h.$level-1||gantt.getChildren(u.id).length?f&&f.$level==h.$level&&h.id!=f.id&&this.moveTask(h.id,-1,this.getParent(f.id)):this.moveTask(h.id,0,u.id)}return!0},this)),e.attachEvent("onDragEnd",dhtmlx.bind(function(){ysy.log.debug("Grid onDragEnd","move_task");var n=this.getTask(e.config.id);if(!1===this.callEvent("onBeforeRowDragEnd",[e.config.id,e.config.parent,e.config.index]))this.moveTask(e.config.id,e.config.index,e.config.parent),n.$drop_target=null;else{if(t){for(var i=e.config.over,s=gantt.allowedParent(n,i);!s;){if(i.real_id>1e12){dhtmlx.message(ysy.view.getLabel("errors2","unsaved_parent"),"error"),i=null;break}var a=i.parent;if(0===a){i=null;break}i=gantt.getTask(a),s=gantt.allowedParent(n,i)}if(i){if(!1===this.callEvent("onBeforeTaskMove",[n.id,i.id,0]))return;if(n.$drop_target=null,i.readonly&&"project"===i.$rendered_type)return void this.callEvent("onAfterTaskMove",[n.id,i.id,0]);gantt.silentMoveTask(n,i.id),this.callEvent("onAfterTaskMove",[n.id,i.id,0]),n.widget.update(n)}}this.callEvent("onRowDragEnd",[e.config.id,n.$drop_target])}n.$transparent=!1,n.$open=e.config.initial_open_state,this.refreshData()},this))},gantt.getGridColumns=function(){return this.config.columns},gantt._has_children=function(t){return this.getChildren(t).length>0},gantt._scale_helpers={getSum:function(t,e,n){n===undefined&&(n=t.length-1),e===undefined&&(e=0);for(var i=0,s=e;s<=n;s++)i+=t[s];return i},setSumWidth:function(t,e,n,i){var s=e.width;i===undefined&&(i=s.length-1),n===undefined&&(n=0);var a=i-n+1;if(!(n>s.length-1||a<=0||i>s.length-1)){var r=t-this.getSum(s,n,i);this.adjustSize(r,s,n,i),this.adjustSize(-r,s,i+1),e.full_width=this.getSum(s)}},splitSize:function(t,e){for(var n=[],i=0;i<e;i++)n[i]=0;return this.adjustSize(t,n),n},adjustSize:function(t,e,n,i){n||(n=0),i===undefined&&(i=e.length-1);for(var s=i-n+1,a=this.getSum(e,n,i),r=n;r<=i;r++){var o=Math.floor(t*(a?e[r]/a:1/s));a-=e[r],t-=o,s--,e[r]+=o,o}e[e.length-1]+=t},sortScales:function(t){t.sort(function(t,e){var n=moment.duration(t.step,t.unit+"s"),i=moment.duration(e.step,e.unit+"s");return n<i?1:n>i?-1:0})},primaryScale:function(){return gantt._init_template("date_scale"),{unit:gantt.config.scale_unit,step:gantt.config.step,template:gantt.templates.date_scale,date:gantt.config.date_scale,css:gantt.templates.scale_cell_class}},prepareConfigs:function(t,e,n,i){for(var s=this.splitSize(i,t.length),a=n,r=[],o=t.length-1;o>=0;o--){var d=o==t.length-1,l=this.initScaleConfig(t[o]);d&&this.processIgnores(l),this.initColSizes(l,e,a,s[o]),this.limitVisibleRange(l),d&&(a=l.full_width),r.unshift(l)}for(o=0;o<r.length-1;o++)this.alineScaleColumns(r[r.length-1],r[o]);for(o=0;o<r.length;o++)this.setPosSettings(r[o]);return r},setPosSettings:function(t){for(var e=0,n=t.trace_x.length;e<n;e++)t.left.push((t.width[e-1]||0)+(t.left[e-1]||0))},_ignore_time_config:function(t){return!!this.config.skip_off_time&&!this.isWorkTime(t)},processIgnores:function(t){t.ignore_x={},t.display_count=t.count},initColSizes:function(t,e,n,i){var s=n;t.height=i;var a=t.display_count===undefined?t.count:t.display_count;a||(a=1),t.col_width=Math.floor(s/a),e&&t.col_width<e&&(t.col_width=e,s=t.col_width*a),t.width=[];for(var r=t.ignore_x||{},o=0;o<t.trace_x.length;o++)r[t.trace_x[o].valueOf()]||t.display_count==t.count?t.width[o]=0:t.width[o]=1;this.adjustSize(s-this.getSum(t.width),t.width),t.full_width=this.getSum(t.width)},initScaleConfig:function(t){var e=dhtmlx.mixin({count:0,col_width:0,full_width:0,height:0,width:[],left:[],trace_x:[],date_cache:{}},t);return this.eachColumn(t.unit,t.step,function(t){e.count++;var n=gantt.date.Date(t);e.trace_x.push(n)}),e},iterateScales:function(t,e,n,i,s){for(var a=e.trace_x,r=t.trace_x,o=n||0,d=i||r.length-1,l=0,h=1;h<a.length;h++)for(var c=o;c<=d;c++)+r[c]!=+a[h]||(s&&s.apply(this,[l,h,o,c]),o=c,l=h)},alineScaleColumns:function(t,e,n,i){this.iterateScales(t,e,n,i,function(n,i,s,a){var r=this.getSum(t.width,s,a-1);this.getSum(e.width,n,i-1)!=r&&this.setSumWidth(r,e,n,i-1)})},eachColumn:function(t,e,n){var i=gantt.date.Date(gantt._min_date),s=gantt.date.Date(gantt._max_date);gantt.date[t+"_start"]&&(i=gantt.date[t+"_start"](i));var a=moment(i).toDate();for(+a>=+s&&(s=gantt.date.add(a,e,t));+a<+s;){n.call(this,gantt.date.Date(a));var r=a.getTimezoneOffset();a=gantt.date.add(a,e,t),a=gantt._correct_dst_change(a,r,e,t),gantt.date[t+"_start"]&&(a=gantt.date[t+"_start"](a))}},limitVisibleRange:function(t){var e=t.trace_x,n=0,i=t.width.length-1,s=0;if(+e[0]<+gantt._min_date&&n!=i){var a=Math.floor(t.width[0]*((e[1]-gantt._min_date)/(e[1]-e[0])));s+=t.width[0]-a,t.width[0]=a,e[0]=moment(gantt._min_date).toDate()}var r=e.length-1,o=e[r],d=gantt.date.add(o,t.step,t.unit);if(+d>+gantt._max_date&&r>0){a=t.width[r]-Math.floor(t.width[r]*((d-gantt._max_date)/(d-o)));s+=t.width[r]-a,t.width[r]=a}if(s){for(var l=this.getSum(t.width),h=0,c=0;c<t.width.length;c++){var u=Math.floor(s*(t.width[c]/l));t.width[c]+=u,h+=u}this.adjustSize(s-h,t.width)}}},gantt._tasks_dnd={drag:null,_events:{before_start:{},before_finish:{},after_finish:{}},_handlers:{},init:function(){this.clear_drag_state();var t=gantt.config.drag_mode;this.set_actions();var e={before_start:"onBeforeTaskDrag",before_finish:"onBeforeTaskChanged",after_finish:"onAfterTaskDrag"};for(var n in this._events)for(var i in t)this._events[n][i]=e[n];this._handlers[t.move]=this._handlers[t.move]||this._move,this._handlers[t.resize]=this._handlers[t.resize]||this._resize,ysy.settings.showTasksSpentTimeRatio||(this._handlers[t.progress]=this._handlers[t.progress]||this._resize_progress)},set_actions:function(){var t=gantt.$task_data;dhtmlxEvent(t,"mousemove",dhtmlx.bind(function(t){this.on_mouse_move(t||event)},this)),dhtmlxEvent(t,"mousedown",dhtmlx.bind(function(t){this.on_mouse_down(t||event)},this)),dhtmlxEvent(t,"mouseup",dhtmlx.bind(function(t){this.on_mouse_up(t||event)},this))},clear_drag_state:function(){this.drag={id:null,mode:null,pos:null,start_x:null,start_y:null,obj:null,left:null,last_event:null}},_resize:function(t,e,n){var i=gantt.config,s=this._drag_task_coords(t,n);if(this.showDraggedTooltip(t,n),n.left){t.start_date;var a=moment(gantt.dateFromPos(s.start+e.x));gantt.multiStop(t,a,null,n.limits),t.start_date=a,t.start_date||(t.start_date=gantt.date.Date(gantt.getState().min_date))}else{t.end_date;var r=moment(gantt.dateFromPos(s.end+e.x)).subtract(1,"days");r._isEndDate=!0,gantt.multiStop(t,null,r,n.limits),t.end_date=r,t.end_date||(t.end_date=gantt.date.Date(gantt.getState().max_date)),t.end_date._isEndDate=!0}t.end_date-t.start_date<i.min_duration&&(n.left?t.start_date=gantt.calculateEndDate(t.end_date,-1):t.end_date=gantt.calculateEndDate(t.start_date,1)),n.left?gantt.moveDependent(t,null,"resize_left"):gantt.moveDependent(t,null,"resize_right")},_resize_progress:function(t,e,n){var i=this._drag_task_coords(t,n),s=Math.max(0,n.pos.x-i.start);t.progress=Math.min(1,s/(i.end-i.start));const a=Math.round(100*t.progress);this.showDraggedProgressTooltip(a,n)},_move:function(t,e,n){var i=this._drag_task_coords(t,n);if("milestone"===t.type)a=moment(gantt.dateFromPos(i.start+e.x)),(a=gantt._working_time_helper.get_closest_worktime({date:a,unit:"day",dir:"any",length:1}))._isEndDate=!0,s=moment(a);else var s=gantt._working_time_helper.get_closest_worktime({date:moment(gantt.dateFromPos(i.start+e.x)),dir:"future"}),a=gantt._working_time_helper.add_worktime(s,t.duration,"day",!0);gantt.multiStop(t,s,a,n.limits);t.start_date;if(s?a?(t.start_date=s,t.end_date=a):(t.end_date=gantt.date.Date(gantt.getState().max_date),t.start_date=gantt.dateFromPos(gantt.posFromDate(t.end_date)-(i.end-i.start))):(t.start_date=gantt.date.Date(gantt.getState().min_date),t.end_date=gantt.dateFromPos(gantt.posFromDate(t.start_date)+(i.end-i.start))),"project"===t.type){t.maximal_start=null,t.minimal_end=null,gantt.getChildren(t.id).forEach(t=>{const n=gantt._pull[t];if("milestone"!==n.$rendered_type)return;n.obj_s_x=n.obj_s_x||gantt.posFromDate(n.start_date);const i=gantt.dateFromPos(n.obj_s_x+e.x);n.start_date=i,n.widget.update(n)})}else gantt.moveDependent(t);this.showDraggedTooltip(t,n)},showDraggedTooltip:function(t,e){const n=gantt._working_time_helper.get_work_units_between(t.start_date,t.end_date,"all"),i={start_date:t.start_date?t.start_date.format(gantt.config.date_format):ysy.settings.labels.label_not_available,end_date:t.end_date?t.end_date.format(gantt.config.date_format):ysy.settings.labels.label_not_available,duration:Math.floor(n.days)},s=gantt.config.dateTooltipY+gantt.config.row_height;return ysy.view.tooltip.show("gantt-task-tooltip",{clientX:e.clientX,clientY:e.clientY,top:s},ysy.view.templates.TaskTooltip,i)},showDraggedProgressTooltip:function(t,e){const n={progress:t},i=gantt.config.dateTooltipY+gantt.config.row_height;return ysy.view.tooltip.show("gantt-task-tooltip",{clientX:e.clientX,clientY:e.clientY,top:i},ysy.view.templates.TaskTooltip,n)},_drag_task_coords:function(t,e){return{start:e.obj_s_x=e.obj_s_x||gantt.posFromDate(t.start_date),end:e.obj_e_x=e.obj_e_x||gantt.posFromDate(t.end_date)}},on_mouse_move:function(t){this.drag.start_drag&&this._start_dnd(t);var e=this.drag;e.mode&&(e.last_event||setTimeout($.proxy(this._update_on_move,this),5),e.last_event=t)},_update_on_move:function(){var t=this.drag;if(t&&t.mode){var e=t.last_event;if(!e)return;t.last_event=null;var n=gantt._get_mouse_pos(e);if(t.pos){if(t.pos.x==n.x&&t.pos.y==n.y)return}else if(Math.abs(t.start_x-n.x)<10&&Math.abs(t.start_y-n.y)<10)return;t.pos=n;var i=gantt.dateFromPos(n.x);if(!i||isNaN(i.getTime()))return;var s={x:n.x-t.start_x,y:n.y-t.start_y},a=gantt.getTask(t.id);if(this._handlers[t.mode]){t.target=e.target,t.clientX=e.clientX,t.clientY=e.clientY;var r=dhtmlx.mixin({},a),o=dhtmlx.mixin({},a);this._handlers[t.mode].apply(this,[o,s,t]),dhtmlx.mixin(a,o,!0),gantt.callEvent("onTaskDrag",[a.id,t.mode,o,r,e]),a._changed=t.mode,gantt.refreshTask(t.id)}}},on_mouse_down:function(t,e){if(2==t.button)return!1;var n=gantt.locate(t),i=null;if(gantt.isTaskExists(n)&&(i=gantt.getTask(n)),null==i)return ysy.log.debug("No task under click","empty_field"),void this.clear_drag_state();if(gantt._is_readonly(i)||this.drag.mode)return!1;this.clear_drag_state(),e=e||t.target||t.srcElement;var s=gantt._trim(e.className||"");if(!s||!this._get_drag_mode(s))return!!e.parentNode&&this.on_mouse_down(t,e.parentNode);var a=this._get_drag_mode(s);if(ysy.log.debug("drag.mode="+(a?a.mode:"null"),"empty_field"),a)if(a.mode&&a.mode!=gantt.config.drag_mode.ignore&&gantt.config["drag_"+a.mode]){if(null!=(n=gantt.locate(e))){if(i=dhtmlx.copy(gantt.getTask(n)||{}),gantt._is_readonly(i))return this.clear_drag_state(),!1;a.id=n,a.obj=i,a.limits=gantt.prepareMultiStop(i)}var r=gantt._get_mouse_pos(t);a.start_x=r.x,a.start_y=r.y,this.drag.start_drag=a}else this.clear_drag_state();else if(gantt.checkEvent("onMouseDown")&&gantt.callEvent("onMouseDown",[s.split(" ")[0]])&&e.parentNode)return this.on_mouse_down(t,e.parentNode);return!1},_fix_dnd_scale_time:function(t,e){function n(t){gantt.isWorkTime(t.start_date)||(t.start_date=gantt.calculateEndDate(t.start_date,0,gantt.config.duration_unit))}function i(t){gantt.isWorkTime(gantt.date.Date(t.end_date-1))||(t.end_date=gantt.calculateEndDate(t.end_date,1,gantt.config.duration_unit))}alert("Forbidden function _fix_dnd_scale_time");var s=gantt._tasks.unit,a=gantt._tasks.step;gantt.config.round_dnd_dates||(s="minute",a=gantt.config.time_step),s="day",e.mode==gantt.config.drag_mode.resize?(e.left?(t.start_date=gantt.roundDate({date:t.start_date,unit:s,step:a}),n(t)):(t.end_date=gantt.roundDate({date:t.end_date,unit:s,step:a}),i(t)),t.duration=gantt.calculateDuration(t.start_date,t.end_date)):e.mode==gantt.config.drag_mode.move&&(t.start_date=gantt.roundDate({date:t.start_date,unit:s,step:a}),n(t),t.end_date=gantt.calculateEndDate(t.start_date,t.duration,gantt.config.duration_unit))},_fix_working_times:function(t,e){gantt._working_time_helper.round_date(t.start_date),e.mode==gantt.config.drag_mode.resize&&(gantt._working_time_helper.round_date(t.end_date,"past"),t.duration=gantt._working_time_helper.get_work_units_between(t.start_date,t.end_date,"day")),t.end_date=gantt._working_time_helper.add_worktime(t.start_date,t.duration,"day")},on_mouse_up:function(t){var e=this.drag;if(e.mode&&e.id){var n=gantt.getTask(e.id);if(this._fireEvent("before_finish",e.mode,[e.id,e.mode,t]),gantt.updateAllTask(n),gantt._tasks.needRescale&&(gantt._tasks.needRescale=!1,gantt.render(),ysy.log.debug("Scale rescaled","outer")),this.clear_drag_state(),ysy.view.tooltip.hide(),"project"===n.type){gantt.getChildren(n.id).forEach(t=>{const e=gantt._pull[t];"milestone"===e.$rendered_type&&(e.obj_s_x=null)})}}else this.clear_drag_state()},_get_drag_mode:function(t){var e=gantt.config.drag_mode,n=(t||"").split(" "),i={mode:null,left:null};switch(n[0]){case"gantt_task_line":case"gantt_task_content":i.mode=e.move;break;case"gantt_task_drag":i.mode=e.resize,n[1]&&-1!==n[1].indexOf("left",n[1].length-"left".length)?i.left=!0:i.left=!1;break;case"gantt_task_progress_drag":i.mode=e.progress;break;case"gantt_link_control":case"gantt_link_point":i.mode=e.ignore;break;case"gantt_task_cell":i.mode="empty";break;default:i=null}return i},_start_dnd:function(t){var e=this.drag=this.drag.start_drag;delete e.start_drag;var n=gantt.config,i=e.id;n["drag_"+e.mode]&&gantt.callEvent("onBeforeDrag",[i,e.mode,t])&&this._fireEvent("before_start",e.mode,[i,e.mode,t])?delete e.start_drag:this.clear_drag_state()},_fireEvent:function(t,e,n){dhtmlx.assert(this._events[t],"Invalid stage:{"+t+"}");var i=this._events[t][e];return dhtmlx.assert(i,"Unknown after drop mode:{"+e+"}"),dhtmlx.assert(n,"Invalid event arguments"),!gantt.checkEvent(i)||gantt.callEvent(i,n)}},gantt.roundTaskDates=function(t){alert("Forbidden function roundTaskDates");var e=gantt._tasks_dnd.drag;e||(e={mode:gantt.config.drag_mode.move}),gantt._tasks_dnd._fix_dnd_scale_time(t,e)},gantt._render_link=function(t){for(var e=this.getLink(t),n=gantt._get_link_renderers(),i=0;i<n.length;i++)n[i].render_item(e)},gantt._get_link_type=function(t,e){var n=null
;return t&&e?n=gantt.config.links.start_to_start:!t&&e?n=gantt.config.links.finish_to_start:t||e?t&&!e&&(n=gantt.config.links.start_to_finish):n=gantt.config.links.finish_to_finish,n},gantt.isLinkAllowed=function(t,e,n,i){var s=null;if(!(s="object"==typeof t?t:{source:t,target:e,type:this._get_link_type(n,i)}))return!1;if(s.target&&s.target.toString().startsWith("p"))return!1;if(!(s.source&&s.target&&s.type))return!1;if(s.source==s.target)return!1;var a=!0;return this.checkEvent("onLinkValidation")&&(a=this.callEvent("onLinkValidation",[s])),a},gantt._render_link_element=function(t){var e=this._path_builder.get_points(t),n=gantt._drawer,i=n.get_lines(e),s=document.createElement("div"),a="gantt_task_link";t.color&&(a+=" gantt_link_inline_color");var r=this.templates.link_class?this.templates.link_class(t):"";r&&(a+=" "+r),this.config.highlight_critical_path&&this.isCriticalLink&&this.isCriticalLink(t)&&(a+=" gantt_critical_link"),s.className=a,s.setAttribute(gantt.config.link_attribute,t.id);for(var o=0;o<i.length;o++){o==i.length-1&&(i[o].size-=gantt.config.link_arrow_size);var d=n.render_line(i[o],i[o+1]);t.color&&(d.firstChild.style.backgroundColor=t.color),s.appendChild(d)}var l=i[i.length-1].direction,h=gantt._render_link_arrow(e[e.length-1],l);t.color&&(h.style.borderColor=t.color),s.appendChild(h);var c={x:(e[e.length-2].x+e[e.length-1].x)/2-5,y:e[e.length-2].y-2},u=gantt.render_delay_element(t,c);return u&&s.appendChild(u),s},gantt._render_link_arrow=function(t,e){var n=document.createElement("div"),i=gantt._drawer,s=t.y,a=t.x,r=gantt.config.link_arrow_size,o=gantt.config.row_height,d="gantt_link_arrow gantt_link_arrow_"+e;switch(e){case i.dirs.right:s-=(r-o)/2,a-=r;break;case i.dirs.left:s-=(r-o)/2;break;case i.dirs.up:a-=(r-o)/2;break;case i.dirs.down:s-=r,a-=(r-o)/2}return n.style.cssText=["top:"+s+"px","left:"+a+"px"].join(";"),n.className=d,n},gantt._drawer={current_pos:null,dirs:{left:"left",right:"right",up:"up",down:"down"},path:[],clear:function(){this.current_pos=null,this.path=[]},point:function(t){this.current_pos=dhtmlx.copy(t)},get_lines:function(t){this.clear(),this.point(t[0]);for(var e=1;e<t.length;e++)this.line_to(t[e]);return this.get_path()},line_to:function(t){var e=dhtmlx.copy(t),n=this.current_pos,i=this._get_line(n,e);this.path.push(i),this.current_pos=e},get_path:function(){return this.path},get_wrapper_sizes:function(t){var e,n=gantt.config.link_wrapper_width,i=(gantt.config.link_line_width,t.y+Math.floor((gantt.config.row_height-n)/2));switch(t.direction){case this.dirs.left:e={top:i,height:n,lineHeight:n,left:t.x-t.size-n/2,width:t.size+n};break;case this.dirs.right:e={top:i,lineHeight:n,height:n,left:t.x-n/2,width:t.size+n};break;case this.dirs.up:e={top:i-t.size,lineHeight:t.size+n,height:t.size+n,left:t.x-n/2,width:n};break;case this.dirs.down:e={top:i,lineHeight:t.size+n,height:t.size+n,left:t.x-n/2,width:n}}return e},get_line_sizes:function(t){var e,n=gantt.config.link_line_width,i=gantt.config.link_wrapper_width,s=t.size+n;switch(t.direction){case this.dirs.left:case this.dirs.right:e={height:n,width:s,marginTop:(i-n)/2-1,marginLeft:(i-n)/2};break;case this.dirs.up:case this.dirs.down:e={height:s,width:n,marginTop:(i-n)/2-1,marginLeft:(i-n)/2}}return e},render_line:function(t){var e=this.get_wrapper_sizes(t),n=document.createElement("div");n.style.cssText=["top:"+e.top+"px","left:"+e.left+"px","height:"+e.height+"px","width:"+e.width+"px"].join(";"),n.className="gantt_line_wrapper";var i=this.get_line_sizes(t),s=document.createElement("div");return s.style.cssText=["height:"+i.height+"px","width:"+i.width+"px","margin-top:"+i.marginTop+"px","margin-left:"+i.marginLeft+"px"].join(";"),s.className="gantt_link_line_"+t.direction,n.appendChild(s),n},_get_line:function(t,e){var n=this.get_direction(t,e),i={x:t.x,y:t.y,direction:this.get_direction(t,e)};return n==this.dirs.left||n==this.dirs.right?i.size=Math.abs(t.x-e.x):i.size=Math.abs(t.y-e.y),i},get_direction:function(t,e){return e.x<t.x?this.dirs.left:e.x>t.x?this.dirs.right:e.y>t.y?this.dirs.down:this.dirs.up}},gantt._y_from_ind=function(t){return t*gantt.config.row_height},gantt._path_builder={path:[],clear:function(){this.path=[]},current:function(){return this.path[this.path.length-1]},point:function(t){return t?(this.path.push(dhtmlx.copy(t)),t):this.current()},point_to:function(t,e,n){n=n?{x:n.x,y:n.y}:dhtmlx.copy(this.point());var i=gantt._drawer.dirs;switch(t){case i.left:n.x-=e;break;case i.right:n.x+=e;break;case i.up:n.y-=e;break;case i.down:n.y+=e}return this.point(n)},get_points:function(t){var e=this.get_endpoint(t),n=gantt.config,i=e.e_y-e.y,s=e.e_x-e.x,a=gantt._drawer.dirs;this.clear(),this.point({x:e.x,y:e.y});var r=(t.id%3/3+1.5)*n.link_arrow_size,o=e.e_x>e.x;if(t.type==gantt.config.links.start_to_start)this.point_to(a.left,r),o?(this.point_to(a.down,i),this.point_to(a.right,s)):(this.point_to(a.right,s),this.point_to(a.down,i)),this.point_to(a.right,r);else if(t.type==gantt.config.links.finish_to_start)if(o=e.e_x>e.x+2*r,this.point_to(a.right,r),o)s-=r,this.point_to(a.down,i),this.point_to(a.right,s);else{s-=2*r;var d=i>0?1:-1;this.point_to(a.down,d*(n.row_height/2)),this.point_to(a.right,s),this.point_to(a.down,d*(Math.abs(i)-n.row_height/2)),this.point_to(a.right,r)}else if(t.type==gantt.config.links.finish_to_finish)this.point_to(a.right,r),o?(this.point_to(a.right,s),this.point_to(a.down,i)):(this.point_to(a.down,i),this.point_to(a.right,s)),this.point_to(a.left,r);else if(t.type==gantt.config.links.start_to_finish)if(o=e.e_x>e.x-2*r,this.point_to(a.left,r),o){s+=2*r;d=i>0?1:-1;this.point_to(a.down,d*(n.row_height/2)),this.point_to(a.right,s),this.point_to(a.down,d*(Math.abs(i)-n.row_height/2)),this.point_to(a.left,r)}else s+=r,this.point_to(a.down,i),this.point_to(a.right,s);return this.path},get_endpoint:function(t){var e=gantt.config.links,n=!1,i=!1;t.type==e.start_to_start?n=i=!0:t.type==e.finish_to_finish?n=i=!1:t.type==e.finish_to_start?(n=!1,i=!0):t.type==e.start_to_finish?(n=!0,i=!1):dhtmlx.assert(!1,"Invalid link type");var s=gantt._get_task_visible_pos(gantt._pull[t.source],n),a=gantt._get_task_visible_pos(gantt._pull[t.target],i);return{x:s.x,e_x:a.x,y:s.y,e_y:a.y}}},gantt._init_links_dnd=function(){function t(t,e,n){var i=gantt._get_task_pos(t,!!e);return i.y+=gantt._get_task_height()/2,n=n||0,i.x+=(e?-1:1)*n,i}function e(t){var e=n(),i=["gantt_link_tooltip"],s=gantt.isLinkAllowed(e.from,e.to,e.from_start,e.to_start);e.from&&e.to&&(s?i.push("gantt_allowed_link"):i.push("gantt_invalid_link"));var a=gantt.templates.drag_link_class(e.from,e.from_start,e.to,e.to_start);a&&i.push(a);var r="<div class='"+a+"'>"+gantt.templates.drag_link(e.from,e.from_start,e.to,e.to_start)+"</div>";t.innerHTML=r}function n(){return{from:gantt._link_source_task,to:gantt._link_target_task,from_start:gantt._link_source_task_start,to_start:gantt._link_target_task_start}}function i(){gantt._link_source_task=gantt._link_source_task_start=gantt._link_target_task=null,gantt._link_target_task_start=!0}function s(t,e,i,s){var d=o(),l=n(),h=["gantt_link_direction"];gantt.templates.link_direction_class&&h.push(gantt.templates.link_direction_class(l.from,l.from_start,l.to,l.to_start));var c=Math.sqrt(Math.pow(i-t,2)+Math.pow(s-e,2));if(c=Math.max(0,c-3)){d.className=h.join(" ");var u=(s-e)/(i-t),_=Math.atan(u);2==r(t,i,e,s)?_+=Math.PI:3==r(t,i,e,s)&&(_-=Math.PI);var g=Math.sin(_),f=Math.cos(_),p=Math.round(e),y=Math.round(t),m=["-webkit-transform: rotate("+_+"rad)","-moz-transform: rotate("+_+"rad)","-ms-transform: rotate("+_+"rad)","-o-transform: rotate("+_+"rad)","transform: rotate("+_+"rad)","width:"+Math.round(c)+"px"];if(-1!=window.navigator.userAgent.indexOf("MSIE 8.0")){m.push('-ms-filter: "'+a(g,f)+'"');var v=Math.abs(Math.round(t-i)),w=Math.abs(Math.round(s-e));switch(r(t,i,e,s)){case 1:p-=w;break;case 2:y-=v,p-=w;break;case 3:y-=v}}m.push("top:"+p+"px"),m.push("left:"+y+"px"),d.style.cssText=m.join(";")}}function a(t,e){return"progid:DXImageTransform.Microsoft.Matrix(M11 = "+e+",M12 = -"+t+",M21 = "+t+",M22 = "+e+",SizingMethod = 'auto expand')"}function r(t,e,n,i){return e>=t?i<=n?1:4:i<=n?2:3}function o(){return l._direction||(l._direction=document.createElement("div"),gantt.$task_links.appendChild(l._direction)),l._direction}function d(){l._direction&&(l._direction.parentNode&&l._direction.parentNode.removeChild(l._direction),l._direction=null)}var l=new dhtmlxDnD(this.$task_bars,{marker:!0,sensitivity:0,updates_per_second:60}),h="task_left",c="task_right",u="gantt_link_point",_="gantt_link_control";l.attachEvent("onBeforeDragStart",dhtmlx.bind(function(e,n){var s=n.target||n.srcElement;if(i(),gantt.getState().drag_id)return!1;if(gantt._locate_css(s,u)){gantt._locate_css(s,h)&&(gantt._link_source_task_start=!0);var a=gantt._link_source_task=this.locate(n),r=gantt.getTask(a);if(gantt._is_readonly(r))return i(),!1;var o=0;return gantt._get_safe_type(r.type)==gantt.config.types.milestone&&(o=(gantt._get_visible_milestone_width()-gantt._get_milestone_width())/2),this._dir_start=t(r,!!gantt._link_source_task_start,o),!0}return!1},this)),l.attachEvent("onAfterDragStart",dhtmlx.bind(function(){e(l.config.marker)},this)),l.attachEvent("onDragMove",dhtmlx.bind(function(i,a){var r=l.config,o=(l.getPosition(a),!1),d=gantt._link_target_task,h=gantt._link_landing,u=gantt._link_target_task_start,g=!0;if(gantt._locate_css(a,"gantt_task_line"))var f=gantt.locate(a);else f=null;if(ysy.log.debug("landing="+o+" target="+f,"link_drag"),f){g=!gantt._locate_css(a,c);var p=n();o=gantt.isLinkAllowed(p.from,p.to,p.from_start,p.to_start)}if(gantt._link_target_task=f,gantt._link_landing=o,gantt._link_target_task_start=g,o){var y=gantt.getTask(f),m=gantt._locate_css(a,_),v=0;m&&(v=Math.floor(m.offsetWidth/2)),this._dir_end=t(y,!!gantt._link_target_task_start,v)}else this._dir_end=gantt._get_mouse_pos(a);var w=!(h==o&&d==f&&u==g);return w&&(d&&gantt.refreshTask(d,!1),f&&gantt.refreshTask(f,!1)),w&&e(r.marker),s(this._dir_start.x,this._dir_start.y,this._dir_end.x,this._dir_end.y),!0},this)),l.attachEvent("onDragEnd",dhtmlx.bind(function(){var t=n();if(t.from&&t.to&&t.from!=t.to){var e=gantt._get_link_type(t.from_start,t.to_start),s={source:t.from,target:t.to,type:e};s.type&&gantt.isLinkAllowed(s)&&gantt.addLink(s)}i(),t.from&&gantt.refreshTask(t.from,!1),t.to&&gantt.refreshTask(t.to,!1),d()},this)),gantt._is_link_drop_area=function(t){return!!gantt._locate_css(t,_)}},gantt._get_link_state=function(){return{link_landing_area:this._link_landing,link_target_id:this._link_target_task,link_target_start:this._link_target_task_start,link_source_id:this._link_source_task,link_source_start:this._link_source_task_start}},gantt._init_tasks=function(){this._tasks={col_width:this.config.columnWidth,width:[],full_width:0,trace_x:[],rendered:{}},this._click.gantt_task_link=dhtmlx.bind(function(t){var e=this.locate(t,gantt.config.link_attribute);e&&this.callEvent("onLinkClick",[e,t])},this),this._click.gantt_scale_cell=dhtmlx.bind(function(t){var e=gantt._get_mouse_pos(t),n=gantt.dateFromPos(e.x),i=Math.floor(gantt._day_index_by_date(n)),s=gantt._tasks.trace_x[i];gantt.callEvent("onScaleClick",[t,s])},this),this._tasks_dnd.init(),this._init_links_dnd(),this._link_layers.clear();var t=this.addLinkLayer({renderer:this._render_link_element,container:this.$task_links,filter:gantt._create_filter(["_filter_link","_is_chart_visible"])});gantt._link_layers.process(),this._linkRenderer=this._link_layers.getRenderer(t),this._task_layers.clear();var e=this.addTaskLayer({renderer:this._render_task_element,container:this.$task_bars,filter:gantt._create_filter(["_filter_task","_is_chart_visible"])}),n=this.addTaskLayer({renderer:this._render_grid_item,container:this.$grid_data,filter:gantt._create_filter(["_filter_task","_is_grid_visible"])}),i=this.addTaskLayer(ysy.view.getGanttBackground());gantt._task_layers.process(),this._taskRenderer=this._task_layers.getRenderer(e),this._gridRenderer=this._task_layers.getRenderer(n),this._backgroundRenderer=this._task_layers.getRenderer(i)},gantt._create_filter=function(t){return t instanceof Array||(t=Array.prototype.slice.call(arguments,0)),function(e){for(var n=!0,i=0,s=t.length;i<s;i++){var a=t[i];gantt[a]&&(n=n&&!1!==gantt[a].apply(gantt,[e.id,e]))}return n}},gantt._is_chart_visible=function(){return!!this.config.show_chart},gantt._filter_task=function(t,e){var n=null,i=null;return!(this.config.start_date&&this.config.end_date&&(n=this.config.start_date.valueOf(),i=this.config.end_date.valueOf(),+e.start_date>i||+e.end_date<+n))},gantt._filter_link=function(t,e){return!!this.config.show_links&&(!(!gantt.isTaskVisible(e.source)||!gantt.isTaskVisible(e.target))&&this.callEvent("onBeforeLinkDisplay",[t,e]))},gantt._is_std_background=function(){return!this.config.static_background},gantt.getTaskNode=function(t){return this._taskRenderer.rendered[t]},gantt.getLinkNode=function(t){return this._linkRenderer.rendered[t]},gantt._get_tasks_data=function(){var t=[],e=null;let n=[0];for(var i=0;i<this._order.length;i++){var s=this._pull[this._order[i]];if(s.$index=i,n[s.$level]||(n[s.$level]=0),e)if(s.$level>e.$level)n[s.$level]++,s.$prev=0;else if(s.$level==e.$level)n[s.$level]++,s.$prev=0;else if(s.$level<e.$level){for(var a=0;a<e.$level-s.$level;a++)n[s.$level]+=n[s.$level+1+a],n[s.$level+1+a]=0;s.$prev=n[s.$level]}e=s,this.resetProjectDates(s),t.push(s)}return t},gantt._get_links_data=function(){var t=[];for(var e in this._lpull)t.push(this._lpull[e]);return t},gantt._render_data=function(){this.callEvent("onBeforeDataRender",[]),this._sync_order(),this._update_layout_sizes(),this.config.static_background&&this._render_bg_canvas();for(var t=this._get_tasks_data(),e=this._get_task_renderers(),n=0;n<e.length;n++)e[n].render_items(t);var i=gantt._get_links_data();e=this._get_link_renderers();for(n=0;n<e.length;n++)e[n].render_items(i);this.callEvent("onDataRender",[])},gantt._update_layout_sizes=function(){var t=this._tasks;t.bar_height=this._get_task_height(),this.$task_data.style.height=Math.max(this.$task.offsetHeight-this.config.scale_height,0)+"px",this.$task_bg.style.height="",this.$task_bg.style.backgroundImage="";for(var e=this.$task_data.childNodes,n=0,i=e.length;n<i;n++){var s=e[n];this._is_layer(s)&&s.style&&(s.style.width=t.full_width+"px")}if(this._is_grid_visible()){var a=this.getGridColumns(),r=0;for(n=0;n<a.length;n++)r+=a[n].width;this.$grid_data.style.width=Math.max(r-1,0)+"px"}},gantt._scale_range_unit=function(){var t=this.config.scale_unit;if(this.config.scale_offset_minimal){var e=this._get_scales();t=e[e.length-1].unit}return t},gantt._init_tasks_range=function(){var t=this._scale_range_unit();this._sync_order(),this._get_tasks_data();var e=this.getSubtaskDates();this._min_date=e.start_date||moment(),this._max_date=e.end_date||moment(),this.config.start_date&&+this.config.start_date<+this._min_date&&(this._min_date=this.date[t+"_start"](this.date.Date(this.config.start_date))),this.config.end_date&&+this.config.end_date>+this._max_date&&(this._max_date=this.date[t+"_start"](this.date.Date(this.config.end_date))),this._max_date&&this._max_date||(this._min_date=gantt.date.Date(),this._max_date=gantt.date.Date(this._min_date));var n=1;"day"===t&&(n=3),this._min_date=this.date[t+"_start"](this._min_date),this._min_date=this.date.add(this._min_date,-n,t),this._max_date=this.date[t+"_start"](this._max_date),this._max_date=this.date.add(this._max_date,3*n,t)},gantt._prepare_scale_html=function(t){var e=[],n=null,i=null,s=null;(t.template||t.date)&&(i=t.template||this.date.date_to_str(t.date)),s=t.css||function(){},!t.css&&this.config.inherit_scale_class&&(s=gantt.templates.scale_cell_class);for(var a=0;a<t.count;a++){n=gantt.date.Date(t.trace_x[a]);var r=i.call(this,n),o=t.width[a],d="",l="",h="";if(o){d="width:"+o+"px;",h="gantt_scale_cell"+(a==t.count-1?" gantt_last_cell":""),(l=s.call(this,n))&&(h+=" "+l);var c="<div class='"+h+"' style='"+d+"'>"+r+"</div>";e.push(c)}}return e.join("")},gantt._get_scales=function(){var t=this._scale_helpers,e=[t.primaryScale()].concat(this.config.subscales);return t.sortScales(e),e},gantt._render_tasks_scales=function(){this._init_tasks_range(),this._scroll_resize(),this._set_sizes();var t="",e=0,n=0;if(this._is_chart_visible()){var i=this._scale_helpers,s=this._get_scales();n=this.config.scale_height-1;for(var a=this._get_resize_options().x?Math.max(this.config.autosize_min_width,0):this.$task.offsetWidth,r=i.prepareConfigs(s,this.config.min_column_width,a,n),o=this._tasks=r[r.length-1],d=[],l=this.templates.scale_row_class,h=0;h<r.length;h++){var c="gantt_scale_line",u=l(r[h]);u&&(c+=" "+u),d.push('<div class="'+c+'" style="height:'+r[h].height+"px;line-height:"+r[h].height+'px">'+this._prepare_scale_html(r[h])+"</div>")}t=d.join(""),e=o.full_width+this.$scroll_ver.offsetWidth+"px",o.full_width+"px",n+="px"}this._is_chart_visible()?this.$task.style.display="":this.$task.style.display="none",this.$task_scale.style.height=n,this.$task_data.style.width=this.$task_scale.style.width=e,this.$task_scale.innerHTML=t},gantt._render_bg_line=function(t){var e=gantt._tasks,n=e.count,i=document.createElement("div");if(gantt.config.show_task_cells)for(var s=0;s<n;s++){var a=e.width[s],r="";if(a>0){var o=document.createElement("div");o.style.width=a+"px",r="gantt_task_cell"+(s==n-1?" gantt_last_cell":""),(l=this.templates.task_cell_class(t,e.trace_x[s]))&&(r+=" "+l),o.className=r,i.appendChild(o)}}var d=t.$index%2!=0,l=gantt.templates.task_row_class(t.start_date,t.end_date,t),h="gantt_task_row"+(d?" odd":"")+(l?" "+l:"");return this.getState().selected_task==t.id&&(h+=" gantt_selected"),i.className=h,i.style.height=gantt.config.row_height+"px",i.setAttribute(this.config.task_attribute,t.id),i},gantt._render_bg_canvas=function(){},gantt._adjust_scales=function(){if(this.config.fit_tasks){var t=+this._min_date,e=+this._max_date;if(this._init_tasks_range(),+this._min_date!=t||+this._max_date!=e)return this.render(),this.callEvent("onScaleAdjusted",[]),!0}return!1},gantt.refreshTask=function(t){gantt._update_parents(gantt.getParent(t)),this.refresher.refreshTask(t)},gantt._refreshTask=function(t){var e,n=this._get_task_renderers(),i=this.getTask(t);if(i)if(+this._min_date<+i.start_date&&+this._max_date>+i.end_date){for(e=0;e<n.length;e++)n[e].render_item(i);for(e=0;e<i.$source.length;e++)gantt.refreshLink(i.$source[e]);for(e=0;e<i.$target.length;e++)gantt.refreshLink(i.$target[e])}else this.render();else;},gantt.refreshLink=function(t){this.refresher.refreshLink(t)},gantt._refreshLink=function(t){if(this.isLinkExists(t))this._render_link(t);else for(var e=this._get_link_renderers(),n=0;n<e.length;n++)e[n].remove_item(t)},gantt._combine_item_class=function(t,e,n){var i=[t];e&&i.push(e);var s=gantt.getState(),a=this.getTask(n);a.type&&i.push("gantt_"+a.type+"-type"),this._is_flex_task(a)&&i.push("gantt_dependent_task"),this.config.select_task&&n==s.selected_task&&i.push("gantt_selected"),n==s.drag_id&&(i.push("gantt_drag_"+s.drag_mode),s.touch_drag&&i.push("gantt_touch_"+s.drag_mode));var r=gantt._get_link_state();if(r.link_source_id==n&&i.push("gantt_link_source"),r.link_target_id==n&&i.push("gantt_link_target"),this.config.highlight_critical_path&&this.isCriticalTask&&this.isCriticalTask(a)&&i.push("gantt_critical_task"),r.link_landing_area&&r.link_target_id&&r.link_source_id&&r.link_target_id!=r.link_source_id){var o=r.link_source_id,d=r.link_source_start,l=r.link_target_start,h="";h=gantt.isLinkAllowed(o,n,d,l)?l?"link_start_allow":"link_finish_allow":l?"link_start_deny":"link_finish_deny",i.push(h)}return i.join(" ")},gantt._render_pair=function(t,e,n,i){var s=gantt.getState();+n.start_date>=+s.min_date&&t.appendChild(i(e+" task_left")),+n.end_date<=+s.max_date&&t.appendChild(i(e+" task_right"))},gantt._get_task_height=function(){var t=this.config.task_height;return"full"==t&&(t=this.config.row_height-5),t=Math.min(t,this.config.row_height),Math.max(t,0)},gantt._get_milestone_width=function(){return this._get_task_height()},gantt._get_visible_milestone_width=function(){var t=gantt._get_task_height();return Math.sqrt(2*t*t)},gantt.getTaskPosition=function(t,e,n){var i=this.posFromDate(e||t.start_date),s=this.posFromDate(n||t.end_date);return s=Math.max(i,s),{left:i,top:this.getTaskTop(t.id),height:this.config.task_height,width:Math.max(s-i,0)}},gantt._get_task_width=function(t){return Math.round(this._get_task_pos(t,!1).x-this._get_task_pos(t,!0).x)},gantt._is_readonly=function(t){return(!t||!t[this.config.editable_property])&&(t&&t[this.config.readonly_property]||this.config.readonly||this.config["readonly_"+gantt._get_safe_type(t.type)])},gantt._task_default_render=function(t){var e=this._get_task_pos(t),n=this.config,i=this._get_task_height(),s=this._get_safe_type(t.type),a=n["controls_"+s]||{},r=Math.floor((this.config.row_height-i)/2);s==n.types.milestone&&n.link_line_width>1&&(r+=1);var o=document.createElement("div"),d=gantt._get_task_width(t);if(o.setAttribute(this.config.task_attribute,t.id),n.show_progress&&(a.show_progress||a.progress)){var l=this._render_task_progress(t,o,d);const e=ysy.settings.appSettings,n=ysy.settings.showTasksSpentTimeRatio,i=!gantt._branches[t.id];this._is_readonly(t)||!a.progress||n||e.useStatusForIssueDoneRatio||e.issueDoneRatioDerived&&!i||this._render_task_progress_drag(o,l)}var h=gantt._render_task_content(t,d);t.textColor&&(h.style.color=t.textColor),o.appendChild(h);var c=this._combine_item_class("gantt_task_line",this.templates.task_class(t.start_date,t.end_date,t),t.id);(t.color||t.progressColor||t.textColor)&&(c+=" gantt_task_inline_color"),o.className=c;var u=["left:"+e.x+"px","top:"+(r+e.y)+"px","height:"+i+"px","line-height:"+i+"px","width:"+d+"px"];t.color&&u.push("background-color:"+t.color),t.textColor&&u.push("color:"+t.textColor),o.style.cssText=u.join(";");var _=this._render_leftside_content(t);return _&&o.appendChild(_),(_=this._render_rightside_content(t))&&o.appendChild(_),this._is_readonly(t)||(n.drag_resize&&!this._is_flex_task(t)&&a.resize&&gantt._render_pair(o,"gantt_task_drag",t,function(t){var e=document.createElement("div");return e.className=t,e}),n.drag_links&&this.config.show_links&&a.links&&gantt._render_pair(o,"gantt_link_control",t,function(t){var e=document.createElement("div");e.className=t,e.style.cssText=["height:"+i+"px","line-height:"+i+"px"].join(";");var n=document.createElement("div");return n.className="gantt_link_point",e.appendChild(n),e})),o},gantt._render_task_element=function(t){var e=this.config.type_renderers[this._get_safe_type(t.type)],n=this._task_default_render;return e||(e=n),e.call(this,t,dhtmlx.bind(n,this))},gantt._render_side_content=function(t,e,n){if(!e)return null;var i=e(t.start_date,t.end_date,t);if(!i)return null;var s=document.createElement("div");return s.className="gantt_side_content "+n,s.innerHTML=i,s},gantt._render_leftside_content=function(t){var e="gantt_left "+gantt._get_link_crossing_css(!0,t);return gantt._render_side_content(t,this.templates.leftside_text,e)},gantt._render_rightside_content=function(t){var e="gantt_right "+gantt._get_link_crossing_css(!1,t);return gantt._render_side_content(t,this.templates.rightside_text,e)},gantt._get_conditions=function(t){return t?{$source:[gantt.config.links.start_to_start],$target:[gantt.config.links.start_to_start,gantt.config.links.finish_to_start]}:{$source:[gantt.config.links.finish_to_start,gantt.config.links.finish_to_finish],$target:[gantt.config.links.finish_to_finish]}},gantt._get_link_crossing_css=function(t,e){var n=gantt._get_conditions(t);for(var i in n)for(var s=e[i],a=0;a<s.length;a++)for(var r=gantt.getLink(s[a]),o=0;o<n[i].length;o++)if(r.type==n[i][o])return"gantt_link_crossing";return""},gantt._render_task_content=function(t){var e=document.createElement("div");return this._get_safe_type(t.type)!=this.config.types.milestone&&(e.innerHTML=this.templates.task_text(t.start_date,t.end_date,t)),e.className="gantt_task_content",e},gantt._render_task_progress=function(t,e,n){var i=1*t.progress||0;n=Math.max(n-2,0);var s=document.createElement("div"),a=Math.round(n*i);return a=Math.min(n,a),t.progressColor&&(s.style.backgroundColor=t.progressColor,s.style.opacity=1),s.style.width=a+"px",s.className="gantt_task_progress",s.innerHTML=this.templates.progress_text(t.start_date,t.end_date,t),e.appendChild(s),a},gantt._render_task_progress_drag=function(t,e){var n=document.createElement("div");n.style.left=e+"px",n.className="gantt_task_progress_drag",t.appendChild(n)},gantt._get_line=function(t){return{second:1,minute:60,hour:3600,day:86400,week:604800,month:2592e3,year:31536e3}[t]||0},gantt.dateFromPos=function(t){return gantt.dateFromPos2(t)},gantt.posFromDate=function(t){var e=gantt._day_index_by_date(t);dhtmlx.assert(e>=0,"Invalid day index");var n=Math.floor(e),i=e%1,s=gantt._tasks.left[Math.min(n,gantt._tasks.width.length-1)];return n==gantt._tasks.width.length&&(s+=gantt._tasks.width[gantt._tasks.width.length-1]),i&&(n<gantt._tasks.width.length?s+=gantt._tasks.width[n]*(i%1):s+=1),s},gantt.posFromDateCached=function(t){if("string"!=typeof t){var e=t;t=t.toISOString()}var n=gantt._tasks.date_cache[t];return n||(n=gantt.posFromDate(e||t),gantt._tasks.date_cache[t]=n),n},gantt._day_index_by_date=function(t){var e=gantt.date.Date(t);t._isEndDate&&(e=moment(e).add(1,"days"));var n=e.valueOf(),i=gantt._tasks.trace_x,s=gantt._tasks.ignore_x||{};if(n<=this._min_date)return 0;if(n>=this._max_date)return i.length;for(var a=gantt._findBinary(i,n),r=+gantt._tasks.trace_x[a];s[r];)r=gantt._tasks.trace_x[++a];return r?a+(e-i[a])/gantt._get_coll_duration(gantt._tasks,i[a]):0},gantt._findBinary=function(t,e){for(var n,i,s,a=0,r=t.length-1;a<=r;)if(i=+t[n=Math.floor((a+r)/2)],s=+t[n-1],i<e)a=n+1;else{if(!(i>e))return n;if(!isNaN(s)&&s<e)return n-1;r=n-1}return t.length-1},gantt._get_coll_duration=function(t,e){return gantt.date.add(e,t.step,t.unit)-e},gantt._get_x_pos=function(t,e){e=!1!==e;gantt.posFromDate(e?t.start_date:t.end_date)},gantt.getTaskTop=function(t){return this._y_from_ind(this._get_visible_order(t))},gantt._get_task_coord=function(t,e,n){e=!1!==e,n=n||0;var i=this._get_safe_type(t.type)==this.config.types.milestone,s=null;s=e&&!i?t.start_date||this._default_task_date(t):t.end_date||this.calculateEndDate(this._default_task_date(t));var a=this.posFromDate(s);return i&&(e?a-=n:a+=n),{x:a,y:this.getTaskTop(t.id)}},gantt._get_task_pos=function(t,e){e=!1!==e;var n=gantt._get_milestone_width()/2;return this._get_task_coord(t,e,n)},gantt._get_task_visible_pos=function(t,e){e=!1!==e;var n=gantt._get_visible_milestone_width()/2;return this._get_task_coord(t,e,n)},gantt._correct_shift=function(t,e){return t-6e4*(gantt.date.Date(gantt._min_date).getTimezoneOffset()-gantt.date.Date(t).getTimezoneOffset())*(e?-1:1)},gantt._get_mouse_pos=function(t){if(t.pageX||t.pageY)var e={x:t.pageX,y:t.pageY};else{var n=_isIE?document.documentElement:document.body;e={x:t.clientX+n.scrollLeft-n.clientLeft,y:t.clientY+n.scrollTop-n.clientTop}}var i=gantt._get_position(gantt.$task_data);return e.x=e.x-i.x+gantt.$task_data.scrollLeft,e.y=e.y-i.y+gantt.$task_data.scrollTop,e},gantt._is_layer=function(t){return t&&t.hasAttribute&&t.hasAttribute(this.config.layer_attribute)},gantt._task_renderer=function(t){if("object"!=typeof t)var e=t;else{e=t.id;var n=t.renderer,i=t.container,s=t.filter}return this._task_area_pulls||(this._task_area_pulls={}),this._task_area_renderers||(this._task_area_renderers={}),this._task_area_renderers[e]?this._task_area_renderers[e]:(n||dhtmlx.assert(!1,"Invalid renderer call"),i&&i.setAttribute(this.config.layer_attribute,!0),this._task_area_renderers[e]=$.extend({render_item:function(t,a){var r=gantt._task_area_pulls[e];if(a=a||i,s&&!s(t))return ysy.log.debug("_task_area_renderers() filtered id="+t.id,"link_render"),void this.remove_item(t.id);var o=n.call(gantt,t,r[t.id]);o&&(r[t.id]?this.replace_item(t.id,o):(r[t.id]=o,a.appendChild(o)))},clear:function(t){this.rendered=gantt._task_area_pulls[e]={},(t=t||i)&&(t.innerHTML="")},render_items:function(t,e){e=e||i,this.clear(e);for(var n=document.createDocumentFragment(),s=0,a=t.length;s<a;s++)this.render_item(t[s],n);e.appendChild(n)},replace_item:function(t,e){var n=this.rendered[t];n&&n.parentNode&&n.parentNode.replaceChild(e,n),this.rendered[t]=e},remove_item:function(t){var e=this.rendered[t];e&&e.parentNode&&e.parentNode.removeChild(e),delete this.rendered[t]},change_id:function(t,e){this.rendered[e]=this.rendered[t],delete this.rendered[t]},rendered:this._task_area_pulls[e]||{},node:i,unload:function(){this.clear(),delete gantt._task_area_renderers[e],delete gantt._task_area_pulls[e]}},t),this._task_area_renderers[e])},gantt._clear_renderers=function(){for(var t in this._task_area_renderers)this._task_renderer(t).unload()},gantt.attachEvent("onGanttReady",function(){gantt._task_layers.add(),gantt._link_layers.add()}),gantt._layers={prepareConfig:function(t){"function"==typeof t&&(t={renderer:t});t.id=dhtmlx.uid();return t.container||(t.container=document.createElement("div")),t},create:function(t,e){return{tempCollection:[],renderers:{},container:t,getRenderers:function(){var t=[];for(var e in this.renderers)t.push(this.renderers[e]);return t},getRenderer:function(t){return this.renderers[t]},add:function(t){t&&this.tempCollection.push(t)},process:function(){if(this.container())for(var t=this.container(),n=this.tempCollection,i=0;i<n.length;i++){var s=n[i],a=s.container,r=s.id,o=s.topmost;if(!a.parentNode)if(o)t.appendChild(a);else{var d=e?e():t.firstChild;d?t.insertBefore(a,d):t.appendChild(a)}this.renderers[r]=gantt._task_renderer(s),this.tempCollection.splice(i,1),i--}},remove:function(t){this.renderers[t].unload(),delete this.renderers[t]},clear:function(){for(var t in this.renderers)this.renderers[t].unload();this.renderers={}}}}},gantt._create_filter=function(t){return t instanceof Array||(t=Array.prototype.slice.call(arguments,0)),function(e){for(var n=!0,i=0,s=t.length;i<s;i++){var a=t[i];gantt[a]&&(n=n&&!1!==gantt[a].call(gantt,e.id,e))}return n}},gantt._add_generic_layer=function(t,e){return function(n){return n.filter===undefined&&(n.filter=gantt._create_filter(e)),n=gantt._layers.prepareConfig(n),t.add(n),n.id}},gantt._task_layers=gantt._layers.create(function(){return gantt.$task_data},function(){return gantt.$task_links}),gantt._link_layers=gantt._layers.create(function(){return gantt.$task_data}),gantt.addTaskLayer=gantt._add_generic_layer(gantt._task_layers,["_filter_task","_is_chart_visible"]),gantt.removeTaskLayer=function(t){gantt._task_layers.remove(t)},gantt.addLinkLayer=gantt._add_generic_layer(gantt._link_layers,["_filter_link","_is_chart_visible"]),gantt.removeLinkLayer=function(t){gantt._link_layers.remove(t)},gantt._get_task_renderers=function(){return this._task_layers.getRenderers()},gantt._get_link_renderers=function(){return this._link_layers.getRenderers()},gantt._pull={},gantt._branches={},gantt._order=[],gantt._lpull={},gantt.load=function(t,e,n){this._load_url=t,dhtmlx.assert(arguments.length,"Invalid load arguments"),this.callEvent("onLoadStart",[]);var i="json",s=null;arguments.length>=3?(i=e,s=n):"string"==typeof arguments[1]?i=arguments[1]:"function"==typeof arguments[1]&&(s=arguments[1]),this._load_type=i,dhx4.ajax.get(t,dhtmlx.bind(function(t){this.on_load(t,i),this.callEvent("onLoadEnd",[]),"function"==typeof s&&s.call(this)},this))},gantt.parse=function(t,e){this.on_load({xmlDoc:{responseText:t}},e)},gantt.serialize=function(t){return this[t=t||"json"].serialize()},gantt.on_load=function(t,e){this.callEvent("onBeforeParse",[]),e||(e="json"),dhtmlx.assert(this[e],"Invalid data type:'"+e+"'");var n=t.xmlDoc.responseText,i=this[e].parse(n,t);this._process_loading(i)},gantt._process_loading=function(t){t.collections&&this._load_collections(t.collections);for(var e,n=t.data,i=0;i<n.length;i++)e=n[i],this._init_task(e),this.callEvent("onTaskLoading",[e])&&(this._pull[e.id]=e);for(var i in this._pull)e=this._pull[i],this.setParent(e,this.getParent(e)||this.config.root_id);for(var i in this._pull)e=this._pull[i],this._add_branch(e,!0),e.$level=this.calculateTaskLevel(e);if(this._sync_order(),this._init_links(t.links||(t.collections?t.collections.links:[])),this.callEvent("onParse",[]),this.render(),this.config.initial_scroll){var s=this._order[0]||this.config.root_id;s&&this.showTask(s)}},gantt._init_links=function(t){if(t)for(var e=0;e<t.length;e++)if(t[e]){var n=this._init_link(t[e]);this._lpull[n.id]=n}this._sync_links()},gantt._load_collections=function(t){var e=!1;for(var n in t)if(t.hasOwnProperty(n)){e=!0;var i=t[n],s=this.serverList[n];if(!s)continue;s.splice(0,s.length);for(var a=0;a<i.length;a++){var r=i[a],o=dhtmlx.copy(r);for(var d in o.key=o.value,
r)if(r.hasOwnProperty(d)){if("value"==d||"label"==d)continue;o[d]=r[d]}s.push(o)}}e&&this.callEvent("onOptionsLoad",[])},gantt._sync_order=function(t){this._order=[],this._sync_order_item({parent:this.config.root_id,$open:!0,$ignore:!0,id:this.config.root_id}),t||(this._scroll_resize(),this._set_sizes())},gantt.attachEvent("onBeforeTaskDisplay",function(t,e){return!e.$ignore}),gantt._sync_order_item=function(t){if(t||ysy.log.debug("error: no item"),(!t.id||this._filter_task(t.id,t)&&this.callEvent("onBeforeTaskDisplay",[t.id,t]))&&(t.id&&this._order.push(t.id),t.$open)){var e=this.getChildren(t.id);if(e)for(var n=0;n<e.length;n++)this._sync_order_item(this._pull[e[n]])}},gantt._get_visible_order=function(t){dhtmlx.assert(t,"Invalid argument");for(var e=this._order,n=0,i=e.length;n<i;n++)if(e[n]==t)return n;return-1},gantt.eachTask=function(t,e,n){e=e||this.config.root_id,n=n||this;var i=this.getChildren(e),s=e?this.getTask(e):null;if(i)for(var a=0;a<i.length;a++){var r=this._pull[i[a]];s&&s.hasOwnProperty("$rendered_type")&&"milestone"===r.$rendered_type&&"project"===s.$rendered_type||(t.call(n,r),this.hasChild(r.id)&&this.eachTask(t,r.id,n))}},gantt.json={parse:function(data){return dhtmlx.assert(data,"Invalid data"),"string"==typeof data&&(window.JSON?data=JSON.parse(data):(gantt._temp=eval("("+data+")"),data=gantt._temp||{},gantt._temp=null)),data.dhx_security&&(dhtmlx.security_key=data.dhx_security),data},_copyLink:function(t){var e={};for(var n in t)e[n]=t[n];return e},_copyObject:function(t){var e={};for(var n in t)"$"!=n.charAt(0)&&(e[n]=t[n],e[n]instanceof Date&&(e[n]=gantt.templates.xml_format(e[n])));return e},serialize:function(){var t=[],e=[];for(var n in gantt.eachTask(function(e){gantt.resetProjectDates(e),t.push(this._copyObject(e))},gantt.config.root_id,this),gantt._lpull)e.push(this._copyLink(gantt._lpull[n]));return{data:t,links:e}}},gantt.xml={_xmlNodeToJSON:function(t,e){for(var n={},i=0;i<t.attributes.length;i++)n[t.attributes[i].name]=t.attributes[i].value;if(!e){for(i=0;i<t.childNodes.length;i++){var s=t.childNodes[i];1==s.nodeType&&(n[s.tagName]=s.firstChild?s.firstChild.nodeValue:"")}n.text||(n.text=t.firstChild?t.firstChild.nodeValue:"")}return n},_getCollections:function(t){for(var e={},n=dhx4.ajax.xpath("//coll_options",t),i=0;i<n.length;i++)for(var s=e[n[i].getAttribute("for")]=[],a=dhx4.ajax.xpath(".//item",n[i]),r=0;r<a.length;r++){for(var o=a[r].attributes,d={key:a[r].getAttribute("value"),label:a[r].getAttribute("label")},l=0;l<o.length;l++){var h=o[l];"value"!=h.nodeName&&"label"!=h.nodeName&&(d[h.nodeName]=h.nodeValue)}s.push(d)}return e},_getXML:function(t,e,n){n=n||"data",e.getXMLTopNode||(e=dhx4.ajax.parse(e));var i=dhx4.ajax.xmltop(n,e.xmlDoc);if(i.tagName!=n)throw"Invalid XML data";var s=i.getAttribute("dhx_security");return s&&(dhtmlx.security_key=s),i},parse:function(t,e){e=this._getXML(t,e);for(var n={},i=n.data=[],s=dhx4.ajax.xpath("//task",e),a=0;a<s.length;a++)i[a]=this._xmlNodeToJSON(s[a]);return n.collections=this._getCollections(e),n},_copyLink:function(t){return"<item id='"+t.id+"' source='"+t.source+"' target='"+t.target+"' type='"+t.type+"' />"},_copyObject:function(t){return"<task id='"+t.id+"' parent='"+(t.parent||"")+"' start_date='"+t.start_date+"' duration='"+t.duration+"' open='"+!!t.open+"' progress='"+t.progress+"' end_date='"+t.end_date+"'><![CDATA["+t.text+"]]></task>"},serialize:function(){for(var t=[],e=[],n=gantt.json.serialize(),i=0,s=n.data.length;i<s;i++)t.push(this._copyObject(n.data[i]));for(i=0,s=n.links.length;i<s;i++)e.push(this._copyLink(n.links[i]));return"<data>"+t.join("")+"<coll_options for='links'>"+e.join("")+"</coll_options></data>"}},gantt.oldxml={parse:function(t,e){e=gantt.xml._getXML(t,e,"projects");for(var n={collections:{links:[]}},i=n.data=[],s=dhx4.ajax.xpath("//task",e),a=0;a<s.length;a++){i[a]=gantt.xml._xmlNodeToJSON(s[a]);var r=s[a].parentNode;"project"==r.tagName?i[a].parent="project-"+r.getAttribute("id"):i[a].parent=r.parentNode.getAttribute("id")}s=dhx4.ajax.xpath("//project",e);for(a=0;a<s.length;a++){(o=gantt.xml._xmlNodeToJSON(s[a],!0)).id="project-"+o.id,i.push(o)}for(a=0;a<i.length;a++){var o;(o=i[a]).start_date=o.startdate||o.est,o.end_date=o.enddate,o.text=o.name,o.duration=o.duration/8,o.open=1,o.duration||o.end_date||(o.duration=1),o.predecessortasks&&n.collections.links.push({target:o.id,source:o.predecessortasks,type:gantt.config.links.finish_to_start})}return n},serialize:function(){dhtmlx.message("Serialization to 'old XML' is not implemented")}},gantt.serverList=function(t,e){return e?this.serverList[t]=e.slice(0):this.serverList[t]||(this.serverList[t]=[]),this.serverList[t]},gantt.getTask=function(t,e=!0){return dhtmlx.assert(t,"Invalid argument for gantt.getTask"),e&&dhtmlx.assert(this._pull[t],"Task not found id="+t),this._pull[t]},gantt.getTaskByTime=function(t,e){var n=this._pull,i=[];if(t||e)for(var s in t=+t||-Infinity,e=+e||Infinity,n){var a=n[s];+a.start_date<e&&+a.end_date>t&&i.push(a)}else for(var s in n)i.push(n[s]);return i},gantt.isTaskExists=function(t){return dhtmlx.defined(this._pull[t])},gantt.isTaskVisible=function(t){if(!this._pull[t])return!1;if(!(+this._pull[t].start_date<+this._max_date&&+this._pull[t].end_date>+this._min_date))return!1;for(var e=0,n=this._order.length;e<n;e++)if(this._order[e]==t)return!0;return!1},gantt.updateTask=function(t,e){if(dhtmlx.defined(e)||(e=this.getTask(t)),!1===this.callEvent("onBeforeTaskUpdate",[t,e]))return!1;this._pull[e.id]=e,this._is_parent_sync(e)||this._resync_parent(e),e.widget.update(e),this.refreshTask(e.id),this.callEvent("onAfterTaskUpdate",[t,e]),this._sync_order(),this._adjust_scales()},gantt._add_branch=function(t,e){var n=this.getParent(t);this.hasChild(n)||(this._branches[n]=[]);for(var i=this.getChildren(n),s=!1,a=0,r=i.length;a<r;a++)if(i[a]==t.id){s=!0;break}s||i.push(t.id),this._sync_parent(t),e||this._sync_order(e)},gantt._move_branch=function(t,e,n){this.setParent(t,n),this._sync_parent(t),this._replace_branch_child(e,t.id),this.isTaskExists(n)||n==this.config.root_id?this._add_branch(t):delete this._branches[t.id],t.$level=this.calculateTaskLevel(t)},gantt._resync_parent=function(t){this._move_branch(t,t.$rendered_parent,this.getParent(t))},gantt._sync_parent=function(t){t.$rendered_parent=this.getParent(t)},gantt._is_parent_sync=function(t){return t.$rendered_parent==this.getParent(t)},gantt._replace_branch_child=function(t,e,n){var i;if(ysy.log.debug("_replace_branch_child","sort"),i=this.getChildren(t)){for(var s=[],a=0;a<i.length;a++)i[a]!=e?s.push(i[a]):n&&s.push(n);ysy.log.debug("new Branch="+JSON.stringify(s),"sort"),this._branches[t]=s}},gantt.addTask=function(t,e){return dhtmlx.defined(e)||(e=this.getParent(t)||0),this.isTaskExists(e)||(e=0),this.setParent(t,e),t=this._init_task(t),!1!==this.callEvent("onBeforeTaskAdd",[t.id,t])&&(this._pull[t.id]=t,this._add_branch(t),this.refreshData(),this._adjust_scales(),this.callEvent("onAfterTaskAdd",[t.id,t]),t.id)},gantt.addTaskFaster=function(t,e){return ysy.log.debug("addTaskNoDraw()","add_task"),dhtmlx.defined(e)||(e=this.getParent(t)||0),this.isTaskExists(e)||(e=0),this.setParent(t,e),t=this._init_task(t),this._pull[t.id]=t,this._add_branch(t,!0),this.refreshData(),(+this._min_date>+t.start_date||+this._max_date<+t.end_date)&&this.render(),t.id},gantt._default_task_date=function(t,e){var n=!(!e||e==this.config.root_id)&&this.getTask(e),i="";if(n)i=n.start_date;else{var s=this._order[0];i=s?this.getTask(s).start_date:this.config.start_date||this.getState().min_date}return gantt.date.Date(i)},gantt._set_default_task_timing=function(t){t.start_date=t.start_date||gantt._default_task_date(t,this.getParent(t)),t.duration=t.duration||this.config.duration_step,t.end_date=t.end_date||this.calculateEndDate(t.start_date,t.duration)},gantt.deleteTask=function(t){return this._deleteTask(t)},gantt._getChildLinks=function(t){var e=this.getTask(t);if(!e)return[];for(var n=e.$source.concat(e.$target),i=this.getChildren(e.id),s=0;s<i.length;s++)n=n.concat(this._getChildLinks(i[s]));var a={};for(s=0;s<n.length;s++)a[n[s]]=!0;for(var s in n=[],a)n.push(s);return n},gantt._getTaskTree=function(t){var e=this.getTask(t);if(!e)return[];for(var n=[],i=this.getChildren(e.id),s=0;s<i.length;s++)n.push(i[s]),n=n.concat(this._getTaskTree(i[s]));return n},gantt._deleteRelatedLinks=function(t,e){var n=this._dp&&!e,i="",s=!!n&&"off"!=this._dp.updateMode;n&&(i=this._dp.updateMode,this._dp.setUpdateMode("off"));for(var a=0;a<t.length;a++)n&&(this._dp.setGanttMode("links"),this._dp.setUpdated(t[a],!0,"deleted")),this._deleteLink(t[a],!0);n&&(this._dp.setUpdateMode(i),s&&this._dp.sendAllData())},gantt._deleteRelatedTasks=function(t,e){var n=this._dp&&!e,i="";n&&(i=this._dp.updateMode,this._dp.setGanttMode("tasks"),this._dp.setUpdateMode("off"));for(var s=this._getTaskTree(t),a=0;a<s.length;a++){var r=s[a];this._unset_task(r),n&&this._dp.setUpdated(r,!0,"deleted")}n&&this._dp.setUpdateMode(i)},gantt._unset_task=function(t){var e=this.getTask(t);this._update_flags(t,null),delete this._pull[t],this._move_branch(e,this.getParent(e),null)},gantt._deleteTask=function(t,e){var n=this.getTask(t);if(!e&&!1===this.callEvent("onBeforeTaskDelete",[t,n]))return!1;var i=gantt._getChildLinks(t);return this._deleteRelatedTasks(t,e),this._deleteRelatedLinks(i,e),this._unset_task(t),e||(this.callEvent("onAfterTaskDelete",[t,n]),this.refreshData()),!0},gantt.clearAll=function(){this._clear_data(),this.callEvent("onClear",[]),this.refreshData()},gantt._clear_data=function(){this._pull={},this._branches={},this._order=[],this._order_full=[],this._lpull={},this._update_flags(),this.userdata={}},gantt._update_flags=function(t,e){t===undefined?(this._lightbox_id=this._selected_task=null,this._tasks_dnd.drag&&(this._tasks_dnd.drag.id=null)):(this._lightbox_id==t&&(this._lightbox_id=e),this._selected_task==t&&(this._selected_task=e),this._tasks_dnd.drag&&this._tasks_dnd.drag.id==t&&(this._tasks_dnd.drag.id=e))},gantt._get_duration_unit=function(){return 1e3*gantt._get_line(this.config.duration_unit)||this.config.duration_unit},gantt._get_safe_type=function(t){return t||"task"},gantt._get_type_name=function(t){for(var e in this.config.types)if(this.config.types[e]==t)return e;return"task"},gantt.getWorkHours=function(t){return this._working_time_helper.get_working_hours(t)},gantt.setWorkTime=function(t){this._working_time_helper.set_time(t)},gantt.isWorkTime=function(t,e){return this._working_time_helper.is_working_unit(t,e||this.config.duration_unit)},gantt.correctTaskWorkTime=function(t){alert("Forbidden function correctTaskWorkTime"),gantt.config.work_time&&gantt.config.correct_work_time&&(gantt.isWorkTime(t.start_date)?gantt.isWorkTime(new Date(+t.end_date-1))||(t.end_date=gantt.calculateEndDate(t.start_date,t.duration)):(t.start_date=gantt.getClosestWorkTime({date:t.start_date,dir:"future"}),t.end_date=gantt.calculateEndDate(t.start_date,t.duration)))},gantt.getClosestWorkTime=function(t){var e=this._working_time_helper;return t instanceof Date&&(t={date:t}),t.dir=t.dir||"any",t.unit=t.unit||this.config.duration_unit,e.get_closest_worktime(t)},gantt.calculateDuration=function(t,e){return this._working_time_helper.get_work_units_between(t,e,this.config.duration_unit,this.config.duration_step)},gantt._hasDuration=function(t,e){return this._working_time_helper.is_work_units_between(t,e,this.config.duration_unit,this.config.duration_step)},gantt.calculateEndDate=function(t,e,n){return this._working_time_helper.add_worktime(t,e,n||this.config.duration_unit)},gantt._init_task=function(t){return dhtmlx.defined(t.id)||(t.id=dhtmlx.uid()),t.start_date&&(t.start_date=gantt.date.parseDate(t.start_date,"xml_date")),t.end_date&&(t.end_date=gantt.date.parseDate(t.end_date,"xml_date")),t.start_date&&!t.end_date&&t.duration&&(t.end_date=this.calculateEndDate(t.start_date,t.duration)),gantt._init_task_timing(t),t.$source=[],t.$target=[],t.parent===undefined&&this.setParent(t,this.config.root_id),t.$open=dhtmlx.defined(t.open)?t.open:this.config.open_tree_initially,t.$level=this.calculateTaskLevel(t),t},gantt._init_task_timing=function(t){var e=this._get_safe_type(t.type);t.$rendered_type===undefined?t.$rendered_type=e:t.$rendered_type!=e&&(delete t.$no_end,delete t.$no_start,t.$rendered_type=e),t.$no_end!==undefined&&t.$no_start!==undefined||e==this.config.types.milestone||(e==this.config.types.project?(t.$no_end=t.$no_start=!0,this._set_default_task_timing(t)):(t.$no_end=!(t.end_date||t.duration),t.$no_start=!t.start_date)),t.start_date&&t.end_date&&(t.duration=Math.max(this.calculateDuration(t.start_date,t.end_date),1)),t.duration=t.duration||0},gantt._is_flex_task=function(t){return!(!t.$no_end&&!t.$no_start)},gantt.resetProjectDates=function(t){if(t.$no_end||t.$no_start){var e=this.getSubtaskDates(t.id);t.minimal_end&&t.minimal_end>e.end_date&&(e.end_date=moment(t.minimal_end),e.end_date._isEndDate=!0),t.maximal_start&&t.maximal_start<e.start_date&&(e.start_date=moment(t.maximal_start)),ysy.log.debug("resetProjectDates to start="+e.start_date+" end="+e.end_date,"parent"),this._assign_project_dates(t,e.start_date,e.end_date)}},gantt.getSubtaskDates=function(t){var e=null,n=null,i=t!==undefined?t:gantt.config.root_id;if(this.eachTask(function(t){t.start_date&&(!e||e>t.start_date.valueOf())&&(e=t.start_date.valueOf()),t.end_date&&(!n||n<t.end_date.valueOf())&&(n=t.end_date.valueOf())},i),(!e||!n)&&t){var s=gantt.getTask(t);e=e||s.start_date,n=n||s.end_date}var a=moment(e),r=moment(n);return r._isEndDate=!0,{start_date:a.isValid()?a:null,end_date:r.isValid()?r:null}},gantt._assign_project_dates=function(t,e,n){t.$no_start&&(e&&e!=Infinity?t.start_date=gantt.date.Date(e):t.start_date=this._default_task_date(t,this.getParent(t))),t.$no_end&&(n&&n!=-Infinity?t.end_date=gantt.date.Date(n):t.end_date=this.calculateEndDate(t.start_date,this.config.duration_step)),(t.$no_start||t.$no_end)&&this._init_task_timing(t)},gantt._update_parents=function(t,e){if(ysy.log.debug("_update_parents on ID="+t,"parent"),t){for(var n=this.getTask(t),i=this.getParent(n);!n.$no_end&&!n.$no_start&&i&&this.isTaskExists(i);)n=this.getTask(i),i=this.getParent(n);(n.$no_start||n.$no_end)&&(gantt.resetProjectDates(n),e||this.refreshTask(n.id,!0)),i&&this.isTaskExists(i)&&this._update_parents(i,e)}},gantt.isChildOf=function(t,e){if(!this.isTaskExists(t))return!1;if(e===this.config.root_id)return this.isTaskExists(t);for(var n=this.getTask(t),i=this.getParent(t);n&&this.isTaskExists(i);){if((n=this.getTask(i))&&n.id==e)return!0;i=this.getParent(n)}return!1},gantt.roundDate=function(t){alert("Forbidden function roundDate"),t instanceof Date&&(t={date:t,unit:gantt._tasks.unit,step:gantt._tasks.step});var e=t.date,n=(t.step,t.unit),i=1e3*this._get_line(n),s=e.getTimezoneOffset();return moment(Math.round(+e/i)*i).add(s,"m").toDate()},gantt.attachEvent("onBeforeTaskUpdate",function(t,e){return gantt._init_task_timing(e),!0}),gantt.attachEvent("onBeforeTaskAdd",function(t,e){return gantt._init_task_timing(e),!0}),gantt.calculateTaskLevel=function(t){for(var e=0;this.getParent(t)&&this.isTaskExists(this.getParent(t));)t=this.getTask(this.getParent(t)),e++;return e},gantt.sort=function(t,e,n,i){var s=!i;this.isTaskExists(n)||(n=this.config.root_id),t||(t="order");var a="string"==typeof t?function(n,i){if(n[t]==i[t])return 0;var s=n[t]>i[t];return e&&(s=!s),s?1:-1}:t,r=this.getChildren(n);if(r){for(var o=[],d=r.length-1;d>=0;d--)o[d]=this._pull[r[d]];o.sort(a);for(d=0;d<o.length;d++)r[d]=o[d].id,this.sort(t,e,r[d],!0)}s&&this.render()},gantt.getNext=function(t){for(var e=0;e<this._order.length-1;e++)if(this._order[e]==t)return this._order[e+1];return null},gantt.getPrev=function(t){for(var e=1;e<this._order.length;e++)if(this._order[e]==t)return this._order[e-1];return null},gantt._get_parent_id=function(t){var e=this.config.root_id;return t&&(e=t.parent),e},gantt.getParent=function(t){var e=null;return t.id?e=t:this.isTaskExists(t)&&(e=gantt.getTask(t)),this._get_parent_id(e)},gantt.setParent=function(t,e){t.parent=e},gantt.getSiblings=function(t){if(!this.isTaskExists(t))return[];var e=this.getParent(t);return this.getChildren(e)},gantt.getNextSibling=function(t){for(var e=this.getSiblings(t),n=0,i=e.length;n<i;n++)if(e[n]==t)return e[n+1]||null;return null},gantt.getPrevSibling=function(t){for(var e=this.getSiblings(t),n=0,i=e.length;n<i;n++)if(e[n]==t)return e[n-1]||null;return null},gantt._init_link=function(t){return dhtmlx.defined(t.id)||(t.id=dhtmlx.uid()),t},gantt._sync_links=function(){for(var t in this._pull)this._pull[t].$source=[],this._pull[t].$target=[];for(var t in this._lpull){var e=this._lpull[t];this._pull[e.source]&&this._pull[e.source].$source.push(t),this._pull[e.target]&&this._pull[e.target].$target.push(t)}},gantt.getLink=function(t){return dhtmlx.assert(this._lpull[t],"Link doesn't exist"),this._lpull[t]},gantt.getLinks=function(){var t=[];for(var e in gantt._lpull)t.push(gantt._lpull[e]);return t},gantt.isLinkExists=function(t){return dhtmlx.defined(this._lpull[t])},gantt.addLink=function(t){return t=this._init_link(t),!1!==this.callEvent("onBeforeLinkAdd",[t.id,t])&&(this._lpull[t.id]=t,this._sync_links(),this.refreshLink(t.id),this.callEvent("onAfterLinkAdd",[t.id,t]),t.id)},gantt.updateLink=function(t,e){return dhtmlx.defined(e)||(e=this.getLink(t)),!1!==this.callEvent("onBeforeLinkUpdate",[t,e])&&(this._lpull[t]=e,e.widget.update(e),this._sync_links(),this.refreshLink(t),this.callEvent("onAfterLinkUpdate",[t,e]),!0)},gantt.deleteLink=function(t){return this._deleteLink(t)},gantt._deleteLink=function(t,e){var n=this.getLink(t);return!(!e&&!1===this.callEvent("onBeforeLinkDelete",[t,n]))&&(delete this._lpull[t],this._sync_links(),this.refreshLink(t),e||this.callEvent("onAfterLinkDelete",[t,n]),!0)},gantt.getChildren=function(t){return dhtmlx.defined(this._branches[t])?this._branches[t]:[]},gantt.hasChild=function(t){return dhtmlx.defined(this._branches[t])&&this._branches[t].length},gantt.refreshData=function(){this.refresher.renderData()},gantt._configure=function(t,e,n){for(var i in e)("undefined"==typeof t[i]||n)&&(t[i]=e[i])},gantt._init_skin=function(){gantt._get_skin(!1),gantt._init_skin=function(){}},gantt._get_skin=function(t){if(!gantt.skin||t)for(var e=document.getElementsByTagName("link"),n=0;n<e.length;n++){var i=e[n].href.match("dhtmlxgantt_([a-z]+).css");if(i){gantt.skin=i[1];break}}gantt.skin||(gantt.skin="terrace");var s=gantt.skins[gantt.skin];this._configure(gantt.config,s.config,t);var a=gantt.getGridColumns();a[1]&&"undefined"==typeof a[1].width&&(a[1].width=s._second_column_width),a[2]&&"undefined"==typeof a[2].width&&(a[2].width=s._third_column_width),s._lightbox_template&&(gantt._lightbox_template=s._lightbox_template)},gantt.resetSkin=function(){this.skin="",this._get_skin(!0)},gantt.skins={},gantt._init_dnd_events=function(){dhtmlxEvent(document.body,"mousemove",gantt._move_while_dnd),dhtmlxEvent(document.body,"mouseup",gantt._finish_dnd),gantt._init_dnd_events=function(){}},gantt._move_while_dnd=function(t){if(gantt._dnd_start_lb){document.gantt_unselectable||(document.body.className+=" gantt_unselectable",document.gantt_unselectable=!0);var e=gantt.getLightbox(),n=t&&t.target?[t.pageX,t.pageY]:[event.clientX,event.clientY];e.style.top=gantt._lb_start[1]+n[1]-gantt._dnd_start_lb[1]+"px",e.style.left=gantt._lb_start[0]+n[0]-gantt._dnd_start_lb[0]+"px"}},gantt._ready_to_dnd=function(t){var e=gantt.getLightbox();gantt._lb_start=[parseInt(e.style.left,10),parseInt(e.style.top,10)],gantt._dnd_start_lb=t&&t.target?[t.pageX,t.pageY]:[event.clientX,event.clientY]},gantt._finish_dnd=function(){gantt._lb_start&&(gantt._lb_start=gantt._dnd_start_lb=!1,document.body.className=document.body.className.replace(" gantt_unselectable",""),document.gantt_unselectable=!1)},gantt._focus=function(t,e){if(t&&t.focus)if(gantt.config.touch);else try{e&&t.select&&t.select(),t.focus()}catch(n){}},dataProcessor.prototype={setTransactionMode:function(t,e){"object"==typeof t?(this._tMode=t.mode||this._tMode,this._headers=this._headers||t.headers,this._payload=this._payload||t.payload):(this._tMode=t,this._tSend=e),"REST"==this._tMode&&(this._tSend=!1,this._endnm=!0)},escape:function(t){return this._utf?encodeURIComponent(t):escape(t)},enableUTFencoding:function(t){this._utf=dhx4.s2b(t)},setDataColumns:function(t){this._columns="string"==typeof t?t.split(","):t},getSyncState:function(){return!this.updatedRows.length},enableDataNames:function(t){this._endnm=dhx4.s2b(t)},enablePartialDataSend:function(t){this._changed=dhx4.s2b(t)},setUpdateMode:function(t,e){this.autoUpdate="cell"==t,this.updateMode=t,this.dnd=e},ignore:function(t,e){this._silent_mode=!0,t.call(e||window),this._silent_mode=!1},setUpdated:function(t,e,n){if(!this._silent_mode){var i=this.findRow(t);n=n||"updated";var s=this.obj.getUserData(t,this.action_param);s&&"updated"==n&&(n=s),e?(this.set_invalid(t,!1),this.updatedRows[i]=t,this.obj.setUserData(t,this.action_param,n),this._in_progress[t]&&(this._in_progress[t]="wait")):this.is_invalid(t)||(this.updatedRows.splice(i,1),this.obj.setUserData(t,this.action_param,"")),e||this._clearUpdateFlag(t),this.markRow(t,e,n),e&&this.autoUpdate&&this.sendData(t)}},_clearUpdateFlag:function(){},markRow:function(t,e,n){var i="",s=this.is_invalid(t);if(s&&(i=this.styles[s],e=!0),this.callEvent("onRowMark",[t,e,n,s])&&(i=this.styles[e?n:"clear"]+i,this.obj[this._methods[0]](t,i),s&&s.details)){i+=this.styles[s+"_cell"];for(var a=0;a<s.details.length;a++)s.details[a]&&this.obj[this._methods[1]](t,a,i)}},getState:function(t){return this.obj.getUserData(t,this.action_param)},is_invalid:function(t){return this._invalid[t]},set_invalid:function(t,e,n){n&&(e={value:e,details:n,toString:function(){return this.value.toString()}}),this._invalid[t]=e},checkBeforeUpdate:function(){return!0},sendData:function(t){if(!this._waitMode||"tree"!=this.obj.mytype&&!this.obj._h2){if(this.obj.editStop&&this.obj.editStop(),void 0===t||this._tSend)return this.sendAllData();if(this._in_progress[t])return!1;if(this.messages=[],!this.checkBeforeUpdate(t)&&this.callEvent("onValidationError",[t,this.messages]))return!1;this._beforeSendData(this._getRowData(t),t)}},_beforeSendData:function(t,e){if(!this.callEvent("onBeforeUpdate",[e,this.getState(e),t]))return!1;this._sendData(t,e)},serialize:function(t,e){if("string"==typeof t)return t;if(void 0!==e)return this.serialize_one(t,"");var n=[],i=[];for(var s in t)t.hasOwnProperty(s)&&(n.push(this.serialize_one(t[s],s+this.post_delim)),i.push(s));return n.push("ids="+this.escape(i.join(","))),dhtmlx.security_key&&n.push("dhx_security="+dhtmlx.security_key),n.join("&")},serialize_one:function(t,e){if("string"==typeof t)return t;var n=[];for(var i in t)if(t.hasOwnProperty(i)){if(("id"==i||i==this.action_param)&&"REST"==this._tMode)continue;n.push(this.escape((e||"")+i)+"="+this.escape(t[i]))}return n.join("&")},_sendData:function(t,e){if(t){if(!this.callEvent("onBeforeDataSending",e?[e,this.getState(e),t]:[null,null,t]))return!1;e&&(this._in_progress[e]=(new Date).valueOf());var n=this,i=function(i){var s=[];if(e)s.push(e);else if(t)for(var a in t)s.push(a);return n.afterUpdate(n,i,s)},s=this.serverProcessor+(this._user?dhtmlx.url(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+this.obj.getUserData(0,"version")].join("&"):"");if("GET"==this._tMode)dhx4.ajax.get(s+(-1!=s.indexOf("?")?"&":"?")+this.serialize(t,e),i);else if("POST"==this._tMode)dhx4.ajax.post(s,this.serialize(t,e),i);else if("REST"==this._tMode){var a=this.getState(e),r=s.replace(/(\&|\?)editing\=true/,""),o="",d="post";if("inserted"==a?o=this.serialize(t,e):"deleted"==a?(d="DELETE",r=r+("/"==r.slice(-1)?"":"/")+e):(d="PUT",o=this.serialize(t,e),r=r+("/"==r.slice(-1)?"":"/")+e),this._payload)for(var l in this._payload)r=r+dhtmlx.url(r)+this.escape(l)+"="+this.escape(this._payload[l]);dhx4.ajax.query({url:r,method:d,headers:this._headers,data:o,callback:i})}this._waitMode++}},sendAllData:function(){if(this.updatedRows.length){this.messages=[];for(var t=!0,e=0;e<this.updatedRows.length;e++)t&=this.checkBeforeUpdate(this.updatedRows[e]);if(!t&&!this.callEvent("onValidationError",["",this.messages]))return!1;if(this._tSend)this._sendData(this._getAllData());else for(e=0;e<this.updatedRows.length;e++)if(!this._in_progress[this.updatedRows[e]]){if(this.is_invalid(this.updatedRows[e]))continue;if(this._beforeSendData(this._getRowData(this.updatedRows[e]),this.updatedRows[e]),this._waitMode&&("tree"==this.obj.mytype||this.obj._h2))return}}},_getAllData:function(){for(var t={},e=!1,n=0;n<this.updatedRows.length;n++){var i=this.updatedRows[n];this._in_progress[i]||this.is_invalid(i)||this.callEvent("onBeforeUpdate",[i,this.getState(i),this._getRowData(i)])&&(t[i]=this._getRowData(i,i+this.post_delim),e=!0,this._in_progress[i]=(new Date).valueOf())}return e?t:null},setVerificator:function(t,e){this.mandatoryFields[t]=e||function(t){return""!==t}},clearVerificator:function(t){this.mandatoryFields[t]=!1},findRow:function(t){var e=0;for(e=0;e<this.updatedRows.length&&t!=this.updatedRows[e];e++);return e},defineAction:function(t,e){this._uActions||(this._uActions=[]),this._uActions[t]=e},afterUpdateCallback:function(t,e,n,i){var s=t,a="error"!=n&&"invalid"!=n;if(a||this.set_invalid(t,n),this._uActions&&this._uActions[n]&&!this._uActions[n](i))return delete this._in_progress[s];"wait"!=this._in_progress[s]&&this.setUpdated(t,!1);var r=t;switch(n){case"inserted":case"insert":e!=t&&(this.obj[this._methods[2]](t,e),t=e);break;case"delete":case"deleted":return this.obj.setUserData(t,this.action_param,"true_deleted"),this.obj[this._methods[3]](t),delete this._in_progress[s],this.callEvent("onAfterUpdate",[t,n,e,i])}"wait"!=this._in_progress[s]?(a&&this.obj.setUserData(t,this.action_param,""),delete this._in_progress[s]):(delete this._in_progress[s],this.setUpdated(e,!0,this.obj.getUserData(t,this.action_param))),this.callEvent("onAfterUpdate",[r,n,e,i])},afterUpdate:function(t,e,n){if(window.JSON)try{var i=JSON.parse(e.xmlDoc.responseText),s=i.action||this.getState(n)||"updated",a=i.sid||n[0],r=i.tid||n[0];return t.afterUpdateCallback(a,r,s,i),void t.finalizeUpdate()}catch(c){}var o=dhx4.ajax.xmltop("data",e.xmlDoc);if(!o)return this.cleanUpdate(n);var d=dhx4.ajax.xpath("//data/action",o);if(!d.length)return this.cleanUpdate(n);for(var l=0;l<d.length;l++){var h=d[l];s=h.getAttribute("type"),a=h.getAttribute("sid"),r=h.getAttribute("tid");t.afterUpdateCallback(a,r,s,h)}t.finalizeUpdate()},cleanUpdate:function(t){if(t)for(var e=0;e<t.length;e++)delete this._in_progress[t[e]]},finalizeUpdate:function(){this._waitMode&&this._waitMode--,("tree"==this.obj.mytype||this.obj._h2)&&this.updatedRows.length&&this.sendData(),this.callEvent("onAfterUpdateFinish",[]),this.updatedRows.length||this.callEvent("onFullSync",[])},init:function(t){this.obj=t,this.obj._dp_init&&this.obj._dp_init(this)},setOnAfterUpdate:function(t){this.attachEvent("onAfterUpdate",t)},enableDebug:function(){},setOnBeforeUpdateHandler:function(t){this.attachEvent("onBeforeDataSending",t)},setAutoUpdate:function(t,e){t=t||2e3,this._user=e||(new Date).valueOf(),this._need_update=!1,this._loader=null,this._update_busy=!1,this.attachEvent("onAfterUpdate",function(t,e,n,i){this.afterAutoUpdate(t,e,n,i)}),this.attachEvent("onFullSync",function(){this.fullSync()});var n=this;window.setInterval(function(){n.loadUpdate()},t)},afterAutoUpdate:function(t,e){return"collision"!=e||(this._need_update=!0,!1)},fullSync:function(){return 1==this._need_update&&(this._need_update=!1,this.loadUpdate()),!0},getUpdates:function(t,e){if(this._update_busy)return!1;this._update_busy=!0,this._loader=this._loader||new dtmlXMLLoaderObject(!0),this._loader.async=!0,this._loader.waitCall=e,this._loader.loadXML(t)},_v:function(t){return t.firstChild?t.firstChild.nodeValue:""},_a:function(t){for(var e=[],n=0;n<t.length;n++)e[n]=this._v(t[n]);return e},loadUpdate:function(){var t=this,e=this.obj.getUserData(0,"version"),n=this.serverProcessor+dhtmlx.url(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+e].join("&");n=n.replace("editing=true&",""),this.getUpdates(n,function(){var e=t._loader.doXPath("//userdata");t.obj.setUserData(0,"version",t._v(e[0]));var n=t._loader.doXPath("//update");if(n.length){t._silent_mode=!0;for(var i=0;i<n.length;i++){var s=n[i].getAttribute("status"),a=n[i].getAttribute("id"),r=n[i].getAttribute("parent");switch(s){case"inserted":t.callEvent("insertCallback",[n[i],a,r]);break;case"updated":t.callEvent("updateCallback",[n[i],a,r]);break;case"deleted":t.callEvent("deleteCallback",[n[i],a,r])}}t._silent_mode=!1}t._update_busy=!1,t=null})}},dhtmlx.assert=function(t,e){t||dhtmlx.message({type:"error",text:e,expire:-1})},gantt.init=function(t,e,n){this.callEvent("onBeforeGanttReady",[]),e&&n&&(this.config.start_date=this._min_date=gantt.date.Date(e),this.config.end_date=this._max_date=gantt.date.Date(n)),this._init_skin(),this.config.scroll_size||(this.config.scroll_size=this._detectScrollSize()),dhtmlxEvent(window,"resize",this._on_resize),this.init=function(t){this.$container&&this.$container.parentNode&&(this.$container.parentNode.removeChild(this.$container),this.$container=null),this._reinit(t)},this._reinit(t)},gantt._reinit=function(t){this._init_html_area(t),this._set_sizes(),this._clear_renderers(),this._update_flags(),this._init_touch_events(),this._init_templates(),this._init_grid(),this._init_tasks(),this._set_scroll_events(),dhtmlxEvent(this.$container,"click",this._on_click),dhtmlxEvent(this.$container,"dblclick",this._on_dblclick),dhtmlxEvent(this.$container,"mousemove",this._on_mousemove),dhtmlxEvent(this.$container,"contextmenu",this._on_contextmenu),this.callEvent("onGanttReady",[]),this.render()},gantt._init_html_area=function(t){ysy.log.debug("html_inited","render"),this._obj="string"==typeof t?document.getElementById(t):t,dhtmlx.assert(this._obj,"Invalid html container: "+t);var e="<div class='gantt_container'><div class='gantt_grid'></div><div class='gantt_task'></div><div class='gantt_grid_column_resize_wrap' data-column_id='grid_width'>        </div>";e+="<div class='gantt_ver_scroll'><div></div></div><div class='gantt_hor_scroll'><div></div></div></div>",this._obj.innerHTML=e,this.$container=this._obj.firstChild;var n=this.$container.childNodes;this.$grid=n[0],this.$task=n[1],this.$grid_resize=n[2],this.$scroll_ver=n[3],this.$scroll_hor=n[4],this.$grid.innerHTML="<div class='gantt_grid_scale'></div><div class='gantt_grid_data'></div>",this.$grid_scale=this.$grid.childNodes[0],this.$grid_data=this.$grid.childNodes[1],this.$task.innerHTML="<div class='gantt_task_scale'></div><div class='gantt_data_area'><div class='gantt_task_bg'></div><div class='gantt_marker_area'></div><div class='gantt_links_area'></div><div class='gantt_bars_area'></div></div>",this.$task_scale=this.$task.childNodes[0],this.$task_data=this.$task.childNodes[1],this.$task_bg=this.$task_data.childNodes[0],this.$marker_area=this.$task_data.childNodes[1],this.$task_links=this.$task_data.childNodes[2],this.$task_bars=this.$task_data.childNodes[3]},gantt.$click={buttons:{edit:function(t){gantt.showLightbox(t)},"delete":function(t){var e=gantt.locale.labels.confirm_deleting,n=gantt.locale.labels.confirm_deleting_title;gantt._dhtmlx_confirm(e,n,function(){gantt.getTask(t).$new?(gantt._deleteTask(t,!0),gantt.refreshData()):gantt.deleteTask(t),gantt.hideLightbox()})}}},gantt._calculate_content_height=function(){var t=this.config.scale_height,e=this._order.length*this.config.row_height,n=this._scroll_hor?this.config.scroll_size+1:0;return this._is_grid_visible()||this._is_chart_visible()?t+e+2+n:0},gantt._calculate_content_width=function(){var t=this._get_grid_width(),e=this._tasks?this._tasks.full_width:0;this._scroll_ver&&this.config.scroll_size;return this._is_chart_visible()||(e=0),this._is_grid_visible()||(t=0),t+e+1},gantt._get_resize_options=function(){var t={x:!1,y:!1};return"xy"==this.config.autosize?t.x=t.y=!0:"y"==this.config.autosize||!0===this.config.autosize?t.y=!0:"x"==this.config.autosize&&(t.x=!0),t},gantt._clean_el_size=function(t){return 1*(t||"").toString().replace("px","")||0},gantt._get_box_styles=function(){var t=null,e=["width","height","paddingTop","paddingBottom","paddingLeft","paddingRight","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],n={boxSizing:"border-box"==(t=window.getComputedStyle?window.getComputedStyle(this._obj,null):{width:this._obj.clientWidth,height:this._obj.clientHeight}).boxSizing};t.MozBoxSizing&&(n.boxSizing="border-box"==t.MozBoxSizing);for(var i=0;i<e.length;i++)n[e[i]]=t[e[i]]?this._clean_el_size(t[e[i]]):0;var s={
horPaddings:n.paddingLeft+n.paddingRight+n.borderLeftWidth+n.borderRightWidth,vertPaddings:n.paddingTop+n.paddingBottom+n.borderTopWidth+n.borderBottomWidth,borderBox:n.boxSizing,innerWidth:n.width,innerHeight:n.height,outerWidth:n.width,outerHeight:n.height};return s.borderBox?(s.innerWidth-=s.horPaddings,s.innerHeight-=s.vertPaddings):(s.outerWidth+=s.horPaddings,s.outerHeight+=s.vertPaddings),s},gantt._do_autosize=function(){ysy.log.debug("_do_autosize()","print");var t=this._get_resize_options(),e=this._get_box_styles();if(t.y){var n=this._calculate_content_height();e.borderBox&&(n+=e.vertPaddings),this._obj.style.height=n+"px"}if(t.x){var i=this._calculate_content_width();e.borderBox&&(i+=e.horPaddings),this._obj.style.width=i+"px"}},gantt._set_sizes=function(){ysy.log.debug("_set_sizes()","print"),this._do_autosize();var t=this._get_box_styles();if(this._y=t.innerHeight,!(this._y<20)){this.$grid.style.height=this.$task.style.height=Math.max(this._y-this.$scroll_hor.offsetHeight-2,0)+"px";var e=Math.max(this._y-(this.config.scale_height||0)-this.$scroll_hor.offsetHeight-2,0);this.$grid_data.style.height=this.$task_data.style.height=e+"px";var n=Math.max(this._get_grid_width()-1,0);this.$grid.style.width=n+"px",this.$grid.style.display=0===n?"none":"",t=this._get_box_styles(),this._x=t.innerWidth,this._x<20||(this.$grid_data.style.width=Math.max(this._get_grid_width()-1,0)+"px",this.$task.style.width=Math.max(this._x-this._get_grid_width()-2,0)+"px")}},gantt._unset_sizes=function(){ysy.log.debug("_unset_sizes()","print"),this.$grid.style.height=this.$task.style.height="",this.$grid_data.style.height=this.$task_data.style.height="";var t=Math.max(this._get_grid_width()-1,0);this.$grid.style.width=t+"px",this.$grid.style.display=0===t?"none":"";var e=this._get_box_styles();this._x=e.innerWidth,this._x<20||(this.$grid_data.style.width=Math.max(this._get_grid_width()-1,0)+"px",this.$task.style.width="",this.$scroll_hor.style.display="none",this.$scroll_ver.style.display="none")},gantt.getScrollState=function(){return this.$task&&this.$task_data?{x:this.$task.scrollLeft,y:this.$task_data.scrollTop}:null},gantt._save_scroll_state=function(t,e){var n={};this._cached_scroll_pos=this._cached_scroll_pos||{x:0,y:0},t!==undefined&&(n.x=t),e!==undefined&&(n.y=e),dhtmlx.mixin(this._cached_scroll_pos,n,!0)},gantt._restore_scroll_state=function(){return this._cached_scroll_pos||null},gantt.scrollTo=function(t,e){if(1*t==t){var n=Math.min(t,this.$task.scrollWidth-this.$task.offsetWidth);this.$task.scrollLeft=n,this._save_scroll_state(n,undefined)}1*e==e&&this._save_scroll_state(undefined,e),ysy.log.debug("ScrollTo ["+t+" ("+n+"),"+e+"]","scroll"),this.callEvent("onScrollTo",[n,e])},gantt.showDate=function(t){var e=Math.round(this.posFromDate(t)),n=Math.max(e-this.config.task_scroll_offset,0);this.scrollTo(n)},gantt.showTask=function(t){var e=this.getTaskNode(t);if(e){var n=Math.max(e.offsetLeft-this.config.task_scroll_offset,0),i=e.offsetTop-(this.$task_data.offsetHeight-this.config.row_height)/2;this.scrollTo(n,i)}},gantt._on_resize=gantt.setSizes=function(){gantt._set_sizes(),gantt._scroll_resize()},gantt.render=function(){this.refresher.renderAll()},gantt._render=function(){ysy.log.debug("render is triggered","render"),this.callEvent("onBeforeGanttRender",[]);var t=dhtmlx.copy(this._restore_scroll_state()),e=null;if(t&&(e=gantt.dateFromPos(t.x+this.config.task_scroll_offset)),this._render_grid(),this._render_tasks_scales(),this._scroll_resize(),this._on_resize(),this._render_data(),this.config.preserve_scroll&&t){var n=gantt._restore_scroll_state(),i=gantt.dateFromPos(n.x+this.config.task_scroll_offset);+e==+i&&n.y==t.y||(ysy.log.debug("pos.x="+t.x+" new_pos="+n.x,"scroll"),this.showDate(i),gantt.scrollTo(undefined,t.y))}else this.showDate(moment());this.callEvent("onGanttRender",[]),gantt._skip_render=!1},gantt._set_scroll_events=function(){function t(t){var n=gantt._get_resize_options();gantt._wheel_time=gantt.date.Date();var i=e?-20*t.deltaX:2*t.wheelDeltaX,s=e?-40*t.deltaY:t.wheelDelta;if(i&&Math.abs(i)>Math.abs(s)){if(n.x)return!0;var a=i/-40,r=gantt.$task.scrollLeft+30*a;gantt.scrollTo(r,null),gantt.$scroll_hor.scrollTop=o}else{if(n.y)return!0;a=s/-40;void 0===s&&(a=t.detail);var o=gantt.$scroll_ver.scrollTop+30*a;if(!gantt.config.prevent_default_scroll&&gantt._cached_scroll_pos&&gantt._cached_scroll_pos.y==o)return!0;gantt.scrollTo(null,o),gantt.$scroll_ver.scrollTop=o}return t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,!1}dhtmlxEvent(this.$scroll_hor,"scroll",function(){if(gantt.date.now()-(gantt._wheel_time||0)<100)return!0;if(!gantt._touch_scroll_active){var t=gantt.$scroll_hor.scrollLeft;gantt.scrollTo(t)}}),dhtmlxEvent(this.$scroll_ver,"scroll",function(){if(!gantt._touch_scroll_active){var t=gantt.$scroll_ver.scrollTop;gantt.$grid_data.scrollTop=t,gantt.scrollTo(null,t)}}),dhtmlxEvent(this.$task,"scroll",function(){var t=gantt.$task.scrollLeft;gantt.$scroll_hor.scrollLeft!=t&&(gantt.$scroll_hor.scrollLeft=t)}),dhtmlxEvent(this.$task_data,"scroll",function(){var t=gantt.$task_data.scrollTop;gantt.$scroll_ver.scrollTop!=t&&(gantt.$scroll_ver.scrollTop=t)});var e=_isFF&&!window._KHTMLrv;e?dhtmlxEvent(gantt.$container,"wheel",t):dhtmlxEvent(gantt.$container,"mousewheel",t)},gantt._scroll_resize=function(){if(!(this._x<20||this._y<20)){var t=this._get_grid_width(),e=Math.max(this._x-t,0),n=Math.max(this._y-this.config.scale_height,0),i=this.config.scroll_size+1,s=Math.max(this.$task_data.offsetWidth-i,0),a=this.config.row_height*this._order.length,r=this._get_resize_options(),o=this._scroll_hor=!r.x&&s>e,d=this._scroll_ver=!r.y&&a>n;this.$scroll_hor.style.display=o?"block":"none",this.$scroll_hor.style.height=(o?i:0)+"px",this.$scroll_hor.style.width=Math.max(this._x-(d?i:2),0)+"px",this.$scroll_hor.firstChild.style.width=s+t+i+2+"px",this.$scroll_ver.style.display=d?"block":"none",this.$scroll_ver.style.width=(d?i:0)+"px",this.$scroll_ver.style.height=Math.max(this._y-(o?i:0)-this.config.scale_height,0)+"px",this.$scroll_ver.style.top=this.config.scale_height+"px",this.$scroll_ver.firstChild.style.height=this.config.scale_height+a+"px"}},gantt.locate=function(t){var e=gantt._get_target_node(t),n=e.className||"";if(n.indexOf||(n=""),(n||"").indexOf("gantt_task_cell")>=0)return null;for(var i=arguments[1]||this.config.task_attribute;e;){if(e.getAttribute){var s=e.getAttribute(i);if(s)return s}e=e.parentNode}return null},gantt._get_target_node=function(t){return t.tagName?t:(t=t||window.event).target||t.srcElement},gantt._trim=function(t){return(String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")}).apply(t)},gantt._locate_css=function(t,e,n){n===undefined&&(n=!0);for(var i=gantt._get_target_node(t),s="";i;){if((s=i.className)&&!s.indexOf&&(s=""),s){var a=s.indexOf(e);if(a>=0){if(!n)return i;var r=0===a||!gantt._trim(s.charAt(a-1)),o=a+e.length>=s.length||!gantt._trim(s.charAt(a+e.length));if(r&&o)return i}}i=i.parentNode}return null},gantt._locateHTML=function(t,e){var n=gantt._get_target_node(t);for(e=e||this.config.task_attribute;n;){if(n.getAttribute)if(n.getAttribute(e))return n;n=n.parentNode}return null},gantt.getTaskRowNode=function(t){for(var e=this.$grid_data.childNodes,n=this.config.task_attribute,i=0;i<e.length;i++){if(e[i].getAttribute)if(e[i].getAttribute(n)==t)return e[i]}return null},gantt.getState=function(){return{drag_id:this._tasks_dnd.drag.id,drag_mode:this._tasks_dnd.drag.mode,drag_from_start:this._tasks_dnd.drag.left,selected_task:this._selected_task,min_date:gantt.date.Date(this._min_date),max_date:gantt.date.Date(this._max_date),lightbox:this._lightbox_id,touch_drag:this._touch_drag}},gantt._checkTimeout=function(t,e){if(!e)return!0;var n=1e3/e;return n<1||!t._on_timeout&&(setTimeout(function(){delete t._on_timeout},n),t._on_timeout=!0,!0)},gantt.selectTask=function(t){if(!this.config.select_task)return!1;if(t){if(this._selected_task==t)return this._selected_task;if(!this.callEvent("onBeforeTaskSelected",[t]))return!1;if(this.unselectTask(!0),this._selected_task=t,this.refreshTask(t),this.config.scroll_on_click){var e=gantt.getTask(t);this.showDate(e.start_date)}this.callEvent("onTaskSelected",[t])}return this._selected_task},gantt.unselectTask=function(t){var e=this._selected_task;e&&(this._selected_task=null,this.refreshTask(e),this.callEvent("onTaskUnselected",[e,t]))},gantt.getSelectedId=function(){return dhtmlx.defined(this._selected_task)?this._selected_task:null},gantt.changeLightboxType=function(t){if(this.getLightboxType()==t)return!0;gantt._silent_redraw_lightbox(t)},gantt._is_render_active=function(){return!this._skip_render},gantt._correct_dst_change=function(t,e,n,i){var s=gantt._get_line(i)*n;if(s>3600&&s<86400){var a=t.getTimezoneOffset()-e;a&&(t=gantt.date.add(t,a,"minute"))}return t},gantt.batchUpdate=function(t){var e,n=this._dp&&"off"!=this._dp.updateMode;n&&(e=this._dp.updateMode,this._dp.setUpdateMode("off")),this._skip_render=!0;try{t()}catch(i){}this._skip_render=!1,this.render(),n&&(this._dp.setUpdateMode(e),this._dp.sendData())},gantt.config||(gantt.config={}),gantt.config||(gantt.config={}),gantt.templates||(gantt.templates={}),dhtmlx.mixin(gantt.config,{links:{finish_to_start:"0",start_to_start:"1",finish_to_finish:"2",start_to_finish:"3"},types:{task:"task",project:"project",milestone:"milestone"},duration_unit:"day",work_time:!1,correct_work_time:!1,skip_off_time:!1,autosize:!1,autosize_min_width:0,show_links:!0,show_task_cells:!0,static_background:!1,branch_loading:!1,show_loading:!1,show_chart:!0,show_grid:!0,min_duration:36e5,xml_date:"%d-%m-%Y %H:%i",api_date:"%d-%m-%Y %H:%i",start_on_monday:!0,server_utc:!1,show_progress:!0,fit_tasks:!1,select_task:!0,scroll_on_click:!0,preserve_scroll:!0,readonly:!1,date_grid:"%Y-%m-%d",drag_links:!0,drag_progress:!0,drag_resize:!0,drag_move:!0,drag_mode:{resize:"resize",progress:"progress",move:"move",ignore:"ignore",empty:"empty"},round_dnd_dates:!0,link_wrapper_width:20,root_id:0,autofit:!1,columns:[{name:"text",tree:!0,width:"*",resize:!0},{name:"start_date",align:"center",resize:!0},{name:"duration",align:"center"},{name:"add",width:"44"}],step:1,scale_unit:"day",scale_offset_minimal:!0,subscales:[],inherit_scale_class:!1,time_step:60,duration_step:1,date_scale:"%d %M",task_date:"%d %F %Y",time_picker:"%H:%i",task_attribute:"task_id",link_attribute:"link_id",layer_attribute:"data-layer",buttons_left:["gantt_save_btn","gantt_cancel_btn"],_migrate_buttons:{dhx_save_btn:"gantt_save_btn",dhx_cancel_btn:"gantt_cancel_btn",dhx_delete_btn:"gantt_delete_btn"},buttons_right:["gantt_delete_btn"],lightbox:{sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:!0},{name:"time",type:"duration",map_to:"auto"}],project_sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:!0},{name:"type",type:"typeselect",map_to:"type"},{name:"time",type:"duration",readonly:!0,map_to:"auto"}],milestone_sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:!0},{name:"type",type:"typeselect",map_to:"type"},{name:"time",type:"duration",single_date:!0,map_to:"auto"}]},drag_lightbox:!0,sort:!1,details_on_create:!0,details_on_dblclick:!0,initial_scroll:!0,task_scroll_offset:100,task_height:"full",min_column_width:70,min_grid_column_width:70,grid_resizer_column_attribute:"column_index",grid_resizer_attribute:"grid_resizer",keep_grid_width:!1,grid_resize:!1,readonly_property:"readonly",editable_property:"editable",type_renderers:{},open_tree_initially:!1,optimize_render:"auto",prevent_default_scroll:!1}),gantt.keys={edit_save:13,edit_cancel:27},gantt._init_template=function(t,e){var n=this._reg_templates||{};this.config[t]&&n[t]!=this.config[t]&&(e&&this.templates[t]||(this.templates[t]=this.date.date_to_str(this.config[t]),n[t]=this.config[t])),this._reg_templates=n},gantt._init_templates=function(){var t=gantt.locale.labels;t.gantt_save_btn=t.icon_save,t.gantt_cancel_btn=t.icon_cancel,t.gantt_delete_btn=t.icon_delete;var e=this.date.date_to_str,n=this.config;gantt._init_template("date_scale",!0),gantt._init_template("date_grid",!0),gantt._init_template("task_date",!0),dhtmlx.mixin(this.templates,{xml_date:this.date.str_to_date(n.xml_date,n.server_utc),xml_format:e(n.xml_date,n.server_utc),api_date:this.date.str_to_date(n.api_date),progress_text:function(){return""},grid_header_class:function(){return""},task_text:function(t,e,n){return n.text},task_class:function(){return""},grid_row_class:function(){return""},task_row_class:function(){return""},task_cell_class:function(){return""},scale_cell_class:function(){return""},scale_row_class:function(){return""},grid_indent:function(){return"<div class='gantt_tree_indent'></div>"},grid_folder:function(t){return t.$open||gantt._get_safe_type(t.type)!==gantt.config.types.task?"<div class='gantt_tree_icon gantt_folder_"+(t.$open?"open":"closed")+"'></div>":"<div class='gantt_tree_icon'><div class='gantt_drag_handle gantt_alldirarrow'></div></div>"},grid_file:function(t){return gantt._get_safe_type(t.type)===gantt.config.types.task?"<div class='gantt_tree_icon'><div class='gantt_drag_handle gantt_alldirarrow'></div></div>":"<div class='gantt_tree_icon gantt_folder_open'></div>"},grid_open:function(t){return"<div class='gantt_tree_icon gantt_"+(t.$open?"close":"open")+"'></div>"},grid_blank:function(){return"<div class='gantt_tree_indent'></div>"},task_time:function(t,e){return gantt.templates.task_date(t)+" - "+gantt.templates.task_date(e)},time_picker:e(n.time_picker),link_class:function(){return""},link_description:function(t){var e=gantt.getTask(t.source),n=gantt.getTask(t.target);return"<b>"+e.text+"</b> &ndash;  <b>"+n.text+"</b>"},drag_link:function(t,e,n,i){t=gantt.getTask(t);var s=gantt.locale.labels,a="<b>"+t.text+"</b> "+(e?s.link_start:s.link_end)+"<br/>";return n&&(a+="<b> "+(n=gantt.getTask(n)).text+"</b> "+(i?s.link_start:s.link_end)+"<br/>"),a},drag_link_class:function(t,e,n,i){var s="";return t&&n&&(s=" "+(gantt.isLinkAllowed(t,n,e,i)?"gantt_link_allow":"gantt_link_deny")),"gantt_link_tooltip"+s}}),this.callEvent("onTemplatesReady",[])},window.jQuery&&function(t){var e=[];t.fn.dhx_gantt=function(n){if("string"!=typeof(n=n||{})){var i=[];return this.each(function(){if(this&&this.getAttribute&&!this.getAttribute("dhxgantt")){for(var t in n)"data"!=t&&(gantt.config[t]=n[t]);gantt.init(this),n.data&&gantt.parse(n.data),i.push(gantt)}}),1===i.length?i[0]:i}if(e[n])return e[n].apply(this,[]);t.error("Method "+n+" does not exist on jQuery.dhx_gantt")}}(jQuery),window.dhtmlx&&(dhtmlx.attaches||(dhtmlx.attaches={}),dhtmlx.attaches.attachGantt=function(t,e){var n=document.createElement("DIV");n.id="gantt_"+dhtmlx.uid(),n.style.width="100%",n.style.height="100%",n.cmp="grid",document.body.appendChild(n),this.attachObject(n.id);var i=this.vs[this.av];i.grid=gantt,gantt.init(n.id,t,e),n.firstChild.style.border="none",i.gridId=n.id,i.gridObj=n;var s="_viewRestore";return this.vs[this[s]()].grid}),gantt.locale={labels:{}},gantt.skins.skyblue={config:{grid_width:350,row_height:27,scale_height:27,link_line_width:1,link_arrow_size:8,lightbox_additional_height:75},_second_column_width:95,_third_column_width:80},gantt.skins.meadow={config:{grid_width:350,row_height:27,scale_height:30,link_line_width:2,link_arrow_size:6,lightbox_additional_height:72},_second_column_width:95,_third_column_width:80},gantt.skins.terrace={config:{grid_width:360,row_height:35,scale_height:35,link_line_width:2,link_arrow_size:6,lightbox_additional_height:75},_second_column_width:90,_third_column_width:70},gantt.skins.broadway={config:{grid_width:360,row_height:35,scale_height:35,link_line_width:1,link_arrow_size:7,lightbox_additional_height:86},_second_column_width:90,_third_column_width:80,_lightbox_template:"<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span><div class='gantt_cancel_btn'></div></div><div class='gantt_cal_larea'></div>",_config_buttons_left:{},_config_buttons_right:{gantt_delete_btn:"icon_delete",gantt_save_btn:"icon_save"}},gantt.config.touch_drag=500,gantt.config.touch=!0,gantt.config.touch_feedback=!0,gantt._touch_feedback=function(){gantt.config.touch_feedback&&navigator.vibrate&&navigator.vibrate(1)},gantt._init_touch_events=function(){"force"!=this.config.touch&&(this.config.touch=this.config.touch&&(-1!=navigator.userAgent.indexOf("Mobile")||-1!=navigator.userAgent.indexOf("iPad")||-1!=navigator.userAgent.indexOf("Android")||-1!=navigator.userAgent.indexOf("Touch"))),this.config.touch&&(window.navigator.msPointerEnabled?this._touch_events(["MSPointerMove","MSPointerDown","MSPointerUp"],function(t){return t.pointerType==t.MSPOINTER_TYPE_MOUSE?null:t},function(t){return!t||t.pointerType==t.MSPOINTER_TYPE_MOUSE}):this._touch_events(["touchmove","touchstart","touchend"],function(t){return t.touches&&t.touches.length>1?null:t.touches[0]?{target:t.target,pageX:t.touches[0].pageX,pageY:t.touches[0].pageY,clientX:t.touches[0].clientX,clientY:t.touches[0].clientY}:t},function(){return!1}))},gantt._touch_events=function(t,e,n){function i(t){return t&&t.preventDefault&&t.preventDefault(),(t||event).cancelBubble=!0,!1}function s(t){var e=gantt._task_area_pulls,n=gantt.getTask(t);if(n&&gantt.isTaskVisible(t))for(var i in e)if((n=e[i][t])&&n.getAttribute("task_id")&&n.getAttribute("task_id")==t){var s=n.cloneNode(!0);return c=n,e[i][t]=s,n.style.display="none",s.className+=" gantt_drag_move ",n.parentNode.appendChild(s),s}}var a,r=0,o=!1,d=!1,l=null,h=null,c=null;this._gantt_touch_event_ready||(this._gantt_touch_event_ready=1,dhtmlxEvent(gantt.$container,t[0],function(t){if(!n(t)&&o){h&&clearTimeout(h);var s=e(t);if(gantt._tasks_dnd.drag.id||gantt._tasks_dnd.drag.start_drag)return gantt._tasks_dnd.on_mouse_move(s),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,!1;if(s&&l){var c=l.pageX-s.pageX,u=l.pageY-s.pageY;if(!d&&(Math.abs(c)>5||Math.abs(u)>5)&&(gantt._touch_scroll_active=d=!0,r=0,a=gantt.getScrollState()),d){gantt.scrollTo(a.x+c,a.y+u);var _=gantt.getScrollState();if(a.x!=_.x&&u>2*c||a.y!=_.y&&c>2*u)return i(t)}}return i(t)}})),dhtmlxEvent(this.$container,"contextmenu",function(t){if(o)return i(t)}),dhtmlxEvent(this.$container,t[1],function(t){if(!n(t))if(t.touches&&t.touches.length>1)o=!1;else{if(o=!0,(l=e(t))&&r){var a=gantt.date.Date();a-r<500?(gantt._on_dblclick(l),i(t)):r=a}else r=gantt.date.Date();h=setTimeout(function(){var t=gantt.locate(l);!t||gantt._locate_css(l,"gantt_link_control")||gantt._locate_css(l,"gantt_grid_data")||(gantt._tasks_dnd.on_mouse_down(l),gantt._tasks_dnd._start_dnd(l),gantt._touch_drag=!0,s(t),gantt.refreshTask(t),gantt._touch_feedback()),h=null},gantt.config.touch_drag)}}),dhtmlxEvent(this.$container,t[2],function(t){if(!n(t)){h&&clearTimeout(h),gantt._touch_drag=!1,o=!1;var i=e(t);gantt._tasks_dnd.on_mouse_up(i),c&&(gantt.refreshTask(gantt.locate(c)),c.parentNode.removeChild(c),gantt._touch_feedback()),gantt._touch_scroll_active=o=d=!1,c=null}})},gantt._markers||(gantt._markers={}),gantt.config.show_markers=!0,gantt.attachEvent("onClear",function(){gantt._markers={}}),gantt.attachEvent("onGanttReady",function(){function t(t){if(!gantt.config.show_markers)return!1;if(!t.start_date)return!1;var e=gantt.getState();if(!(+t.start_date>+e.max_date||+t.end_date&&+t.end_date<+e.min_date||+t.start_date<+e.min_date)){var n=document.createElement("div");n.setAttribute("marker_id",t.id);var i="gantt_marker";gantt.templates.marker_class&&(i+=" "+gantt.templates.marker_class(t)),t.css&&(i+=" "+t.css),t.title&&(n.title=t.title),n.className=i;var s=gantt.posFromDate(t.start_date);if(n.style.left=s+"px",n.style.height=Math.max(gantt._y_from_ind(gantt._order.length),0)+"px",t.end_date){var a=gantt.posFromDate(t.end_date);n.style.width=Math.max(a-s,0)+"px"}return t.text&&(n.innerHTML="<div class='gantt_marker_content' >"+t.text+"</div>"),n}}gantt._markerRenderer=gantt._task_renderer({id:"markers",renderer:t,container:gantt.$marker_area,filter:null})}),gantt.attachEvent("onDataRender",function(){gantt.renderMarkers()}),gantt.getMarker=function(t){return this._markers?this._markers[t]:null},gantt.addMarker=function(t){return t.id=t.id||dhtmlx.uid(),this._markers[t.id]=t,t.id},gantt.deleteMarker=function(t){return!(!this._markers||!this._markers[t])&&(delete this._markers[t],!0)},gantt.updateMarker=function(t){this._markerRenderer&&this._markerRenderer.render_item(t)},gantt.renderMarkers=function(){if(!this._markers)return!1;if(!this._markerRenderer)return!1;var t=[];for(var e in this._markers)t.push(this._markers[e]);return this._markerRenderer.render_items(t),!0},window.ysy=window.ysy||{},ysy.view=ysy.view||{},ysy.view.Gantt=function(){ysy.view.Widget.call(this),this.name="GanttInitWidget",ysy.log.message("widget Gantt created")},ysy.main.extender(ysy.view.Widget,ysy.view.Gantt,{_updateChildren:function(){if(!(this.children.length>0)){var t=new ysy.view.GanttRender;t.init(ysy.data.limits,ysy.settings.critical,ysy.settings.zoom,ysy.settings.sumRow),this.children.push(t)}},_postInit:function(){window.addEventListener("resize",()=>{this._resize()})},_resize:function(){this.debounceResize&&clearTimeout(this.debounceResize),this.debounceResize=setTimeout(()=>{this._repaintCore()},200)},_repaintCore:function(){if(null===this.$target)throw"Target is null for "+this.name;if(!ysy.data.columns)return!0;ysy.data.limits.setSilent("zoomDate",gantt.getShowDate()||moment()),ysy.view.initGantt(),this.addBaselineLayer(),gantt.init(this.$target),ysy.log.debug("gantt.init()","load"),this.tideFunctionality();for(var t=0;t<this.children.length;t++){var e=this.children[t];e.$target=this.$target,e.repaint(!0)}ysy.settings.controls.controls||$(".gantt_bars_area").addClass("no_task_controls"),dhtmlx.dragScroll()},addBaselineLayer:function(){}}),ysy.view.GanttRender=function(){ysy.view.Widget.call(this),this.name="GanttRenderWidget"},ysy.main.extender(ysy.view.Widget,ysy.view.GanttRender,{_updateChildren:function(){this.tasks||(this.tasks=new ysy.view.GanttTasks,this.tasks.init(ysy.data.issues,ysy.data.milestones,ysy.data.projects,ysy.settings.resource,ysy.data.assignees,ysy.settings.scheme,ysy.data.resourceReservations),this.children.push(this.tasks)),this.links||(this.links=new ysy.view.GanttLinks,this.links.init(ysy.data.relations,ysy.settings.resource),this.children.push(this.links)),this.refresher||(this.refresher=new ysy.view.GanttRefresher,this.refresher.init(gantt),this.children.push(this.refresher)),!this.sumRow&&ysy.settings.sumRow.active&&(this.sumRow=new ysy.view.SumRow,this.sumRow.init(),this.children.push(this.sumRow))},zoomTo:function(t){"month"===t?$.extend(gantt.config,{scale_unit:"month",date_scale:"%M",subscales:[{unit:"year",step:1,date:"%Y"}]}):"week"===t?$.extend(gantt.config,{scale_unit:"week",date_scale:"%W",subscales:[{unit:"month",step:1,date:"%F %Y"}]}):"day"===t&&$.extend(gantt.config,{scale_unit:"day",date_scale:"%d",subscales:[{unit:"month",step:1,date:"%F %Y"}]}),this.sumRow&&ysy.settings.sumRow.active&&gantt.config.subscales.push(this.sumRow.getSubScale(t))},_repaintCore:function(){if(null===this.$target)throw"Target is null for "+this.name;this.zoomTo(ysy.settings.zoom.zoom),this.tideFunctionality();for(var t=0;t<this.children.length;t++){this.children[t].repaint(!0)}gantt.showDate(moment()),gantt.render()},addBaselineLayer:function(){}}),ysy.view.GanttTasks=function(){ysy.view.Widget.call(this),this.name="GanttTasksWidget",ysy.view.ganttTasks=this},ysy.main.extender(ysy.view.Widget,ysy.view.GanttTasks,{_selectChildren:function(){var t=this.model.getArray(),e=ysy.data.milestones.getArray(),n=ysy.data.projects.getArray(),i=t.concat(e,n);return i.sort(function(t,e){if(t.isProject!==e.isProject)return t.isProject?t.id===ysy.settings.projectID?-1:1:e.id===ysy.settings.projectID?1:-1;var n=t.start_date||t._start_date,i=e.start_date||e._start_date;return n?i?n-i:1:i?-1:0}),i},_updateChildren:function(){var t,e,n,i=this._selectChildren();if(0===this.children.length)for(t=0;t<i.length;t++)e=i[t],(n=new ysy.view.GanttTask).init(e),n.parent=this,n.order=t+1,this.children.push(n);else{var s=[],a={};for(t=0;t<this.children.length;t++){var r=this.children[t];a[r.model.getID()]=r}for(t=0;t<i.length;t++)(n=a[(e=i[t]).getID()])?delete a[e.getID()]:((n=new ysy.view.GanttTask).init(e),n.parent=this),n.order=t+1,s.push(n);for(var o in a)a.hasOwnProperty(o)&&a[o].destroy(!0);this.children=s}ysy.log.log("-- "+this.children.length+" Children updated in "+this.name)},_repaintCore:function(){for(var t=0;t<this.children.length;t++){this.children[t].repaint(!0)}gantt._sync_links(),gantt.reconstructTree(),gantt.sort(gantt._sort&&gantt._sort.criteria)}}),ysy.view.GanttTask=function(){ysy.view.Widget.call(this),this.name="GanttTaskWidget"},ysy.main.extender(ysy.view.Widget,ysy.view.GanttTask,{_repaintCore:function(){var t=this.model,e=this._constructDhData(t);if(gantt._pull[e.id]){if(this.dhdata||(this.dhdata=gantt._pull[e.id]),this.dhdata.parent!=e.realParent){if(!gantt._pull[e.realParent]){let t;ysy.view.ganttTasks.children.forEach(n=>{`p${n.model.id}`===e.realParent&&((t=this._constructDhData(n.model)).parent=t.realParent)}),gantt.addTaskFaster(t)}gantt.silentMoveTask(this.dhdata,e.realParent),delete e.realParent}$.extend(this.dhdata,e),gantt.refreshTask(e.id)}else this.destroyDhData(),this.dhdata=e,ysy.log.debug("addTaskNoDraw()","load"),gantt.addTaskFaster(e)},destroyDhData:function(t){this.dhdata&&(this.dhdata.deleted=!0,gantt.isTaskExists(this.dhdata.id)&&gantt._deleteTask(this.dhdata.id,t),this.dhdata=null,ysy.log.debug("Destroy for "+this.name,"widget_destroy"))},destroy:function(t){this.destroyDhData(t),this.deleted=!0},_constructDhData:function(t){var e={id:t.getID(),real_id:t.id,text:t.name,css:(t.css||"")+(t.closed?" closed":""),widget:this,order:this.order,open:t.isOpened(),start_date:t.start_date?moment(t.start_date):undefined,$ignore:t._ignore||!1,columns:t.columns,readonly:!t.isEditable(),realParent:t.getParent()||0,type:t.ganttType};if(e.$open=e.open,t.isProject)$.extend(e,{progress:t.getProgress(),maximal_start:t.start_date,minimal_end:t.end_date,start_date:t.start_date,end_date:t.end_date});else if(t.isIssue){var n=moment(t._end_date);ysy.settings.showTasksSpentTimeRatio?progress=t.spent_hours?t.spent_hours/t.estimated_hours:0:progress=(t.done_ratio||0)/100,n._isEndDate=!0,$.extend(e,{start_date:moment(t._start_date),end_date:n,progress:progress,assigned_to:t.assigned_to,estimated:t.estimated_hours||0,priority_position:t.priority_position,soonest_start:t.soonest_start,latest_due:t.latest_due})}else t.milestone&&(e.end_date=moment(e.start_date),e.end_date._isEndDate=!0);return ysy.proManager.fireEvent("extendGanttTask",t,e),e},update:function(t,e){var n;if("milestone"===t.type)this.model.set({name:t.text,start_date:moment(t.start_date),_noDate:!1});else if("project"===t.type)(n={start_date:moment(t.start_date),end_date:moment(t.end_date),_shift:t.start_date.diff(this.model.start_date,"days")+(this.model._shift||0)}).end_date._isEndDate=!0,this.model.set(n);else{var i={name:t.text,estimated_hours:t.estimated,done_ratio:10*Math.round(10*t.progress),start_date:moment(t.start_date),end_date:moment(t.end_date)};if(i.end_date._isEndDate=!0,t._parentChanged&&($.extend(i,this._constructParentUpdate(t.parent)),t._parentChanged=!1),n=i,e!==undefined){n={};for(var s=0;s<e.length;s++){var a=e[s];"fixed_version_id"===a?"string"==typeof t.parent?n.fixed_version_id=parseInt(t.parent.substring(1)):n.parent=t.parent:n[a]=i[a]}}this.model.set(n)}this.requestRepaint()},_constructParentUpdate:function(t){if("string"!=typeof t){var e=gantt._pull[t];if(!e)return{};var n=e.widget.model;return n?n.fixed_version_id?{parent_issue_id:t,fixed_version_id:n.fixed_version_id,project_id:n.project_id}:{parent_issue_id:t,project_id:n.project_id}:{}}return ysy.main.startsWith(t,"p")?{parent_issue_id:null,project_id:parseInt(t.substring(1)),fixed_version_id:null}:ysy.main.startsWith(t,"m")?{parent_issue_id:null,fixed_version_id:parseInt(t.substring(1))}:"empty"===t?{parent_issue_id:null,project_id:ysy.settings.projectID,fixed_version_id:null}:null}}),ysy.view.GanttLinks=function(){ysy.view.Widget.call(this),this.name="GanttLinksWidget",ysy.view.ganttLinks=this},ysy.main.extender(ysy.view.Widget,ysy.view.GanttLinks,{_updateChildren:function(){var t,e,n,i=this.model.getArray();if(0===this.children.length)for(n=0;n<i.length;n++)(t=i[n]).isHalfLink()||((e=new ysy.view.GanttLink).init(t),this.children.push(e));else{var s=[],a={};for(n=0;n<this.children.length;n++){var r=this.children[n];a[r.model.id]=r}for(n=0;n<i.length;n++)(t=i[n]).isHalfLink()||((e=a[t.id])?delete a[t.id]:(e=new ysy.view.GanttLink).init(t),s.push(e));for(var o in a)a.hasOwnProperty(o)&&a[o].destroy(!0);this.children=s}ysy.log.log("-- "+this.children.length+" Children updated in "+this.name)},_repaintCore:function(){for(var t=0;t<this.children.length;t++){this.children[t].repaint(!0)}}}),ysy.view.GanttLink=function(){ysy.view.Widget.call(this),this.name="GanttLinkWidget"},ysy.main.extender(ysy.view.Widget,ysy.view.GanttLink,{_repaintCore:function(){var t=this.model,e=this._constructDhData(t);gantt._lpull[e.id]?(this.dhdata||(this.dhdata=gantt._lpull[e.id]),$.extend(this.dhdata,e),gantt.refreshLink(e.id),gantt.refreshTask(e.source),gantt.refreshTask(e.target)):(this.dhdata=e,gantt.addLink(e))},destroy:function(t){this.dhdata&&(this.dhdata.deleted=!0,gantt.isLinkExists(this.model.id)&&gantt._deleteLink(this.model.id,t),this.dhdata=null,ysy.log.debug("Destroy for "+this.name,"widget_destroy")),this.deleted=!0},_constructDhData:function(t){return ysy.settings.unfixRelations&&ysy.settings.unfixRelations.active&&(t.delay=0,t._unlocked=!0),{id:t.id,source:t.source_id,target:t.target_id,type:t.isSimple?"start_to_start":t.type,isSimple:t.isSimple,delay:t.delay,unlocked:t._unlocked,readonly:!t.isEditable(),widget:this}},update:function(t){ysy.history.openBrack(),this.model.set({type:this.model.type||t.type,delay:t.delay}),ysy.pro.relations.moveByCreatedLink(t,this.model),ysy.history.closeBrack()}}),ysy.view.GanttRefresher=function(){ysy.view.Widget.call(this),this.name="GanttRefresherWidget",this.all=!1,this.data=!1,this.tasks=[],this.links=[]},ysy.main.extender(ysy.view.Widget,ysy.view.GanttRefresher,{_postInit:function(){this.model.refresher=this},_register:function(){},renderAll:function(){this.all=!0,this.requestRepaint()},renderData:function(){this.data=!0,this.requestRepaint()},refreshTask:function(t){for(var e=0;e<this.tasks.length;e++)if(this.tasks[e]==t)return;this.tasks.push(t),this.requestRepaint()},refreshLink:function(t){for(var e=0;e<this.links.length;e++)if(this.links[e]==t)return;this.links.push(t),this.requestRepaint()},_repaintCore:function(){if(this.all){ysy.log.debug("---- Refresher: _renderAll","refresher");var t=gantt.getShowDate();t||(t=ysy.data.limits.zoomDate),gantt._backgroundRenderer.forceRender=!1,this.model._render(),gantt._backgroundRenderer.forceRender=!0,gantt.showDate(t),delete gantt._backgroundRenderer.forceRender,ysy.view.affix.requestRepaint()}else if(this.data){if(ysy.log.debug("---- Refresher: _renderData","refresher"),this.model._render_data(),this.all)return!0}else{ysy.log.debug("---- Refresher: _render for "+this.tasks.length+" tasks and "+this.links.length+" links","refresher");for(var e=0;e<this.tasks.length;e++){var n=this.tasks[e];if(this.model._refreshTask(n),this.all||this.data)return!0}for(e=0;e<this.links.length;e++){var i=this.links[e];if(this.model._refreshLink(i),this.all||this.data)return!0}}this.all=!1,this.data=!1,this.tasks=[],this.links=[]}}),window.ysy=window.ysy||{},ysy.history=ysy.history||{},EasyGem.extend(ysy.history,{_name:"History",_inbrack:0,stack:[],_binded:!1,add:function(t,e){this.stack.push({diff:t,ctx:e}),this._fireChanges(this,"add"),this._bind()},revert:function(t){var e=!0;if(0!==this.stack.length){for(;this._inbrack||e;){e=!1;var n=this.stack.pop();if(!n)return;if("string"==typeof n){if("close"===n){this._inbrack++;continue}if("open"===n){this._inbrack--;continue}}this._revertOne(n)}0===this.stack.length&&this._unbind(),this._fireChanges(t,"revert")}},_revertOne:function(t){"array"==typeof t.diff?(t.ctx.array=t.diff,t.ctx._fireChanges(this,"revert")):"function"==typeof t.diff?($.proxy(t.diff,t.ctx)(),t.ctx._fireChanges(this,"revert")):($.extend(t.ctx,t.diff),t.ctx._fireChanges(this,"revert"))},clear:function(t){this.stack.length>0&&this._unbind(),this.stack=[],this._inbrack=0,this._fireChanges(t,"clear")},openBrack:function(){this._inbrack||this.stack.push("open"),this._inbrack++},closeBrack:function(){0===this._inbrack&&ysy.log.error("History bracket is not opened"),
1===this._inbrack&&("open"===this.stack[this.stack.length-1]?this.stack.pop():this.stack.push("close")),this._inbrack--},_bind:function(){this._binded||$(window).bind("beforeunload",function(t){var e="Some changes are not saved!";return t.returnValue=e,e})},_unbind:function(){$(window).unbind("beforeunload"),this._binded=!1},_onChange:[],register:function(t,e){this._onChange.push({func:t,ctx:e})},inBracket:function(){return this._inbrack>0},isEmpty:function(){return!this.stack.length},_fireChanges:function(t,e){if(t){var n="";e&&(n=" because of "+e),ysy.log.log("* "+t._name+" ordered repaint on "+this._name+n)}this._onChange.length>0?ysy.log.log("- "+this._name+" onChange fired for "+this._onChange.length+" widgets"):ysy.log.log("- no changes for "+this._name);for(var i=0;i<this._onChange.length;i++){var s=this._onChange[i].ctx;s&&!s.deleted?(ysy.log.log("-- changes to "+s.name+" widget"),$.proxy(this._onChange[i].func,s)()):this._onChange.splice(i,1)}}}),window.ysy=window.ysy||{},ysy.data=ysy.data||{},ysy.data.loader=ysy.data.loader||{},ysy.data.loader.checkIntegrity=function(t){var e,n,i=2980,s=moment().format("YYYY-MM-DD"),a=function(t){var s,a,d,l,h=t.issues||[],c=t.projects||[],u=t.versions||[],_=[],g=[],f=[],p=[],y={},m=[],v=[],w=function(t){t.start_date&&v.push(t.start_date),t.due_date&&v.push(t.due_date)};if(h.forEach(w),c.forEach(w),u.forEach(w),0===v.length)return{issues:f,versions:p,projects:m};v.sort();var k=moment(v[Math.floor(v.length/2)]);for(e=moment(k-i/2*24*60*60*1e3).format("YYYY-MM-DD"),n=moment(k+i/2*24*60*60*1e3).format("YYYY-MM-DD"),d=0;d<h.length;d++)l=h[d],s=r(l),e>s?(f.push({entity:l,isLeft:!0}),y[l.project_id]=!0):(a=o(l),n<a?(f.push({entity:l,isLeft:!1}),y[l.project_id]=!0):_.push(l));for(d=0;d<u.length;d++)l=u[d],s=r(l),e>s?(p.push({entity:l,isLeft:!0}),y[l.project_id]=!0):(a=o(l),n<a?(p.push({entity:l,isLeft:!1}),y[l.project_id]=!0):g.push(l));for(d=0;d<c.length;d++){l=c[d];var x=!0;if(s=r(l),e<=s&&(x=!1,a=o(l),n>=a)){if(!y[l.id])continue;x=!0}m.push({entity:$.extend({},l),isLeft:x}),x?(l.start_date=e,l.due_date<e?l.due_date=e:l.due_date>n&&(l.due_date=n)):(l.due_date=n,l.start_date<n&&(l.start_date=n))}return t.issues=_,t.versions=g,{issues:f,versions:p,projects:m}},r=function(t){return t.start_date?t.start_date:t.due_date&&t.due_date<s?t.due_date:s},o=function(t){return t.due_date?t.due_date:t.start_date&&t.start_date>s?t.start_date:s},d=function(t){var s=ysy.main.toMomentFormat(ysy.settings.dateFormat);return $.extend(t,{limit:i,minLimit:moment(e).format(s),maxLimit:moment(n).format(s)}),t.issues.forEach(function(t){t.isLeft?t.date=moment(r(t.entity)).format(s):t.date=moment(o(t.entity)).format(s)}),t.versions.forEach(function(t){t.date=moment(r(t.entity)).format(s)}),t.projects.forEach(function(t){t.isLeft?t.date=moment(r(t.entity)).format(s):t.date=moment(o(t.entity)).format(s)}),t};if(function(t){for(var e,n,s=0;s<t.length;s++){var a=t[s],r=moment(a.start_date),o=moment(a.due_date);e&&!e.isAfter(r)||(e=r),n&&!n.isBefore(o)||(n=o)}return!(!n||!e)&&n.diff(e,"days")>i}(t.projects)){var l=d(a(t));return 0===l.issues.length&&0===l.versions.length||dhtmlx.message(Mustache.render(ysy.view.templates.integrityCheck,l),"error"),!1}return!0},window.ysy=window.ysy||{},ysy.view=ysy.view||{},ysy.view.leftGrid=ysy.view.leftGrid||{},EasyGem.extend(ysy.view.leftGrid,{columnsWidth:{id:60,subject:200,name:200,project:140,other:70,updated_on:85,assigned_to:100,grid_width:400,max_grid_width:700,min_grid_width:400,first_load:!0},patch:function(){ysy.data.limits.columnsWidth=$.extend({},this.columnsWidth),ysy.view.columnBuilders=ysy.view.columnBuilders||{};var t=this;$.extend(ysy.view.columnBuilders,{id:function(t){return t.id>1e12?"":"<a href='"+(ysy.settings.paths.rootPath+("project"===t.type?"projects/":"issues/"))+t.real_id+"' title='"+ysy.main.escapeText(t.text)+"' target='_blank'>#"+t.real_id+"</a>"},updated_on:function(t){if(!t.columns)return"";var e=t.columns.updated_on;return e?moment.utc(e,"YYYY-MM-DD HH:mm:ss ZZ").fromNow():""},done_ratio:function(t){return t.columns?"project"===t.type?"":"<span >"+10*Math.round(10*t.progress)+"</span>":""},due_date:function(t){if(!t.columns)return"";const e=t.columns.due_date;let n=`<span >${ysy.main.escapeText(e||"")}</span>`;if(!e)return n;if(!("project"===t.type))return n;if(!!!t.parent)return n;if((()=>{const e=t.parent.match(/\d+/)[0],n=ysy.data.projects.dict[e];return new Date(n.end_date).setHours(0,0,0,0)<new Date(t.end_date).setHours(0,0,0,0)})()){n=`<span ><i class="icon-warning red" title="${ysy.view.getLabel("warnings").subproject_precedes_parent}"></i>${ysy.main.escapeText(t.columns.due_date||"")}</span>`}return n},easy_indicator:function(t){if(!t.columns)return"";const e=t.columns.easy_indicator;if(!e)return"";const n={21:"warning",22:"alert",20:"ok",0:"ok"}[e];return`<div class="state-indicator-circle easy-indicator-${n}" title="${ysy.view.getLabel("indicator")[n]}"></div>`},estimated_hours:function(t){return t.columns&&t.estimated?"<span >"+t.estimated+"</span>":""},subject:function(e){var n=parseInt(e.real_id);if(isNaN(n)||n>1e12)return e.text;var i=t.constructUrl(e),s=ysy.main.escapeText(e.text);if(gantt.modalAdapter&&i&&"task"===e.$rendered_type){const t="gantt_task_subject",a=`<a href="${i}${n}" class="gantt_task_subject" title="${s}" target="_blank"> ${s} </a>`;return gantt.addTogglersToEntity(e,i,t)||a}if(i){const t=`<a href="${i}${n}" title="${s}" target="_blank"> ${s}</a>`;return gantt.addTogglersToEntity(e,i)||t}return s},_default:function(t){return function(e){return e.columns?t.dont_escape?e.columns[t.name]:ysy.main.escapeText(e.columns[t.name]||""):""}}}),gantt._render_grid_superitem=function(t){for(var e=ysy.view.columnBuilders.subject,n="",i=0;i<t.$level;i++)n+=this.templates.grid_indent(t);var s=this._has_children(t.id);s?(n+=this.templates.grid_open(t),n+=this.templates.grid_folder(t)):(n+=this.templates.grid_blank(t),n+=this.templates.grid_file(t));var a=this.templates.superitem_after_text(t,s),r=t.$index%2==0,o="<div class='gantt_grid_superitem gantt_cell gantt_tree_cell' style='"+""+"'>"+n+"<div class='gantt_tree_content'>"+e(t)+a+"</div></div>",d=r?" odd":"";if(this.templates.grid_row_class){var l=this.templates.grid_row_class.call(this,t.start_date,t.end_date,t);l&&(d+=" "+l)}this.getState().selected_task==t.id&&(d+=" gantt_selected");var h=document.createElement("div");return h.className="gantt_row gantt_tree_row"+d,h.style.height=this.config.row_height+"px",h.style.lineHeight=gantt.config.row_height+"px",h.setAttribute(this.config.task_attribute,t.id),h.setAttribute("data-level",t.$level),h.setAttribute("data-prev-count",t.$prev),h.innerHTML=o,h},$.extend(gantt.templates,{grid_open:function(t){return"<div class='gantt_tree_icon gantt_"+(t.$open?"close":"open")+" gantt_tree_expander easy-gantt__icon easy-gantt__icon--"+(t.$open?"close":"open")+"'></div>"},grid_folder:function(t){return this["grid_bullet_"+gantt._get_safe_type(t.type)]?this["grid_bullet_"+gantt._get_safe_type(t.type)](t,!0):t.$open||gantt._get_safe_type(t.type)!==gantt.config.types.task?"<div class='gantt_tree_icon easy-gantt__icon easy-gantt__icon--folder_"+(t.$open?"open":"closed")+"'></div>":"<div class='gantt_tree_icon easy-gantt__icon easy-gantt__icon--task gantt_drag_handle'></div>"},grid_file:function(t){return this["grid_bullet_"+gantt._get_safe_type(t.type)]?this["grid_bullet_"+gantt._get_safe_type(t.type)](t,!1):gantt._get_safe_type(t.type)===gantt.config.types.task?"<div class='gantt_tree_icon easy-gantt__icon easy-gantt__icon--task gantt_drag_handle'></div>":"<div class='gantt_tree_icon easy-gantt__icon easy-gantt__icon--open'></div>"},grid_bullet_milestone:function(){return"<div class='gantt_tree_icon easy-gantt__icon easy-gantt__icon--milestone"+(!1?"gantt_drag_handle":"")+"'></div>"},grid_bullet_project:function(t){var e,n=ysy.settings.labels.titles,i=t.widget&&t.widget.model.issues_count;return e=i>9?"more":i,i?"<div class='gantt_tree_icon easy-gantt__icon easy-gantt__icon--filter_"+e+" easy-gantt__project_issues' title='"+n.load+" "+i+" "+n.issues+"' data-project_id='"+t.real_id+"'></div>":"<div class='gantt_tree_icon easy-gantt__icon easy-gantt__icon--filter_none ' title='"+n.allIssueLoaded+"'></div>"},grid_bullet_task:function(t,e){return e?"<div class='gantt_tree_icon gantt_drag_handle easy-gantt__icon easy-gantt__icon--folder_"+(t.$open?"open":"closed")+"'></div>":"<div class='gantt_tree_icon easy-gantt__icon easy-gantt__icon--task gantt_drag_handle'></div>"},superitem_after_text:function(t,e){return this["superitem_after_"+gantt._get_safe_type(t.type)]?this["superitem_after_"+gantt._get_safe_type(t.type)](t,e):""}}),gantt._render_grid_header=function(){var t=this.getGridColumns(),e=[],n=0,i=this.locale.labels;let s,a="global";ysy.settings.project&&(a=`project_${ysy.settings.project.id}`);var r=this.config.scale_height-2,o=[];let d={};for(var l=0;l<t.length;l++){var h=l===t.length-1,c=t[l];h&&this._get_grid_width()>n+c.width&&(c.width=this._get_grid_width()-n),n+=c.width;var u=this._sort&&c.name===this._sort.name?"<div class='gantt_sort gantt_"+this._sort.direction+"'></div>":"";c.tree&&(this._sort||(u='<div class="gantt_sort gantt_none"></div>'),ysy.pro.collapsor&&(u+=ysy.pro.collapsor.templateHtml));var _=["gantt_grid_head_cell","gantt_grid_head_"+c.name,h?"gantt_last_cell":"",this.templates.grid_header_class(c.name,c)].join(" ");c.width=c.width?c.width:c.min_width;var g="width:"+(c.width-(h?1:0))+"px;";d[`${c.name}`]=c.width-(h?1:0),s=h?Object.values(d).filter(t=>t<0):[],h&&!s.length&&ysy.data.storage.savePersistentData(a,JSON.stringify(d));var f=c.label||i["column_"+c.name];f=f||"";var p="<div class='"+_+"' style='"+g+"' column_id='"+c.name+"'><div class='gantt-grid-header-multi'>"+f+u+"</div></div>";h||o.push("<div style='left:"+(n-6)+"px' class='gantt_grid_column_resize_wrap' data-column_id='"+c.name+"'></div>"),e.push(p)}this.$grid_resize.style.left=this._get_grid_width()-6+"px",this.$grid_scale.style.height=this.config.scale_height-1+"px",this.$grid_scale.style.lineHeight=r+"px",this.$grid_scale.style.width=n-1+"px",this.$grid_scale.style.position="relative",this.$grid_scale.innerHTML=e.join("")+o.join(""),ysy.view.leftGrid.resizeTable(),ysy.view.collapsors&&ysy.view.collapsors.requestRepaint()},gantt._calc_grid_width=function(){var t,e=this.getGridColumns(),n=0,i=[];let s=0;var a=ysy.view.leftGrid.columnsWidth;let r="global";for(ysy.settings.project&&(r=`project_${ysy.settings.project.id}`),t=0;t<e.length;t++){var o=parseInt(e[t].min_width,10);i[t]=o,n+=o}if(a.first_load){const t=JSON.parse(ysy.data.storage.getPersistentData(r));t?(e.forEach(e=>{t[`${e.name}`]?(s+=t[`${e.name}`],e.width=t[`${e.name}`]):(e.width=e.min_width,s+=e.width)}),this.config.grid_width=s):this.config.grid_width=n,a.first_load=!1}}},constructColumns:function(t){for(var e=[],n=ysy.view.columnBuilders,i=function(t){return n[t.name]?n[t.name]:n[t.name+"Builder"]?n[t.name+"Builder"](t):n._default(t)},s=0;s<t.length;s++){var a=t[s],r="subject"===a.name||"name"===a.name;if("id"!==a.name||ysy.settings.easyRedmine){var o="gantt_grid_body_"+a.name;if(""!==a.name){var d=ysy.data.limits.columnsWidth[a.name]||ysy.data.limits.columnsWidth.other,l={name:a.name,label:a.title,min_width:d,width:d,tree:r,align:r?"left":"center",template:i(a),css:o};r?e.unshift(l):e.push(l)}}}return e},resizeTable:function(){var t=$(".gantt_grid_column_resize_wrap:not(inited)"),e=ysy.data.limits.columnsWidth,n=$(".gantt_grid"),i=$(".gantt_grid_data"),s=$(".gantt_grid_scale");t.each(function(t,a){var r,o,d,l,h={},c=$(a),u=gantt.config.columns[t].name,_=new dhtmlxDnD(a,h);_.attachEvent("onDragStart",function(){this.config.started||(r=e[u]||e.other,o=n.find(".gantt_grid_head_"+u).width(),l=n.width(),d=c.offset())}),_.attachEvent("onDragMove",function(){var a=Math.floor(_.getDiff().x);ysy.log.debug("moveDrag diff="+a+"px width="+o+"px","grid_resize"),n.width(l+a),i.width(l+a),s.width(l+a),c.offset({top:d.top,left:d.left+a}),e[u]=r+a;var h=gantt.config.columns;t<=h.length-1&&(gantt.config.columns[t].min_width=r+a,gantt.config.columns[t].width=o+a+1,n.find(".gantt_grid_head_"+u+", .gantt_grid_body_"+u).width(o+a+"px")),gantt.config.grid_width=l+a,e.grid_width=l+a}),_.attachEvent("onDragEnd",function(){gantt.render()})}),t.addClass("inited")},urlMap:{task:"issues/","default":"issues/",milestone:"versions/",project:"projects/",assignee:{"default":"users/",group:"groups/"}},constructUrl:function(t){var e=this.urlMap[t.type||"default"];return e?"string"==typeof e?ysy.settings.paths.rootPath+e:ysy.settings.paths.rootPath+e[t.subtype||"default"]:null}}),window.ysy=window.ysy||{},ysy.data=ysy.data||{},ysy.data.loader=ysy.data.loader||{},EasyGem.extend(ysy.data.loader,{_name:"Loader",loaded:!1,inited:!1,issueIdListMap:{},_onChange:[],init:function(){var t=ysy.settings,e=ysy.data;"/"!==t.paths.rootPath.substr(-1)&&(t.paths.rootPath+="/"),t.project||(t.global=!0),t.project&&(t.projectID=parseInt(t.project.id)),t.zoom=new ysy.data.Data,t.zoom.init({zoom:e.storage.getSavedZoom()||ysy.settings.defaultZoom||"day",_name:"Zoom"}),t.controls=new ysy.data.Data,t.controls.init({controls:!0,_name:"Task controls"}),t.baseline=new ysy.data.Data,t.baseline.init({open:!1,_name:"Baselines"}),t.critical=new ysy.data.Data,t.critical.init({open:!1,active:!1,_name:"Critical path"}),t.addTask=new ysy.data.Data,t.addTask.init({open:!1,type:"issue",_name:"Add Task"}),t.resource=new ysy.data.Data,t.resource.init({open:!1,_name:"Resource Management"}),t.scheme=new ysy.data.Data,t.scheme.init({by:ysy.settings.schemeBy,_name:"Schema switch"}),t.sumRow=new ysy.data.Data,t.sumRow.init({_name:"SumRow"}),t.sample=new e.Data,e.limits=new e.Data,e.limits.init({_name:"Limits",openings:{}}),e.relations=(new e.Array).init({_name:"RelationArray"}),e.issues=(new e.Array).init({_name:"IssueArray"}),e.milestones=(new e.Array).init({_name:"MilestoneArray"}),e.projects=(new e.Array).init({_name:"ProjectArray"}),e.baselines=(new e.Array).init({_name:"BaselineArray"}),ysy.view.patch(),ysy.proManager.patch(),t.sample.init(),this.inited=!0},load:function(){this.loaded=!1,ysy.log.debug("load()","load"),ysy.settings.sample.active?ysy.pro.sample.loadSample(ysy.settings.sample.active):(ysy.settings.resource.open||this.setHeading(!0),ysy.gateway.loadGanttdata($.proxy(this._handleMainGantt,this),function(){ysy.log.error("Error: Unable to load data")}))},loadSubEntity:async function(t,e){if("project"===t){return await this.loadProject(e)}},register:function(t,e){this._onChange.push({func:t,ctx:e})},setHeading:function(t){var e=ysy.settings;if(e.easyRedmine)var n=$("#query_form_content").find(".easy-query-heading-wrapper");else n=$(".content-title").find("h2");if(n.length){var i=e.global,s=e.labels.titles;if(i)var a="",r=s.global+" - ",o=t?s.easyGantt:s.title_rm;else a=" - "+e.project.name,r="",o=t?s.easyGantt:s.title_rm_short;var d=e.query_name?" - "+e.query_name:"",l="";if(n.children().length)for(var h=0;h<n.children().length;h++)l+=n.children()[h].outerHTML;n.html(ysy.main.escapeText(r+o+a+d)+l),document.title=r+o+a}},reorderArray:function(t,e){for(var n=[],i=0,s=0;s<t.length;s++)if(e.length===s||e[s]!==t[s].id){s>0&&(n=t.slice(0,s),i=s,e=e.slice(s));break}var a=[];for(s=0;s<e.length;s++)for(var r=i;r<t.length;r++)if(t[r].id===e[s]){n.push(t[r]),a.push(t[r]);break}for(s=i;s<t.length;s++)a.indexOf(t[s])>-1||n.push(t[s]);return n},_fireChanges:function(){for(var t=0;t<this._onChange.length;t++){var e=this._onChange[t].ctx;e&&!e.deleted?(ysy.log.log("-- changes to "+(e.name?e.name:e._name)+" widget"),$.proxy(this._onChange[t].func,e)()):this._onChange.splice(t,1)}},_handleMainGantt:function(t){if(t.easy_gantt_data){var e=t.easy_gantt_data;ysy.settings.resource&&(ysy.settings.resource.buttons=ysy.settings.resource.buttons||{},this.buttons=ysy.settings.resource.buttons),this.checkIntegrity(e),ysy.log.debug("_handleGantt()","load"),e.columns.forEach(t=>{t.name=t.name.replace(/\./g,"_")}),ysy.data.columns=e.columns,ysy.data.relations.clear(),ysy.data.issues.clear(),ysy.data.milestones.clear(),ysy.data.projects.clear(),this._loadProjects(e.projects),(ysy.settings.resource_on&&!this.buttons.onlyReservation||!ysy.settings.resource_on)&&this._loadIssues(e.issues,"root"),this._loadMilestones(e.versions),this._loadRelations(e.relations),this._loadHolidays(e.holidays),this._loadSchemes&&this._loadSchemes(e.schemes),ysy.log.debug("data loaded","load"),ysy.log.message("JSON loaded"),this._fireChanges(),ysy.history.clear(),this.loaded=!0}},_loadIssues:function(t,e){if(t){e&&(this.issueIdListMap[e]&&(t=ysy.data.loader.reorderArray(t,this.issueIdListMap[e])),this.issueIdListMap[e]=t.map(function(t){return t.id}));for(var n=ysy.data.issues,i=0;i<t.length;i++){var s=new ysy.data.Issue;s.init(t[i]),n.pushSilent(s)}n._fireChanges(this,"load")}},_loadRelations:function(t){if(t){for(var e=ysy.data.relations,n={precedes:!0,finish_to_finish:!0,start_to_start:!0,start_to_finish:!0},i=0;i<t.length;i++){if(n[t[i].type])var s=new ysy.data.Relation;else s=new ysy.data.SimpleRelation;s.init(t[i]),e.pushSilent(s)}e._fireChanges(this,"load")}},_loadMilestones:function(t){if(t){for(var e=ysy.data.milestones,n=0;n<t.length;n++){var i=new ysy.data.Milestone;i.init(t[n]),e.pushSilent(i);for(var s=i.getIssues(),a={},r=0;r<s.length;r++)a[s[r].project_id]=!0;delete a[i.project_id];var o=Object.getOwnPropertyNames(a);if(0!==o.length){var d=t[n].project_id,l=t[n].project_name;for(delete t[n].project_id,r=0;r<o.length;r++){var h=new ysy.data.SharedMilestone;$.extend(h,{project_id:parseInt(o[r]),real_project_id:d,real_project_name:l,real_milestone:e.getByID(i.id)}),h.init(t[n]),e.pushSilent(h)}}}e._fireChanges(this,"load")}},_loadProjects:function(t){if(t){for(var e=ysy.data.projects,n=0;n<t.length;n++){var i=new ysy.data.Project;i.init(t[n]),e.pushSilent(i)}e._fireChanges(this,"load");var s=ysy.data.limits.openings;for(var a in s)if(s.hasOwnProperty(a))if(ysy.main.startsWith(a,"p")){var r=a.substring(1);if(!(i=e.getByID(r)))continue;if(!i.needLoad)continue;i.needLoad=!1,this.loadProject(r)}else if(this.openIssuesOfProject&&ysy.main.startsWith(a,"s")){if(!s["p"+(r=a.substring(1))])continue;this.openIssuesOfProject(r)}}},_loadHolidays:function(t){t&&(ysy.settings.holidays=t,ysy.view.initNonworkingDays())},loadProject:function(){}}),ysy.gateway||(ysy.gateway={}),EasyGem.extend(ysy.gateway,{loadGanttdata:function(t,e){$.getJSON(ysy.settings.paths.mainGantt).done(t).fail(e)}}),window.ysy=window.ysy||{},ysy.log={logLevel:2,mainDebug:"",debugTypes:["nothing"],log:function(t){this.logLevel>=4&&this.print(t)},message:function(t){this.logLevel>=3&&this.print(t)},debug:function(t,e){if(e){if(this.mainDebug===e)return void this.print(t,"debug");for(var n=0;n<this.debugTypes.length;n++)if(this.debugTypes[n]===e)return void this.print(t,e===this.mainDebug?"debug":null)}else this.print(t,"debug")},warning:function(t){this.logLevel>=2&&this.print(t,"warning")},error:function(t){this.logLevel>=1&&this.print(t,"error")},print:function(t,e){"error"===e?console.error(t):"warning"===e?console.warn(t):"debug"===e?console.debug(t):console.log(t)}},window.ysy=window.ysy||{},ysy.main=ysy.main||{},ysy.initGantt=function(){ysy.data.loader.init(),ysy.data.loader.load(),ysy.data.storage.init(),ysy.settings.easyRedmine||moment.locale(ysy.settings.language||"en"),ysy.main.setFirstDayOfWeek(),ysy.view.start()},ysy.deepCounter=0,ysy.moreDashes=function(){for(var t="",e=0;e<ysy.deepCounter;e++)t+="\u2502";return ysy.deepCounter++,t+"\u250c "},ysy.sameDashes=function(){for(var t="",e=0;e<ysy.deepCounter;e++)t+="\u2502";return t+"- "},ysy.lessDashes=function(){if(ysy.deepCounter--,ysy.deepCounter<0)throw"tooMany lessDashes";for(var t="",e=0;e<ysy.deepCounter;e++)t+="\u2502";return t+"\u2514 "},window.ysy=window.ysy||{},ysy.view=ysy.view||{},ysy.view.Toolbars=function(){ysy.view.Widget.call(this)},ysy.main.extender(ysy.view.Widget,ysy.view.Toolbars,{name:"ToolbarsWidget",template:"",childTargets:{SuperPanelWidget:"#supertop_panel",BottomPanelWidget:"#gantt_footer_buttons",BaselinePanelWidget:"#baseline_panel",CriticalPanelWidget:"#critical_panel",AddTaskPanelWidget:"#add_task_panel",LegendWidget:"#easy_gantt_footer_legend",ToolPanelWidget:"#easy_gantt_tool_panel",CollapsorsWidget:"#gantt_cont",AffixWidget:"#easy_gantt_menu"},_updateChildren:function(){if(!(this.children.length>0)){if(ysy.view.SuperPanel){var t=new ysy.view.SuperPanel;t.init(ysy.settings.sample),this.children.push(t)}var e=new ysy.view.AllButtons;e.init(),this.children.push(e),ysy.proManager.fireEvent("initToolbar",this);var n=new ysy.view.Legend;n.init(null),this.children.push(n);var i=new ysy.view.Collapsors;if(i.init(null),ysy.view.collapsors=i,this.children.push(i),window.affix||!ysy.settings.easyRedmine){var s=new ysy.view.Affix;ysy.view.affix=s,s.init(),this.children.push(s)}else ysy.view.affix={requestRepaint:function(){}}}},_repaintCore:function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];this.setChildTarget(e,t),e.repaint(!0)}},setChildTarget:function(t){this.childTargets[t.name]&&(t.$target=this.$target.find(this.childTargets[t.name]))}}),ysy.view.AllButtons=function(){ysy.view.Widget.call(this)},ysy.main.extender(ysy.view.Widget,ysy.view.AllButtons,{name:"AllButtonsWidget",templateName:"AllButtons",extendees:{test:{func:function(){ysy.test.run()},on:!0,hid:!0},back:{bind:function(){this.model=ysy.history},func:function(){ysy.history.revert()},isDisabled:function(){return ysy.history.isEmpty()}},save:{bind:function(){this.model=ysy.history,this.sample=ysy.settings.sample,this._register(this.sample)},func:function(){if(ysy.settings.sample.active)ysy.data.loader.load();else{var t=$(".easy-content-page"),e=t.height();t.css({height:e}),this.timeoutSubscription&&window.clearTimeout(this.timeoutSubscription),this.timeoutSubscription=window.setTimeout(function(){t.css({height:""})},5e3),ysy.data.save()}},specialRepaint:function(){var t=ysy.view.getLabel("buttons");if(ysy.settings.sample.active)var e=t.button_reload;else e=t.button_save;this.$target.children().html(e)},isDisabled:function(){return this.model.isEmpty()},timeoutSubscription:0},day_zoom:{value:"day",bind:function(){this.model=ysy.settings.zoom},func:function(){ysy.settings.zoom.setSilent("zoom",this.value)&&ysy.settings.zoom._fireChanges(this,this.value)},isOn:function(){return ysy.settings.zoom.zoom===this.value}},week_zoom:{value:"week",bind:function(){this.model=ysy.settings.zoom},func:function(){ysy.settings.zoom.setSilent("zoom",this.value)&&ysy.settings.zoom._fireChanges(this,this.value)},isOn:function(){return ysy.settings.zoom.zoom===this.value}},month_zoom:{value:"month",bind:function(){this.model=ysy.settings.zoom},func:function(){ysy.settings.zoom.setSilent("zoom",this.value)&&ysy.settings.zoom._fireChanges(this,this.value)},isOn:function(){return ysy.settings.zoom.zoom===this.value}},task_control:{bind:function(){this.model=ysy.settings.controls},func:function(){ysy.settings.controls.setSilent("controls",!this.isOn()),ysy.settings.controls._fireChanges(this,!this.isOn()),$(".gantt_bars_area").toggleClass("no_task_controls"),this.requestRepaint()},isOn:function(){return ysy.settings.controls.controls},isHidden:function(){return!1}},resource_help:{},add_task_help:{},baseline_help:{},critical_help:{},print:{func:function(){return ysy.pro.print.directPrint(this)},isOn:function(){return ysy.pro.print.printPreparing},forceRepaint:function(){this.requestRepaint(),this.repaint()}},jump_today:{func:function(){gantt.showDate(moment())}}},_updateChildren:function(){var t=[];for(var e in this.$target=$("#content"),this.extendees)if(this.extendees.hasOwnProperty(e)){var n,i=this.extendees[e];n=i.widget?new i.widget:new ysy.view.Button,$.extend(n,i,{elid:e}),this.getChildTarget(n,e).length&&(n.init(),t.push(n))}this.children=t},out:function(){},_repaintCore:function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];this.setChildTarget(e,t),e.repaint(!0)}},setChildTarget:function(t){t.$target=this.getChildTarget(t)},getChildTarget:function(t,e){return e||(e=t.elid),this.$target.find("#"+t.elementPrefix+e)}}),ysy.view.Button=function(){ysy.view.Widget.call(this),this.on=!1,this.disabled=!1,this.func=function(){var t=$(this.$target).next("div"),e=t.clone().attr({id:t[0].id+"_popup"}).appendTo($("body"));showModal(e[0].id)}},ysy.main.extender(ysy.view.Widget,ysy.view.Button,{name:"ButtonWidget",templateName:"Button",elementPrefix:"button_",_replace:!0,init:function(){return this.name=(this.elid||this.id)+this.name,this.name=this.name.charAt(0).toUpperCase()+this.name.slice(1),this.bind&&this.bind(),this.model&&this._register(this.model),this},tideFunctionality:function(){!this.func||this.isDisabled()||this.$target.is("a")&&"javascript:void(0)"!==this.$target.attr("href")||this.$target.off("click").on("click",$.proxy(this.func,this))},isHidden:function(){return this.hid},_repaintCore:function(){var t=this.$target,e=this.isHidden();t.toggle(!e),e?this.specialRepaint&&this.specialRepaint(e):(this.isDisabled()?(t.addClass("disabled"),t.removeClass("active")):(t.removeClass("disabled"),this.isOn()?t.addClass("active"):t.removeClass("active")),this.specialRepaint&&this.specialRepaint(),this.tideFunctionality())},isOn:function(){return this.on},isDisabled:function(){return this.disabled}}),ysy.view.Select=function(){ysy.view.Button.call(this)},ysy.main.extender(ysy.view.Button,ysy.view.Select,{name:"SelectWidget",templateName:"Select",elementPrefix:"select_",_repaintCore:function(){var t=this.$target,e=this.isHidden();t.toggle(!e),e?this.specialRepaint&&this.specialRepaint(e):(t.prop("disabled",this.isDisabled()),t.val(this.modelValue()),this.specialRepaint&&this.specialRepaint(),this.tideFunctionality())},tideFunctionality:function(){this.func&&!this.isDisabled()&&this.$target.off("change").on("change",$.proxy(this.func,this))},modelValue:function(){return""}}),ysy.view.CheckBox=function(){ysy.view.Button.call(this)},ysy.main.extender(ysy.view.Button,ysy.view.CheckBox,{name:"CheckBoxWidget",elementPrefix:"checkbox_",_repaintCore:function(){var t=this.$target,e=this.isHidden();t.toggle(!e),e?this.specialRepaint&&this.specialRepaint(e):(t.prop("disabled",this.isDisabled()),t.prop("checked",this.isOn()),this.specialRepaint&&this.specialRepaint(),this.tideFunctionality())},tideFunctionality:function(){this.func&&!this.isDisabled()&&this.$target.off("change").on("change",$.proxy(this.func,this))}}),ysy.view.Legend=function(){ysy.view.Widget.call(this)},ysy.main.extender(ysy.view.Widget,ysy.view.Legend,{name:"LegendWidget",templateName:"legend",_postInit:function(){},out:function(){return{}}}),ysy.view.Affix=function(){ysy.view.Widget.call(this),this.offset=0},ysy.main.extender(ysy.view.Widget,ysy.view.Affix,{name:"AffixWidget",init:function(){this.$document=$(document),this.$superPanel=$("#supertop_panel"),this.$cont=$("#gantt_cont"),this.$document.on("scroll",$.proxy(this.requestRepaint,this)),$(window).on("resize",$.proxy(this.requestRepaint,this)),ysy.settings.easyRedmine&&(this.offset+=$("#top-menu").outerHeight()),this.bottomFixed=!1,this.stickyAllowed=this.isStickyAllowed()},isStickyAllowed:function(){var t=document.createElement("a").style;return t.cssText="position:sticky;position:-webkit-sticky;position:-ms-sticky;",-1!==t.position.indexOf("sticky")},_repaintCore:function(){var t=this.$document.scrollTop()+this.offset-this.$superPanel.offset().top-this.$superPanel.outerHeight();(t=Math.max(Math.floor(t),0),this.stickyAllowed)?(this.$target[0].style.cssText="position:sticky;position:-webkit-sticky;position:-ms-sticky;top:"+this.offset+"px",this.$cont.find(".gantt_hor_scroll").css({position:"sticky",bottom:"0"})):(this.$target.css({transform:"translate(0, "+t+"px)"}),this.$cont[0].getBoundingClientRect().bottom>window.innerHeight?this.bottomFixed||(this.$cont.find(".gantt_hor_scroll").css({position:"fixed",bottom:"0"}),this.bottomFixed=!0):this.bottomFixed&&(this.$cont.find(".gantt_hor_scroll").css({position:"relative",bottom:""}),this.bottomFixed=!1));this.$cont.find(".gantt_grid_scale, .gantt_task_scale").css({transform:"translate(0, "+(t-1)+"px)"})}}),window.ysy=window.ysy||{},ysy.pro=ysy.pro||{},ysy.pro.print={printPrepared:!1,printPreparing:!1,patch:function(){var t=this;window.matchMedia("print").addListener(function(e){e.matches||t.afterPrint()}),window.onafterprint=$.proxy(this.afterPrint,this),window.easyModel=window.easyModel||{},window.easyModel.print=window.easyModel.print||{},window.easyModel.print.functions=window.easyModel.print.functions||[],window.easyModel.print.functions.push(this.printToTemplate)},directPrint:function(t){var e=this;e.printPreparing=!0,t.forceRepaint(),setTimeout(function(){e.beforePrint(),e.printPreparing=!1,t.forceRepaint(),window.print()},30)},beforePrint:function(t){var e=ysy.pro.print;if(e.printPrepared)return;var n=$("#wrapper2"),i=$("#wrapper3");ysy.view.affix.setPosition&&ysy.view.affix.setPosition(0),$("#print_area").remove();var s=$('<div id="print_area" class="'+(ysy.settings.easyRedmine?"easy":"redmine")+' gantt-print__area"></div>'),a=$('<div class="gantt-print__gantt"></div>');s.append(a);var r=gantt._tasks.full_width;t=t||490;var o=e.cloneGrid();a.append(o);var d=o.outerWidth();const l=document.getElementById("gantt_print_from"),h=document.getElementById("gantt_print_to");if(l&&h){const t=gantt.posFromDate(moment(l.value)),e=gantt.posFromDate(moment(h.value).add(1,"days"));t&&e&&(d=-t,r=e)}for(var c=-d;c<r;c+=t)a.append(e.createStrip(c<0?0:c,Math.min(c+t,r)));i.hide(),$(".gantt_hor_scroll").hide(),n.append(s),$("body").addClass("gantt-print__body"),e.printPrepared=!0},afterPrint:function(){setTimeout(function(){ysy.pro.print.printPrepared&&($("body").removeClass("gantt-print__body"),$("#print_area").remove(),$("#wrapper3").show(),$("#content, #sidebar").removeClass("fake-responsive"),gantt._scroll_resize(),ysy.pro.print.printPrepared=!1)},100)},printToTemplate:function(){var t=$("#easy_gantt_print_fit_checkbox").is(":checked");ysy.pro.print.beforePrint(t?Infinity:undefined);var e=$(".gantt_container").width(),n=$("#print_area").html()+ysy.view.templates.printIncludes;t&&(n='<div class="easy-print-page-fitting gantt-print__template--nowrap">'+n+"</div>"),window.easyModel.print.tokens.easy_gantt_current=n,window.easyModel.print.setWidth(e),ysy.pro.print.afterPrint()},cloneGrid:function(){var t=$("#gantt_cont").find(".gantt_grid").clone().addClass("gantt-print__grid");t.find("a").each(function(){var t=$(this);t.parent().append('<span class="'+this.className+'">'+t.text()+"</span>"),t.remove()});var e=t.find(".gantt_grid_scale");return e.css({height:e.height()+1+"px",transform:"none"}),t},createStrip:function(t,e){if(e<=t)return null;var n=$("#gantt_cont"),i=n.find(".gantt_task"),s=$('<div class="gantt-print__strip" style="width:'+(e-t)+'px"></div>');s.append(this.cloneScales(i,t,e));var a=n.find(".gantt_data_area"),r=$('<div class="gantt_data_area"></div>').css({height:a.height()+"px",width:e-t+"px"});return r.append(this.cloneSvgBackground(a,t,e)),r.append(this.cloneTasks(a,t,e)),r.append(this.cloneLinks(a,t,e)),s.append(r),s},cloneScales:function(t,e,n){for(var i=$('<div class="gantt_task_scale gantt-print__scale"></div>'),s=t.find(".gantt_scale_line"),a=0;a<s.length;a++){var r=$(s[a]).find(".gantt_scale_cell"),o=$('<div class="gantt_scale_line gantt-print__scale-line"></div>');o[0].style.height=s[a].style.height,o[0].style.lineHeight=s[a].style.lineHeight;for(var d=0,l=!1,h=0;h<r.length;h++){var c=$(r[h]),u=c.outerWidth();if(d<n&&d+u>e){var _=c.clone();o.append(_),!1===l&&(l=!0,_.css("margin-left",d-e+"px"))}d+=u}o.width(d),i.append(o)}return i},cloneSvgBackground:function(t,e,n){var i=$('<div class="gantt_task_bg gantt-print__bg" style="width:'+(n-e)+'px"></div>'),s=SVG(i[0]);$(s.node).css({position:"absolute"});var a=gantt._order,r=a.map(function(t){return gantt._pull[t]}),o=gantt._tasks,d=a.length*o.height,l=o.col_width,h=o.count,c=r.length,u=Math.ceil(n/l),_=Math.floor(e/l);return u>h&&(u=h),gantt._backgroundRenderer._render_bg_canvas(s,r,{fromX:_,toX:u,fromY:0,toY:c}),s.node.style.left=o.left[_]-e+"px",i.height(d)},cloneLinks:function(t,e,n){var i=t.find(".gantt_links_area").clone().addClass("gantt-print__links-area").css("left",-e+"px");return i.find(".gantt_task_link > div").filter(function(){var t=parseInt(this.style.left),i=parseInt(this.style.width||10);return t>n||t+i<e}).remove(),i},cloneTasks:function(t,e,n){for(var i=t.find(".gantt_bars_area"),s=$(i[0].cloneNode(!1)).addClass("gantt-print__bars-area").css("left",-e+"px"),a=i.children(),r=0;r<a.length;r++){var o=a[r],d=parseInt(o.style.left)-50,l=o.offsetWidth+300;d>=n||d+l<=e||s.append($(o).clone())}var h=i.find("canvas");if(h.length>0){var c=s.find("canvas")
;for(r=0;r<c.length;r++)c[r].getContext("2d").drawImage(h[r],0,0)}return s}},ysy.pro=ysy.pro||{},ysy.pro.pdfPrint=ysy.pro.pdfPrint||{},EasyGem.extend(ysy.pro.pdfPrint,{beats:0,targetBeat:2,patch:function(){ysy.settings.pdfPrint&&ysy.data.loader.register(function(){ysy.view.onRepaint.push($.proxy(this.repaint,this))},this)},repaint:function(){this.beats>this.targetBeat||(this.beats===this.targetBeat&&(gantt._backgroundRenderer.switchFullRender(!0),gantt._unset_sizes()),this.beats++)}}),window.ysy=window.ysy||{},ysy.proManager=ysy.proManager||{},ysy.pro=ysy.pro||{},EasyGem.extend(ysy.proManager,{proFunctionsMap:{},name:"proManager",patch:function(){for(var t in window.ysy=window.ysy||{},ysy.settings=ysy.settings||{},ysy.pro)ysy.pro.hasOwnProperty(t)&&ysy.pro[t].patch&&ysy.pro[t].patch()},forEachPro:function(t,e){var n=this.proFunctionsMap[e];if(n)for(var i=0;i<n.length;i++)t.call(this,n[i])},forLastPro:function(t,e){var n=this.proFunctionsMap[e];if(n)for(var i=n.length-1;i>=0;i--)if(t.call(this,n[i]))return!0},fireEvent:function(t){var e=this.proFunctionsMap[t];if(e)for(var n=Array.prototype.slice.call(arguments,1),i=0;i<e.length;i++)e[i].apply(this,n)},register:function(t,e){if(!e)throw"missing call function";var n=this.proFunctionsMap[t];n||(this.proFunctionsMap[t]=n=[]);for(var i=0;i<n.length;i++)if(n[i]===e)return;n.push(e)},unregister:function(t,e){var n=this.proFunctionsMap[t];if(n)for(var i=0;i<n.length;i++)if(n[i]===e)return void n.splice(i,1)},showHelp:function(){var t=$(this).next(),e=t.clone().attr({id:t[0].id+"_popup"}).appendTo($("body"));showModal(e[0].id)},closeAll:function(t){this.forEachPro(function(e){t.close!==e&&e.call(this,t)},"close")},eventFilterTask:function(t,e){var n=!0;return this.forEachPro(function(i){n&&(n=i(t,e))},"filterTask"),n}}),window.ysy=window.ysy||{},ysy.pro=ysy.pro||{},ysy.pro.problemFinder=EasyGem.extend(ysy.pro.problemFinder,{patch:function(){var t=new ysy.data.Data;t.init({_name:"Problem finder",opened:!1,issueProblems:[],relationProblems:[]}),ysy.settings.problemFinder=t,ysy.data.issues.childRegister(function(){ysy.pro.problemFinder.recalculateProblemsInIssues.call(this),ysy.pro.problemFinder.recalculateProblemsInRelations.call(this)},t),ysy.data.relations.childRegister(this.recalculateProblemsInRelations,t),ysy.data.issues.register(this.recalculateProblemsInIssues,t),ysy.data.projects.register(this.recalculateProblemsInIssues,t),ysy.data.relations.register(this.recalculateProblemsInRelations,t),ysy.proManager.register("close",this.close),ysy.view.AllButtons.prototype.extendees.problem_finder={widget:ysy.view.ProblemFinder,bind:function(){this.model=t},func:function(){this.model.setSilent({opened:!this.model.opened}),this.model._fireChanges(this,"open problem list")},isOn:function(){return this.model.opened},isHidden:function(){return 0===this.problemCount()}}},recalculateProblemsInIssues:function(){var t=[],e=ysy.data.issues.getArray();ysy.settings.projectProgress&&(e=e.concat(ysy.data.projects.getArray()));for(var n=0;n<e.length;n++){var i=e[n],s=i.getProblems();if(s)for(var a=0;a<s.length;a++)t.push({entity:i,text:s[a]})}this.issueProblems=t,this._fireChanges(this,"issues problems recalculated")},recalculateProblemsInRelations:function(){for(var t=[],e=ysy.data.relations.getArray(),n=0;+n<e.length;n++){var i=e[n],s=i.getProblems();if(s)for(var a=0;a<s.length;a++)t.push({relation:i,text:s[a]})}this.relationProblems=t,this._fireChanges(this,"relations problems recalculated")},close:function(t){ysy.settings.problemFinder.setSilent({opened:!1}),ysy.settings.problemFinder._fireChanges(t,"event close")},scrollToEntity:function(t){gantt._pull[t]&&(gantt.selectTask(t),gantt.showTask(t))}}),ysy.view.ProblemFinder=function(){ysy.view.Widget.call(this),this.listIsHidden=!0},ysy.main.extender(ysy.view.Button,ysy.view.ProblemFinder,{templateName:"ProblemFinder",elementPrefix:"button_",outerClickBind:!1,specialRepaint:function(t){if(!t||!this.listIsHidden){var e=$("#gantt_problem_list");if(t)return e.hide(),void(this.listIsHidden=!0);var n=Mustache.render(ysy.view.getTemplate(this.templateName),{count:this.problemCount()});if(this.$target.html(n),this.model.opened){if(!e.length){var i=$("#button_problem_finder"),s=i.position().top,a=Math.min($(window).height()-105-s,$("#easy_gantt").height()-95);e=$('<div id="gantt_problem_list" class="gantt-menu-problems-list"></div>').insertAfter(i).css({maxHeight:a+"px"})}this.bindOuterClick(),n=Mustache.render(ysy.view.getTemplate(this.templateName+"List"),this.out()),e.html(n).show(),this.listIsHidden=!1}else e.hide(),this.listIsHidden=!0}},out:function(){for(var t=[],e=[],n=this.model.issueProblems,i=0;i<n.length;i++){var s=n[i];t.push({isProject:s.entity.isProject,name:s.entity.name,text:s.text,entityId:s.entity.getID()})}var a=ysy.data.issues;for(n=this.model.relationProblems,i=0;i<n.length;i++){s=n[i];var r=a.getByID(s.relation.source_id),o=a.getByID(s.relation.target_id);e.push({sourceName:r?r.name:"#"+s.relation.source_id,targetName:o?o.name:"#"+s.relation.target_id,text:s.text,entityId:s.relation.target_id})}return{entities:t,relations:e}},problemCount:function(){return this.model.issueProblems.length+this.model.relationProblems.length},bindOuterClick:function(){if(!this.outerClickBind){var t=this;$(document).on("click.problem_finder",function(e){e&&$(e.target).closest("#gantt_problem_list").length||($(document).off("click.problem_finder"),t.outerClickBind=!1,ysy.pro.problemFinder.close(t))}),this.outerClickBind=!0}}}),window.ysy=window.ysy||{},ysy.gateway||(ysy.gateway={}),EasyGem.extend(ysy.gateway,{requestsGroups:{},temp:{retry:!1,superSuccess:null,superFail:null,fails:0},sendIssue:function(t,e,n,i){var s=3;"REPAIR"===t&&(t="PUT",s=9);var a=ysy.settings.paths["issue"+t];if(a){var r=a.replace(":issueID",e);this.prepare({priority:s,method:t,url:r,data:n,callback:i,issueID:e})}},sendRelation:function(t,e,n,i){var s=ysy.settings.paths["relation"+t];if(s){var a=s.replace(":issueID",e.source_id).replace(":projectID",e.getSource().project_id).replace(":relaID",e.id),r={DELETE:1,POST:6,PUT:6};this.prepare({priority:r[t],method:t,url:a,data:n,callback:i,relation:e})}},sendMilestone:function(t,e,n,i){var s=ysy.settings.paths["version"+t];if(s){var a=s.replace(":versionID",e.id).replace(":projectID",e.project_id);this.prepare({priority:2,method:t,url:a,data:n,callback:i,milestone:e})}},sendProject:function(t,e,n,i){var s=ysy.settings.paths["project"+t];if(s){var a=s.replace(":projectID",e.id);this.prepare({priority:10,method:t,url:a,data:n,callback:i,project:e})}},prepare:function(t){this.requestsGroups||(this.requestsGroups={});var e=t.priority;this.requestsGroups[e]||(this.requestsGroups[e]=[]),this.requestsGroups[e].push(t),ysy.log.debug("prepared "+t.method+" "+t.url,"supersend")},send:function(t){ysy.log.debug(t.method+" "+t.url+" "+JSON.stringify(t.data),"send");var e=$.ajax({url:t.url,type:t.method,dataType:"text",data:t.data});return e.done(function(e){t.callback&&t.callback(e);var n=ysy.gateway.temp;return n.successes++,t.passed=!0,n.retry=!0,!0}).fail(function(e){var n=ysy.gateway.temp;if(n.allOk=!1,n.fails++,e.responseText)try{var i=JSON.parse(e.responseText);i.errors.length&&(t.errorMessage=i.errors[0])}catch(s){t.errorMessage=e.responseText}t.errorStatus=e.statusText}).always(ysy.gateway._process),e},fireSend:function(t,e){var n=[],i=Object.getOwnPropertyNames(this.requestsGroups);if(0!==i.length){for(var s=[],a=0;a<i.length;a++)s.push(parseFloat(i[a]));for(s.sort(),a=0;a<s.length;a++)n=n.concat(this.requestsGroups[s[a]]);ysy.log.debug("_fireSend() ","supersend"),this.temp={requestList:n,superSuccess:t,superFail:e,retry:!0},this._fireRetry()}else t()},_fireRetry:function(){var t=ysy.gateway.temp;return t.allOk?(ysy.log.debug("superSuccess triggered","supersend"),t.superSuccess&&t.superSuccess(),void(this.requestsGroups={})):t.retry?(ysy.log.debug("_fireRetry() ","supersend"),$.extend(t,{pointer:0,fails:0,successes:0,retry:!1,allOk:!0}),void this._fireOne()):(ysy.log.debug("superFail triggered","supersend"),t.superFail&&t.superFail(this.gatherErrors()),void(this.requestsGroups={}))},_fireOne:function(){var t=this.temp;if(t.pointer>=t.requestList.length)this._fireRetry();else{var e=t.requestList[t.pointer];t.pointer++,e&&!e.passed?this.send(e):this._fireOne()}},_process:function(){var t=ysy.gateway.temp;ysy.log.debug("AJAX _process (p="+t.pointer+",s="+t.successes+",f="+t.fails+")","supersend"),ysy.gateway._fireOne()},gatherErrors:function(){var t=[],e=this.temp.requestList;if(e&&0!==e.length){for(var n=0;n<e.length;n++){var i=e[n];if(!i.passed){var s,a,r=null;if(i.issueID||i.data&&i.data.issue){r="issue";var o=ysy.data.issues.getByID(i.issueID);a=o?'"'+o.name+'"':i.data&&i.data.issue?'"'+i.data.issue.subject+'"':"#"+i.issueID}else if(i.project)r="project",a='"'+i.project.name+'"';else if(i.milestone)r="milestone",a='"'+i.milestone.name+'"';else if(i.relation){r="relation";var d=i.relation.getSource(),l=i.relation.getTarget();a='"'+d.name+'" - "'+l.name+'"'}s=r?ysy.settings.labels.gateway.entitySaveFailed.replace("%{entityName}",a).replace("%{entityType}",ysy.settings.labels.types[r]):i.method+" "+i.url.substr(0,i.url.indexOf("?"))+" - "+i.errorStatus,i.errorMessage?s+=": "+i.errorMessage:r&&(s+=": "+i.errorStatus),t.push(s)}}return t}},polymorficGet:function(t,e,n,i){t&&$.get(t,e).done(n).fail(i)},polymorficGetJSON:function(t,e,n,i){t&&$.getJSON(t,e).done(n).fail(i)},polymorficPostJSON:function(t,e,n,i){t&&$.ajax({url:t,type:"POST",data:e,dataType:"json"}).done(n).fail(i)},polymorficPost:function(t,e,n,i,s){t&&$.ajax({url:t,type:"POST",data:n,dataType:"text"}).done(i).fail(s)},polymorficPut:function(t,e,n,i,s){t&&$.ajax({url:t,type:"PUT",data:JSON.stringify(n),contentType:"application/json",dataType:"text"}).done(i).fail(s)},polymorficDelete:function(t,e,n,i){t&&$.ajax({url:t,type:"DELETE",dataType:"json"}).done(n).fail(i)}}),ysy.data=ysy.data||{},ysy.data.save=function(){let t=!1;ysy.pro.unfixRelations&&ysy.settings.unfixRelations&&ysy.settings.unfixRelations.active&&(ysy.pro.unfixRelations.close(),t=!0),ysy.data.saver.sendIssues(),ysy.data.saver.sendRelations(),ysy.data.saver.sendMilestones(),ysy.data.saver.sendProjects(),ysy.gateway.fireSend(ysy.data.saver.afterSaveSuccess,ysy.data.saver.afterSaveFail,!0),t&&ysy.pro.unfixRelations.open()},ysy.data.saver={_name:"Saver",sendIssues:function(){var t,e,n=ysy.data.issues.array;for(t=0;t<n.length;t++){var i=n[t];if(i._changed&&(!i._deleted||!i._created))if(i._deleted)ysy.gateway.sendIssue("DELETE",i.id,null,callbackBuilder(i));else if(i._created){for(var s in e={issue:{}},i)i.hasOwnProperty(s)&&(ysy.main.startsWith(s,"_")||(e.issue[s]=i[s]));delete e.issue.name,delete e.issue.id,delete e.issue.end_date,$.extend(e.issue,{subject:i.name,start_date:i.start_date?i.start_date.format("YYYY-MM-DD"):undefined,due_date:i.end_date?i.end_date.format("YYYY-MM-DD"):undefined});var a=ysy.data.saver.constructParentData(i);ysy.settings.showTasksSpentTimeRatio&&delete e.done_ratio,$.extend(e.issue,a),ysy.gateway.sendIssue("POST",null,e,this.callbackBuilder(i))}else{for(s in e={},i)i.hasOwnProperty(s)&&(ysy.main.startsWith(s,"_")||(e[s]=i[s]));if(delete e.end_date,delete e.columns,ysy.settings.showTasksSpentTimeRatio&&delete e.done_ratio,$.extend(e,{start_date:i.start_date?i.start_date.format("YYYY-MM-DD"):undefined,due_date:i.end_date?i.end_date.format("YYYY-MM-DD"):undefined}),ysy.proManager.fireEvent("beforeSaveIssue",e),null===(e=i.getDiff(e))){this.callbackBuilder(i)();continue}ysy.gateway.sendIssue("PUT",i.id,{issue:e},this.callbackBuilder(i))}}},sendRelations:function(){var t,e,n=ysy.data.relations.array,i={};for(t=0;t<n.length;t++){var s=n[t];if(s._changed&&(!s._deleted||!s._created))if(s._deleted)ysy.gateway.sendRelation("DELETE",s,null,this.callbackBuilder(s));else{s._created?(e={relation:{issue_to_id:s.target_id,relation_type:s.type,delay:s.delay},project_id:s.getTarget().project_id},ysy.gateway.sendRelation("POST",s,e,this.callbackBuilder(s))):(e={delay:s.delay},ysy.gateway.sendRelation("PUT",s,e,this.callbackBuilder(s)));var a=s.getTarget();i[a.id]=a}}for(var r in i)if(i.hasOwnProperty(r)){var o={issue:{start_date:(a=i[r]).start_date?a.start_date.format("YYYY-MM-DD"):undefined,due_date:a.end_date?a.end_date.format("YYYY-MM-DD"):undefined}};ysy.gateway.sendIssue("REPAIR",a.id,o,null)}},sendMilestones:function(){var t,e,n=ysy.data.milestones.array;for(t=0;t<n.length;t++){var i=n[t];i._changed&&(i._deleted&&i._created||(i._deleted?ysy.gateway.sendMilestone("DELETE",i,null,this.callbackBuilder(i)):i._created?(e={version:{name:i.name,status:i.status,sharing:i.sharing,description:i.description,due_date:i.start_date.format("YYYY-MM-DD"),easy_version_category_id:i.easy_version_category_id}},i.custom_field_values&&(e.version.custom_field_values=i.custom_field_values),ysy.gateway.sendMilestone("POST",i,e,this.callbackBuilder(i))):(e={version:{due_date:i.start_date.format("YYYY-MM-DD")}},ysy.gateway.sendMilestone("PUT",i,e,this.callbackBuilder(i)))))}},sendProjects:function(){},callbackBuilder:function(t){return function(e){var n=t.name||t._name;if(ysy.log.debug(n+" sended","send"),e){try{var i=JSON.parse(e)}catch(a){}if(i){var s=i.issue||i.project||i.version||i.relation;s&&(t.setSilent({id:s.id,_created:!1}),t._fireChanges(ysy.data.saver,"afterPOST set"))}}t._changed=!1}},constructParentData:function(t){var e,n={parent_issue_id:null,fixed_version_id:null,project_id:t.project_id};return t.parent_issue_id?(n.parent_issue_id=t.parent_issue_id,(e=ysy.data.issues.getByID(t.parent_issue_id))&&(n.fixed_version_id=e.fixed_version_id)):t.fixed_version_id&&(n.fixed_version_id=t.fixed_version_id),n},afterSaveSuccess:function(){dhtmlx.message(ysy.view.getLabel("gateway","allSended"),"notice",2e3),ysy.data.loader.load()},afterSaveFail:function(t){for(var e="<p>"+ysy.view.getLabel("gateway","sendFailed")+"</p><ul>",n=0;n<t.length;n++)e+="<li>"+t[n]+"</li>";dhtmlx.message(e+"</ul>","error"),ysy.data.loader.load()}},window.ysy=window.ysy||{},ysy.data=ysy.data||{},ysy.data.storage=ysy.data.storage||{},EasyGem.extend(ysy.data.storage,{_scope:"easy-gantt-",zoomKey:"zoom",init:function(){ysy.settings.zoom.register(function(){this.saveSessionData(this.zoomKey,ysy.settings.zoom.zoom)},this)},getSavedZoom:function(){return this.getSessionData(this.zoomKey)},saveCookie:function(t,e){$.cookie(this._scope+t,e,{expires:3650,path:"/"})},getCookie:function(t){return $.cookie(this._scope+t)},saveSessionData:function(t,e){window.sessionStorage.setItem(this._scope+t,e)},getSessionData:function(t){return window.sessionStorage.getItem(this._scope+t)},savePersistentData:function(t,e){window.localStorage.setItem(this._scope+t,e)},getPersistentData:function(t){return window.localStorage.getItem(this._scope+t)}}),window.ysy=window.ysy||{},ysy.pro=ysy.pro||{},ysy.pro.sumRow=ysy.pro.sumRow||{},EasyGem.extend(ysy.pro.sumRow,{summers:{count:{day:function(t,e){return e._start_date.isAfter(t)?0:e._end_date.isBefore(t)?0:1},week:function(t,e,n){return n._start_date.isAfter(e)?0:n._end_date.isBefore(t)?0:1},entities:["issues"],title:"Count"}},patch:function(){$.extend(ysy.settings.sumRow,{summerArray:[],setSummer:function(t){if(ysy.pro.sumRow.summers[t]){var e=this.summerArray.indexOf(t);-1!==e&&this.summerArray.splice(e,1),this.summerArray.push(t),this.setSilent({active:!0,summer:t}),this._fireChanges(this,"setSummer to "+t)}},removeSummer:function(t){var e=this.summerArray.indexOf(t);-1!==e&&this.summerArray.splice(e,1),0===this.summerArray.length?this.setSilent({active:!1,summer:!1}):this.setSilent({active:!0,summer:this.summerArray[this.summerArray.length-1]}),this._fireChanges(this,"removeSummer "+t)}})}}),ysy.view=ysy.view||{},ysy.view.SumRow=function(){ysy.view.Widget.call(this),this.temper={values:[]}},ysy.main.extender(ysy.view.Widget,ysy.view.SumRow,{name:"SumRowWidget",_postInit:function(){ysy.data.issues.childRegister(this.invalidateIssues,this),ysy.data.projects.childRegister(this.invalidateProjects,this),ysy.data.issues.register(this.invalidateIssues,this),ysy.data.projects.register(this.invalidateProjects,this),gantt.attachEvent("onGanttRender",$.proxy(this.requestRepaint,this))},nopeFormatter:function(){return""},invalidateProjects:function(){this.summer&&this.summer.entities&&this.summer.entities.indexOf("projects")>-1&&this.requestRepaint()},invalidateIssues:function(){this.summer&&(!this.summer.entities||this.summer.entities.indexOf("issues")>-1)&&this.requestRepaint()},getSubScale:function(t){var e=ysy.pro.sumRow.summers[ysy.settings.sumRow.summer];if(e){ysy.log.debug("getSubScale for "+e.title,"summer"),this.summer=e,this.updateTemper();var n=this.temper,i=this.nopeFormatter;return n.values&&(i=e.formatter?function(i){var s=-n.minDate.diff(i,t);return s<0||s>n.valuesLength?"":e.formatter(n.values[s],n.widths[s])}:function(e){var i=-n.minDate.diff(e,t);return i<0||i>n.valuesLength?"":n.values[i]}),{step:1,className:"gantt-sum-row",unit:t,template:i}}},getSummerFunction:function(t){return"day"===t?this.summer.day:this.summer.week},getEntities:function(){if(!this.summer)return null;for(var t=this.summer.entities||["issues"],e=[],n=0;n<t.length;n++)e=e.concat(ysy.data[t[n]].getArray());return e},_repaintCore:function(){if(ysy.settings.sumRow.active){ysy.log.debug("sumRow repaintCore","summer");var t=ysy.pro.sumRow.summers[ysy.settings.sumRow.summer];if(t){this.summer=t,this.updateTemper(this.calculateSums(ysy.settings.zoom.zoom));var e=$(".gantt_scale_line.gantt-sum-row"),n=gantt.config,i=gantt._get_resize_options().x?Math.max(n.autosize_min_width,0):gantt.$task.offsetWidth,s=gantt._scale_helpers.prepareConfigs([this.getSubScale(ysy.settings.zoom.zoom)],n.min_column_width,i,n.scale_height-1),a=gantt._prepare_scale_html(s[0]);e.html(a)}}},updateTemper:function(t){t&&(this.temper.values=t,this.temper.valuesLength=t.length),this.temper.minDate=moment(gantt._min_date),this.temper.widths=gantt._tasks.width},calculateSums:function(t){var e=this.getSummerFunction(t),n=[],i=moment(gantt._min_date),s=moment(gantt._max_date),a=this.getEntities();if("day"===t)for(;i.isBefore(s);){for(var r=0,o=0;o<a.length;o++)r+=e(i,a[o]);n.push(r),i.add(1,t)}else for(var d=moment(i).add(1,t);i.isBefore(s);){for(r=0,o=0;o<a.length;o++)r+=e(i,d,a[o]);n.push(r),i.add(2,t);var l=i;i=d,d=l}return n}}),window.ysy=window.ysy||{},ysy.pro=ysy.pro||{},ysy.pro.toolPanel=ysy.pro.toolPanel||{},EasyGem.extend(ysy.pro.toolPanel,{_name:"ToolPanel",extendees:[],initToolbar:function(t){var e=new ysy.view.ToolPanel;e.init(ysy.settings.toolPanel),t.children.push(e)},patch:function(){var t=ysy.settings.toolPanel=new ysy.data.Data;t.init({_name:"ToolPanel",buttonIds:[],buttons:{},registerButtonSilent:function(t){if(t.id===undefined)throw"Missing id for button";this.buttons[t.id]=t,this.buttonIds.push(t.id)}}),ysy.proManager.register("initToolbar",this.initToolbar);for(var e=0;e<this.extendees.length;e++){var n=this.extendees[e];n.isRemoved&&n.isRemoved()||t.registerButtonSilent(n)}t._fireChanges(this,"delayed registerButton"),delete this.extendees},registerButton:function(t){t.isRemoved&&t.isRemoved()||(ysy.settings.toolPanel?(ysy.settings.toolPanel.registerButtonSilent(t),ysy.settings.toolPanel._fireChanges(this,"direct registerButton")):this.extendees.push(t))}}),ysy.view.ToolPanel=function(){ysy.view.Widget.call(this)},ysy.main.extender(ysy.view.Widget,ysy.view.ToolPanel,{name:"ToolPanelWidget",templateName:"ToolButtons",_postInit:function(){var t=$("#easy_gantt_tool_panel");t.find("a:not([href])").attr("href","javascript:void(0)"),t.find("li > *").hide()},_updateChildren:function(){for(var t=this.model,e=[],n=0;n<t.buttonIds.length;n++){var i,s=t.buttonIds[n],a=t.buttons[s];i=a.widget?new a.widget:new ysy.view.Button,$.extend(i,a),i.init(),e.push(i)}this.children=e},_repaintCore:function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];this.setChildTarget(e,t),e.repaint(!0)}},setChildTarget:function(t){var e="#"+t.elementPrefix+t.id;if(["#select_scheme_select"].indexOf(e)>-1)t.$target=$("<div>");else{var n=this.$target.find(e);if(0===n.length)throw"element #"+t.elementPrefix+t.id+" missing";t.$target=n}}}),window.ysy=window.ysy||{},ysy.view=ysy.view||{},ysy.view.tooltip=EasyGem.extend(ysy.view.tooltip,{instance:null,show:function(t,e,n,i){return this.instance||(this.instance=(new ysy.view.ToolTip).init()),this.instance.set(t,e,n,i)},hide:function(){return!!this.instance&&this.instance.hide()},changePos:function(t){if(this.instance)return this.instance.changePos(t)}}),ysy.view.taskTooltip=EasyGem.extend(ysy.view.taskTooltip,{timeout:0,timeoutTime:250,phase:1,taskTooltipInit:function(){var t=this;$("#content").on("mouseenter",".gantt_task_content, .gantt_task_progress, .gantt-task-tooltip-area",function(e){1===t.phase&&(ysy.log.debug("mouseenter","tooltip"),0===e.buttons&&(t.phase=2,t.bindHiders(e.target),t.updatePos(e)))})},bindHiders:function(t){t.addEventListener("mouseleave",this.hideTooltip),t.addEventListener("mousedown",this.hideTooltip),t.addEventListener("mousemove",this.updatePos)},hideTooltip:function(t){var e=ysy.view.taskTooltip;e.phase=1,e.lastPos=null,e.timeout&&clearTimeout(e.timeout),ysy.view.tooltip.hide()&&(t.target.removeEventListener("mouseleave",this.hideTooltip),t.target.removeEventListener("mousedown",this.hideTooltip),t.target.removeEventListener("mousemove",this.updatePos))},updatePos:function(t){var e=ysy.view.taskTooltip;if(1!==e.phase){var n=!1;e.lastPos?(Math.abs(e.lastPos.clientX-t.clientX)>5&&(e.lastPos.clientX=t.clientX,n=!0),Math.abs(e.lastPos.clientY-t.clientY)>5&&(e.lastPos.clientY=t.clientY,n=!0)):(e.lastPos={clientX:t.clientX,clientY:t.clientY},n=!0),3===e.phase&&n?e.hideTooltip(t):(e.lastPos.target=t.target,n&&(e.timeout&&window.clearTimeout(e.timeout),e.timeout=window.setTimeout(function(){e.showTaskTooltip(e.lastPos)},e.timeoutTime)))}},showTaskTooltip:function(t){var e=this;if(2===e.phase){var n=gantt._pull[gantt.locate(t)];if(n){if(e.phase=3,null!==t.target.parentElement.parentElement){var i=$(t.target).offset();return ysy.view.tooltip.show("gantt-task-tooltip",{clientX:t.clientX,clientY:t.clientY,top:i.top+gantt.config.row_height},ysy.view.templates.TaskTooltip,e.taskTooltipOut(n))}e.phase=1}}},taskTooltipOut:function(t){var e,n=t.widget.model,i=n.getProblems(),s=[],a=500;const r=t.duration;if(n.milestone)return n.isShared&&(s=[{name:"shared-from",label:"Shared from project",value:ysy.main.escapeText(n.real_project_name)}]),{name:n.name,end_date:n._noDate?ysy.settings.labels.label_not_available:n.start_date.format(gantt.config.date_format),columns:s,duration:r};for(var o=gantt.config.columns,d=["subject","start_date","end_date","due_date"],l=0;l<o.length;l++){var h=o[l];if(d.indexOf(h.name)<0){var c=h.template(t);if(!c)continue;0===c.indexOf("<")&&(c=$(c).html()),s.push({name:h.name,label:h.label,value:c})}}if(n.fixed_version_id)var u=ysy.data.milestones.getByID(n.fixed_version_id);return n.description&&(e=this.strip(n.description),n.description.length>=a&&(e=`${e.substr(0,a)} ...`)),{name:n.name,start_date:n.start_date?n.start_date.format(gantt.config.date_format):ysy.settings.labels.label_not_available,end_date:n.end_date?n.end_date.format(gantt.config.date_format):ysy.settings.labels.label_not_available,milestone:u,columns:s,problems:i,description:e||"",duration:r}},strip:function(t){return(new DOMParser).parseFromString(t,"text/html").body.textContent||""}}),ysy.view.ToolTip=function(){ysy.view.Widget.call(this)},ysy.main.extender(ysy.view.Widget,ysy.view.ToolTip,{name:"ToolTip",init:function(){var t=this.$target=$("<div id='gantt_tooltip' style='display: none'></div>").appendTo("#content");return t.on("mouseleave",function(){t[0].style.display="none"}),document.addEventListener("click",this.checkOutterClick.bind(null,t)),ysy.view.onRepaint.push($.proxy(this.repaint,this)),this},set:function(t,e,n,i){return this.className=t||this.className,this.event=e||this.event,this.template=n||this.template,this.outed=i,this.repaintRequested=!0,this.$target},hide:function(){return this.$target[0].style.display="none",!0},changePos:function(t){var e=t.clientX,n=t.top;t.clientY+this.elementHeight>window.innerHeight&&(n-=this.elementHeight+gantt.config.row_height+4),t.clientX+this.elementWidth>window.innerWidth&&(e-=this.elementWidth),this.$target[0].style.cssText="display: flex; left: "+e+"px; top: "+n+"px"},_repaintCore:function(){this.$target.html(Mustache.render(this.template,this.outed)),this.$target[0].style.display="flex",this.$target[0].className="gantt-tooltip "+this.className,this.elementWidth=this.$target.outerWidth(),this.elementHeight=this.$target.outerHeight();var t=this.event;return t&&this.changePos(t),!1},checkOutterClick(t,e){const n=t[0];"none"!==n.style.display&&(e.target.closest(`#${n.id}`)||(n.style.display="none"))}}),window.ysy=window.ysy||{},ysy.view=ysy.view||{},EasyGem.extend(ysy.view,{onRepaint:[],patch:function(){this.applyGanttRewritePatch(),this.addGanttAddons(),this.applyGanttPatch(),window.initEasyAutocomplete||(window.initEasyAutocomplete=function(){}),ysy.settings.easyRedmine&&0===$("#content").children(".easy-content-page").length&&$("#easy_gantt").addClass("easy-content-page")},start:function(){this.labels=ysy.settings.labels,(new ysy.view.Main).init(ysy.data.projects),this.anim()},anim:function(){for(var t=ysy.view,e=0;e<t.onRepaint.length;e++)t.onRepaint[e]();window.requestAnimationFrame(t.anim)},getTemplate:function(t){return this.templates[t]},getLabel:function(){for(var t=this.labels,e=0;e<arguments.length;e++){var n=arguments[e];if(!t[n])return t;t=t[n]}return t}});