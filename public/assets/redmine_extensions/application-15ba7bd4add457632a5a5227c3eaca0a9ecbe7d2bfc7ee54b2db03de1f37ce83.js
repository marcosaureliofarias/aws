window.EasyToggler=new function(){var e=JSON.parse(localStorage.getItem("easy-toggle-state")||"{}"),t=function(){return localStorage.setItem("easy-toggle-state",JSON.stringify(e)),e},i=function(e){return e&&"none"===e.style.display},n=function(e){var n=e.parentNode;return n.classList.toggle("collapsed"),e.style.display=i(e)?"block":"none",e.id&&n.dataset.toggle&&t(),$(document).trigger("erui_interface_change_vertical"),e};this.toggle=function(t,s){if(!s||"A"!==s.target.tagName){var o="object"==typeof t?t:document.getElementById(t),a=o.id;a&&(e[a]?delete e[a]:e[a]=i(o)?0:1),n(o)}},this.ensureToggle=function(){for(var t=document.querySelectorAll("*[data-toggle]"),i=0;i<t.length;++i){var s=t.item(i),o=document.getElementById(s.dataset.toggle);e[s.dataset.toggle]&&n(o)}return this}},EASY.schedule.main(EasyToggler.ensureToggle),function(e){"use strict";function t(t,s){this.element=t,this.options=e.extend({},n,s),this._defaults=n,this._name=i,this.init()}var i="entityArray",n={propertyName:"value"};t.prototype={init:function(){var t=this;this.entities={},this.element.addClass("entity-array"),this.createEmptyInput(),this.options.entities&&e.each(this.options.entities,function(){t.add(this)})},add:function(t){var i=this;return this.normalizeEntityData(t),!t.id||""===t||this.entities[t.id]?null:(t.element=e("<span/>").text(t.name).addClass(t.className||this.options.className).appendTo(this.element).after(" "),e("<input/>").attr("type","hidden").attr("name",this.options.inputNames).val(t.id).appendTo(t.element),e("<span/>").html("&nbsp;").addClass("icon icon-del").appendTo(t.element).data("entity-id",t.id).click(function(){i.removeEntity(e(this).data("entity-id"))}),this.entities[t.id]=t,this.removeEmptyInput(),t)},removeEntity:function(e){var t=this.entities[e];t.element.remove(),delete this.entities[e],0===Object.keys(this.entities).length&&this.createEmptyInput(),"function"==typeof this.options.afterRemove&&this.options.afterRemove(t)},clear:function(){for(var e in this.entities)this.removeEntity(e)},getValue:function(){return Object.keys(this.entities)},normalizeEntityData:function(e){e.id=e.id.toString(),e.name=e.name.toString()},createEmptyInput:function(){this.emptyInput=e("<input/>").attr("type","hidden").attr("name",this.options.inputNames).appendTo(this.element)},removeEmptyInput:function(){this.emptyInput&&(this.emptyInput.remove(),this.emptyInput=null)}},e.fn[i]=function(n,s){var o=null;return this.each(function(){var a=e.data(this,"plugin_"+i);a?o=a[n].call(a,s):e.data(this,"plugin_"+i,new t(e(this),n))}),null!==o?o:this}}(jQuery,window,document),EasyGem.schedule.require(function(e){var t,i=function(n){t&&(window.requestAnimationFrame(i,n),e.fx.tick())};e.fx.timer=function(n){n()&&e.timers.push(n)&&!t&&(t=!0,i(n.elem))},e.fx.stop=function(){t=!1}},"jQuery"),window.REDMINE_EXTENSIONS={toggleDiv:function(e){("string"==typeof e?$("#"+e):e).toggleClass("collapsed").slideToggle("fast")},toggleDivAndChangeOpen:function(e,t){REDMINE_EXTENSIONS.toggleDiv(e),$(t).toggleClass("open")},toggleFilterButtons:function(e,t,i){var n=$("#"+e),s=$("#"+t),o=$("#"+i);s.hasClass("collapsed")&&o.hasClass("collapsed")?n.slideUp("slow"):n.slideDown("slow")}},window.showFlashMessage=function(e,t,i){var n=$("#content");n.find(".flash").remove();var s=document.createElement("div");s.className="fixed flash "+e,s.style.position="fixed",s.style.zIndex="10001",s.style.right="5px",s.style.top="5px",s.setAttribute("onclick","closeFlashMessage($(this))");var o=document.createElement("a");o.className="icon-close close-icon",o.setAttribute("href","javascript:void(0)"),o.style.float="right",o.style.marginLeft="5px";var a=document.createElement("span");a.innerHTML=t,s.appendChild(o),s.appendChild(a),n.prepend(s);var l=$(s);return i&&setTimeout(function(){window.requestAnimationFrame(function(){closeFlashMessage(l)})},i),l},window.closeFlashMessage=function(e){e.closest(".flash").fadeOut(500,function(){e.remove()})},EasyGem.schedule.require(function(){$.widget("easy.easymultiselect",{options:{source:null,rootElement:null,selected:null,multiple:!0,preload:!0,position:{collision:"flip"},autofocus:!1,combo:!1,inputName:null,render_item:function(e,t){return $("<li>").data("item.autocomplete",t).text(t.label).appendTo(e)},activate_on_input_click:!0,load_immediately:!1,show_toggle_button:!0,select_first_value:!0,autocomplete_options:{},multiselectOnChange:null},_create:function(){this.selectedValues=this.options.selected,this._createUI(),this.expanded=!1,this.valuesLoaded=!1,this.afterLoaded=[],Array.isArray(this.options.source)?(this.options.preload=!0,this._initData(this.options.source)):this.options.preload&&this.options.load_immediately?this.load():this.selectedValues&&this.setValue(this.selectedValues)},_createUI:function(){var e=this;this.element.wrap('<span class="easy-autocomplete-tag"></span>'),this.tag=this.element.parent(),this.inputName=this.options.inputName||this.element.prop("name"),this.options.multiple?(this.valueElement=$("<span></span>"),this.tag.after(this.valueElement),this.options.show_toggle_button&&this._createToggleButton(),this.valueElement.entityArray({inputNames:this.inputName,afterRemove:function(){e.element.trigger("change")}})):(this.valueElement=$("<input>",{type:"hidden",name:this.inputName}),this.element.after(this.valueElement)),this._createAutocomplete(),this.options.multiple||this.element.css("margin-right",0)},setMultiselectOnChange:function(e){this.options.multiselectOnChange=e},multiselectOnChange:function(e,t){t&&e.on("change",t)},_createToggleButton:function(){var e=this;this.link_ac_toggle=$("<a>").attr("class","icon icon-add clear-link"),this.link_ac_toggle.click(function(t){var i=$(this);t.preventDefault(),e.load(function(){var t,n=$("<select>").prop("multiple",!0).prop("size",5).prop("name",e.inputName);$.each(e.possibleValues,function(i,s){(t=$("<option>").prop("value",s.id).text(s.value)).prop("selected",e.getValue().indexOf(s.id)>-1),n.append(t)}),e.multiselectOnChange(n,e.options.multiselectOnChange);var s=i.closest(".easy-multiselect-tag-container");s.find(":input").prop("disabled",!0),s.children().hide(),s.append(n),e.valueElement=n,e.expanded=!0})}),this.element.parent().addClass("input-append"),this.element.after(this.link_ac_toggle)},_createAutocomplete:function(){var e=this;e.element.autocomplete($.extend({source:function(t,i){e.options.preload?e.load(function(){var n=new RegExp($.ui.autocomplete.escapeRegex(t.term),"i");i($.grep(e.possibleValues,function(e){return!t.term||n.test(e.value)}))},function(){i()}):"function"==typeof e.options.source?e.options.source(function(t){i(e.options.rootElement?t[e.options.rootElement]:t)}):$.getJSON(e.options.source,{term:t.term},function(t){i(e.options.rootElement?t[e.options.rootElement]:t)})},minLength:0,select:function(t,i){return e.selectValue(i.item),!1},change:function(t,i){i.item||(e.options.combo?($(this).val(e.element.val()),e.options.multiple||(e.valueElement.val(e.element.val()),e.valueElement.change())):($(this).val(""),e.options.multiple||(e.valueElement.val(""),e.valueElement.change())))},position:this.options.position,autoFocus:this.options.autofocus},this.options.autocomplete_options)).data("ui-autocomplete")._renderItem=this.options.render_item,this.element.click(function(){$(this).select()}),this.options.activate_on_input_click&&this.element.on("click",function(){e.options.preload||e.element.focus().val(""),e.element.trigger("keydown"),e.element.autocomplete("search",e.element.val())}),$("<button type='button'>&nbsp;</button>").attr("tabIndex",-1).insertAfter(e.element).button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).removeClass("ui-corner-all").addClass("ui-corner-right ui-button-icon").css("font-size","10px").css("margin-left",-1).click(function(){if(e.element.autocomplete("widget").is(":visible"))return e.element.autocomplete("close"),void e.element.blur();$(this).blur(),e.element.focus().val(""),e.element.trigger("keydown"),e.element.autocomplete("search",e.element.val())})},_formatData:function(e){return $.map(e,function(e){var t,i;return e instanceof Array?(i=e[0],t=e[1]):e instanceof Object?(i=e.value,t=e.id):t=i=e,{value:i,id:t}})},_initData:function(e){this.possibleValues=this._formatData(e),this.valuesLoaded=!0,this.selectedValues=this.selectedValues?this.selectedValues:[],0===this.selectedValues.length&&this.options.preload&&this.options.select_first_value&&this.possibleValues.length>0&&this.selectedValues.push(this.possibleValues[0].id),this.setValue(this.selectedValues)},load:function(e,t){function i(e){var t=n.options.rootElement?e[n.options.rootElement]:e;!t&&window.console&&(console.warn("Data could not be loaded! Please check the datasource."),t=[]),n._initData(t);for(var i=n.afterLoaded.length-1;i>=0;i--)n.afterLoaded[i].call(n);n.loading=!1}var n=this;this.valuesLoaded?"function"==typeof e&&e():("function"==typeof e&&this.afterLoaded.push(e),this.loading||(this.loading=!0,"function"==typeof this.options.source?this.options.source(i):$.ajax(this.options.source,{dataType:"json",success:i,error:t}).always(function(){n.loading=!1})))},selectValue:function(e){this.options.multiple?(this.valueElement.entityArray("add",{id:e.id,name:e.value}),this.element.trigger("change"),this.element.val("")):(this.element.val(e.value),this.valueElement.val(e.id),this.valueElement.change(),this.element.change())},setValue:function(e){var t=this;if(void 0===e||!e)return!1;this.options.preload?this.load(function(){t.options.multiple&&t.valueElement.entityArray("clear"),t._setValues(e)}):(t.options.multiple&&t.valueElement.entityArray("clear"),t._setValues(e))},_setValues:function(e){var t=[];if(0===e.length)return!1;for(var i=e.length-1;i>=0;i--)if(e[i]instanceof Object&&!Array.isArray(e[i])&&null!==e[i])t.push(e[i]);else if(this.options.preload){var n=this;if(!Array.isArray(n.possibleValues))return;for(var s=n.possibleValues.length-1;s>=0;s--)if(e[i]===n.possibleValues[s].id||e[i]===n.possibleValues[s].id.toString()){t.push(n.possibleValues[s]);break}}else t.push({id:e[i],value:e[i]});for(i=t.length-1;i>=0;i--)this.options.multiple?this.valueElement.entityArray("add",{id:t[i].id,name:t[i].value}):(this.element.val(t[i].value),this.valueElement.val(t[i].id))},getValue:function(e){var t;return t=this.options.multiple&&!this.expanded?this.valueElement.entityArray("getValue"):this.options.multiple?this.valueElement.val():[this.valueElement.val()],e&&(t=this.possibleValues.filter(function(e){return t.indexOf(e.id)>=0})),t}})},"jQueryUI");