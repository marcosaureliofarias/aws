window.easyLoaders=window.easyLoaders||{},window.easyClasses=window.easyClasses||{},EasyGem.module.transform("EasyWidget",function(){return window.easyClasses.EasyWidget}),EasyGem.module.transform("ActiveClass",function(){return window.easyClasses.ActiveClass}),function(){function s(e){this.cols=[],this.kanbanRoot=e,this.oneOfGroup=!1}function t(e,s,t,i){this.issues=e,this.parent=s,this.column=t,this.agileRootModel=i}function i(e,s,t,i,o,a,n,l,r,d){this.name=e,this.entityValue=s,this.maxEntities=Number(t),this.issueList=[],this.summableString="",this.issuesList=[],this.agileRootModel=o,this.summable=i,this._isSortable=a,this.sprintId=n,this.showIssuesCount=l,this.issuesCount=r,this.phase=d}window.easyMixins=window.easyMixins||{},window.easyMixins.agile=window.easyMixins.agile||{},window.easyClasses=window.easyClasses||{},window.easyClasses.agile=window.easyClasses.agile||{},window.easyMixins.agile.root={settings:null,allIssuesMap:null,namePrefix:null,columnsData:null,changeInProgress:!1,dragDomain:null,isPageModule:!1,_preventSave:!1,middleColumnsOrdering:[],i18n:{},_loadFromParams:function(s){this.columnsData=s.columnsData,this.paramPrefix=s.update_params_prefix,this.namePrefix=s.assign_param_name,this.settings=s.settings,this.url=s.url,this.allIssuesMap=s.allIssuesMap,this.allMembersMap=s.allMembersMap,this.contextMenuUrl=s.contextMenuUrl,this.rootModel=s.rootModel,this.dragDomain=s.dragDomain,this.isPageModule=s.isPageModule,this.localStorageKey=s.localStorageKey,this.reloadAgile=s.reloadAgile,this.i18n=s.i18n||{},this.settings.issue_priorities&&(window.easyModel=window.easyModel||{},window.easyModel.issue_priorities=this.settings.issue_priorities);var t=this.settings.swimlane_categories;this.settings.swimlane_categories=t;var i=null;try{i=window.localStorage.getItem(this.localStorageKey)}catch(e){console.log("local storage error")}s.swimlane&&(i=s.swimlane);var o=function(e){return e.value===i};i&&t.some(o)?this.groupBy=i:this.groupBy="none";var a=this.columnsData,n=this.settings,l=this.allIssuesMap,r=!$.isEmptyObject(a[0]);this.isBacklog=r;var d=!$.isEmptyObject(a[2]);this.isDone=d,this._onChange=[],this.columns=this.columns||{},this.middleColumns={},this.dials={};var u,h=[];if(r){var g=a[0],c=!(g.hasOwnProperty("positioned")&&!g.positioned);u=new easyClasses.agile.AgileColumn("backlog",g.entity_value,g.max_entities,n.summable_attribute,this,c),this.backlog=new window.easyClasses.Issues,this.backlog.init(),this.backlogIssesCol=new easyClasses.agile.IssuesCol(this.backlog,null,u,this),this.backlog.register(function(e,s){null!==s&&s!==undefined&&"add"===e&&this._sendChange({},s,this.backlogIssesCol.column.entityValue)},this)}if(d){var p=a[2];c=!(p.hasOwnProperty("positioned")&&!p.positioned);var m=new easyClasses.agile.AgileColumn(p.name,p.entity_value,p.max_entities,n.summable_attribute,this,c);this.done=new window.easyClasses.Issues,this.done.init(),this.doneIssuesCol=new easyClasses.agile.IssuesCol(this.done,null,m,this),this.done.register(function(e,s){null!==s&&s!==undefined&&"add"===e&&this._sendChange({},s,this.doneIssuesCol.column.entityValue)},this)}for(var w in l)if(l.hasOwnProperty(w)){var y=l[w];r&&y.agile_column_filter_value==u.entityValue?(this.backlog.map[y.id]=y,y.issues=this.backlog):d&&y.agile_column_filter_value==m.entityValue?(this.done.map[y.id]=y,y.issues=this.done):(h.push(y),y.issues=h)}this.middleColumnsData=a[1].children;var _=new window.easyClasses.Issues;_.fromList(h),this.issues=_,r&&(u.issuesList=[this.backlog],u.recalculateTimes(),this.backlogColumn=u,this.columns[u.entityValue]=u),d&&(m.issuesList=[this.done],this.doneColumn=m,m.recalculateTimes(),this.columns[m.entityValue]=m),this.resolveSwimLanes()},_resetColumns:function(){this.columns=this.columns||{},this.middleColumnsOrdering=[];for(var e=0;e<this.middleColumnsData.length;e++){var s=this.middleColumnsData[e];this.middleColumnsOrdering.push(s.entity_value),this.columns[s.entity_value]=new easyClasses.agile.AgileColumn(s.name,s.entity_value,s.max_entities,this.settings.summable_attribute,this,!0),this.middleColumns[s.entity_value]=this.columns[s.entity_value]}},destroy:function(){this.columns=null,this.settings=null,this.saveQueue=null,this.saveInProgress=!0,this.destroyed=!0,this.dials=null,this.done&&this.done.unRegister(this),this.backlog&&this.backlog.unRegister(this)},setGroupBy:function(s){if(!this.changeInProgress){this.groupBy=s||"none";try{window.localStorage.setItem(this.localStorageKey,this.groupBy)}catch(e){console.log("swimlanes grouping cannot be saved to local storage")}this.resolveSwimLanes(s),this._fireChanges("groupBySet")}},_localStorageExpandedCache:null,isExpanded:function(s){try{var t;if(null==this._localStorageExpandedCache){if(null==(t=window.localStorage.getItem(this.localStorageKey+"_expanded"))||"undefined"==t)return this._localStorageExpandedCache={},!0;t=JSON.parse(t),this._localStorageExpandedCache=t}else t=this._localStorageExpandedCache;return!t.hasOwnProperty(s)}catch(e){return!0}},setIsExpanded:function(s,t){try{var i=window.localStorage.getItem(this.localStorageKey+"_expanded");i=null==i||"undefined"==i?{}:JSON.parse(i),t?delete i[s]:i[s]=!1,window.localStorage.setItem(this.localStorageKey+"_expanded",JSON.stringify(i)),this._localStorageExpandedCache=i}catch(e){}},isGroupBySet:function(){return null!==this.groupBy&&"none"!==this.groupBy},isSortable:function(e,s){return!(!this.doneColumn||!this.backlogColumn)&&(s===this.doneColumn.entityValue||s===this.backlogColumn.entityValue||!this.isGroupBySet()&&this.columns[s].isSortable())},resolveSwimLanes:function(){this.changeInProgress||(this.swimLanes=[],this.stickyLane=null,this._resetColumns(),this._getIssuesGroupedByColumn(),this.isGroupBySet()?this._group():this._oneSwimLane())},_oneSwimLane:function(){if(!this.changeInProgress){var e=this.addSwimLane();e.name="";for(var s=0;s<this.middleColumnsOrdering.length;s++){var t=new easyClasses.Issues,i=this.middleColumns[this.middleColumnsOrdering[s]];t.fromList(i.issueList),t.firstInGlobalColumn=!0,t.register(function(e,s,t){if(null!==s&&s!==undefined&&"add"===e){var i={};this._sendChange(i,s,t.entityValue)}},this,i),e.addCol(t,i),i.issuesList=[t]}for(s=0;s<this.middleColumnsOrdering.length;s++)this.middleColumns[this.middleColumnsOrdering[s]].recalculateTimes()}},_group:function(){if(!this.changeInProgress){var e,s,t,i={};if(this.dials.hasOwnProperty(this.groupBy)){var o=this.dials[this.groupBy];for(var a in o)o.hasOwnProperty(a)&&(i[a]=o[a]);for(s in this.middleColumns)this.middleColumns.hasOwnProperty(s)&&(this.middleColumns[s].issuesList=[]);var n=!0;for(e in i){var l=this.addSwimLane();for(l.name=i[e].name,l.order=i[e].order,l.value=e,l.iconType=this._getMemberType(i[e].id),l.oneOfGroup=!0,t=0;t<this.middleColumnsOrdering.length;t++){var r=this.middleColumns[this.middleColumnsOrdering[t]],d=new easyClasses.Issues;d.filterBy=this.groupBy,d.filterValue=e,d.firstInGlobalColumn=n,d.filterAndAdd(r.issueList),d.register(function(e,s,t){if(null!==s&&s!==undefined&&"add"===e){var i={};i[this.groupBy]=t[1].filterValue,this._sendChange(i,s,t[0].entityValue)}},this,[r,d]),r.issuesList.push(d),l.addCol(d,r)}n=!1}for(s in this.middleColumns)this.middleColumns.hasOwnProperty(s)&&this.middleColumns[s].recalculateTimes();this.addStickyLane(i),this._sortSwimlanes()}else this._fillDial()}},_getMemberType:function(e){var s=this.settings.project_members;for(var t in s)if(s[t].id==e)return s[t].type;return""},_sortSwimlanes:function(){for(var e=function(e,s){return e.order-s.order},s=[],t=[],i=0;i<this.swimLanes.length;i++){for(var o=this.swimLanes[i],a=!1,n=0;n<o.cols.length;n++)if(!$.isEmptyObject(o.cols[n].issues.map)){a=!0;break}a?t.push(o):s.push(o)}t.sort(e),s.sort(e),t.push.apply(t,s),this.swimLanes=t.slice(0,100)},_getIssuesGroupedByColumn:function(){var e,s=this.allIssuesMap;for(var t in this.middleColumns)this.middleColumns.hasOwnProperty(t)&&(this.middleColumns[t].issueList=[]);for(e in s)if(s.hasOwnProperty(e)){var i=s[e];this.middleColumns.hasOwnProperty(i.agile_column_filter_value)&&this.middleColumns[i.agile_column_filter_value].issueList.push(i)}for(e in this.middleColumns)this.middleColumns.hasOwnProperty(e)&&this.middleColumns[e].recalculateTimes()},_fillDial:function(){var e=this.groupBy;e.endsWith("_id")||(e+="_id"),this.changeInProgress=!0,$.ajax(this.settings.available_values_url,{method:"GET",data:{filter_name:e,format:"json"}}).done($.proxy(function(s){function t(){for(i=0;i<s.length;i++)a[s[i][1]]={name:s[i][0],order:i}}var i,o,a={};if("assigned_to_id"===this.groupBy)t(),a[void 0]={name:this.i18n.not_assigned};else if("fixed_version_id"===this.groupBy)t(),a[void 0]={name:this.i18n.issue_no_in_milestone};else if("parent_id"===this.groupBy){var n,l=[],r=this.allIssuesMap;for(o in r)r.hasOwnProperty(o)&&null!==r[o].parent_id&&l.push(r[o].parent_id.toString());for(i=0;i<s.length;i++)n=s[i][1],-1!==l.indexOf(n)&&(a[s[i][1]]={name:s[i][0],order:i});a[void 0]={name:this.i18n.issue_without_parent}}else if("author_id"===this.groupBy)for(i=0;i<s.length;i++)-1!==["author_id"].indexOf(e)&&"me"===s[i][1]||(a[s[i][1]]={name:s[i][0],order:i});else"category_id"===this.groupBy?(t(),a[void 0]={name:this.i18n.without_category}):t();this.dials[this.groupBy]=a,this.changeInProgress=!1,this._group(),this._fireChanges("dialDownloaded")},this)).fail($.proxy(function(){this.groupBy="none",this._oneSwimLane(),this._fireChanges("dialDownloaded")},this))},_sendChange:function(e,s,t,i=!1,o=!1,a=null){if(this._preventSave)return;let n;var l;if(this.issue=s,this.additionalData=a,this.saveQueue=this.saveQueue||[],this.saveInProgress)this.saveQueue.push([e,s,t]);else{this.saveInProgress=!0;var r={},d=this;if(e[this.namePrefix]=t,this.isSortable(s,t)&&(e.next_item_id=s.next_item_id,e.prev_item_id=s.prev_item_id),e.hasOwnProperty(d.groupBy)&&"undefined"==e[d.groupBy]&&(e[d.groupBy]=""),i||(r[d.paramPrefix]=e),r.format="json",o){const t=e.sprint_id?e.sprint_id:null;n=`${s.edit_path}?id=${t}`;const o={issue_easy_sprint_relation:{phase:-1,assigned_to_id:e.assigned_to_id}};i&&(r=Object.assign(r,o))}else n=s.edit_path;$.ajax(n,{method:"PATCH",data:r}).done(function(e){if(!d.destroyed){if(d.saveInProgress=!1,d.saveQueue.length>0){var s=d.saveQueue.shift();d._sendChange(s[0],s[1],s[2])}if(!e)return d.issue.error=!1,void d.issue._fireChanges();if(i){if(!d.additionalData&&!d.additionalData.issue&&!e.issue)return;const s=e.issue.assigned_to?e.issue.assigned_to:{},t={avatar:s.avatar?s.avatar:null,id:s.id?s.id:null,name:s.name?s.name:""};d.additionalData.issue.avatar=t.avatar,d.additionalData.issue.assigned_to=t.name,d.additionalData.issue.assigned_to_id=t.id,d.additionalData.issue.assignedUser=t,d.additionalData._repaintCore()}else{var o=d.issue;if(o.error=!1,e.issue.easy_sprint&&(o.easy_sprint_id=e.issue.easy_sprint.id),d.rootModel&&d.rootModel.allUsers&&o.newData(e.issue,d.rootModel.allUsers),d._fireChanges("issue",o.id),e.positions&&d.isSortable(n,t))for(l=0;l<e.positions.length;l++){var a=e.positions[l],n=d.allIssuesMap[a.issue_id];n&&(n.agile_column_position=a.position)}d._fireChanges("sort")}}}).fail(function(e){d._handleChangeError(s,e)})}},_handleChangeError:function(e,s){if(this.saveInProgress=!1,this.saveQueue.length>0){var t=this.saveQueue.shift();this._sendChange(t[0],t[1],t[2])}if(200===s.status)return e.error=!1,void e._fireChanges();if(e.error=!0,403===s.status)return e.errorMessage=this.i18n.not_authorized,void showFlashMessage("error",this.i18n.not_authorized);if(-1!==[422,404].indexOf(s.status)){var i=s.responseJSON;if(!i)return e.errorMessage="Unknown error on issue #"+e.id,void showFlashMessage("error",e.errorMessage);if(i.error&&(i.errors=[i.error]),i.errors){for(var o=0;o<i.errors.length;o++)e.errorMessage=i.errors[o]+" issue #"+e.id,showFlashMessage("error",e.errorMessage);if(e.undo){this._preventSave=!0;var a=e.issues;e.undo(),this._fireChanges("issues",e.issues),this._fireChanges("issues",a),this._preventSave=!1}}}else window.navigator.onLine?showFlashMessage("error",this.i18n.internal_error):showFlashMessage("error",this.i18n.you_are_offline)},sendReorder:function(e,s){var t=this;$.ajax(this.settings.reorder_path,{method:"POST",data:{phase:s.entityValue,issue_ids:e.getPositions(),format:"json"}}).done($.proxy(function(e){if(e.positions){for(var s=0;s<e.positions.length;s++){var i=e.positions[s],o=t.allIssuesMap[i.issue_id];o&&(o.agile_column_position=i.position)}t._fireChanges("sort")}},this)).fail($.proxy(function(){showFlashMessage("warning","Reorder failed - issues may jump vertical")},this))},sendBulkUpdate:function(e,s){var t=this;$.ajax(e,{method:"POST",data:{format:"json"}}).done($.proxy(function(){s(),this.reloadAgile()},t)).fail($.proxy(function(e){if(200===e.status)this.reloadAgile();else{var t=e&&e.responseJSON;if(t.errors)for(var i=0;i<t.errors.length;i++)showFlashMessage("error",t.errors[i])}s()},t))},sendPositionChange:function(e,s){const t=this.epic?{sprint_id:e.easy_sprint_id}:{};this._sendChange(t,e,s,!1,!!this.epic)},addSwimLane:function(e){var s=new window.easyClasses.agile.SwimLane(this);return 0==this.swimLanes.length&&(s.first=!0),s.maxIssues=e,this.swimLanes.push(s),s},addStickyLane:function(e){var s=new window.easyClasses.agile.StickyLane(this,e);return this.stickyLane=s,s},firePossiblePhases:function(e){this._fireChanges("possiblePhases",e)},cancelPossiblePhases:function(){this._fireChanges("cancelPossiblePhases")}},s.prototype.first=!1,s.prototype.kanbanRoot=null,s.prototype.addCol=function(e,s){this.cols.push(new t(e,this,s,this.kanbanRoot))},s.prototype.cols=null,s.prototype.getData=function(){for(var e=[],s=0;s<this.cols.length;s++)e.push(this.cols[s].getData());return e},s.prototype.name="",window.easyClasses.agile.SwimLane=s,t.prototype.column=null,t.prototype.issueCanBePlacedHere=function(e){var s=-1!==e.getPossiblePhases().indexOf(this.column.entityValue);return!(null!==this.parent||!s)||(null!==this.parent?"undefined"===this.parent.value?-1===e.getRequiredAttributeNames().indexOf(this.parent.value)&&s:-1!==e.getReadOnlyAttributeNames().indexOf(this.agileRootModel.groupBy)?e[this.agileRootModel.groupBy]==this.parent.value&&s:s:void 0)},t.prototype.agileRootModel=null,t.prototype.sendPositionChange=function(e){var s=this.parent&&this.parent.oneOfGroup;this.column.isSortable()&&!s&&$.proxy(this.agileRootModel.sendPositionChange(e,this.column.entityValue),this.agileRootModel)},t.prototype.agileRootModel=null,t.prototype.parent=null,t.prototype.getData=function(){return this.issues.getData()},t.prototype.issues=null,window.easyClasses.agile.IssuesCol=t,i.prototype.isSortable=function(){return this._isSortable},i.prototype.recalculateTimes=function(){if(this.summable){var e,s,t,i,o=0,a=0,n=this.summable.numerator.attr,l=this.summable.denominator&&this.summable.denominator.attr;if(l&&(i=this.summable.denominator.attr),this.showIssuesCount){let i,n,l;for(e in"issueBacklog"===this.phase?(i="0",n=null,l=!0):(firstCondtion=this.phase,l=!1,n=!1),a=Number(this.issuesCount),t=this.agileRootModel.allIssuesMap)t.hasOwnProperty(e)&&(s=t[e]).hasOwnProperty("agile_column_filter_value")&&(s.agile_column_filter_value===i||l&&s.agile_column_filter_value===n)&&o++;if(a>this.maxEntities){a+=o-this.maxEntities}else a=o}else{for(var r=0;r<this.issuesList.length;r++){var d=this.issuesList[r].map;for(e in d)d.hasOwnProperty(e)&&(s=d[e],l&&s.hasOwnProperty(i)&&(a+=s[i]),s.hasOwnProperty(n)&&(o+=s[n]))}if(this.summable.numerator.scope&&"all"===this.summable.numerator.scope)for(e in o=0,t=this.agileRootModel.allIssuesMap)t.hasOwnProperty(e)&&(s=t[e]).hasOwnProperty(n)&&(o+=s[n]);if(this.summable.denominator.scope&&"all"===this.summable.denominator.scope)for(e in a=0,t=this.agileRootModel.allIssuesMap)t.hasOwnProperty(e)&&(s=t[e]).hasOwnProperty(i)&&(a+=s[i])}this.summableString=l?Math.round(o)+" / "+Math.round(a):Math.round(o)}},i.prototype.issueList=null,i.prototype.issuesList=null,i.prototype.name="",i.prototype.entityValue=null,i.prototype.maxEntities=null,window.easyClasses.agile.AgileColumn=i}(),EasyGem.module.part("easyAgile",["EasyWidget"],function(){function e(e,s){this.users=s,this.template=window.easyTemplates.kanbanUserBar,this.members=[],this.repaintRequested=!0,this.model=e,this.childTarget=".agile__top-container",this.children=[],this.isAvatar=!0;this._createChildren()}window.easyClasses=window.easyClasses||{},window.easyClasses.agile=window.easyClasses.agile||{},window.easyClasses.EasyWidget.extendByMe(e),e.prototype._createChildren=function(){let e=0;this.users.forEach(s=>{this.members.push({name:s.name,id:s.id,avatarHtml:s.avatar}),this.children.push(new window.easyClasses.agile.UserWidget(this.members[e],this)),e++})},e.prototype.destroy=function(){window.easyClasses.EasyWidget.prototype.destroy.apply(this)},e.prototype.setChildrenTarget=function(){for(var e=0;e<this.children.length;e++)this.children[e].$target=this.$target.find(".agile_user-"+this.children[e].user.id)},e.prototype.out=function(){return{users:this.members}},e.prototype._functionality=function(){},e.prototype.bonusClasses="",window.easyClasses.agile.UserBarWidget=e}),EasyGem.module.part("easyAgile",["EasyWidget"],function(){"use strict";function e(e,s){this.user=e,this.template=window.easyTemplates.kanbanUser,this.repaintRequested=!0,this.userBar=s,this.children=[],this.isAvatar=!0,this.dragDomain=s.model.dragDomain;var t=this;$(window).on("resize",function(){t.repaintRequested=!0}),$(document).on("easySidebarToggled",function(){t.repaintRequested=!0})}window.easyClasses=window.easyClasses||{},window.easyClasses.agile=window.easyClasses.agile||{},window.easyClasses.EasyWidget.extendByMe(e),e.prototype.destroy=function(){window.easyClasses.EasyWidget.prototype.destroy.apply(this)},e.prototype._functionality=function(){this.$cont=this.$target;this.$target.draggable({zIndex:1e5,revert:!0,scope:"UserDrag",snap:!0,scrollSensitivity:100,sroll:!0})},e.prototype.out=function(){return{avatarHtml:this.user.avatarHtml,id:this.user.id,name:this.user.name}},window.easyClasses.agile.UserWidget=e}),EasyGem.module.part("easyAgile",["EasyWidget"],function(e){"use strict";function s(e,s,i){this.children=[],this.template=s,this.expanded=!0,s||(this.template=window.easyTemplates.kanbanSwimLane),this.$detail=null,this.$tooltip=null,this.$row=null,this.$clone=null,this.repaintRequested=!0,this.model=e;for(var o=0;o<this.model.cols.length;o++)this.children.push(new t(this.model.cols[o],this,null,i));this.top=null}function t(e,s,t,i,o){this.listWidget=new window.easyClasses.agile.ListWidget(e,!1,"",null,i,null,o),this.children=[this.listWidget],this.model=e,this.repaintRequested=!0,this.parent=s,this.template=t,t||(this.template=window.easyTemplates.kanbanSwimLaneCol),this.model.agileRootModel.isGroupBySet()||(this.nameWidget=new window.easyClasses.agile.ColNameWidget(e,this.model.agileRootModel,null,!0,i),this.children.push(this.nameWidget))}function i(e,s,t,i,o,a){if(null===o)throw"show";this.agileRootModel=s,this.children=[],this.repaintRequested=!0,this.$detail=null,this.$tooltip=null,this.isSticky=i,this.showSortButton=a,this.template=t,this.showTimes=o,t||(this.template=window.easyTemplates.kanbanColumnName),this.model=e,this.updateTimes=!1;for(var n=this.model.column||this.model,l=0;l<n.issuesList.length;l++)n.issuesList[l].register(function(){n.recalculateTimes(),this.updateTimes=!0},this)}window.easyClasses=window.easyClasses||{},window.easyClasses.agile=window.easyClasses.agile||{},e.extendByMe(s),s.prototype.setChildTarget=function(e,s){e.$target=this.$target.find(".col"+s)},s.prototype.getColWidth=function(){return 100/this.children.length-.001},s.prototype.destroy=function(){this.$header&&0!==this.$header.length&&(window.easyView.sticky.remove(this.$header),this.$header.remove()),window.easyClasses.EasyWidget.prototype.destroy.apply(this)},s.prototype._functionality=function(){var e=this;if(this.$header=this.$target.find(".agile__col__title"),e.$row=this.$target.find(".agile__row"),0!=this.$header.length){this.$header.addClass("sticky80"),this.$header.addClass("sticky_swimlane");var s=e.model.kanbanRoot;e.expanded=s.isExpanded(e.model.value+"_"+s.groupBy);var t=function(){e.expanded=!e.expanded,s.setIsExpanded(e.model.value+"_"+s.groupBy,e.expanded),e._refreshExpanded(e.$clone)};this.$header.click(t),window.easyView.sticky.add(this.$header,{topOffset:30,onCloneCreated:function(s){e.$clone=s,e._refreshExpanded(s),s.click(t)}})}},s.prototype._refreshExpanded=function(e){this.expanded?(this.$row.show(),this.$target.find("hr").hide()):(this.$row.hide(),this.$target.find("hr").show()),e&&(e.find(".icon").toggleClass("icon-remove",this.expanded),e.find(".icon").toggleClass("icon-add",!this.expanded)),this.$target.find(".sticky_swimlane > .icon").toggleClass("icon-remove",this.expanded),this.$target.find(".sticky_swimlane > .icon").toggleClass("icon-add",!this.expanded)},s.prototype.out=function(){for(var e="agile_sticky_select_for_"+this.model.kanbanRoot.dragDomain.slice(1,-1),s=[],t=0;t<this.children.length;t++)s.push(t);return{cols:s,iconType:this.model.iconType,name:this.model.name,anchorName:this.model.value+"_"+e}},window.easyClasses.agile.SwimLaneWidget=s,window.easyClasses.EasyWidget.extendByMe(t),t.prototype.out=function(){return{name:this.model.column.name,first:!this.model.agileRootModel.isGroupBySet()&&this.model.issues.firstInGlobalColumn}},t.prototype.setChildTarget=function(e,s){e.$target=0===s?this.$target.find(".agile__col__contents"):this.$target.find(".agile__col__title")},window.easyClasses.agile.SwimLaneColWidget=t,e.extendByMe(i),i.prototype.showSortButton=!1,i.prototype.onNoRepaint=function(){this.updateTimes&&this.showTimes&&(this.repaintRequested=!0,this.updateTimes=!1)},i.prototype.out=function(){var e=this.model.column||this.model,s={summableString:e.summableString,name:e.name};return s.showSortButton=this.showSortButton,s.showTimes=this.showTimes,s},i.prototype.destroy=function(){this.isSticky&&this.$target&&0!==this.$target.length&&window.easyView.sticky.remove(this.$target),window.easyClasses.EasyWidget.prototype.destroy.apply(this)},i.prototype._functionality=function(){var e=this;this.isSticky&&(this.$target.addClass("sticky"),window.easyView.sticky.add(this.$target,{onCloneCreated:function(s){e.showSortButton&&(e.$sortButton=s.find(".agile__col-sort"),e._bindSortButton()),e.$detail=s.find(".agile__col__title__details"),e.$tooltip=s.find(".tooltip"),""!==e.$tooltip.html()&&(e.$detail.mouseenter(function(){e.$tooltip.show()}),s.mouseleave(function(){e.$tooltip.hide()}))}})),this.showSortButton&&(this.$sortButton=this.$target.find(".agile__col-sort"),this._bindSortButton()),this.$detail=this.$target.find(".agile__col__title__details"),this.$tooltip=this.$target.find(".tooltip"),""!==this.$tooltip.html()&&(this.$detail.mouseenter(function(){e.$tooltip.show()}),this.$target.mouseleave(function(){e.$tooltip.hide()}))},i.prototype._bindSortButton=function(){this.$sortButton.click($.proxy(function(){this.agileRootModel.sendReorder(this.model.issues,this.model.column)},this))},window.easyClasses.agile.ColNameWidget=i}),EasyGem.module.part("easyAgile",function(){window.easyLoaders.backlog=function(e,s,t){function i(){var e,s=$(".sticky_agile_backlog_autocomplete_wrap"),t=$(".agile__row");0!==t.length&&((e=t.width())&&0!==e&&s.css({width:e}),window.easyView.sticky.rebuild())}const o=function(){window.easyLoaders.backlog(e,s)};$.getJSON(s,t,function(s){var t;window.easyModel=window.easyModel||{},window.easyView=window.easyView||{},window.easyTemplates.ListItem=s.settings.template_card,window.easyTemplates.issueCardWidget=s.settings.template_tooltip,window.easyTemplates.kanbanColumnName=s.settings.template_column_name,window.easyModel.backlogRoot&&easyClasses.root.clear();var a=easyClasses.root,n=s.settings.project_members;for(t=0;t<n.length;t++){var l=n[t];l.avatar_html=l.avatar,a.addUser(new easyClasses.User(l))}a.allIssues.loadFromJson(s.entities,a.allUsers),easyClasses.agile.ListWidget.contextMenuUrl=s.settings.context_menu_path;var r=new window.easyClasses.agile.BacklogRoot(a,s.columns,s.settings.update_params_prefix,s.settings.assign_param_name,s.settings,s.settings.context_menu_path,o);window.easyModel.backlogRoot=r,window.easyView.backlogRootWidget!==undefined&&(window.easyView.root.remove(window.easyView.backlogRootWidget),window.easyLoaders.backlogDestroy()),window.easyView.backlogRootWidget=new window.easyClasses.agile.BacklogRootWidget(r),window.easyView.backlogRootWidget.$target=$(e),window.easyView.root.add(window.easyView.backlogRootWidget),i(),window.setTimeout(i,200),window.setTimeout(i,1e3),window.easyView.root.listenWrapHeightChange(i),$(window).resize(i),document.addEventListener("vueModalIssueChanged",o,{once:!0}),window.EasyVue&&window.EasyVue.modalData&&setTimeout(window.EasyVue.holdTargetWrapperHeight,300)})},window.easyLoaders.backlogDestroy=function(){easyView.backlogRootWidget.destroy(),delete easyView.backlogRootWidget,delete easyModel.backlogRoot},this.backlogLoader=window.easyLoaders.backlog}),EasyGem.module.part("easyAgile",["ActiveClass"],function(){function e(e,s,t,i,o,a,n){this.paramPrefix=t,this.namePrefix=i,this.rootModel=e,this._onChange=[],this._preventSave=!1,this.columns=this.columns||{},this.allIssuesMap=e.allIssues.map,this.dragDomain="agileBacklog",this.contextMenuUrl=a,this.reloadAgile=n,o.issue_priorities&&(window.easyModel=window.easyModel||{},window.easyModel.issue_priorities=o.issue_priorities),this.settings=o;var l=s[0],r=!(l.hasOwnProperty("positioned")&&!l.positioned),d=new easyClasses.agile.AgileColumn(l.name,l.entity_value,"100",o.summable_attribute,this,r,null,!0,l.issues_count,"issueBacklog"),u=s[1];r=!(u.hasOwnProperty("positioned")&&!u.positioned);var h,g=new easyClasses.agile.AgileColumn(u.name,u.entity_value,u.max_entities,o.summable_attribute,this,r);if(s[2]){var c=s[2];r=!(c.hasOwnProperty("positioned")&&!c.positioned),h=new easyClasses.agile.AgileColumn(c.name,c.entity_value,c.max_entities,o.summable_attribute,this,r)}for(var p in this.sprintBacklog=null,this.sprintBacklogIssuesCol=null,h&&(this.sprintBacklog=new window.easyClasses.Issues,this.sprintBacklog.init(),this.sprintBacklogIssuesCol=new easyClasses.agile.IssuesCol(this.sprintBacklog,null,h,this)),this.backlog=new window.easyClasses.Issues,this.backlog.init(),this.backlogIssesCol=new easyClasses.agile.IssuesCol(this.backlog,null,g,this),this.issues=new easyClasses.Issues,this.issues.init(),this.notAssignedIssuesCol=new easyClasses.agile.IssuesCol(this.issues,null,d,this),e.allIssues.map)if(e.allIssues.map.hasOwnProperty(p)){var m=e.allIssues.map[p];m.agile_column_filter_value==g.entityValue?this.backlog.add(m):h&&m.agile_column_filter_value==h.entityValue?this.sprintBacklog.add(m):this.issues.add(m)}this.columns[g.entityValue]=g,this.columns[d.entityValue]=d,h&&(this.columns[h.entityValue]=h,this.sprintBacklog.register(function(e,s){null!==s&&s!==undefined&&"add"===e&&this._sendChange({},s,this.sprintBacklogIssuesCol.column.entityValue)},this),h.recalculateTimes()),d.recalculateTimes(),g.recalculateTimes(),this.backlog.register(function(e,s){null!==s&&s!==undefined&&"add"===e&&this._sendChange({},s,this.backlogIssesCol.column.entityValue)},this),this.issues.register(function(e,s){null!==s&&s!==undefined&&("add"===e&&this._sendChange({},s,this.notAssignedIssuesCol.column.entityValue),d.recalculateTimes())},this),this.sendPositionChange=window.easyMixins.agile.root.sendPositionChange,this._handleChangeError=window.easyMixins.agile.root._handleChangeError,this.sendBulkUpdate=window.easyMixins.agile.root.sendBulkUpdate,this._sendChange=window.easyMixins.agile.root._sendChange,this.sendReorder=window.easyMixins.agile.root.sendReorder,this.firePossiblePhases=window.easyMixins.agile.root.firePossiblePhases,this.cancelPossiblePhases=window.easyMixins.agile.root.cancelPossiblePhases}window.easyClasses=window.easyClasses||{},window.easyClasses.agile=window.easyClasses.agile||{},window.easyClasses.ActiveClass.extendByMe(e),e.prototype.isSortable=function(e,s){return this.columns[s].isSortable()},e.prototype.columns=null,e.prototype.destroy=function(){window.easyClasses.EasyWidget.prototype.destroy.apply(this),window.easyView.root.remove(this)},e.prototype.backlog=null,window.easyClasses.agile.BacklogRoot=e}),EasyGem.module.part("easyAgile",["EasyWidget"],function(){function e(e){this.model=e;var s=new window.easyClasses.EasyRowWidget;s.bonusClasses="agile__row",this.children=[s],this.repaintRequested=!0,this.template=easyTemplates.kanbanRoot;var t=s.addCol();t.bonusClasses="agile__col";var i=new easyClasses.agile.ListWidget(this.model.notAssignedIssuesCol,!0,"backlog-column backlog-column-not-assigned",null,!0,!0);t.setWidget(i);var o=s.addCol();o.bonusClasses="agile__col";var a=new easyClasses.agile.ListWidget(this.model.backlogIssesCol,!0,"backlog-column backlog-column-backlog",null,!1,!0);if(o.setWidget(a),this.model.sprintBacklogIssuesCol){var n=s.addCol();n.bonusClasses="agile__col";var l=new easyClasses.agile.ListWidget(this.model.sprintBacklogIssuesCol,!0,"backlog-column-sprint",null,!1,!0);n.setWidget(l),e.settings.check_capacities=!1}}window.easyClasses=window.easyClasses||{},window.easyClasses.agile=window.easyClasses.agile||{},window.easyClasses.EasyWidget.extendByMe(e),e.prototype.setChildTarget=function(e){e.$target=this.$target.find(".easy-row")},e.prototype.model=null,window.easyClasses.agile.BacklogRootWidget=e}),EasyGem.module.part("easyAgile",function(){window.easyLoaders.epicBacklogLoader=function(e,s,t){function i(){const e=$(".sticky_agile_backlog_autocomplete_wrap"),s=$(".agile__row");let t;0!==s.length&&((t=s.width())&&0!==t&&e.css({width:t}),window.easyView.sticky.rebuild())}const o=function(){window.easyLoaders.epicBacklogLoader(e,s)};$.getJSON(s,t,function(s){let t;window.easyModel=window.easyModel||{},window.easyView=window.easyView||{},window.easyTemplates.ListItem=s.settings.template_card,window.easyTemplates.issueCardWidget=s.settings.template_tooltip,window.easyTemplates.kanbanColumnName=s.settings.template_column_name,window.easyModel.epicBacklogRoot&&(document.removeEventListener("vueModalIssueChanged",window.easyModel.epicBacklogRoot.reloadAgile,!1),easyClasses.root.clear());let a=easyClasses.root,n=s.settings.project_members;for(t=0;t<n.length;t++){let e=n[t];e.avatar_html=e.avatar,a.addUser(new easyClasses.User(e))}a.allIssues.loadFromJson(s.entities,a.allUsers),easyClasses.agile.ListWidget.contextMenuUrl=s.settings.context_menu_path;const l=new window.easyClasses.agile.EpicBacklogRoot(a,s.columns,s.settings.update_params_prefix,s.settings.assign_param_name,s.settings,s.i18n,s.settings.context_menu_path,s.epic,o);window.easyModel.epicBacklogRoot=l,window.easyView.EpicBacklogRootWidget!==undefined&&(window.easyView.root.remove(window.easyView.EpicBacklogRootWidget),window.easyLoaders.epicBacklogDestroy()),window.easyView.EpicBacklogRootWidget=new window.easyClasses.agile.EpicBacklogRootWidget(l),window.easyView.EpicBacklogRootWidget.$target=$(e),window.easyView.root.add(window.easyView.EpicBacklogRootWidget),i(),window.setTimeout(i,200),window.setTimeout(i,1e3),window.easyView.root.listenWrapHeightChange(i),$(window).resize(i),document.addEventListener("vueModalIssueChanged",o)})},window.easyLoaders.epicBacklogDestroy=function(){easyView.EpicBacklogRootWidget.destroy(),delete easyView.EpicBacklogRootWidget,delete easyModel.epicBacklogRoot},this.epicBacklogLoader=window.easyLoaders.epicBacklogLoader}),EasyGem.module.part("easyAgile",["ActiveClass"],function(){function e(e,s,t,i,o,a,n,l,r){this.paramPrefix=t,this.namePrefix=i,this.rootModel=e,this._onChange=[],this._preventSave=!1,this.columns=this.columns||{},this.allIssuesMap=e.allIssues.map,this.dragDomain="epicAgileBacklog",this.contextMenuUrl=n,this.epic=l,this.reloadAgile=r,this.i18n=a||{},o.issue_priorities&&(window.easyModel=window.easyModel||{},window.easyModel.issue_priorities=o.issue_priorities),this.settings=o;let d=s[0],u=!(d.hasOwnProperty("positioned")&&!d.positioned),h=new easyClasses.agile.AgileColumn(d.name,d.entity_value,d.max_entities,o.summable_attribute,this,u);this.sprintBacklogs=[],this.sprintBacklogsIssuesCol=[],s[1].forEach((s,t)=>{u=!(s.hasOwnProperty("positioned")&&!s.positioned);const i=new easyClasses.agile.AgileColumn(s.name,s.entity_value,s.max_entities,o.summable_attribute,this,u,s.easy_sprint_id);i&&(this.sprintBacklogs[t]=new window.easyClasses.Issues,this.sprintBacklogs[t].init(),this.sprintBacklogsIssuesCol[t]=new easyClasses.agile.IssuesCol(this.sprintBacklogs[t],null,i,this));for(const s in e.allIssues.map){if(!e.allIssues.map.hasOwnProperty(s))continue;const o=e.allIssues.map[s];i&&o.agile_column_filter_value==i.sprintId&&this.sprintBacklogs[t].add(o)}i&&(this.columns[i.entityValue]=i,
this.sprintBacklogs[t].register(function(e,s){const i={sprint_id:this.sprintBacklogsIssuesCol[t].column.sprintId};null!==s&&s!==undefined&&"add"===e&&this._sendChange(i,s,this.sprintBacklogsIssuesCol[t].column.entityValue,!1,!!this.epic)},this),i.recalculateTimes())}),this.issues=new easyClasses.Issues,this.issues.init(),this.notAssignedIssuesCol=new easyClasses.agile.IssuesCol(this.issues,null,h,this);for(const s in e.allIssues.map){if(!e.allIssues.map.hasOwnProperty(s))continue;let t=e.allIssues.map[s];t.agile_column_filter_value||this.issues.add(t)}this.columns[h.entityValue]=h,h.recalculateTimes(),this.issues.register(function(e,s){const t={sprint_id:s.easy_sprint_id?s.easy_sprint_id:""};null!==s&&s!==undefined&&"add"===e&&this._sendChange(t,s,this.notAssignedIssuesCol.column.entityValue,!1,!!this.epic)},this),this.sendPositionChange=window.easyMixins.agile.root.sendPositionChange,this._handleChangeError=window.easyMixins.agile.root._handleChangeError,this.sendBulkUpdate=window.easyMixins.agile.root.sendBulkUpdate,this._sendChange=window.easyMixins.agile.root._sendChange,this.sendReorder=window.easyMixins.agile.root.sendReorder,this.firePossiblePhases=window.easyMixins.agile.root.firePossiblePhases,this.cancelPossiblePhases=window.easyMixins.agile.root.cancelPossiblePhases}window.easyClasses=window.easyClasses||{},window.easyClasses.agile=window.easyClasses.agile||{},window.easyClasses.ActiveClass.extendByMe(e),e.prototype.isSortable=function(e,s){return this.columns[s].isSortable()},e.prototype.columns=null,e.prototype.backlog=null,window.easyClasses.agile.EpicBacklogRoot=e}),EasyGem.module.part("easyAgile",["EasyWidget"],function(){function e(e){this.model=e;const s=new window.easyClasses.EasyRowWidget;s.bonusClasses="agile__row",this.children=[s],this.repaintRequested=!0,this.template=easyTemplates.kanbanRoot;const t=s.addCol();t.bonusClasses="agile__col";const i=new easyClasses.agile.ListWidget(this.model.notAssignedIssuesCol,!0,"backlog-column backlog-column-not-assigned",null,!1,!0);t.setWidget(i),this.model.sprintBacklogsIssuesCol.length&&this.model.sprintBacklogsIssuesCol.forEach((t,i)=>{const o=s.addCol();o.bonusClasses="agile__col";const a=new easyClasses.agile.ListWidget(this.model.sprintBacklogsIssuesCol[i],!0,"backlog-column-sprint",null,!1,!0);o.setWidget(a),e.settings.check_capacities=!1}),this.children.unshift(new window.easyClasses.agile.UserBarWidget(this.model,this.model.epic.members))}window.easyClasses=window.easyClasses||{},window.easyClasses.agile=window.easyClasses.agile||{},window.easyClasses.EasyWidget.extendByMe(e),e.prototype.setChildTarget=function(e){e.childTarget?e.$target=this.$target.find(e.childTarget):e.$target=this.$target.find(".easy-row")},e.prototype.model=null,window.easyClasses.agile.EpicBacklogRootWidget=e}),EasyGem.module.part("easyAgile",["EasyWidget"],function(){function e(e,s){this.children=[],this.repaintRequested=!0,this.options=e,this.template=easyTemplates.kanbanGroupSelect,this.agileRootModel=s,this.labeSwimlane=this.agileRootModel.i18n.swimlane}window.easyClasses=window.easyClasses||{},window.easyClasses.agile=window.easyClasses.agile||{},easyClasses.EasyWidget.extendByMe(e),e.prototype.out=function(){return{options:this.options,swimlane:this.labeSwimlane}},e.prototype._functionality=function(){this.$select=this.$target.find("select");var e=this;this.$select.on("change",function(){e.agileRootModel.setGroupBy(this.value),window.easyView.sticky.scheduleRebuild()})},window.easyClasses.agile.AgileGroupSelectWidget=e}),EasyGem.module.part("easyAgile",function(){window.easyModel=window.easyModel||{},window.easyView=window.easyView||{};var e={};window.easyLoaders.kanban=function(s,t,i){const o=function(){window.easyLoaders.kanban(s,t)};$.getJSON(t,function(a){window.easyTemplates.ListItem=a.settings.template_card,window.easyTemplates.issueCardWidget=a.settings.template_tooltip,window.easyTemplates.kanbanColumnName=a.settings.template_column_name;var n=easyClasses.root.loadUsers(a.settings.project_members),l=new window.easyClasses.Issues;l.loadFromJson(a.entities,n);for(var r=l.map,d=[],u=0;u<a.columns.length;u++)null!=a.columns[u]&&d.push(a.columns[u]);var h=!!s.match(/module_inside/),g=new window.easyClasses.agile.KanbanRoot({columnsData:d,update_params_prefix:a.settings.update_params_prefix,assign_param_name:a.settings.assign_param_name,settings:a.settings,i18n:a.i18n,url:t,swimlane:i,allIssuesMap:r,allMembersMap:n,contextMenuUrl:a.settings.context_menu_path,dragDomain:s,isPageModule:h,localStorageKey:easyConstants.agileSwimlanesGroupByParameter+s,reloadAgile:o}),c=e[s];c?(c.kanbanRootWidget.destroy(),c.kanbanRoot.destroy()):document.addEventListener("vueModalIssueChanged",o);var p=new window.easyClasses.agile.KanbanRootWidget(g);p.$target=$(s),window.easyView.root.add(p),e[s]={kanbanRootWidget:p,kanbanRoot:g},window.EasyVue&&window.EasyVue.modalData&&setTimeout(window.EasyVue.holdTargetWrapperHeight,300)})},window.easyLoaders.kanbanDestroy=function(s){var t=e[s];t&&(t.kanbanRootWidget.destroy(),t.kanbanRoot.destroy(),delete e[s])},this.kanbanLoader=window.easyLoaders.kanban,window.easyModel.kanbans=e}),EasyGem.module.part("easyAgile",["ActiveClass"],function(){function e(e){$.extend(this,window.easyMixins.agile.root),this._loadFromParams(e)}window.easyClasses=window.easyClasses||{},window.easyClasses.agile=window.easyClasses.agile||{},easyClasses.ActiveClass.extendByMe(e),e.prototype.rootModel=null,e.prototype.sendPositionChange=function(e,s){this._sendChange({},e,s)},e.prototype.columns=null,e.prototype.isBacklog=null,e.prototype.isDone=null,e.prototype.groupBy=null,e.prototype.swimLanes=null,e.prototype.done=null,e.prototype.backlog=null,e.prototype.done=null,window.easyClasses.agile.KanbanRoot=e}),EasyGem.module.part("easyAgile",["EasyWidget"],function(){function e(e){this.model=e,this.model.register(function(e){"dialDownloaded"===e&&this._buildSwimlanes(),"groupBySet"===e&&(this.model.isGroupBySet()?(this.backlogCol&&this.backlogCol.$target.addClass("agile__col--indent"),this.doneCol&&this.doneCol.$target.addClass("agile__col--indent")):(this.backlogCol&&this.backlogCol.$target.removeClass("agile__col--indent"),this.doneCol&&this.doneCol.$target.removeClass("agile__col--indent")),this._buildSwimlanes())},this);var s=new window.easyClasses.EasyRowWidget;if(this.row=s,s.bonusClasses="agile__row",this.children=[s],this.repaintRequested=!0,this.template=window.easyTemplates.kanbanRoot,this.swimLanesRowWidgets=[],e.isBacklog){this.backlogCol=s.addCol();var t=new window.easyClasses.agile.ListWidget(this.model.backlogIssesCol,!0,"backlog-column",null,!0,!0);this.backlogCol.bonusClasses="agile__col agile__col--side ",this.model.isGroupBySet()&&(this.backlogCol.bonusClasses+="agile__col--indent "),this.backlogCol.setWidget(t)}this._buildSwimlanes(),e.isDone&&(this.doneCol=s.addCol(),this.doneCol.bonusClasses="agile__col agile__col--side ",this.model.isGroupBySet()&&(this.doneCol.bonusClasses+="agile__col--indent "),this.doneCol.setWidget(new window.easyClasses.agile.ListWidget(this.model.doneIssuesCol,!0,"backlog-column",null,!0)));for(var i=this.model.settings.swimlane_categories,o=0;o<i.length;o++)i[o].selected=i[o].value===this.model.groupBy;this.children.push(new window.easyClasses.agile.AgileGroupSelectWidget(i,e))}window.easyClasses=window.easyClasses||{},window.easyClasses.agile=window.easyClasses.agile||{},window.easyClasses.EasyWidget.extendByMe(e),e.prototype._buildSwimlanes=function(){var e,s=0;this.model.isBacklog&&(s=1);var t=this.model.middleColumns,i=this.model.middleColumnsOrdering,o=this.row.addCol(s);if(o.bonusClasses="agile__main-col agile__col",o.bonusStyle={flexGrow:Object.keys(t).length},this.model.isGroupBySet()){var a=o.addRow();for(a.isSticky=!0,a.bonusClasses+="agile__row",e=0;e<i.length;e++){var n=t[i[e]],l=a.addCol();l.bonusClasses="agile__col",l.setWidget(new window.easyClasses.agile.ColNameWidget(n,this.model,null,!1,!0))}}for(this.swimLanesRowWidgets.push(r),e=0;e<this.model.swimLanes.length;e++){var r=o.addRow();r.bonusClasses+="agile__row",r.setWidget(new window.easyClasses.agile.SwimLaneWidget(this.model.swimLanes[e],null,!0)),this.swimLanesRowWidgets.push(r)}if(this.model.stickyLane){var d=o.addRow();d.bonusClasses+="agile__row agile__sticky-lane",d.setWidget(new window.easyClasses.agile.StickyLaneWidget(this.model.stickyLane))}},e.prototype.swimLanesRowWidgets=null,e.prototype.setChildTarget=function(e,s){e.$target=0===s?this.$target.find(".easy-row"):this.$target.find(".agile__group-select")},e.prototype.model=null,e.prototype.destroy=function(){window.easyClasses.EasyWidget.prototype.destroy.apply(this),window.easyView.root.remove(this)},window.easyClasses.agile.KanbanRootWidget=e}),EasyGem.module.part("easyAgile",["EasyWidget"],function(){function s(e,s,t){this.maxDistanceToClick=30,this.timeToContextMenu=1e3,this.maxTimeToContextMenu=4e3,this.maxDistanceCancelingContextMenu=50,this.issue=e,this.listWidget=s,this.maxDistance=0,this.template=window.easyTemplates.ListItem,this.showTooltip=!!window.easyTemplates.issueCardWidget,this.children=[],this.repaintRequested=!0,this.selected=!1,this.$overlay=null,this.$a=null,this.modalOpenable=!0,this.actualY=null,this.actualX=null,this.shiftKey=!1,this.doScrollUp=!1,this.doScrollDown=!1,this.isPossibleTarget=!1,this.hover=!1,this.aTouched=!1,this.isScrum=this._isScrum(s),this.itemSettings=this._itemSettings(),this.capacityAttribute=this._capacityAttribute(),this.dragDomain=s.model.agileRootModel.dragDomain,this.isPageModule=s.model.agileRootModel.isPageModule,this.touchTimeout=null,this.clickTimeout=null,this.touchDrag=!1,this._isNewIssue()&&(this.issue.showCapacityAttribute=!0),t||(this.issue.register(this.onChange,this),window.easyView.root.addItemToDragCollection(this.dragDomain,this,2)),this.isAvatar=t,this.destroyed=!1}window.easyClasses=window.easyClasses||{},window.easyClasses.agile=window.easyClasses.agile||{},window.easyClasses.EasyWidget.extendByMe(s),s.prototype._functionality=function(){if(this.$cont=this.$target.find(".agile__card"),!this.isAvatar){this.$a=this.$target.find("a"),this.setDropHover(this.hover),this.setWrapperHeight(),this._select(this.selected);var e=this;this.showTooltip&&(this.issueCardWidget?this.toolTip.destroy():this.issueCardWidget=new window.easyClasses.IssueCardWidget(this.issue),this.toolTip=new window.easyClasses.EasyTooltip(this.issueCardWidget,this.$target,-80),e._suppressTooltipForAWhile()),this.issue.agile_column_filter_value&&this.$cont.droppable({hoverClass:"agile__card__drop-hover",scope:"UserDrag",activeClass:"agile__card-droppable",drop:function(s,t){if(!t.draggable.context.lastChild.attributes[1].nodeValue)return;const i={assigned_to_id:t.draggable.context.lastChild.attributes[1].nodeValue,sprint_id:e.issue.easy_sprint_id};self.easyMixins.agile.root._sendChange(i,e.issue,null,!0,!0,e)}}),this.$target.off("contextmenu.listItem"),this.$target.on("contextmenu.listItem",function(s){return!ERUI.isMobile&&(s.preventDefault(),e.actualX=s.pageX-$(window).scrollLeft(),e.actualY=s.pageY-$(window).scrollTop(),e._contextMenu(s),!1)}),this.$target.find(".agile__capacity__button").off("click").on("click",function(){var s={url:e.issue.show_path+".xml",method:"PUT",data:{issue:{}}};s.data.issue[e.capacityAttribute]=e.$target.find(".easy_agile_rating").val(),e.issue.old=e.issue[e.capacityAttribute+"_raw"];var t={showCapacityAttribute:!1};t[e.capacityAttribute]=e.$target.find(".easy_agile_rating").val(),t[e.capacityAttribute+"_raw"]=parseInt(e.$target.find(".easy_agile_rating").val()),t[e.capacityAttribute+"_int"]=parseInt(e.$target.find(".easy_agile_rating").val()),$.ajax(s).done(function(){e.issue.set(t),e._capacityLoad(e.issue,"input")})}),this.$target.find(".agile__close__button").off("click").on("click",function(){e.issue.set("showCapacityAttribute",!1),e.listWidget.repaintRequested=!0}),this.issue.showCapacityAttribute&&$(e.$target[0]).find(".agile__capacity__input").focus(),this.$target.off("mousedown.listItem"),this.$target.on("mousedown.listItem",function(s){if(e.shiftKey=s.shiftKey,"A"===s.target.parentElement.tagName){if(e.modalOpenable=!1,2===s.which)return!0;e.aTouched=!0}return("INPUT"===s.target.tagName||"BUTTON"===s.target.tagName)&&(e.modalOpenable=!1,1===s.which)||(s.preventDefault(),3===s.which||"SPAN"===s.target.tagName&&"true"===s.target.dataset.contextMenu?(e.modalOpenable=!1,e.actualX=s.pageX-$(window).scrollLeft(),e.actualY=s.pageY-$(window).scrollTop(),e._contextMenu(s)):(e.actualX=s.pageX-$(window).scrollLeft(),e.actualY=s.pageY-$(window).scrollTop(),e.down(s.pageX,s.pageY)),!1)}),this.$target.off("touchstart.listItem"),this.$target.on("touchstart.listItem",this.handleTouchStart.bind(this)),this.$target.off("touchend.listItem"),this.$target.on("touchend.listItem",this.handleTouchEnd.bind(this)),this.$target.off("touchmove.listItem"),this.$target.on("touchmove.listItem",function(s){if(e.modalOpenable=!1,!e.touchDrag)return!0;s.preventDefault();var t=s.originalEvent.touches[0];return e._suppressTooltipForAWhile(),!!t&&(e.move(t.pageX,t.pageY),!1)}),this.issue.error&&this.$cont.addClass("agile__card--error")}},s.prototype.setWrapperHeight=function(){const e=document.querySelector(this.dragDomain);e&&(e.style.minHeight=`${e.getBoundingClientRect().height}px`)},s.prototype.handleTouchStart=function(e){this.touchTimeout=setTimeout(()=>{if(e.preventDefault(),this.touchDrag=!0,"A"===e.target.parentElement.tagName&&(this.modalOpenable=!1,this.aTouched=!0),"SPAN"===e.target.tagName&&"true"===e.target.dataset.contextMenu)return this.modalOpenable=!1,this.actualX=e.pageX-$(window).scrollLeft(),this.actualY=e.pageY-$(window).scrollTop(),this._contextMenu(e),!1;this._suppressTooltipForAWhile();var s=e.originalEvent.touches[0];return!!s&&(this.actualX=s.pageX-$(window).scrollLeft(),this.actualY=s.pageY-$(window).scrollTop(),this.down(s.pageX,s.pageY,!1),!1)},500)},s.prototype.handleTouchEnd=function(e){return e.preventDefault(),this.touchTimeout&&window.clearTimeout(this.touchTimeout),this.touchDrag=!1,this.up(),!1},s.prototype._isScrum=function(e){return!(!e.nameWidget||"issue_easy_sprint_relation"!==e.nameWidget.agileRootModel.paramPrefix)||!(!e.model||"issue_easy_sprint_relation"!==e.model.agileRootModel.paramPrefix)},s.prototype._openModal=function(){if(!window.testEnviroment&&window.EasyVue&&EasyVue.showModal){EasyVue.showModal("issue",this.issue.id);const e=this.$target.closest(".agile")[0].parentElement;if(!e)return;EasyVue.modalData.openedFromElement=e,EasyVue.modalData.pageOffsetY=window.pageYOffset,e.style.height=`${e.offsetHeight}px`}},s.prototype._capacityAttribute=function(){return this.isScrum&&this.itemSettings.capacity_attribute?this.itemSettings.capacity_attribute:"estimated_hours"},s.prototype._itemSettings=function(){return this.listWidget.model.agileRootModel.settings},s.prototype._isNewIssue=function(){var e=this.itemSettings,s=this.issue;return!("1"!=e.check_capacities||-1!=s.agile_column_filter_value||s.read||s[this.capacityAttribute]>0)},s.prototype._suppressTooltipForAWhile=function(){var e=this;this.toolTip&&(this.toolTip.suppress=!0,this._suppressTooltipTimout&&window.clearTimeout(this._suppressTooltipTimout),this._suppressTooltipTimout=window.setTimeout(function(){e.toolTip.suppress=!1},1e3))},s.prototype.doScroll=function(){if(this.doScrollDown)window.scrollBy(0,9);else{if(!this.doScrollUp)return;window.scrollBy(0,-9)}window.setTimeout($.proxy(this.doScroll,this),100)},s.prototype.down=function(e,s){this.$dragedCard=this.issue,this.maxDistance=0,this.startX=e-$(window).scrollLeft(),this.startY=s-$(window).scrollTop(),this.startTime=Date.now(),this.actionActive=!0;var t=this;window.easyView.root.dragStartOnDomain(this.dragDomain,this),this.$overlay=$("<div>").css({position:"fixed",top:0,left:0,width:window.innerWidth,height:window.innerHeight,zIndex:1e4,cursor:"move"}),$(document.body).append(this.$overlay),this.$overlay.on("mouseup.listItem",function(e){e.preventDefault(),t.up()}),window.testEnviroment&&this.$overlay.on("mousemove.listItem",function(e){e.preventDefault(),t.move(e.pageX,e.pageY)}),this.clickTimeout=setTimeout(()=>{this.$overlay.on("mousemove.listItem",function(e){e.preventDefault(),t.move(e.pageX,e.pageY)})},300)},s.prototype.move=function(e,s){if(this.actionActive){this.modalOpenable=!1;var t=$(window),i=t.scrollTop(),o=t.scrollLeft();s-i<80?(this.doScrollUp=!0,this.doScroll()):this.doScrollUp=!1;var a=window.innerHeight-s+i,n=!0,l=$(".backlog-column");if(l.length>0&&"agileBacklog"!=this.dragDomain){n=!1;for(var r=0;r<l.length;r++){var d=l[r];if(d.offsetLeft<e&&d.offsetLeft+d.offsetWidth>e){n=!0;break}}}if(a<100&&a>0&&n?(this.doScrollDown=!0,this.doScroll()):this.doScrollDown=!1,this.actualX=e-o,this.actualY=s-i,this.moveDistance()>15&&!this.avatar&&(this.createAvatar(),this.listWidget.model.agileRootModel.firePossiblePhases(this.issue)),this.avatar&&this.moveAvatar(),this.currentDropTarget=window.easyView.root.getCurrentDragTargetWidget(e,s),this.currentDropTarget){this.$target.hide();var u=$(this.currentDropTarget.$target[0]),h=document.getElementById("agile__place_holder");h||(h="<div id='agile__place_holder' style='height: 100px'></div>"),u.hasClass("agile__item")?this.$dragedCard.agile_column_position>this.currentDropTarget.issue.agile_column_position||this.$dragedCard.agile_column_filter_value!=this.currentDropTarget.issue.agile_column_filter_value?$(h).insertBefore(u):$(h).insertAfter(u):h&&$(h).remove()}else $("#agile__place_holder").remove()}},s.prototype.up=function(){if(this.doScrollDown=!1,this.doScrollUp=!1,this.clickTimeout&&window.clearTimeout(this.clickTimeout),this.$overlay&&(this.$overlay.remove(),this.avatar&&this.avatar.destroy(),this.avatar=null),!this.modalOpenable||event.ctrlKey||event.metaKey?this.modalOpenable=!0:this._openModal(),window.easyView.root.dragStopOnDomain(this.dragDomain),this.listWidget.cancelPossiblePhases(),this.actionActive=!1,!this.destroyed)if($(this.$target).show(),$("#agile__place_holder").remove(),this.forceContextMenu)this._contextMenu(e);else{if(this.moveDistance()<this.maxDistanceToClick)if(Date.now()-this.startTime<this.timeToContextMenu)if(this.aTouched)this._openModal(),this.aTouched=!1;else{var s=window.easyView.root.lastSelectedIssueItemWidget;if(this.shiftKey&&s&&s!==this&&s.listWidget===this.listWidget){var t=this.listWidget.children.indexOf(this),i=this.listWidget.children.indexOf(s);if(t>i){var o=t;t=i,i=o}for(var a=t;a<=i;a++)this.listWidget.children[a]._select(!0)}else this._select()}else Date.now()-this.startTime<this.maxTimeToContextMenu&&this.maxDistance<this.maxDistanceCancelingContextMenu&&this._contextMenu(e);else this._drop();this.currentDropTarget=null}},s.prototype.setDropHover=function(e){this.destroyed||(this.hover=e,e?this.listWidget.setDropHover(!0):this.listWidget.setDropHover(!1))},s.prototype.onChange=function(){this.repaintRequested=!0},s.prototype._select=function(e){window.easyView.root.mapOfPossibleSelectedIssueItemWidgets=window.easyView.root.mapOfPossibleSelectedIssueItemWidgets||{},window.easyView.root.lastSelectedIssueItemWidget=window.easyView.root.lastSelectedIssueItemWidget||{},this.selected=void 0===e?!this.selected:e,this.selected?(window.easyView.root.mapOfPossibleSelectedIssueItemWidgets[this.issue.id]=this,window.easyView.root.lastSelectedIssueItemWidget=this,this.$cont.addClass("agile__card--selected")):this.$cont.removeClass("agile__card--selected")},s.prototype._contextMenu=function(e){if(!this.destroyed){this.event=e;var s=this;if(!this._contextMenuOpened&&null!==this.listWidget.model.agileRootModel.contextMenuUrl){this._contextMenuOpened=!0,this._suppressTooltipForAWhile();var t=window.easyView.root.mapOfPossibleSelectedIssueItemWidgets,i=[];for(var o in t)t.hasOwnProperty(o)&&t[o].selected&&i.push(t[o].issue.id);i.push(this.issue.id),$.ajax({url:this.listWidget.model.agileRootModel.contextMenuUrl,data:{ids:i,show_story_points:!0},success:function(e){if(!s.destroyed){var t=function(){s._contextMenuOpened=!1,$(window).unbind("mousedown.contextMenu"),o.remove(),i.remove()};s.closeContextMenu=t,$("#context-menu").remove();var i=$("<div>"),o=$("<div>").css({position:"fixed",top:0,left:0,width:window.innerWidth,height:window.innerHeight,zIndex:1});i.attr("id","context-menu"),i.html(e),i.find(".context-menu-autocomplete").remove(),window.setTimeout(function(){EASY.contextMenu.contextMenuCalculatePosition(s.event,i),$(window).bind("mousedown.contextMenu",function(e){0==$(e.target).closest("#context-menu").length&&window.setTimeout(function(){t()},50)}),i.find(".agile__context__edit__atribute").off("click").on("click",function(){s.issue.set("showCapacityAttribute",!0),s.listWidget.repaintRequested=!0,t()}),i.find("a").each(function(e,i){var o=$(i);-1!==i.href.indexOf("bulk_update")&&o.mousedown(function(e){return e.preventDefault(),e.stopPropagation(),!1}).mouseup(function(e){return e.preventDefault(),e.stopPropagation(),!1}).click(function(e){return e.preventDefault(),e.stopPropagation(),s.listWidget.model.agileRootModel.sendBulkUpdate(i.href,function(){$(window).unbind("mousedown.contextMenu"),t()}),!1})})},30),$(document.body).append(i),o.mousedown(function(){t()}),o.on("touchstart",function(){t()}),$(document.body).append(o),window.initEasyAutocomplete()}}})}}},s.prototype._drop=function(){if(!this.destroyed&&this.currentDropTarget){var e,s=window.easyView.root.mapOfPossibleSelectedIssueItemWidgets;this.selected=!0,s[this.issue.id]=this;var t={};for(var i in this.isPossibleTarget=!1,s)if(s.hasOwnProperty(i)){var o=s[i];if(o.selected){var a,n=o.issue,l=n.agile_column_position,r=n.issues,d=null,u=(a=this.currentDropTarget.issue!==undefined?this.currentDropTarget.listWidget.model:this.currentDropTarget.model).column.entityValue;if(a.issueCanBePlacedHere(n)){if("agileBacklog"===this.dragDomain&&this._capacityLoad(n,u),this.isPossibleTarget=!0,this.currentDropTarget.issue!==undefined){var h=this.currentDropTarget.issue,g=(e=h.issues).moveIssueOntoThisIssue(n,h);n.next_item_id=g?null:h.id,n.prev_item_id=g?h.id:null,n.agile_column_filter_value=u}else{var c;e=this.currentDropTarget.model.issues,n.prev_item_id=null,0!==e.temporarySortedList.length&&(c=e.temporarySortedList[e.temporarySortedList.length-1],n.prev_item_id=c.id,d=c.agile_column_position+1),n.next_item_id=null}n.agile_column_filter_value=u,function(e,s,t){e.undo=function(){e.agile_column_position=t,e.issues.remove(e),s.add(e)}}(n,r,l),d&&(n.agile_column_position=d),t[i]={sourceIssues:r,targetIssues:e,issue:n}}}}for(i in t)s.hasOwnProperty(i)&&(s[i]._select(!1),e=t[i].targetIssues,r=t[i].sourceIssues,n=t[i].issue,e===r?($.proxy(this.listWidget.model.sendPositionChange(n),this.listWidget.model),this.listWidget.requestRepaint()):(r.remove(n),e.add(n)));this.currentDropTarget.children.length<2&&-1!=u&&this.listWidget.model.agileRootModel._fireChanges("groupBySet"),window.easyView.sticky.scheduleRebuild()}},s.prototype._capacityLoad=function(e,s){if(this.isScrum){var t=e.agile_column_filter_value,i=0,o=this.itemSettings;"estimated_hours"===this.capacityAttribute?i=e.estimated_hours_raw:"easy_story_points"===this.capacityAttribute&&(i=e.easy_story_points_raw),"input"===s?(o.sum_easy_agile_rating=o.sum_easy_agile_rating-e.old,o.sum_easy_agile_rating=o.sum_easy_agile_rating+i):-1==t&&-1!=s?(o.sum_easy_agile_rating=o.sum_easy_agile_rating-i,e.showCapacityAttribute=!1,o.sum_easy_agile_rating<0&&(o.sum_easy_agile_rating=0)):-1!=t&&-1==s&&(o.sum_easy_agile_rating=o.sum_easy_agile_rating+i,0!==i&&i||(e.showCapacityAttribute=!0)),e.showCapacityAttribute||this._capacityWidgetChange(o.capacity,o.sum_easy_agile_rating),this.listWidget.repaintRequested=!0}},s.prototype._capacityWidgetChange=function(e,s){var t=$("#current-load");s<0&&(s=0),t.find(".load-value").html(s);var i=s>e;t.toggleClass("color-positive",!i),t.toggleClass("color-negative",i)},s.prototype.moveDistance=function(){if(null==this.actualX)return 0;var e=Math.sqrt(Math.pow(this.actualX-this.startX,2)+Math.pow(this.actualY-this.startY,2));return e>this.maxDistance&&(this.maxDistance=e),e},s.prototype.destroy=function(){window.easyView.root.removeItemFromDragCollection(this.dragDomain,this),this.issue.unRegister(this),window.easyClasses.EasyWidget.prototype.destroy.apply(this),delete window.easyView.root.mapOfPossibleSelectedIssueItemWidgets[this.issue.id],this.issue=null,this.listWidget=null,this.destroyed=!0,this.$overlay&&(this.$overlay.remove(),this.$overlay=null),this.avatar&&(this.avatar.destroy(),this.avatar=null),this.$a=null,this.toolTip&&(this.toolTip.destroy(),this.toolTip=null),this.closeContextMenu&&(this.closeContextMenu(),this.closeContextMenu=null),this._suppressTooltipTimout&&window.clearTimeout(this._suppressTooltipTimout),this.toolTip=null},s.prototype.createAvatar=function(){if(!this.destroyed){this.avatar=new s(this.issue,this.listWidget,!0),this.avatar.$target=this.$overlay,this.avatar.repaint(),this.avatar.$cont.addClass("agile__card-avatar");var e=this.$cont.css("backgroundColor");"rgba(0, 0, 0, 0)"!==e&&"transparent"!==e||(e="rgba(255, 255, 255, 0.5)"),this.avatar.$cont.css({position:"absolute",top:this.actualY,left:this.actualX,zIndex:-1,height:this.$target.height(),width:this.$target.closest(".agile__list").width(),backgroundColor:e})}},s.prototype.moveAvatar=function(){this.avatar.$cont.css({position:"absolute",top:this.actualY,left:this.actualX})},s.prototype.out=function(){return this.issue},window.easyClasses.agile.IssueItemWidget=s}),EasyGem.module.part("easyAgile",["EasyWidget"],function(){function e(e,s,t,i,o,a,n){this.nameWidget=null,this.model=e,this.showTimes=o,this.showName=s,this.showSortButton=a,this.customSort=!1,this.repaintRequested=!0,this.template=i,t=t||"",this.bonusClasses=t,this.template||(this.template=easyTemplates.kanbanList),this.model.issues.register(function(e){"sort"===e&&(this.model.issues.resolvePositions(),this.repaintRequested=!0),"add"!==e&&"remove"!==e||(this._createChildren(),this.repaintRequested=!0)},this);var l=this;this.model.agileRootModel.register(function(e){"possiblePhases"===e&&(l.isAnySelectedPossible()?this.$cont.addClass("agile__list--drop-valid"):this.$cont.addClass("agile__list--drop-invalid")),"cancelPossiblePhases"===e&&(this.dropValid=!1,this.$cont.removeClass("agile__list--drop-valid"),this.$cont.removeClass("agile__list--drop-invalid")),"sort"===e&&(this.model.issues.resolvePositionsNeeded=!0,this.model.issues.resolvePositions(),this.repaintRequested=!0)},this),this._hover=!1,this._createChildren(),window.easyView.root.addItemToDragCollection(this.model.agileRootModel.dragDomain,this,n||1)}window.easyClasses=window.easyClasses||{},window.easyClasses.agile=window.easyClasses.agile||{},window.easyClasses.EasyWidget.extendByMe(e),e.prototype.insertBefore=function(e){var s=this.model.issues.temporarySortedList.indexOf(e.issue);if(-1===s)return null;for(var t=this.model.issues.temporarySortedList[s],i=s;i<this.children.length;i++)this.children[i].issue.agile_column_position++;return t},e.prototype.setDropHover=function(e){this._hover=e,e&&this.isAnySelectedPossible()?this.$cont.addClass("agile__list--drop-valid-hover"):this.$cont.removeClass("agile__list--drop-valid-hover")},e.prototype._getDraggedListItemWidget=function(){var e=window.easyView.root;return e.draggedItem.listWidget?e.draggedItem:null},e.prototype._createChildren=function(){this.showName?(this.nameWidget=new window.easyClasses.agile.ColNameWidget(this.model,this.model.agileRootModel,null,!0,this.showTimes,this.showSortButton),this.children=[this.nameWidget]):this.children=[],this.model.issues.resolvePositions();for(var e=this.model.issues.temporarySortedList,s=0;s<e.length;s++){var t=e[s];this.children.push(new window.easyClasses.agile.IssueItemWidget(t,this))}},e.prototype.destroy=function(){window.easyClasses.EasyWidget.prototype.destroy.apply(this),this.model.issues.unRegister(this),this.model.agileRootModel.unRegister(this)},e.prototype.setChildrenTarget=function(){var e=0;for(this.showName&&(this.nameWidget.$target=this.$target.find(".agile__col__title"),e=1);e<this.children.length;e++)this.children[e].$target=this.$target.find(".item_"+this.children[e].issue.id)},e.prototype.out=function(){var e={};return e.bonusClasses=this.bonusClasses,e.columnName=this.model.column.name,e.totalSpentTime=this.model.column.totalSpentTime,e.totalEstimatedTime=this.model.column.totalEstimatedTime,e.showName=this.showName,e.items=this.model.issues.temporarySortedList,e},e.prototype._functionality=function(){this.$cont=this.$target.find(".agile__list"),this.setDropHover(this._hover)},e.prototype.cancelPossiblePhases=function(){this.model.agileRootModel.cancelPossiblePhases()},e.prototype.bonusClasses="",e.prototype.getSelectedIssueListWidgets=function(){var e=[],s=window.easyView.root.mapOfPossibleSelectedIssueItemWidgets;for(var t in s)s.hasOwnProperty(t)&&s[t].selected&&e.push(s[t]);return e},e.prototype.isAnySelectedPossible=function(){var e=this.getSelectedIssueListWidgets(),s=window.easyView.root.draggedItem;s&&s.issue&&s.listWidget&&e.push(s);for(var t=0;t<e.length;t++)if(this.model.issueCanBePlacedHere(e[t].issue))return!0;return!1},window.easyClasses.agile.ListWidget=e});var scrums={};EasyGem.module.part("easyAgile",function(){window.easyLoaders.scrum=function(e,s,t){const i=function(){window.easyLoaders.scrum(e,s)};$.getJSON(s,function(o){window.easyModel=window.easyModel||{},window.easyView=window.easyView||{},window.easyTemplates.ListItem=o.settings.template_card,window.easyTemplates.issueCardWidget=o.settings.template_tooltip,window.easyTemplates.kanbanColumnName=o.settings.template_column_name;var a=easyClasses.root.loadUsers(o.settings.project_members),n=new window.easyClasses.Issues;n.loadFromJson(o.entities,a);for(var l=n.map,r=[],d=0;d<o.columns.length;d++)null!=o.columns[d]&&r.push(o.columns[d]);var u=!!e.match(/module_inside/),h=new window.easyClasses.agile.ScrumRoot({columnsData:r,update_params_prefix:o.settings.update_params_prefix,assign_param_name:o.settings.assign_param_name,settings:o.settings,url:s,swimlane:t,i18n:o.i18n,allIssuesMap:l,allMembersMap:a,contextMenuUrl:o.settings.context_menu_path,dragDomain:e,isPageModule:u,localStorageKey:easyConstants.agileSwimlanesGroupByParameter+e,reloadAgile:i}),g=scrums[e];g?(document.removeEventListener("vueModalIssueChanged",g.scrumRoot.reloadAgile,!1),g.scrumRootWidget.destroy(),g.scrumRoot.destroy(),document.addEventListener("vueModalIssueChanged",i)):document.addEventListener("vueModalIssueChanged",i);var c=new window.easyClasses.agile.ScrumRootWidget(h,!0);c.$target=$(e),window.easyView.root.add(c),scrums[e]={scrumRootWidget:c,scrumRoot:h},window.EasyVue&&window.EasyVue.modalData&&setTimeout(window.EasyVue.holdTargetWrapperHeight,300)})},window.easyLoaders.scrumDestroy=function(e){var s=scrums[e];s&&(s.scrumRootWidget.destroy(),s.scrumRoot.destroy(),delete scrums[e])},this.scrumLoader=window.easyLoaders.scrum,window.easyModel.scrums=scrums}),EasyGem.module.part("easyAgile",["ActiveClass"],function(){"use strict";function e(e){$.extend(this,window.easyMixins.agile.root),this._loadFromParams(e)}window.easyClasses=window.easyClasses||{},window.easyClasses.agile=window.easyClasses.agile||{},easyClasses.ActiveClass.extendByMe(e),e.prototype.rootModel=null,e.prototype.sendPositionChange=function(e,s){this._sendChange({},e,s)},e.prototype.columns=null,e.prototype.isBacklog=null,e.prototype.isDone=null,e.prototype.groupBy=null,e.prototype.swimLanes=null,e.prototype.done=null,e.prototype.backlog=null,e.prototype.done=null,window.easyClasses.agile.ScrumRoot=e}),EasyGem.module.part("easyAgile",["EasyWidget"],function(){function e(e,s){this.model=e,this.model.register(function(e){"dialDownloaded"===e&&this._buildSwimlanes(),"groupBySet"===e&&(this.model.isGroupBySet()?(this.backlogCol.$target.addClass("agile__col--indent"),this.doneCol.$target.addClass("agile__col--indent")):(this.backlogCol.$target.removeClass("agile__col--indent"),this.doneCol.$target.removeClass("agile__col--indent")),this._buildSwimlanes())},this);var t=new window.easyClasses.EasyRowWidget;if(this.row=t,t.bonusClasses="agile__row",this.children=[t],this.repaintRequested=!0,this.template=window.easyTemplates.kanbanRoot,this.swimLanesRowWidgets=[],s){this.backlogCol=t.addCol();var i=new window.easyClasses.agile.ListWidget(this.model.backlogIssesCol,!0,"backlog-column",null,!0,!0);this.backlogCol.bonusClasses="agile__col agile__col--side ",this.model.isGroupBySet()&&(this.backlogCol.bonusClasses+="agile__col--indent "),this.backlogCol.setWidget(i)}this._buildSwimlanes(),this.doneCol=t.addCol(),this.doneCol.bonusClasses="agile__col agile__col--side ",this.model.isGroupBySet()&&(this.doneCol.bonusClasses+="agile__col--indent "),
this.doneCol.setWidget(new window.easyClasses.agile.ListWidget(this.model.doneIssuesCol,!0,"backlog-column",null,!0));for(var o=this.model.settings.swimlane_categories,a=0;a<o.length;a++)o[a].selected=o[a].value===this.model.groupBy;this.children.push(new window.easyClasses.agile.AgileGroupSelectWidget(o,e)),this.model.isPageModule&&this.children.push(new window.easyClasses.agile.AgileSprintAutocompleteWidget(e))}window.easyClasses=window.easyClasses||{},window.easyClasses.agile=window.easyClasses.agile||{},window.easyClasses.EasyWidget.extendByMe(e),e.prototype._buildSwimlanes=function(){this.model._sortSwimlanes();var e,s=this.row.addCol(1),t=this.model.middleColumns,i=this.model.middleColumnsOrdering;if(s.bonusClasses="agile__main-col agile__col",s.bonusStyle={flexGrow:Object.keys(t).length},this.model.isGroupBySet()){var o=s.addRow();for(o.isSticky=!0,o.bonusClasses+="agile__row",e=0;e<i.length;e++){var a=t[i[e]],n=o.addCol();n.bonusClasses="agile__col",n.setWidget(new window.easyClasses.agile.ColNameWidget(a,this.model,null,!1,!0))}}for(e=0;e<this.model.swimLanes.length;e++){var l=s.addRow();l.bonusClasses+="agile__row",l.setWidget(new window.easyClasses.agile.SwimLaneWidget(this.model.swimLanes[e],null,!0)),this.swimLanesRowWidgets.push(l)}if(this.model.stickyLane){var r=s.addRow();r.bonusClasses+="agile__row agile__sticky-lane",r.setWidget(new window.easyClasses.agile.StickyLaneWidget(this.model.stickyLane))}},e.prototype.swimLanesRowWidgets=null,e.prototype.setChildTarget=function(e,s){e.childTarget?e.$target=this.$target.find(e.childTarget):e.$target=0===s?this.$target.find(".easy-row"):1===s?this.$target.find(".agile__swimline-select"):this.$target.find(".agile__sprint-select")},e.prototype.model=null,e.prototype.destroy=function(){window.easyClasses.EasyWidget.prototype.destroy.apply(this),window.easyView.root.remove(this)},window.easyClasses.agile.ScrumRootWidget=e}),EasyGem.module.part("easyAgile",["EasyWidget"],function(){function e(e){this.children=[],this.repaintRequested=!0,this.template=easyTemplates.kanbanSprintSelect,this.rootModel=e,this.sprintsUrl=this.rootModel.settings.sprint_autocomplete_url,this.moduleId=this.rootModel.dragDomain.slice(1,-1),this.sprintName=this.rootModel.settings.current_sprint.name,this.labeSprint=this.rootModel.i18n.sprint}window.easyClasses=window.easyClasses||{},window.easyClasses.agile=window.easyClasses.agile||{},easyClasses.EasyWidget.extendByMe(e),e.prototype.out=function(){return{moduleId:this.moduleId,label:this.sprintName,sprint:this.labeSprint}},e.prototype._functionality=function(){var e=this,s=e.rootModel.url,t=/easy_sprint_id=\d+/,i="sprint_autocomplete_"+e.moduleId;easyAutocomplete(i,e.sprintsUrl,function(i,o){if(o.item){var a=s.replace(t,"easy_sprint_id="+o.item.id);EasyGem.loadModule("easyAgile",function(s){s.scrumLoader(e.rootModel.dragDomain,a,"")})}},"easy_sprints")},window.easyClasses.agile.AgileSprintAutocompleteWidget=e}),EasyGem.module.part("easyAgile",["ActiveClass"],function(){"use strict";function e(e,s){this.cols=[],this.kanbanRoot=e,this.order=5e5,this.possibleValues=[],this._onChange=[];for(var t=Object.keys(s),i=0;i<t.length;i++){var o=s[t[i]];this.possibleValues.push({id:t[i],label:o.name,order:o.order})}this.possibleValues.sort(function(e,s){return e.order-s.order}),this.possibleValues.length&&this.changeValue(this.possibleValues[0])}window.easyClasses=window.easyClasses||{},window.easyClasses.agile=window.easyClasses.agile||{},easyClasses.ActiveClass.extendByMe(e),e.prototype.kanbanRoot=null,e.prototype.item={id:0,label:"---"},e.prototype.changeValue=function(e){this.item=e;var s=e.id;this.cols=[];for(var t=this.kanbanRoot.middleColumnsOrdering,i=0;i<t.length;i++){for(var o=this.kanbanRoot.middleColumns[t[i]],a=0;a<o.issuesList.length;a++){var n=o.issuesList[a];if(n.filterValue==s)break}this.cols.push(new window.easyClasses.agile.IssuesCol(n,this,o,this.kanbanRoot))}this._fireChanges(e)},e.prototype.cols=null,e.prototype.getData=function(){for(var e=[],s=0;s<this.cols.length;s++)e.push(this.cols[s].getData());return e},e.prototype.name="",window.easyClasses.agile.StickyLane=e}),EasyGem.module.part("easyAgile",["EasyWidget"],function(){"use strict";function e(e,s){this.children=[],this.template=s,s||(this.template=window.easyTemplates.kanbanStickyLane),this.$row=null,this.repaintRequested=!0,this.model=e,this.model.register($.proxy(this.onChange,this)),this.onChange();var t=this;$(window).on("resize",function(){t.repaintRequested=!0}),$(document).on("easySidebarToggled",function(){t.repaintRequested=!0}),this.model.kanbanRoot.register(function(e){"possiblePhases"===e&&this.$target.addClass("agile__sticky-lane--drop"),"cancelPossiblePhases"===e&&this.$target.removeClass("agile__sticky-lane--drop")},this)}window.easyClasses=window.easyClasses||{},window.easyClasses.agile=window.easyClasses.agile||{},window.easyClasses.EasyWidget.extendByMe(e),e.prototype.setChildTarget=function(e,s){e.$target=this.$target.find(".col"+s)},e.prototype.getColWidth=function(){return 100/this.children.length-.001},e.prototype.onChange=function(){this.repaintRequested=!0,this.children=[];for(var e=0;e<this.model.cols.length;e++)this.children.push(new window.easyClasses.agile.SwimLaneColWidget(this.model.cols[e],this,null,!0,3))},e.prototype.destroy=function(){window.easyClasses.EasyWidget.prototype.destroy.apply(this),this.model.kanbanRoot.unRegister(this)},e.prototype._functionality=function(){var e=this,s="agile_sticky_select_for_"+this.model.kanbanRoot.dragDomain.slice(1,-1);easyAutocomplete(s,function(s,t){t($.ui.autocomplete.filter(e.model.possibleValues,s.term).slice(0,15))},function(s,t){t.item&&t.item.id&&e.model.changeValue(t.item)},this.model.possibleValues[0],{activate_on_input_click:!0,no_button:!0}),this.$target.find("input").attr("type","text"),$(".agile__sticky_button_go-to_"+s).on("click",function(t){EasyGem.readAndRender(function(){return{anchorName:"[name='"+$("#"+t.currentTarget.dataset.select).val()+"_"+s+"']",heightFromTop:-1*$("#top-menu").outerHeight()}},function(e){scrollTo(e.anchorName,e.heightFromTop)},e)})},e.prototype._refreshExpanded=function(){this.$row.toggle(this.expanded),this.$target.find("hr").toggle(!this.expanded),this.$target.find(".icon").toggleClass("icon-remove",this.expanded).toggleClass("icon-add",!this.expanded)},e.prototype.out=function(){for(var e="agile_sticky_select_for_"+this.model.kanbanRoot.dragDomain.slice(1,-1),s=[],t=0;t<this.children.length;t++)s.push(t);return{cols:s,item:this.model.item,goTo:I18n.buttonGoTo,stickySelectName:e}},window.easyClasses.agile.StickyLaneWidget=e});