function restArguments(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),i=Array(n),r=0;r<n;r++)i[r]=arguments[r+e];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,arguments[0],i);case 2:return t.call(this,arguments[0],arguments[1],i)}var o=Array(e+1);for(r=0;r<e;r++)o[r]=arguments[r];return o[e]=i,t.apply(this,o)}}function isObject(t){var e=typeof t;return"function"===e||"object"===e&&!!t}function isNull(t){return null===t}function isUndefined(t){return void 0===t}function isBoolean(t){return!0===t||!1===t||"[object Boolean]"===toString.call(t)}function isElement(t){return!(!t||1!==t.nodeType)}function tagTester(t){return function(e){return toString.call(e)==="[object "+t+"]"}}function has(t,e){return null!=t&&hasOwnProperty.call(t,e)}function isFinite$1(t){return!isSymbol(t)&&_isFinite(t)&&!isNaN(parseFloat(t))}function isNaN$1(t){return isNumber(t)&&_isNaN(t)}function constant(t){return function(){return t}}function createSizePropertyCheck(t){return function(e){var n=t(e);return"number"==typeof n&&n>=0&&n<=MAX_ARRAY_INDEX}}function shallowProperty(t){return function(e){return null==e?void 0:e[t]}}function isTypedArray(t){return nativeIsView?nativeIsView(t)&&!isDataView(t):isBufferLike(t)&&typedArrayPattern.test(toString.call(t))}function emulatedSet(t){for(var e={},n=t.length,i=0;i<n;++i)e[t[i]]=!0;return{contains:function(t){return e[t]},push:function(n){return e[n]=!0,t.push(n)}}}function collectNonEnumProps(t,e){e=emulatedSet(e);var n=nonEnumerableProps.length,i=t.constructor,r=isFunction$1(i)&&i.prototype||ObjProto,o="constructor";for(has(t,o)&&!e.contains(o)&&e.push(o);n--;)(o=nonEnumerableProps[n])in t&&t[o]!==r[o]&&!e.contains(o)&&e.push(o)}function keys(t){if(!isObject(t))return[];if(nativeKeys)return nativeKeys(t);var e=[];for(var n in t)has(t,n)&&e.push(n);return hasEnumBug&&collectNonEnumProps(t,e),e}function isEmpty(t){return null==t||(isArrayLike(t)&&(isArray(t)||isString(t)||isArguments$1(t))?0===t.length:0===keys(t).length)}function isMatch(t,e){var n=keys(e),i=n.length;if(null==t)return!i;for(var r=Object(t),o=0;o<i;o++){var s=n[o];if(e[s]!==r[s]||!(s in r))return!1}return!0}function _(t){return t instanceof _?t:this instanceof _?void(this._wrapped=t):new _(t)}function eq(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var r=typeof t;return("function"===r||"object"===r||"object"==typeof e)&&deepEq(t,e,n,i)}function deepEq(t,e,n,i){t instanceof _&&(t=t._wrapped),e instanceof _&&(e=e._wrapped);var r=toString.call(t);if(r!==toString.call(e))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return SymbolProto.valueOf.call(t)===SymbolProto.valueOf.call(e);case"[object ArrayBuffer]":return deepEq(new DataView(t),new DataView(e),n,i);case"[object DataView]":var o=getByteLength(t);if(o!==getByteLength(e))return!1;for(;o--;)if(t.getUint8(o)!==e.getUint8(o))return!1;return!0}if(isTypedArray$1(t))return deepEq(new DataView(t.buffer),new DataView(e.buffer),n,i);var s="[object Array]"===r;if(!s){if("object"!=typeof t||"object"!=typeof e)return!1;var a=t.constructor,u=e.constructor;if(a!==u&&!(isFunction$1(a)&&a instanceof a&&isFunction$1(u)&&u instanceof u)&&"constructor"in t&&"constructor"in e)return!1}i=i||[];for(var d=(n=n||[]).length;d--;)if(n[d]===t)return i[d]===e;if(n.push(t),i.push(e),s){if((d=t.length)!==e.length)return!1;for(;d--;)if(!eq(t[d],e[d],n,i))return!1}else{var l,c=keys(t);if(d=c.length,keys(e).length!==d)return!1;for(;d--;)if(!has(e,l=c[d])||!eq(t[l],e[l],n,i))return!1}return n.pop(),i.pop(),!0}function isEqual(t,e){return eq(t,e)}function allKeys(t){if(!isObject(t))return[];var e=[];for(var n in t)e.push(n);return hasEnumBug&&collectNonEnumProps(t,e),e}function values(t){for(var e=keys(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=t[e[r]];return i}function pairs(t){for(var e=keys(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=[e[r],t[e[r]]];return i}function invert(t){for(var e={},n=keys(t),i=0,r=n.length;i<r;i++)e[t[n[i]]]=n[i];return e}function functions(t){var e=[];for(var n in t)isFunction$1(t[n])&&e.push(n);return e.sort()}function createAssigner(t,e){return function(n){var i=arguments.length;if(e&&(n=Object(n)),i<2||null==n)return n;for(var r=1;r<i;r++)for(var o=arguments[r],s=t(o),a=s.length,u=0;u<a;u++){var d=s[u];e&&void 0!==n[d]||(n[d]=o[d])}return n}}function ctor(){return function(){}}function baseCreate(t){if(!isObject(t))return{};if(nativeCreate)return nativeCreate(t);var e=ctor();e.prototype=t;var n=new e;return e.prototype=null,n}function create(t,e){var n=baseCreate(t);return e&&extendOwn(n,e),n}function clone(t){return isObject(t)?isArray(t)?t.slice():extend({},t):t}function tap(t,e){return e(t),t}function has$1(t,e){if(!isArray(e))return has(t,e);for(var n=e.length,i=0;i<n;i++){var r=e[i];if(null==t||!hasOwnProperty.call(t,r))return!1;t=t[r]}return!!n}function identity(t){return t}function matcher(t){return t=extendOwn({},t),function(e){return isMatch(e,t)}}function deepGet(t,e){for(var n=e.length,i=0;i<n;i++){if(null==t)return;t=t[e[i]]}return n?t:void 0}function property(t){return isArray(t)?function(e){return deepGet(e,t)}:shallowProperty(t)}function optimizeCb(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,i,r){return t.call(e,n,i,r)};case 4:return function(n,i,r,o){return t.call(e,n,i,r,o)}}return function(){return t.apply(e,arguments)}}function baseIteratee(t,e,n){return null==t?identity:isFunction$1(t)?optimizeCb(t,e,n):isObject(t)&&!isArray(t)?matcher(t):property(t)}function iteratee(t,e){return baseIteratee(t,e,Infinity)}function cb(t,e,n){return _.iteratee!==iteratee?_.iteratee(t,e):baseIteratee(t,e,n)}function mapObject(t,e,n){e=cb(e,n);for(var i=keys(t),r=i.length,o={},s=0;s<r;s++){var a=i[s];o[a]=e(t[a],a,t)}return o}function noop(){}function propertyOf(t){return null==t?function(){}:function(e){return isArray(e)?deepGet(t,e):t[e]}}function times(t,e,n){var i=Array(Math.max(0,t));e=optimizeCb(e,n,1);for(var r=0;r<t;r++)i[r]=e(r);return i}function random(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}function createEscaper(t){var e=function(e){return t[e]},n="(?:"+keys(t).join("|")+")",i=RegExp(n),r=RegExp(n,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(r,e):t}}function escapeChar(t){return"\\"+escapes[t]}function template(t,e,n){!e&&n&&(e=n),e=defaults({},e,_.templateSettings);var i,r=RegExp([(e.escape||noMatch).source,(e.interpolate||noMatch).source,(e.evaluate||noMatch).source].join("|")+"|$","g"),o=0,s="__p+='";t.replace(r,function(e,n,i,r,a){return s+=t.slice(o,a).replace(escapeRegExp,escapeChar),o=a+e.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?s+="'+\n((__t=("+i+"))==null?'':__t)+\n'":r&&(s+="';\n"+r+"\n__p+='"),e}),s+="';\n",e.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{i=new Function(e.variable||"obj","_",s)}catch(d){throw d.source=s,d}var a=function(t){return i.call(this,t,_)},u=e.variable||"obj";return a.source="function("+u+"){\n"+s+"}",a}function result(t,e,n){isArray(e)||(e=[e]);var i=e.length;if(!i)return isFunction$1(n)?n.call(t):n;for(var r=0;r<i;r++){var o=null==t?void 0:t[e[r]];void 0===o&&(o=n,r=i),t=isFunction$1(o)?o.call(t):o}return t}function uniqueId(t){var e=++idCounter+"";return t?t+e:e}function chain(t){var e=_(t);return e._chain=!0,e}function executeBound(t,e,n,i,r){if(!(i instanceof e))return t.apply(n,r);var o=baseCreate(t.prototype),s=t.apply(o,r);return isObject(s)?s:o}function flatten(t,e,n,i){if(i=i||[],e||0===e){if(e<=0)return i.concat(t)}else e=Infinity;for(var r=i.length,o=0,s=getLength(t);o<s;o++){var a=t[o];if(isArrayLike(a)&&(isArray(a)||isArguments$1(a)))if(e>1)flatten(a,e-1,n,i),r=i.length;else for(var u=0,d=a.length;u<d;)i[r++]=a[u++];else n||(i[r++]=a)}return i}function memoize(t,e){var n=function(i){var r=n.cache,o=""+(e?e.apply(this,arguments):i);return has(r,o)||(r[o]=t.apply(this,arguments)),r[o]};return n.cache={},n}function throttle(t,e,n){var i,r,o,s,a=0;n||(n={});var u=function(){a=!1===n.leading?0:now(),i=null,s=t.apply(r,o),i||(r=o=null)},d=function(){var d=now();a||!1!==n.leading||(a=d);var l=e-(d-a);return r=this,o=arguments,l<=0||l>e?(i&&(clearTimeout(i),i=null),a=d,s=t.apply(r,o),i||(r=o=null)):i||!1===n.trailing||(i=setTimeout(u,l)),s};return d.cancel=function(){clearTimeout(i),a=0,i=r=o=null},d}function debounce(t,e,n){var i,r,o=function(e,n){i=null,n&&(r=t.apply(e,n))},s=restArguments(function(s){if(i&&clearTimeout(i),n){var a=!i;i=setTimeout(o,e),a&&(r=t.apply(this,s))}else i=delay(o,e,this,s);return r});return s.cancel=function(){clearTimeout(i),i=null},s}function wrap(t,e){return partial(e,t)}function negate(t){return function(){return!t.apply(this,arguments)}}function compose(){var t=arguments,e=t.length-1;return function(){for(var n=e,i=t[e].apply(this,arguments);n--;)i=t[n].call(this,i);return i}}function after(t,e){return function(){if(--t<1)return e.apply(this,arguments)}}function before(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}}function findKey(t,e,n){e=cb(e,n);for(var i,r=keys(t),o=0,s=r.length;o<s;o++)if(e(t[i=r[o]],i,t))return i}function createPredicateIndexFinder(t){return function(e,n,i){n=cb(n,i);for(var r=getLength(e),o=t>0?0:r-1;o>=0&&o<r;o+=t)if(n(e[o],o,e))return o;return-1}}function sortedIndex(t,e,n,i){for(var r=(n=cb(n,i,1))(e),o=0,s=getLength(t);o<s;){var a=Math.floor((o+s)/2);n(t[a])<r?o=a+1:s=a}return o}function createIndexFinder(t,e,n){return function(i,r,o){var s=0,a=getLength(i);if("number"==typeof o)t>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(n&&o&&a)return i[o=n(i,r)]===r?o:-1;if(r!=r)return(o=e(slice.call(i,s,a),isNaN$1))>=0?o+s:-1;for(o=t>0?s:a-1;o>=0&&o<a;o+=t)if(i[o]===r)return o;return-1}}function find(t,e,n){var i=(isArrayLike(t)?findIndex:findKey)(t,e,n);if(void 0!==i&&-1!==i)return t[i]}function findWhere(t,e){return find(t,matcher(e))}function each(t,e,n){var i,r;if(e=optimizeCb(e,n),isArrayLike(t))for(i=0,r=t.length;i<r;i++)e(t[i],i,t);else{var o=keys(t);for(i=0,r=o.length;i<r;i++)e(t[o[i]],o[i],t)}return t}function map(t,e,n){e=cb(e,n);for(var i=!isArrayLike(t)&&keys(t),r=(i||t).length,o=Array(r),s=0;s<r;s++){var a=i?i[s]:s;o[s]=e(t[a],a,t)}return o}function createReduce(t){var e=function(e,n,i,r){var o=!isArrayLike(e)&&keys(e),s=(o||e).length,a=t>0?0:s-1;for(r||(i=e[o?o[a]:a],a+=t);a>=0&&a<s;a+=t){var u=o?o[a]:a;i=n(i,e[u],u,e)}return i};return function(t,n,i,r){var o=arguments.length>=3;return e(t,optimizeCb(n,r,4),i,o)}}function filter(t,e,n){var i=[];return e=cb(e,n),each(t,function(t,n,r){e(t,n,r)&&i.push(t)}),i}function reject(t,e,n){return filter(t,negate(cb(e)),n)}function every(t,e,n){e=cb(e,n);for(var i=!isArrayLike(t)&&keys(t),r=(i||t).length,o=0;o<r;o++){var s=i?i[o]:o;if(!e(t[s],s,t))return!1}return!0}function some(t,e,n){e=cb(e,n);for(var i=!isArrayLike(t)&&keys(t),r=(i||t).length,o=0;o<r;o++){var s=i?i[o]:o;if(e(t[s],s,t))return!0}return!1}function contains(t,e,n,i){return isArrayLike(t)||(t=values(t)),("number"!=typeof n||i)&&(n=0),indexOf(t,e,n)>=0}function pluck(t,e){return map(t,property(e))}function where(t,e){return filter(t,matcher(e))}function max(t,e,n){var i,r,o=-Infinity,s=-Infinity;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var a=0,u=(t=isArrayLike(t)?t:values(t)).length;a<u;a++)null!=(i=t[a])&&i>o&&(o=i);else e=cb(e,n),each(t,function(t,n,i){((r=e(t,n,i))>s||r===-Infinity&&o===-Infinity)&&(o=t,s=r)});return o}function min(t,e,n){var i,r,o=Infinity,s=Infinity;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var a=0,u=(t=isArrayLike(t)?t:values(t)).length;a<u;a++)null!=(i=t[a])&&i<o&&(o=i);else e=cb(e,n),each(t,function(t,n,i){((r=e(t,n,i))<s||r===Infinity&&o===Infinity)&&(o=t,s=r)});return o}function sample(t,e,n){if(null==e||n)return isArrayLike(t)||(t=values(t)),t[random(t.length-1)];var i=isArrayLike(t)?clone(t):values(t),r=getLength(i);e=Math.max(Math.min(e,r),0);for(var o=r-1,s=0;s<e;s++){var a=random(s,o),u=i[s];i[s]=i[a],i[a]=u}return i.slice(0,e)}function shuffle(t){return sample(t,Infinity)}function sortBy(t,e,n){var i=0;return e=cb(e,n),pluck(map(t,function(t,n,r){return{value:t,index:i++,criteria:e(t,n,r)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return t.index-e.index}),"value")}function group(t,e){return function(n,i,r){var o=e?[[],[]]:{};return i=cb(i,r),each(n,function(e,r){var s=i(e,r,n);t(o,e,s)}),o}}function toArray(t){return t?isArray(t)?slice.call(t):isString(t)?t.match(reStrSymbol):isArrayLike(t)?map(t,identity):values(t):[]}function size(t){return null==t?0:isArrayLike(t)?t.length:keys(t).length}function keyInObj(t,e,n){return e in n}function initial(t,e,n){return slice.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))}function first(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[0]:initial(t,t.length-e)}function rest(t,e,n){return slice.call(t,null==e||n?1:e)}function last(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[t.length-1]:rest(t,Math.max(0,t.length-e))}function compact(t){return filter(t,Boolean)}function flatten$1(t,e){return flatten(t,e,!1)}function uniq(t,e,n,i){isBoolean(e)||(i=n,n=e,e=!1),null!=n&&(n=cb(n,i));for(var r=[],o=[],s=0,a=getLength(t);s<a;s++){var u=t[s],d=n?n(u,s,t):u;e&&!n?(s&&o===d||r.push(u),o=d):n?contains(o,d)||(o.push(d),r.push(u)):contains(r,u)||r.push(u)}return r}function intersection(t){for(var e=[],n=arguments.length,i=0,r=getLength(t);i<r;i++){var o=t[i];if(!contains(e,o)){var s;for(s=1;s<n&&contains(arguments[s],o);s++);s===n&&e.push(o)}}return e}function unzip(t){for(var e=t&&max(t,getLength).length||0,n=Array(e),i=0;i<e;i++)n[i]=pluck(t,i);return n}function object(t,e){for(var n={},i=0,r=getLength(t);i<r;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n}function range(t,e,n){null==e&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var i=Math.max(Math.ceil((e-t)/n),0),r=Array(i),o=0;o<i;o++,t+=n)r[o]=t;return r}function chunk(t,e){if(null==e||e<1)return[];for(var n=[],i=0,r=t.length;i<r;)n.push(slice.call(t,i,i+=e));return n}function chainResult(t,e){return t._chain?_(e).chain():e}function mixin(t){return each(functions(t),function(e){var n=_[e]=t[e];_.prototype[e]=function(){var t=[this._wrapped];return push.apply(t,arguments),chainResult(this,n.apply(_,t))}}),_}if(void 0===net)var net={};net.brehaut||(net.brehaut={}),function(){"use strict";function t(t,e){t=t.toString();for(var n=[],i=0,r=Math.max(e-t.length,0);i<r;i++)n.push("0");return n.push(t),n.join("")}function e(t){return t.slice(0,1).toUpperCase()+t.slice(1)}function n(t){return t.replace(/^\s+|\s+$/g,"")}function i(t){return function(){var e=this.clone();return t.apply(e,arguments),e}}function r(t,n){function i(t){return function(){return t.apply(this[u](),arguments)}}function r(){}function o(){return new r}var s=v(l),a=[],u="to"+e(t);for(var d in n)if(n.hasOwnProperty(d)){s[d]=n[d];var c=s[d];if("_"==d.slice(0,1))continue;if(d in l||"function"!=typeof c){if("function"!=typeof c){a.push(d);var h="get"+e(d),p="set"+e(d);l[h]=i(s[h]=function(t){return function(){return this[t]}}(d)),l[p]=i(s[p]=function(t){return function(e){var n=this.clone();return n[t]=e,n}}(d))}}else l[d]=i(c)}return r.prototype=s,m[t]=o,s.clone=function(){for(var t=o(),e=0,n=a.length;e<n;e++){var i=a[e];t[i]=this[i]}return t},l[u]=function(){return o()},g.push(s),s}function o(t){return l.fromObject(t)}var s={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370D8",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#D87093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},a="(?:\\+|-)?\\d+",u="(?:\\+|-)?\\d*\\.\\d+",d="(?:"+a+")|(?:"+u+")";a="("+a+")",u="("+u+")";var l,c=(d="("+d+")")+"%",h="\\s*?",p=new RegExp(["^hsl(a?)\\(",d,",",c,",",c,"(,(",d,"))?\\)$"].join(h)),f=new RegExp(["^rgb(a?)\\(",a,",",a,",",a,"(,(",d,"))?\\)$"].join(h)),y=new RegExp(["^rgb(a?)\\(",c,",",c,",",c,"(,(",d,"))?\\)$"].join(h)),g=[],m={};this.object||(this.object=function(t){function e(){}return e.prototype=t,new e});var v=this.object;l={fromObject:function(t){if(!t)return v(l);for(var e=0,n=g.length;e<n;e++){var i=g[e].fromObject(t);if(i)return i}return v(l)},toString:function(){return this.toCSS()}};var w=null;r("RGB",{red:0,green:0,blue:0,alpha:0,getLuminance:function(){return.2126*this.red+.7152*this.green+.0722*this.blue},blend:function(t,e){t=t.toRGB(),e=Math.min(Math.max(e,0),1);var n=this.clone();return n.red=n.red*(1-e)+t.red*e,n.green=n.green*(1-e)+t.green*e,n.blue=n.blue*(1-e)+t.blue*e,n.alpha=n.alpha*(1-e)+t.alpha*e,n},fromObject:function(t){return t instanceof Array?this._fromRGBArray(t):"string"==typeof t?this._fromCSS(n(t)):t.hasOwnProperty("red")&&t.hasOwnProperty("green")&&t.hasOwnProperty("blue")?this._fromRGB(t):void 0},_stringParsers:[function(t){function e(e,n){var i=t.match(e);if(!i||!!i[1]+!!i[5]===1)return null;var r=m.RGB();return r.red=Math.min(1,Math.max(0,i[2]/n)),r.green=Math.min(1,Math.max(0,i[3]/n)),r.blue=Math.min(1,Math.max(0,i[4]/n)),r.alpha=i[5]?Math.min(Math.max(parseFloat(i[6]),0),1):1,r}t=n(t);var i=e(f,255);return i||e(y,100)},function(t){var e=t.toLowerCase();if(e in s&&(t=s[e]),t.match(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/)){var n=(t=t.replace(/^#/,"")).length/3,i=Math.pow(16,n)-1,r=m.RGB();return r.red=parseInt(t.slice(0,n),16)/i,r.green=parseInt(t.slice(1*n,2*n),16)/i,r.blue=parseInt(t.slice(2*n),16)/i,r.alpha=1,r}},function(t){if("transparent"===t.toLowerCase())return w}],_fromCSS:function(t){for(var e=null,n=0,i=this._stringParsers.length;n<i;n++)if(e=this._stringParsers[n](t))return e},_fromRGB:function(t){var e=m.RGB();return e.red=t.red,e.green=t.green,e.blue=t.blue,e.alpha=t.hasOwnProperty("alpha")?t.alpha:1,e},_fromRGBArray:function(t){var e=m.RGB();return e.red=Math.max(0,Math.min(1,t[0]/255)),e.green=Math.max(0,Math.min(1,t[1]/255)),e.blue=Math.max(0,Math.min(1,t[2]/255)),e.alpha=t[3]!==undefined?Math.max(0,Math.min(1,t[3])):1,e},toCSSHex:function(e){e=e||2;var n=Math.pow(16,e)-1;return["#",t(Math.round(this.red*n).toString(16).toUpperCase(),e),t(Math.round(this.green*n).toString(16).toUpperCase(),e),t(Math.round(this.blue*n).toString(16).toUpperCase(),e)].join("")},toCSS:function(t){if(1===this.alpha)return this.toCSSHex(t);var e=255;return["rgba(",Math.max(0,Math.min(e,Math.round(this.red*e))),",",Math.max(0,Math.min(e,Math.round(this.green*e))),",",Math.max(0,Math.min(e,Math.round(this.blue*e))),",",Math.max(0,Math.min(1,this.alpha)),")"].join("")},toHSV:function(){var t,e,n,i=m.HSV();return t=Math.min(this.red,this.green,this.blue),e=Math.max(this.red,this.green,this.blue),i.value=e,0==(n=e-t)?i.hue=i.saturation=0:(i.saturation=n/e,this.red==e?i.hue=(this.green-this.blue)/n:this.green==e?i.hue=2+(this.blue-this.red)/n:i.hue=4+(this.red-this.green)/n,i.hue=(60*i.hue+360)%360),i.alpha=this.alpha,i},toHSL:function(){return this.toHSV().toHSL()},toRGB:function(){return this.clone()}}),w=l.fromObject({red:0,blue:0,green:0,alpha:0}),r("HSV",{hue:0,saturation:0,value:1,alpha:1,shiftHue:i(function(t){var e=(this.hue+t)%360;e<0&&(e=(360+e)%360),this.hue=e}),devalueByAmount:i(function(t){this.value=Math.min(1,Math.max(this.value-t,0))}),devalueByRatio:i(function(t){this.value=Math.min(1,Math.max(this.value*(1-t),0))}),valueByAmount:i(function(t){this.value=Math.min(1,Math.max(this.value+t,0))}),valueByRatio:i(function(t){this.value=Math.min(1,Math.max(this.value*(1+t),0))}),desaturateByAmount:i(function(t){this.saturation=Math.min(1,Math.max(this.saturation-t,0))}),desaturateByRatio:i(function(t){this.saturation=Math.min(1,Math.max(this.saturation*(1-t),0))}),saturateByAmount:i(function(t){this.saturation=Math.min(1,Math.max(this.saturation+t,0))}),saturateByRatio:i(function(t){this.saturation=Math.min(1,Math.max(this.saturation*(1+t),0))}),schemeFromDegrees:function(t){for(var e=[],n=0,i=t.length;n<i;n++){var r=this.clone();r.hue=(this.hue+t[n])%360,e.push(r)}return e},complementaryScheme:function(){return this.schemeFromDegrees([0,180])},splitComplementaryScheme:function(){return this.schemeFromDegrees([0,150,320])},splitComplementaryCWScheme:function(){return this.schemeFromDegrees([0,150,300])},splitComplementaryCCWScheme:function(){return this.schemeFromDegrees([0,60,210])},triadicScheme:function(){return this.schemeFromDegrees([0,120,240])},clashScheme:function(){return this.schemeFromDegrees([0,90,270])},tetradicScheme:function(){return this.schemeFromDegrees([0,90,180,270])},fourToneCWScheme:function(){return this.schemeFromDegrees([0,60,180,240])},fourToneCCWScheme:function(){return this.schemeFromDegrees([0,120,180,300])},fiveToneAScheme:function(){return this.schemeFromDegrees([0,115,155,205,245])},fiveToneBScheme:function(){return this.schemeFromDegrees([0,40,90,130,245])},fiveToneCScheme:function(){return this.schemeFromDegrees([0,50,90,205,320])},fiveToneDScheme:function(){return this.schemeFromDegrees([0,40,155,270,310])},fiveToneEScheme:function(){return this.schemeFromDegrees([0,115,230,270,320])},sixToneCWScheme:function(){return this.schemeFromDegrees([0,30,120,150,240,270])},sixToneCCWScheme:function(){return this.schemeFromDegrees([0,90,120,210,240,330])},neutralScheme:function(){return this.schemeFromDegrees([0,15,30,45,60,75])},analogousScheme:function(){return this.schemeFromDegrees([0,30,60,90,120,150])},fromObject:function(t){if(t.hasOwnProperty("hue")&&t.hasOwnProperty("saturation")&&t.hasOwnProperty("value")){var e=m.HSV();return e.hue=t.hue,e.saturation=t.saturation,e.value=t.value,e.alpha=t.hasOwnProperty("alpha")?t.alpha:1,e}return null},_normalise:function(){this.hue%=360,this.saturation=Math.min(Math.max(0,this.saturation),1),this.value=Math.min(Math.max(0,this.value)),this.alpha=Math.min(1,Math.max(0,this.alpha))},toRGB:function(){this._normalise();var t,e,n,i,r,o=m.RGB();if(0===this.saturation)return o.red=this.value,o.green=this.value,o.blue=this.value,o.alpha=this.alpha,o;var s=this.hue/60;switch(e=s-(t=Math.floor(s)),n=this.value*(1-this.saturation),i=this.value*(1-this.saturation*e),r=this.value*(1-this.saturation*(1-e)),t){case 0:o.red=this.value,o.green=r,o.blue=n;break;case 1:o.red=i,o.green=this.value,o.blue=n;break;case 2:o.red=n,o.green=this.value,o.blue=r;break;case 3:o.red=n,o.green=i,o.blue=this.value;break;case 4:o.red=r,o.green=n,o.blue=this.value;break;default:o.red=this.value,o.green=n,o.blue=i}return o.alpha=this.alpha,o},toHSL:function(){this._normalise();var t=m.HSL();t.hue=this.hue;var e=(2-this.saturation)*this.value,n=this.saturation*this.value;return e&&2-e&&(n/=e<=1?e:2-e),e/=2,t.saturation=n,t.lightness=e,t.alpha=this.alpha,t},toHSV:function(){return this.clone()}}),r("HSL",{hue:0,saturation:0,lightness:0,alpha:1,darkenByAmount:i(function(t){this.lightness=Math.min(1,Math.max(this.lightness-t,0))}),darkenByRatio:i(function(t){this.lightness=Math.min(1,Math.max(this.lightness*(1-t),0))}),lightenByAmount:i(function(t){this.lightness=Math.min(1,Math.max(this.lightness+t,0))}),lightenByRatio:i(function(t){this.lightness=Math.min(1,Math.max(this.lightness*(1+t),0))}),fromObject:function(t){return"string"==typeof t?this._fromCSS(t):t.hasOwnProperty("hue")&&t.hasOwnProperty("saturation")&&t.hasOwnProperty("lightness")?this._fromHSL(t):void 0},_fromCSS:function(t){var e=n(t).match(p);if(!e||!!e[1]+!!e[5]===1)return null;var i=m.HSL();return i.hue=(e[2]%360+360)%360,i.saturation=Math.max(0,Math.min(parseInt(e[3],10)/100,1)),i.lightness=Math.max(0,Math.min(parseInt(e[4],10)/100,1)),i.alpha=e[5]?Math.max(0,Math.min(1,parseFloat(e[6]))):1,i},_fromHSL:function(t){var e=m.HSL();return e.hue=t.hue,e.saturation=t.saturation,e.lightness=t.lightness,e.alpha=t.hasOwnProperty("alpha")?t.alpha:1,e},_normalise:function(){this.hue=(this.hue%360+360)%360,this.saturation=Math.min(Math.max(0,this.saturation),1),this.lightness=Math.min(Math.max(0,this.lightness)),this.alpha=Math.min(1,Math.max(0,this.alpha))},toHSL:function(){return this.clone()},toHSV:function(){this._normalise();var t=m.HSV();t.hue=this.hue;var e=2*this.lightness,n=this.saturation*(e<=1?e:2-e);return t.value=(e+n)/2,t.saturation=2*n/(e+n)||0,t.alpha=this.alpha,t},toRGB:function(){return this.toHSV().toRGB()}}),o.isValid=function(t){var e,n=o(t),i=0;for(e in n)n.hasOwnProperty(e)&&i++;return i>0},net.brehaut.Color=o}.call(net.brehaut),"undefined"!=typeof module&&(module.exports=net.brehaut.Color),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Mustache=e()}(this,function(){"use strict";function t(t){return"function"==typeof t}function e(t){return y(t)?"array":typeof t}function n(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(t,e){return null!=t&&"object"==typeof t&&e in t}function r(t,e){return null!=t&&"object"!=typeof t&&t.hasOwnProperty&&t.hasOwnProperty(e)}function o(t,e){return g.call(t,e)}function s(t){return!o(m,t)}function a(t){return String(t).replace(/[&<>"'`=\/]/g,function(t){return v[t]})}function u(t,e){function i(){if(m&&!v)for(;g.length;)delete f[g.pop()];else g=[];m=!1,v=!1}function r(t){if("string"==typeof t&&(t=t.split(b,2)),!y(t)||2!==t.length)throw new Error("Invalid tags: "+t);o=new RegExp(n(t[0])+"\\s*"),a=new RegExp("\\s*"+n(t[1])),u=new RegExp("\\s*"+n("}"+t[1]))}if(!t)return[];var o,a,u,h=!1,p=[],f=[],g=[],m=!1,v=!1,C="",k=0;r(e||S.tags);for(var E,T,I,A,P,D,F=new c(t);!F.eos();){if(E=F.pos,I=F.scanUntil(o))for(var O=0,B=I.length;O<B;++O)s(A=I.charAt(O))?(g.push(f.length),C+=A):(v=!0,h=!0,C+=" "),f.push(["text",A,E,E+1]),E+=1,"\n"===A&&(i(),C="",k=0,h=!1);if(!F.scan(o))break;if(m=!0,T=F.scan(x)||"name",F.scan(w),"="===T?(I=F.scanUntil(_),F.scan(_),F.scanUntil(a)):"{"===T?(I=F.scanUntil(u),F.scan(M),F.scanUntil(a),T="&"):I=F.scanUntil(a),!F.scan(a))throw new Error("Unclosed tag at "+F.pos);if(P=">"==T?[T,I,E,F.pos,C,k,h]:[T,I,E,F.pos],k++,f.push(P),"#"===T||"^"===T)p.push(P);else if("/"===T){if(!(D=p.pop()))throw new Error('Unopened section "'+I+'" at '+E);if(D[1]!==I)throw new Error('Unclosed section "'+D[1]+'" at '+E)}else"name"===T||"{"===T||"&"===T?v=!0:"="===T&&r(I)}if(i(),D=p.pop())throw new Error('Unclosed section "'+D[1]+'" at '+F.pos);return l(d(f))}function d(t){for(var e,n,i=[],r=0,o=t.length;r<o;++r)(e=t[r])&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(i.push(e),n=e));return i}function l(t){for(var e,n=[],i=n,r=[],o=0,s=t.length;o<s;++o)switch((e=t[o])[0]){case"#":case"^":i.push(e),r.push(e),i=e[4]=[];break;case"/":r.pop()[5]=e[2],i=r.length>0?r[r.length-1][4]:n;break;default:i.push(e)}return n}function c(t){this.string=t,this.tail=t,this.pos=0}function h(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function p(){this.templateCache={_cache:{},set:function(t,e){this._cache[t]=e},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}var f=Object.prototype.toString,y=Array.isArray||function(t){return"[object Array]"===f.call(t)},g=RegExp.prototype.test,m=/\S/,v={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},w=/\s*/,b=/\s+/,_=/\s*=/,M=/\s*\}/,x=/#|\^|\/|>|\{|&|=|!/;c.prototype.eos=function(){return""===this.tail},c.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},c.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=e.length,e},h.prototype.push=function(t){return new h(t,this)},h.prototype.lookup=function(e){var n,o=this.cache;if(o.hasOwnProperty(e))n=o[e];else{for(var s,a,u,d=this,l=!1;d;){if(e.indexOf(".")>0)for(s=d.view,a=e.split("."),u=0;null!=s&&u<a.length;)u===a.length-1&&(l=i(s,a[u])||r(s,a[u])),s=s[a[u++]];else s=d.view[e],l=i(d.view,e);if(l){n=s;break}d=d.parent}o[e]=n}return t(n)&&(n=n.call(this.view)),n},p.prototype.clearCache=function(){"undefined"!=typeof this.templateCache&&this.templateCache.clear()},p.prototype.parse=function(t,e){var n=this.templateCache,i=t+":"+(e||S.tags).join(":"),r=void 0!==n,o=r?n.get(i):undefined;return o==undefined&&(o=u(t,e),r&&n.set(i,o)),o},p.prototype.render=function(t,e,n,i){var r=this.parse(t,i),o=e instanceof h?e:new h(e,undefined);return this.renderTokens(r,o,n,t,i)},p.prototype.renderTokens=function(t,e,n,i,r){for(var o,s,a,u="",d=0,l=t.length;d<l;++d)a=undefined,"#"===(s=(o=t[d])[0])?a=this.renderSection(o,e,n,i):"^"===s?a=this.renderInverted(o,e,n,i):">"===s?a=this.renderPartial(o,e,n,r):"&"===s?a=this.unescapedValue(o,e):"name"===s?a=this.escapedValue(o,e):"text"===s&&(a=this.rawValue(o)),a!==undefined&&(u+=a);return u},p.prototype.renderSection=function(e,n,i,r){function o(t){return s.render(t,n,i)}var s=this,a="",u=n.lookup(e[1]);if(u){if(y(u))for(var d=0,l=u.length;d<l;++d)a+=this.renderTokens(e[4],n.push(u[d]),i,r);else if("object"==typeof u||"string"==typeof u||"number"==typeof u)a+=this.renderTokens(e[4],n.push(u),i,r);else if(t(u)){if("string"!=typeof r)throw new Error("Cannot use higher-order sections without the original template");null!=(u=u.call(n.view,r.slice(e[3],e[5]),o))&&(a+=u)}else a+=this.renderTokens(e[4],n,i,r);return a}},p.prototype.renderInverted=function(t,e,n,i){var r=e.lookup(t[1]);if(!r||y(r)&&0===r.length)return this.renderTokens(t[4],e,n,i)},p.prototype.indentPartial=function(t,e,n){for(var i=e.replace(/[^ \t]/g,""),r=t.split("\n"),o=0;o<r.length;o++)r[o].length&&(o>0||!n)&&(r[o]=i+r[o]);return r.join("\n")},p.prototype.renderPartial=function(e,n,i,r){if(i){var o=t(i)?i(e[1]):i[e[1]];if(null!=o){
var s=e[6],a=e[5],u=e[4],d=o;return 0==a&&u&&(d=this.indentPartial(o,u,s)),this.renderTokens(this.parse(d,r),n,i,d,r)}}},p.prototype.unescapedValue=function(t,e){var n=e.lookup(t[1]);if(null!=n)return n},p.prototype.escapedValue=function(t,e){var n=e.lookup(t[1]);if(null!=n)return S.escape(n)},p.prototype.rawValue=function(t){return t[1]};var S={name:"mustache.js",version:"4.0.1",tags:["{{","}}"],clearCache:undefined,escape:undefined,parse:undefined,render:undefined,Scanner:undefined,Context:undefined,Writer:undefined,set templateCache(t){C.templateCache=t},get templateCache(){return C.templateCache}},C=new p;return S.clearCache=function(){return C.clearCache()},S.parse=function(t,e){return C.parse(t,e)},S.render=function(t,n,i,r){if("string"!=typeof t)throw new TypeError('Invalid template! Template should be a "string" but "'+e(t)+'" was given as the first argument for mustache#render(template, view, partials)');return C.render(t,n,i,r)},S.escape=a,S.Scanner=c,S.Context=h,S.Writer=p,S}),function(t,e,n,i){"use strict";function r(t,e,n){return setTimeout(d(t,n),e)}function o(t,e,n){return!!Array.isArray(t)&&(s(t,n[e],n),!0)}function s(t,e,n){var r;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==i)for(r=0;r<t.length;)e.call(n,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r,t)}function a(e,n,i){var r="DEPRECATED METHOD: "+n+"\n"+i+" AT \n";return function(){var n=new Error("get-stack-trace"),i=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=t.console&&(t.console.warn||t.console.log);return o&&o.call(t.console,r,i),e.apply(this,arguments)}}function u(t,e,n){var i,r=e.prototype;(i=t.prototype=Object.create(r)).constructor=t,i._super=r,n&&ct(i,n)}function d(t,e){return function(){return t.apply(e,arguments)}}function l(t,e){return typeof t==ft?t.apply(e&&e[0]||i,e):t}function c(t,e){return t===i?e:t}function h(t,e,n){s(g(e),function(e){t.addEventListener(e,n,!1)})}function p(t,e,n){s(g(e),function(e){t.removeEventListener(e,n,!1)})}function f(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function y(t,e){return t.indexOf(e)>-1}function g(t){return t.trim().split(/\s+/g)}function m(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var i=0;i<t.length;){if(n&&t[i][n]==e||!n&&t[i]===e)return i;i++}return-1}function v(t){return Array.prototype.slice.call(t,0)}function w(t,e,n){for(var i=[],r=[],o=0;o<t.length;){var s=e?t[o][e]:t[o];m(r,s)<0&&i.push(t[o]),r[o]=s,o++}return n&&(i=e?i.sort(function(t,n){return t[e]>n[e]}):i.sort()),i}function b(t,e){for(var n,r,o=e[0].toUpperCase()+e.slice(1),s=0;s<ht.length;){if((r=(n=ht[s])?n+o:e)in t)return r;s++}return i}function _(){return bt++}function M(e){var n=e.ownerDocument||e;return n.defaultView||n.parentWindow||t}function x(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){l(t.options.enable,[t])&&n.handler(e)},this.init()}function S(t){var e=t.options.inputClass;return new(e||(xt?N:St?Y:Mt?H:L))(t,C)}function C(t,e,n){var i=n.pointers.length,r=n.changedPointers.length,o=e&At&&i-r==0,s=e&(Dt|Ft)&&i-r==0;n.isFirst=!!o,n.isFinal=!!s,o&&(t.session={}),n.eventType=e,k(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function k(t,e){var n=t.session,i=e.pointers,r=i.length;n.firstInput||(n.firstInput=I(e)),r>1&&!n.firstMultiple?n.firstMultiple=I(e):1===r&&(n.firstMultiple=!1);var o=n.firstInput,s=n.firstMultiple,a=s?s.center:o.center,u=e.center=A(i);e.timeStamp=mt(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=O(a,u),e.distance=F(a,u),E(n,e),e.offsetDirection=D(e.deltaX,e.deltaY);var d=P(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=d.x,e.overallVelocityY=d.y,e.overallVelocity=gt(d.x)>gt(d.y)?d.x:d.y,e.scale=s?j(s.pointers,i):1,e.rotation=s?B(s.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,T(n,e);var l=t.element;f(e.srcEvent.target,l)&&(l=e.srcEvent.target),e.target=l}function E(t,e){var n=e.center,i=t.offsetDelta||{},r=t.prevDelta||{},o=t.prevInput||{};e.eventType!==At&&o.eventType!==Dt||(r=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=t.offsetDelta={x:n.x,y:n.y}),e.deltaX=r.x+(n.x-i.x),e.deltaY=r.y+(n.y-i.y)}function T(t,e){var n,r,o,s,a=t.lastInterval||e,u=e.timeStamp-a.timeStamp;if(e.eventType!=Ft&&(u>It||a.velocity===i)){var d=e.deltaX-a.deltaX,l=e.deltaY-a.deltaY,c=P(u,d,l);r=c.x,o=c.y,n=gt(c.x)>gt(c.y)?c.x:c.y,s=D(d,l),t.lastInterval=e}else n=a.velocity,r=a.velocityX,o=a.velocityY,s=a.direction;e.velocity=n,e.velocityX=r,e.velocityY=o,e.direction=s}function I(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:yt(t.pointers[n].clientX),clientY:yt(t.pointers[n].clientY)},n++;return{timeStamp:mt(),pointers:e,center:A(e),deltaX:t.deltaX,deltaY:t.deltaY}}function A(t){var e=t.length;if(1===e)return{x:yt(t[0].clientX),y:yt(t[0].clientY)};for(var n=0,i=0,r=0;r<e;)n+=t[r].clientX,i+=t[r].clientY,r++;return{x:yt(n/e),y:yt(i/e)}}function P(t,e,n){return{x:e/t||0,y:n/t||0}}function D(t,e){return t===e?Ot:gt(t)>=gt(e)?t<0?Bt:jt:e<0?Lt:Nt}function F(t,e,n){n||(n=qt);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return Math.sqrt(i*i+r*r)}function O(t,e,n){n||(n=qt);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return 180*Math.atan2(r,i)/Math.PI}function B(t,e){return O(e[1],e[0],Ht)+O(t[1],t[0],Ht)}function j(t,e){return F(e[0],e[1],Ht)/F(t[0],t[1],Ht)}function L(){this.evEl=Xt,this.evWin=Vt,this.pressed=!1,x.apply(this,arguments)}function N(){this.evEl=Ut,this.evWin=Qt,x.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function R(){this.evTarget=Gt,this.evWin=Zt,this.started=!1,x.apply(this,arguments)}function $(t,e){var n=v(t.touches),i=v(t.changedTouches);return e&(Dt|Ft)&&(n=w(n.concat(i),"identifier",!0)),[n,i]}function Y(){this.evTarget=ee,this.targetIds={},x.apply(this,arguments)}function q(t,e){var n=v(t.touches),i=this.targetIds;if(e&(At|Pt)&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,o,s=v(t.changedTouches),a=[],u=this.target;if(o=n.filter(function(t){return f(t.target,u)}),e===At)for(r=0;r<o.length;)i[o[r].identifier]=!0,r++;for(r=0;r<s.length;)i[s[r].identifier]&&a.push(s[r]),e&(Dt|Ft)&&delete i[s[r].identifier],r++;return a.length?[w(o.concat(a),"identifier",!0),a]:void 0}function H(){x.apply(this,arguments);var t=d(this.handler,this);this.touch=new Y(this.manager,t),this.mouse=new L(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function W(t,e){t&At?(this.primaryTouch=e.changedPointers[0].identifier,X.call(this,e)):t&(Dt|Ft)&&X.call(this,e)}function X(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var i=this.lastTouches;setTimeout(function(){var t=i.indexOf(n);t>-1&&i.splice(t,1)},ne)}}function V(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],o=Math.abs(e-r.x),s=Math.abs(n-r.y);if(o<=ie&&s<=ie)return!0}return!1}function z(t,e){this.manager=t,this.set(e)}function J(t){if(y(t,de))return de;var e=y(t,le),n=y(t,ce);return e&&n?de:e||n?e?le:ce:y(t,ue)?ue:ae}function U(){if(!oe)return!1;var e={},n=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(i){e[i]=!n||t.CSS.supports("touch-action",i)}),e}function Q(t){this.options=ct({},this.defaults,t||{}),this.id=_(),this.manager=null,this.options.enable=c(this.options.enable,!0),this.state=pe,this.simultaneous={},this.requireFail=[]}function K(t){return t&ve?"cancel":t&ge?"end":t&ye?"move":t&fe?"start":""}function G(t){return t==Nt?"down":t==Lt?"up":t==Bt?"left":t==jt?"right":""}function Z(t,e){var n=e.manager;return n?n.get(t):t}function tt(){Q.apply(this,arguments)}function et(){tt.apply(this,arguments),this.pX=null,this.pY=null}function nt(){tt.apply(this,arguments)}function it(){Q.apply(this,arguments),this._timer=null,this._input=null}function rt(){tt.apply(this,arguments)}function ot(){tt.apply(this,arguments)}function st(){Q.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function at(t,e){return(e=e||{}).recognizers=c(e.recognizers,at.defaults.preset),new ut(t,e)}function ut(t,e){this.options=ct({},at.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=S(this),this.touchAction=new z(this,this.options.touchAction),dt(this,!0),s(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function dt(t,e){var n,i=t.element;i.style&&(s(t.options.cssProps,function(r,o){n=b(i.style,o),e?(t.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=t.oldCssProps[n]||""}),e||(t.oldCssProps={}))}function lt(t,n){var i=e.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=n,n.target.dispatchEvent(i)}var ct,ht=["","webkit","Moz","MS","ms","o"],pt=e.createElement("div"),ft="function",yt=Math.round,gt=Math.abs,mt=Date.now;ct="function"!=typeof Object.assign?function(t){if(t===i||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==i&&null!==r)for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])}return e}:Object.assign;var vt=a(function(t,e,n){for(var r=Object.keys(e),o=0;o<r.length;)(!n||n&&t[r[o]]===i)&&(t[r[o]]=e[r[o]]),o++;return t},"extend","Use `assign`."),wt=a(function(t,e){return vt(t,e,!0)},"merge","Use `assign`."),bt=1,_t=/mobile|tablet|ip(ad|hone|od)|android/i,Mt="ontouchstart"in t,xt=b(t,"PointerEvent")!==i,St=Mt&&_t.test(navigator.userAgent),Ct="touch",kt="pen",Et="mouse",Tt="kinect",It=25,At=1,Pt=2,Dt=4,Ft=8,Ot=1,Bt=2,jt=4,Lt=8,Nt=16,Rt=Bt|jt,$t=Lt|Nt,Yt=Rt|$t,qt=["x","y"],Ht=["clientX","clientY"];x.prototype={handler:function(){},init:function(){this.evEl&&h(this.element,this.evEl,this.domHandler),this.evTarget&&h(this.target,this.evTarget,this.domHandler),this.evWin&&h(M(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(M(this.element),this.evWin,this.domHandler)}};var Wt={mousedown:At,mousemove:Pt,mouseup:Dt},Xt="mousedown",Vt="mousemove mouseup";u(L,x,{handler:function(t){var e=Wt[t.type];e&At&&0===t.button&&(this.pressed=!0),e&Pt&&1!==t.which&&(e=Dt),this.pressed&&(e&Dt&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:Et,srcEvent:t}))}});var zt={pointerdown:At,pointermove:Pt,pointerup:Dt,pointercancel:Ft,pointerout:Ft},Jt={2:Ct,3:kt,4:Et,5:Tt},Ut="pointerdown",Qt="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(Ut="MSPointerDown",Qt="MSPointerMove MSPointerUp MSPointerCancel"),u(N,x,{handler:function(t){var e=this.store,n=!1,i=t.type.toLowerCase().replace("ms",""),r=zt[i],o=Jt[t.pointerType]||t.pointerType,s=o==Ct,a=m(e,t.pointerId,"pointerId");r&At&&(0===t.button||s)?a<0&&(e.push(t),a=e.length-1):r&(Dt|Ft)&&(n=!0),a<0||(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),n&&e.splice(a,1))}});var Kt={touchstart:At,touchmove:Pt,touchend:Dt,touchcancel:Ft},Gt="touchstart",Zt="touchstart touchmove touchend touchcancel";u(R,x,{handler:function(t){var e=Kt[t.type];if(e===At&&(this.started=!0),this.started){var n=$.call(this,t,e);e&(Dt|Ft)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:Ct,srcEvent:t})}}});var te={touchstart:At,touchmove:Pt,touchend:Dt,touchcancel:Ft},ee="touchstart touchmove touchend touchcancel";u(Y,x,{handler:function(t){var e=te[t.type],n=q.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:Ct,srcEvent:t})}});var ne=2500,ie=25;u(H,x,{handler:function(t,e,n){var i=n.pointerType==Ct,r=n.pointerType==Et;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)W.call(this,e,n);else if(r&&V.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var re=b(pt.style,"touchAction"),oe=re!==i,se="compute",ae="auto",ue="manipulation",de="none",le="pan-x",ce="pan-y",he=U();z.prototype={set:function(t){t==se&&(t=this.compute()),oe&&this.manager.element.style&&he[t]&&(this.manager.element.style[re]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return s(this.manager.recognizers,function(e){l(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),J(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var i=this.actions,r=y(i,de)&&!he[de],o=y(i,ce)&&!he[ce],s=y(i,le)&&!he[le];if(r){var a=1===t.pointers.length,u=t.distance<2,d=t.deltaTime<250;if(a&&u&&d)return}if(!s||!o)return r||o&&n&Rt||s&&n&$t?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var pe=1,fe=2,ye=4,ge=8,me=ge,ve=16,we=32;Q.prototype={defaults:{},set:function(t){return ct(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(o(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Z(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return o(t,"dropRecognizeWith",this)?this:(t=Z(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(o(t,"requireFailure",this))return this;var e=this.requireFail;return-1===m(e,t=Z(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(o(t,"dropRequireFailure",this))return this;t=Z(t,this);var e=m(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){function e(e){n.manager.emit(e,t)}var n=this,i=this.state;i<ge&&e(n.options.event+K(i)),e(n.options.event),t.additionalEvent&&e(t.additionalEvent),i>=ge&&e(n.options.event+K(i))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=we},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(we|pe)))return!1;t++}return!0},recognize:function(t){var e=ct({},t);if(!l(this.options.enable,[this,e]))return this.reset(),void(this.state=we);this.state&(me|ve|we)&&(this.state=pe),this.state=this.process(e),this.state&(fe|ye|ge|ve)&&this.tryEmit(e)},process:function(){},getTouchAction:function(){},reset:function(){}},u(tt,Q,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,i=e&(fe|ye),r=this.attrTest(t);return i&&(n&Ft||!r)?e|ve:i||r?n&Dt?e|ge:e&fe?e|ye:fe:we}}),u(et,tt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Yt},getTouchAction:function(){var t=this.options.direction,e=[];return t&Rt&&e.push(ce),t&$t&&e.push(le),e},directionTest:function(t){var e=this.options,n=!0,i=t.distance,r=t.direction,o=t.deltaX,s=t.deltaY;return r&e.direction||(e.direction&Rt?(r=0===o?Ot:o<0?Bt:jt,n=o!=this.pX,i=Math.abs(t.deltaX)):(r=0===s?Ot:s<0?Lt:Nt,n=s!=this.pY,i=Math.abs(t.deltaY))),t.direction=r,n&&i>e.threshold&&r&e.direction},attrTest:function(t){return tt.prototype.attrTest.call(this,t)&&(this.state&fe||!(this.state&fe)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=G(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),u(nt,tt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[de]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&fe)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),u(it,Q,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ae]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,o=t.deltaTime>e.time;if(this._input=t,!i||!n||t.eventType&(Dt|Ft)&&!o)this.reset();else if(t.eventType&At)this.reset(),this._timer=r(function(){this.state=me,this.tryEmit()},e.time,this);else if(t.eventType&Dt)return me;return we},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===me&&(t&&t.eventType&Dt?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=mt(),this.manager.emit(this.options.event,this._input)))}}),u(rt,tt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[de]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&fe)}}),u(ot,tt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Rt|$t,pointers:1},getTouchAction:function(){return et.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return n&(Rt|$t)?e=t.overallVelocity:n&Rt?e=t.overallVelocityX:n&$t&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&gt(e)>this.options.velocity&&t.eventType&Dt},emit:function(t){var e=G(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),u(st,Q,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ue]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,o=t.deltaTime<e.time;if(this.reset(),t.eventType&At&&0===this.count)return this.failTimeout();if(i&&o&&n){if(t.eventType!=Dt)return this.failTimeout();var s=!this.pTime||t.timeStamp-this.pTime<e.interval,a=!this.pCenter||F(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,a&&s?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=r(function(){this.state=me,this.tryEmit()},e.interval,this),fe):me}return we},failTimeout:function(){return this._timer=r(function(){this.state=we},this.options.interval,this),we},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==me&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),at.VERSION="2.0.8",at.defaults={domEvents:!1,touchAction:se,enable:!0,inputTarget:null,inputClass:null,preset:[[rt,{enable:!1}],[nt,{enable:!1},["rotate"]],[ot,{direction:Rt}],[et,{direction:Rt},["swipe"]],[st],[st,{event:"doubletap",taps:2},["tap"]],[it]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var be=1,_e=2;ut.prototype={set:function(t){return ct(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?_e:be},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var i=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&me)&&(r=e.curRecognizer=null);for(var o=0;o<i.length;)n=i[o],e.stopped===_e||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(t),!r&&n.state&(fe|ye|ge)&&(r=e.curRecognizer=n),o++}},get:function(t){if(t instanceof Q)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(o(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(o(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=m(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==i&&e!==i){var n=this.handlers;return s(g(t),function(t){n[t]=n[t]||[],n[t].push(e)}),this}},off:function(t,e){if(t!==i){var n=this.handlers;return s(g(t),function(t){e?n[t]&&n[t].splice(m(n[t],e),1):delete n[t]}),this}},emit:function(t,e){this.options.domEvents&&lt(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](e),i++}},destroy:function(){this.element&&dt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},ct(at,{INPUT_START:At,INPUT_MOVE:Pt,INPUT_END:Dt,INPUT_CANCEL:Ft,STATE_POSSIBLE:pe,STATE_BEGAN:fe,STATE_CHANGED:ye,STATE_ENDED:ge,STATE_RECOGNIZED:me,STATE_CANCELLED:ve,STATE_FAILED:we,DIRECTION_NONE:Ot,DIRECTION_LEFT:Bt,DIRECTION_RIGHT:jt,DIRECTION_UP:Lt,DIRECTION_DOWN:Nt,DIRECTION_HORIZONTAL:Rt,DIRECTION_VERTICAL:$t,DIRECTION_ALL:Yt,Manager:ut,Input:x,TouchAction:z,TouchInput:Y,MouseInput:L,PointerEventInput:N,TouchMouseInput:H,SingleTouchInput:R,Recognizer:Q,AttrRecognizer:tt,Tap:st,Pan:et,Swipe:ot,Pinch:nt,Rotate:rt,Press:it,on:h,off:p,each:s,merge:wt,extend:vt,assign:ct,inherit:u,bindFn:d,prefixed:b}),(void 0!==t?t:"undefined"!=typeof self?self:{}).Hammer=at,"function"==typeof define&&define.amd?define(function(){return at}):"undefined"!=typeof module&&module.exports?module.exports=at:t[n]=at}(window,document,"Hammer"),EASY.schedule.require(function(t){var e;e=function(t,e){function n(n,i){var r=t(n);r.data("hammer")||r.data("hammer",new e(r[0],i))}var i;t.fn.hammer=function(t){return this.each(function(){n(this,t)})},e.Manager.prototype.emit=(i=e.Manager.prototype.emit,function(e,n){i.call(this,e,n),t(this.element).trigger({type:e,gesture:n})})},"function"==typeof define&&define.amd?define(["jquery","hammerjs"],e):"object"==typeof exports?e(require("jquery"),require("hammerjs")):e(t,Hammer)},"jQuery"),EASY.schedule.require(function(t){function e(e){if("string"==typeof e.data&&(e.data={keys:e.data}),e.data&&e.data.keys&&"string"==typeof e.data.keys){var n=e.handler,i=e.data.keys.toLowerCase().split(" ");e.handler=function(e){if(this===e.target||!(t.hotkeys.options.filterInputAcceptingElements&&t.hotkeys.textInputTypes.test(e.target.nodeName)||t.hotkeys.options.filterContentEditable&&t(e.target).attr("contenteditable")||t.hotkeys.options.filterTextInputs&&t.inArray(e.target.type,t.hotkeys.textAcceptingInputTypes)>-1)){var r="keypress"!==e.type&&t.hotkeys.specialKeys[e.which],o=String.fromCharCode(e.which).toLowerCase(),s="",a={};t.each(["alt","ctrl","shift"],function(t,n){e[n+"Key"]&&r!==n&&(s+=n+"+")}),e.metaKey&&!e.ctrlKey&&"meta"!==r&&(s+="meta+"),e.metaKey&&"meta"!==r&&s.indexOf("alt+ctrl+shift+")>-1&&(s=s.replace("alt+ctrl+shift+","hyper+")),r?a[s+r]=!0:(a[s+o]=!0,a[s+t.hotkeys.shiftNums[o]]=!0,"shift+"===s&&(a[t.hotkeys.shiftNums[o]]=!0));for(var u=0,d=i.length;u<d;u++)if(a[i[u]])return n.apply(this,arguments)}}}}t.hotkeys={version:"0.2.0",specialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},textAcceptingInputTypes:["text","password","number","email","url","range","date","month","week","time","datetime","datetime-local","search","color","tel"],textInputTypes:/textarea|input|select/i,options:{filterInputAcceptingElements:!0,filterTextInputs:!0,filterContentEditable:!0}},t.each(["keydown","keyup","keypress"],function(){t.event.special[this]={add:e}})},"jQuery");var VERSION="1.11.0",root="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},ArrayProto=Array.prototype,ObjProto=Object.prototype,SymbolProto="undefined"!=typeof Symbol?Symbol.prototype:null,push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,supportsArrayBuffer="undefined"!=typeof ArrayBuffer,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeCreate=Object.create,nativeIsView=supportsArrayBuffer&&ArrayBuffer.isView,_isNaN=isNaN,_isFinite=isFinite,hasEnumBug=!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],MAX_ARRAY_INDEX=Math.pow(2,53)-1,isString=tagTester("String"),isNumber=tagTester("Number"),isDate=tagTester("Date"),isRegExp=tagTester("RegExp"),isError=tagTester("Error"),isSymbol=tagTester("Symbol"),isMap=tagTester("Map"),isWeakMap=tagTester("WeakMap"),isSet=tagTester("Set"),isWeakSet=tagTester("WeakSet"),isArrayBuffer=tagTester("ArrayBuffer"),isDataView=tagTester("DataView"),isArray=nativeIsArray||tagTester("Array"),isFunction=tagTester("Function"),nodelist=root.document&&root.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof nodelist&&(isFunction=function(t){return"function"==typeof t||!1});var isFunction$1=isFunction,isArguments=tagTester("Arguments");!function(){isArguments(arguments)||(isArguments=function(t){return has(t,"callee")})}();var isArguments$1=isArguments,getByteLength=shallowProperty("byteLength"),isBufferLike=createSizePropertyCheck(getByteLength),typedArrayPattern=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/,isTypedArray$1=supportsArrayBuffer?isTypedArray:constant(!1),getLength=shallowProperty("length"),isArrayLike=createSizePropertyCheck(getLength);_.VERSION=VERSION,_.prototype.value=function(){return this._wrapped},_.prototype.valueOf=_.prototype.toJSON=_.prototype.value,_.prototype.toString=function(){return String(this._wrapped)};var extend=createAssigner(allKeys),extendOwn=createAssigner(keys),defaults=createAssigner(allKeys,!0);_.iteratee=iteratee;var now=Date.now||function(){return(new Date).getTime()},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},_escape=createEscaper(escapeMap),unescapeMap=invert(escapeMap),_unescape=createEscaper(unescapeMap),templateSettings=_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},escapeRegExp=/\\|'|\r|\n|\u2028|\u2029/g,idCounter=0,partial=restArguments(function(t,e){var n=partial.placeholder,i=function(){for(var r=0,o=e.length,s=Array(o),a=0;a<o;a++)s[a]=e[a]===n?arguments[r++]:e[a];for(;r<arguments.length;)s.push(arguments[r++]);return executeBound(t,i,this,this,s)};return i});partial.placeholder=_;var bind=restArguments(function(t,e,n){if(!isFunction$1(t))throw new TypeError("Bind must be called on a function");var i=restArguments(function(r){return executeBound(t,i,e,this,n.concat(r))});return i}),bindAll=restArguments(function(t,e){var n=(e=flatten(e,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var i=e[n];t[i]=bind(t[i],t)}return t}),delay=restArguments(function(t,e,n){return setTimeout(function(){return t.apply(null,n)},e)}),defer=partial(delay,_,1),once=partial(before,2),findIndex=createPredicateIndexFinder(1),findLastIndex=createPredicateIndexFinder(-1),indexOf=createIndexFinder(1,findIndex,sortedIndex),lastIndexOf=createIndexFinder(-1,findLastIndex),reduce=createReduce(1),reduceRight=createReduce(-1),invoke=restArguments(function(t,e,n){var i,r;return isFunction$1(e)?r=e:isArray(e)&&(i=e.slice(0,-1),e=e[e.length-1]),map(t,function(t){var o=r;if(!o){if(i&&i.length&&(t=deepGet(t,i)),null==t)return;o=t[e]}return null==o?o:o.apply(t,n)})}),groupBy=group(function(t,e,n){has(t,n)?t[n].push(e):t[n]=[e]}),indexBy=group(function(t,e,n){t[n]=e}),countBy=group(function(t,e,n){has(t,n)?t[n]++:t[n]=1}),partition=group(function(t,e,n){t[n?0:1].push(e)},!0),reStrSymbol=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g,pick=restArguments(function(t,e){var n={},i=e[0];if(null==t)return n;isFunction$1(i)?(e.length>1&&(i=optimizeCb(i,e[1])),e=allKeys(t)):(i=keyInObj,e=flatten(e,!1,!1),t=Object(t));for(var r=0,o=e.length;r<o;r++){var s=e[r],a=t[s];i(a,s,t)&&(n[s]=a)}return n}),omit=restArguments(function(t,e){var n,i=e[0];return isFunction$1(i)?(i=negate(i),e.length>1&&(n=e[1])):(e=map(flatten(e,!1,!1),String),i=function(t,n){return!contains(e,n)}),pick(t,i,n)}),difference=restArguments(function(t,e){return e=flatten(e,!0,!0),filter(t,function(t){return!contains(e,t)})}),without=restArguments(function(t,e){return difference(t,e)}),union=restArguments(function(t){return uniq(flatten(t,!0,!0))}),zip=restArguments(unzip);each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=ArrayProto[t];_.prototype[t]=function(){var n=this._wrapped;return null!=n&&(e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0]),chainResult(this,n)}}),each(["concat","join","slice"],function(t){var e=ArrayProto[t];_.prototype[t]=function(){var t=this._wrapped;return null!=t&&(t=e.apply(t,arguments)),chainResult(this,t)}});var allExports={__proto__:null,VERSION:VERSION,restArguments:restArguments,isObject:isObject,isNull:isNull,isUndefined:isUndefined,isBoolean:isBoolean,isElement:isElement,isString:isString,isNumber:isNumber,isDate:isDate,isRegExp:isRegExp,isError:isError,isSymbol:isSymbol,isMap:isMap,isWeakMap:isWeakMap,isSet:isSet,isWeakSet:isWeakSet,isArrayBuffer:isArrayBuffer,isDataView:isDataView,isArray:isArray,isFunction:isFunction$1,isArguments:isArguments$1,isFinite:isFinite$1,isNaN:isNaN$1,isTypedArray:isTypedArray$1,isEmpty:isEmpty,isMatch:isMatch,isEqual:isEqual,keys:keys,allKeys:allKeys,values:values,pairs:pairs,invert:invert,functions:functions,methods:functions,extend:extend,extendOwn:extendOwn,assign:extendOwn,defaults:defaults,create:create,clone:clone,tap:tap,has:has$1,mapObject:mapObject,identity:identity,constant:constant,noop:noop,property:property,propertyOf:propertyOf,matcher:matcher,matches:matcher,times:times,random:random,now:now,escape:_escape,unescape:_unescape,templateSettings:templateSettings,template:template,result:result,uniqueId:uniqueId,chain:chain,iteratee:iteratee,partial:partial,bind:bind,bindAll:bindAll,memoize:memoize,delay:delay,defer:defer,throttle:throttle,debounce:debounce,wrap:wrap,negate:negate,compose:compose,after:after,before:before,once:once,findKey:findKey,findIndex:findIndex,findLastIndex:findLastIndex,sortedIndex:sortedIndex,indexOf:indexOf,lastIndexOf:lastIndexOf,find:find,detect:find,findWhere:findWhere,each:each,forEach:each,map:map,collect:map,reduce:reduce,foldl:reduce,inject:reduce,reduceRight:reduceRight,foldr:reduceRight,filter:filter,select:filter,reject:reject,every:every,all:every,some:some,any:some,contains:contains,includes:contains,include:contains,invoke:invoke,pluck:pluck,where:where,max:max,min:min,shuffle:shuffle,sample:sample,sortBy:sortBy,groupBy:groupBy,indexBy:indexBy,countBy:countBy,partition:partition,toArray:toArray,size:size,pick:pick,omit:omit,first:first,head:first,take:first,initial:initial,last:last,rest:rest,tail:rest,drop:rest,compact:compact,flatten:flatten$1,without:without,uniq:uniq,unique:uniq,union:union,intersection:intersection,difference:difference,unzip:unzip,transpose:unzip,zip:zip,object:object,range:range,chunk:chunk,mixin:mixin,"default":_},_$1=mixin(allExports);_$1._=_$1;var MAPJS=MAPJS||{};!function(){function t(t){this.ysy=t,this._messages=[],this._messageType="notice",this._lastMessageTime=0}window.easyMindMupClasses=window.easyMindMupClasses||{},window.easyMindMupClasses.extendClass=function(t,e){var n=new Function;return n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.superclass=e.prototype,t},MAPJS.enableVerticalPan=function(t){return t.data("hammer").get("pan").set({direction:Hammer.DIRECTION_ALL}),t},t.prototype.showMessage=function(t,e,n){this._messages=[];var i=$("#content").children(".flash"),r=(new Date).valueOf();if(!i.length||this._lastMessageTime+6e4<r||"notice"===this._messageType)return window.showFlashMessage(e,t,n),this._lastMessageTime=r,this._messages=[t],void(this._messageType=e);"notice"!==e&&(this._lastMessageTime=r,
this._messages.push(t),"error"===e&&"warning"===this._messageType?(window.showFlashMessage(e,this._messages.join("<br>"),n),this._messageType=e):i.find("span").html(this._messages.join("<br>")))},t.prototype.getModal=function(t,e){var n=$("#"+t);return 0===n.length&&((n=$("<div id="+t+">")).dialog({width:e,appendTo:document.body,modal:!0,resizable:!1,dialogClass:"modal",position:{my:"center top",at:"center top",of:window}}),n.dialog("close")),n},t.prototype.showUpgradeModal=function(t){var e=this.ysy,n=e.util.getModal("form-modal","auto"),i=e.settings.templates.upgrade,r=e.settings.labels.free,o={text:r.textNotAvailable,href:r.buttonUpgradeHref};o[t]=!0;var s=Mustache.render(i,o);n.html(s),showModal("form-modal"),n.dialog({buttons:[{id:"upgrade_button","class":"button-1 button-positive",text:r.buttonUpgrade,click:function(){var t=n.find("#upgrade_link");window.open(t.attr("href"),"_blank"),n.dialog("close")}},{id:"close_button","class":"button-2 button",text:e.settings.labels.buttons.close,click:function(){n.dialog("close")}}]}),n.parent().find("#upgrade_button").focus()},t.prototype.startsWith=function(t,e){return t.startsWith?t.startsWith(e):t.charAt(0)===e},t.prototype.toUnderscore=function(t){return t.replace(/([A-Z])/g,function(t){return"_"+t.toLowerCase()})},t.prototype.isEquivalent=function(t,e){var n=Object.getOwnPropertyNames(t),i=Object.getOwnPropertyNames(e);if(n.length!=i.length)return!1;for(var r=0;r<n.length;r++){var o=n[r];if(t[o]!==e[o])return!1}return!0},t.prototype.traverse=function(t,e,n){if(t&&(e(t,n),t.ideas))for(var i=_.values(t.ideas),r=0;r<i.length;r++)this.traverse(i[r],e,t)},t.prototype.backTraverse=function(t,e){if(t){if(t.ideas)for(var n=_.values(t.ideas),i=0;i<n.length;i++)this.backTraverse(n[i],e);e(t)}},t.prototype.forAllParents=function(t,e,n){if(t===e)return!0;if(!t.ideas)return!1;for(var i=_.values(t.ideas),r=0;r<i.length;r++){if(this.forAllParents(i[r],e,n))return n(t),!0}},t.prototype.findWhere=function(t,e){if(e(t))return t;if(!t.ideas)return null;for(var n=_.values(t.ideas),i=0;i<n.length;i++){var r=this.findWhere(n[i],e);if(r)return r}return null},t.prototype.getSortedRanks=function(t){var e=_.chain(t).keys().map(parseFloat).value();return e.sort(function(t,e){return t-e}),e},t.prototype.correctRanks=function(t){var e=_.findIndex(t,function(t){return t>0}),n=[];e<0&&(e=0);for(var i=0;i<e;i++)n.push(i-e);for(i=e;i<t.length;i++)n.push(i-e+1);return n},t.prototype.formToJson=function(t){for(var e={},n=function(t,e,i){var r=e.shift();if(""===r)t.push(i);else if(e.length>0){var o=e[0];t[r]||(t[r]=""===o?[]:{}),n(t[r],e,i)}else t[r]=i},i=0;i<t.length;i++){var r=t[i].name.split(/]\[|\[|]/);r.length>1&&r.pop(),n(e,r,t[i].value)}return e},t.prototype.getEntityProjectId=function(t,e){for(t||(t=this.ysy.idea.findParent(e));t&&"project"!==t.attr.entityType;)t=this.ysy.idea.findParent(t.id);return t?this.ysy.getData(t).id:null};var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};t.prototype.escapeHtml=function(t){return String(t).replace(/[&<>"'`=\/]/g,function(t){return e[t]})},window.easyMindMupClasses.Util=t}(),MAPJS.MemoryClipboard=function(){"use strict";var t,e=this,n=function(t){return t?JSON.parse(JSON.stringify(t)):undefined};e.get=function(){return n(t)},e.put=function(e){t=n(e)}},MAPJS.content=function(t,e){"use strict";var n,i,r=function(){n=undefined},o=function I(e){return(e=e||t).ideas?_.reduce(e.ideas,function(t,e){return Math.max(t,I(e))},parseInt(e.id,10)||0):parseInt(e.id,10)||0},s=function(t){return t=t||e,n||(n=o()),n+=1,t?n+"."+t:n},a=function(t,e){return t.id?r():t.id=s(e),t.ideas&&_.each(t.ideas,function(n,i){t.ideas[parseFloat(i)]=a(n,e)}),t.title||(t.title=""),t.containsDirectChild=t.findChildRankById=function(e){return parseFloat(_.reduce(t.ideas,function(t,n,i){return n.id==e?i:t},undefined))},t.findSubIdeaById=function(e){return _.find(t.ideas,function(t){return t.id==e})||_.reduce(t.ideas,function(t,n){return t||n.findSubIdeaById(e)},undefined)},t.find=function(e){var n=e(t)?[_.pick(t,"id","title")]:[];return 0===_.size(t.ideas)?n:_.reduce(t.ideas,function(t,n){return _.union(t,n.find(e))},n)},t.getAttr=function(e){return!(!t.attr||!t.attr[e])&&_.clone(t.attr[e])},t.sortedSubIdeas=function(){if(!t.ideas)return[];var e=[],n=_.groupBy(_.map(_.keys(t.ideas),parseFloat),function(t){return t>0}),i=_.sortBy(n[!0],Math.abs).concat(_.sortBy(n[!1],Math.abs));return _.each(i,function(n){e.push(t.ideas[n])}),e},t.traverse=function(e,n){n||e(t),_.each(t.sortedSubIdeas(),function(t){t.traverse(e,n)}),n&&e(t)},t},u=function(t,e){if(e=e||1,0===_.size(t))return 0;var n=_.keys(t);return n.push(0),_.max(_.map(n,parseFloat),function(t){return t*e})},d=function(e){var n,i=1;return e.id==t.id&&((n=_.countBy(e.ideas,function(t,e){return e<0}))["true"]||0)<n["false"]&&(i=-1),u(e.ideas,i)+i},l=function(t,e){var n;return t.ideas=t.ideas||{},n=d(t),t.ideas[n]=e,n},c=function(e){return t.id==e?t:t.findSubIdeaById(e)},h=function(t,e){return _(_.map(_.keys(t.ideas),parseFloat)).reject(function(t){return t*e<0})},p=function(t){return t<0?-1:1},f={},y={},g=!1,m={},v=function(e,n,i){i?t.dispatchEvent("changed",e,n,i):t.dispatchEvent("changed",e,n)},w=function(e,n,i,r){var o;"batch"!==e&&!m[r]&&f&&f[r]&&0!==f[r].length?("batch"===(o=f[r].pop()).eventMethod?f[r].push({eventMethod:"batch",eventArgs:o.eventArgs.concat([[e].concat(n)]),undoFunction:function(){i(),o.undoFunction()}}):f[r].push({eventMethod:"batch",eventArgs:[[o.eventMethod].concat(o.eventArgs)].concat([[e].concat(n)]),undoFunction:function(){i(),o.undoFunction()}}),g?t.dispatchEvent("changed","redo",undefined,r):(v(e,n,r),y[r]=[])):b(e,n,i,r)},b=function(e,n,i,r){var o={eventMethod:e,eventArgs:n,undoFunction:i};m[r]?m[r].push(o):(f[r]||(f[r]=[]),f[r].push(o),g?t.dispatchEvent("changed","redo",undefined,r):(v(e,n,r),y[r]=[]))},M=function(t,e,n){t.ideas[e]=t.ideas[n],delete t.ideas[n]},x=function(t){if(t.style){t.attr={};var e=t.style.collapsed;delete t.style.collapsed,t.attr.style=t.style,e&&(t.attr.collapsed=e),delete t.style}t.ideas&&_.each(t.ideas,x)},S=function(t){var e=String(t).indexOf(".");return e>0&&t.substr(e+1)},C={},k={},E="/xxxxxxxx-yxxx-yxxx-yxxx-xxxxxxxxxxxx/".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})+(e||""),T=function(t,e,n){var i;if(!t)return!1;if(i=_.extend({},t.attr),t.attr=_.extend({},t.attr),!n||"false"===n||_.isObject(n)&&_.isEmpty(n)){if(!t.attr[e])return!1;delete t.attr[e]}else{if(_.isEqual(t.attr[e],n))return!1;t.attr[e]=JSON.parse(JSON.stringify(n))}return 0===_.size(t.attr)&&delete t.attr,function(){t.attr=i}};return t.logChange=b,t.setConfiguration=function(t){k=t||{}},t.getSessionKey=function(){return e},t.nextSiblingId=function(e){var n,i,r,o=t.findParent(e);return!!o&&(n=o.findChildRankById(e),i=h(o,n),0!==(r=_.reject(i,function(t){return Math.abs(t)<=Math.abs(n)})).length&&o.ideas[_.min(r,Math.abs)].id)},t.sameSideSiblingIds=function(e){var n=t.findParent(e),i=n.findChildRankById(e);return _.without(_.map(_.pick(n.ideas,h(n,i)),function(t){return t.id}),e)},t.getAttrById=function(t,e){var n=c(t);return n&&n.getAttr(e)},t.previousSiblingId=function(e){var n,i,r,o=t.findParent(e);return!!o&&(n=o.findChildRankById(e),i=h(o,n),0!==(r=_.reject(i,function(t){return Math.abs(t)>=Math.abs(n)})).length&&o.ideas[_.max(r,Math.abs)].id)},t.clone=function(e){var n=e&&e!=t.id&&t.findSubIdeaById(e)||t;return JSON.parse(JSON.stringify(n))},t.cloneMultiple=function(e){return _.map(e,t.clone)},t.calculatePath=function(e,n,i){return t.id==e?[]:(n=n||[t],(i=i||t).containsDirectChild(e)?n:_.reduce(i.ideas,function(i,r){return i||t.calculatePath(e,[r].concat(n),r)},!1))},t.getSubTreeIds=function(e){var n=[],i=function(t){if(_.isEmpty(t.ideas))return[];_.each(t.sortedSubIdeas(),function(t){i(t),n.push(t.id)})};return i(t.findSubIdeaById(e)||t),n},t.findParent=function(e,n){return(n=n||t).containsDirectChild(e)?n:_.reduce(n.ideas,function(n,i){return n||t.findParent(e,i)},!1)},t.getCommandProcessors=function(){return C},t.startBatch=function(n){var i=n||e;t.endBatch(n),m[i]=[]},t.endBatch=function(t){var n,i,r=t||e,o=m[r];m[r]=undefined,_.isEmpty(o)||(1===_.size(o)?b(o[0].eventMethod,o[0].eventArgs,o[0].undoFunction,r):(n=_.map(o,function(t){return[t.eventMethod].concat(t.eventArgs)}),i=_.sortBy(_.map(o,function(t){return t.undoFunction}),function(t,e){return-1*e}),b("batch",n,function(){_.each(i,function(t){t()})},r)))},t.execCommand=function(n,i,r){return!!C[n]&&C[n].apply(t,[r||e].concat(_.toArray(i)))},t.batch=function(e){t.startBatch();try{e()}finally{t.endBatch()}},C.batch=function(e){t.startBatch(e);try{_.each(_.toArray(arguments).slice(1),function(n){t.execCommand(n[0],n.slice(1),e)})}finally{t.endBatch(e)}},t.pasteMultiple=function(e,n){t.startBatch();var i=_.map(n,function(n){return t.paste(e,n)});return t.endBatch(),i},t.paste=function(){return t.execCommand("paste",arguments)},C.paste=function(e,i,o,s){var u,d,c=i==t.id?t:t.findSubIdeaById(i),h=function(t){var e,n,i=_.omit(t,"ideas","id","attr"),r=1;return i.attr=_.omit(t.attr,k.nonClonedAttributes),_.isEmpty(i.attr)&&delete i.attr,t.ideas&&(e=_.groupBy(_.map(_.keys(t.ideas),parseFloat),function(t){return t>0}),n=_.sortBy(e[!0],Math.abs).concat(_.sortBy(e[!1],Math.abs)),i.ideas={},_.each(n,function(e){i.ideas[r++]=h(t.ideas[e])})),i};return s&&(n=parseInt(s,10)-1),u=o&&(o.title||o.attr)&&a(h(o),S(s)),!(!c||!u)&&(!!t.getYsy().validator.validate("paste",c,u)&&(d=l(c,u),s&&r(),T(u,"position"),b("paste",[i,o,u.id],function(){delete c.ideas[d]},e),u.id))},t.flip=function(){return t.execCommand("flip",arguments)},C.flip=function(e,n){var i,r,o=t.findChildRankById(n);return!!o&&(r=u(t.ideas,-1*p(o)),i=r-10*p(o),M(t,i,o),b("flip",[n],function(){M(t,o,i)},e),!0)},t.initialiseTitle=function(){return t.execCommand("initialiseTitle",arguments)},C.initialiseTitle=function(t,e,n){var i,r=c(e);return!!r&&((i=r.title)!=n&&(r.title=n,w("initialiseTitle",[e,n],function(){r.title=i},t),!0))},t.updateTitle=function(){return t.execCommand("updateTitle",arguments)},C.updateTitle=function(t,e,n){var i,r=c(e);return!!r&&((i=r.title)!=n&&(r.title=n,b("updateTitle",[e,n],function(){r.title=i},t),!0))},t.addSubIdea=function(){return t.execCommand("addSubIdea",arguments)},C.addSubIdea=function(e,n,i,r){var o,s,u=c(n);return!!u&&((!r||!c(r))&&(o=a({title:i,id:r}),!!t.getYsy().validator.validate("addSubIdea",u,o)&&(s=l(u,o),b("addSubIdea",[n,i,o.id],function(){delete u.ideas[s]},e),o.id)))},t.removeMultiple=function(e){t.startBatch();var n=_.map(e,t.removeSubIdea);return t.endBatch(),n},t.removeSubIdea=function(){return t.execCommand("removeSubIdea",arguments)},C.removeSubIdea=function(e,n){if(!t.getYsy().validator.validate("removeSubIdea",n,e))return!1;var i,r,o,s=t.findParent(n);return!!s&&(i=s.findChildRankById(n),r=s.ideas[i],delete s.ideas[i],o=t.links,t.links=_.reject(t.links,function(t){return t.ideaIdFrom==n||t.ideaIdTo==n}),b("removeSubIdea",[n],function(){s.ideas[i]=r,t.links=o},e),!0)},t.insertIntermediateMultiple=function(e){t.startBatch();var n=t.insertIntermediate(e[0]);return _.each(e.slice(1),function(e){t.changeParent(e,n)}),t.endBatch(),n},t.insertIntermediate=function(){return t.execCommand("insertIntermediate",arguments)},C.insertIntermediate=function(e,n,i,r){if(t.id==n)return!1;var o,s,u,d=t.findParent(n);return!!d&&((!r||!c(r))&&(!!(o=d.findChildRankById(n))&&(s=d.ideas[o],u=a({title:i,id:r}),!!t.getYsy().validator.validate("insertIntermediate",d,s,u)&&(d.ideas[o]=u,u.ideas={1:s},b("insertIntermediate",[n,i,u.id],function(){d.ideas[o]=s},e),u.id))))},t.changeParent=function(){return t.execCommand("changeParent",arguments)},C.changeParent=function(e,n,i){var r,o,s,a,u,d=c(i);return n!=i&&(!!d&&(!!(a=t.findSubIdeaById(n))&&(!a.findSubIdeaById(i)&&(!d.containsDirectChild(n)&&(!!t.getYsy().validator.changeParent(a,d)&&(!!(r=t.findParent(n))&&(o=r.findChildRankById(n),s=l(d,a),u=a.getAttr("position"),T(a,"position"),delete r.ideas[o],b("changeParent",[n,i,r.id],function(){T(a,"position",u),r.ideas[o]=a,delete d.ideas[s]},e),!0)))))))},t.mergeAttrProperty=function(e,n,i,r){var o=t.getAttrById(e,n)||{};return r?o[i]=r:delete o[i],_.isEmpty(o)&&(o=!1),t.updateAttr(e,n,o)},t.updateAttr=function(){return t.execCommand("updateAttr",arguments)},C.updateAttr=function(t,e,n,i){var r,o=c(e);return(r=T(o,n,i))&&b("updateAttr",[e,n,i],r,t),!!r},t.moveRelative=function(e,n){var i=t.findParent(e),r=i&&i.findChildRankById(e),o=r&&_.sortBy(h(i,r),Math.abs),s=(o&&o.indexOf(r))+(n>0?n+1:n),a=s>=0&&i&&o&&i.ideas[o[s]];return!(s<0||!i)&&t.positionBefore(e,a&&a.id,i)},t.positionBefore=function(){return t.execCommand("positionBefore",arguments)},C.positionBefore=function(e,n,i,r){var o,s,a,d,l,c,p;if(!(p=(r=r||t).findChildRankById(n)))return _.reduce(r.ideas,function(t,r){return t||C.positionBefore(e,n,i,r)},!1);if(n==i)return!1;if(o=0,i){if(!(s=r.findChildRankById(i)))return!1;if(a=h(r,p),(l=(d=_.reject(_.sortBy(a,Math.abs),function(t){return Math.abs(t)>=Math.abs(s)})).length>0?_.max(d,Math.abs):0)==p)return!1;o=l+(s-l)/2}else{if((c=u(r.ideas,p<0?-1:1))==p)return!1;o=c+10*(p<0?-1:1)}return o!=p&&(M(r,o,p),b("positionBefore",[n,i],function(){M(r,p,o)},e),!0)},observable(t),i=function(t,e){var n,i;return t!==e&&(!!(n=c(t))&&(!!(i=c(e))&&!(_.find(n.ideas,function(t){return t.id===e})||_.find(i.ideas,function(e){return e.id===t}))))},t.addLink=function(){return t.execCommand("addLink",arguments)},C.addLink=function(e,n,r){var o;return!!i(n,r)&&!_.find(t.links,function(t){return t.ideaIdFrom===n&&t.ideaIdTo===r||t.ideaIdFrom===r&&t.ideaIdTo===n})&&(t.links=t.links||[],o={ideaIdFrom:n,ideaIdTo:r,attr:{style:{color:"#FF0000",lineStyle:"dashed"}}},t.links.push(o),b("addLink",[n,r],function(){t.links.pop()},e),!0)},t.removeLink=function(){return t.execCommand("removeLink",arguments)},C.removeLink=function(e,n,i){for(var r,o=0;t.links&&o<t.links.length;){if(r=t.links[o],String(r.ideaIdFrom)===String(n)&&String(r.ideaIdTo)===String(i))return t.links.splice(o,1),b("removeLink",[n,i],function(){t.links.push(_.clone(r))},e),!0;o+=1}return!1},t.getLinkAttr=function(e,n,i){var r=_.find(t.links,function(t){return t.ideaIdFrom==e&&t.ideaIdTo==n});return!!(r&&r.attr&&r.attr[i])&&r.attr[i]},t.updateLinkAttr=function(){return t.execCommand("updateLinkAttr",arguments)},C.updateLinkAttr=function(e,n,i,r,o){var s,a=_.find(t.links,function(t){return t.ideaIdFrom==n&&t.ideaIdTo==i});return(s=T(a,r,o))&&b("updateLinkAttr",[n,i,r,o],s,e),!!s},t.resetHistory=function(){f={},y={}},t.canUndo=function(){return!!(f[e]&&f[e].length>0)},t.canRedo=function(){return!!(y[e]&&y[e].length>0)},t.undo=function(){return t.execCommand("undo",arguments)},C.undo=function(e){var n;return t.endBatch(),!(!(n=f[e]&&f[e].pop())||!n.undoFunction)&&(n.undoFunction(),y[e]||(y[e]=[]),y[e].push(n),t.dispatchEvent("changed","undo",[],e),!0)},t.redo=function(){return t.execCommand("redo",arguments)},C.redo=function(e){var n;return t.endBatch(),!!(n=y[e]&&y[e].pop())&&(g=!0,t.execCommand(n.eventMethod,n.eventArgs,e),g=!1,!0)},t.storeResource=function(){return t.execCommand("storeResource",arguments)},C.storeResource=function(n,i,r){var o,s,a=function(){if(_.isEmpty(t.resources))return 0;var n=function(t){return parseInt(t,10)},i=_.keys(t.resources),r=e?_.filter(i,RegExp.prototype.test.bind(new RegExp("\\/"+e+"$"))):i,o=_.map(r,n);return _.isEmpty(o)?0:_.max(o)},u=function(){return a()+1+E};return!r&&t.resources&&(o=_.find(_.keys(t.resources),function(e){return t.resources[e]===i}))?o:(s=r||u(),t.resources=t.resources||{},t.resources[s]=i,t.dispatchEvent("resourceStored",i,s,n),s)},t.getResource=function(e){return t.resources&&t.resources[e]},t.hasSiblings=function(e){if(e===t.id)return!1;var n=t.findParent(e);return n&&_.size(n.ideas)>1},2!=t.formatVersion&&(x(t),t.formatVersion=2),a(t),t},EASY.schedule.require(function(){MAPJS.DOMRender={svgPixel:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="1" height="1"></svg>',nodeCacheMark:function(t,e){"use strict";return{title:t.title,icon:t.attr&&t.attr.icon&&_.pick(t.attr.icon,"width","height","position"),collapsed:t.attr&&t.attr.collapsed,level:t.level||e}},dummyTextBox:jQuery("<div>").addClass("mapjs-node").css({position:"absolute",visibility:"hidden"}),dimensionProvider:function(t,e){"use strict";var n,i=jQuery(document).nodeWithId(t.id),r=function(){return MAPJS.DOMRender.svgPixel};return i&&i.length>0&&_.isEqual(i.data("nodeCacheMark"),MAPJS.DOMRender.nodeCacheMark(t,e))?_.pick(i.data(),"width","height"):((i=MAPJS.DOMRender.dummyTextBox).attr("mapjs-level",e).appendTo("body").updateNodeContent(t,r),n={width:i.outerWidth(!0),height:i.outerHeight(!0)},i.detach(),n)},layoutCalculator:function(t){"use strict";return MAPJS.calculateLayout(t,MAPJS.DOMRender.dimensionProvider)},fixedLayout:!1},MAPJS.createSVG=function(t){"use strict";return jQuery(document.createElementNS("http://www.w3.org/2000/svg",t||"svg"))},jQuery.fn.getBox=function(){"use strict";var t=this&&this[0];return!!t&&{top:t.offsetTop,left:t.offsetLeft,width:t.offsetWidth,height:t.offsetHeight}},jQuery.fn.getDataBox=function(){"use strict";var t=this.data();return t&&t.width&&t.height?{top:t.y,left:t.x,width:t.width,height:t.height}:this.getBox()},jQuery.fn.animateConnectorToPosition=function(t,e){"use strict";var n=jQuery(this),i=n.data("nodeFrom"),r=n.data("nodeTo"),o=i&&i.getDataBox(),s=r&&r.getDataBox(),a={from:i&&i.getBox(),to:r&&r.getBox()};return e=e||1,!!(o&&s&&a&&a.from.width===o.width&&a.to.width===s.width&&a.from.height===o.height&&a.to.height===s.height&&Math.abs(a.from.top-a.to.top-(o.top-s.top))<e&&Math.abs(a.from.left-a.to.left-(o.left-s.left))<e)&&(n.animate({left:Math.round(Math.min(o.left,s.left)),top:Math.round(Math.min(o.top,s.top))},t),!0)},jQuery.fn.queueFadeOut=function(t){"use strict";var e=this;return e.fadeOut(_.extend({complete:function(){e.is(":focus")&&e.parents("[tabindex]").focus(),e.remove()}},t))},jQuery.fn.queueFadeIn=function(t){"use strict";var e=this;return e.css("opacity",0).animate({opacity:1},_.extend({complete:function(){e.css("opacity","")}},t))},jQuery.fn.updateStage=function(){"use strict";var t=this.data(),e={"min-width":Math.round(t.width-t.offsetX),"min-height":Math.round(t.height-t.offsetY),width:Math.round(t.width-t.offsetX),height:Math.round(t.height-t.offsetY),"transform-origin":"top left",transform:"translate3d("+Math.round(t.offsetX)+"px, "+Math.round(t.offsetY)+"px, 0)"};return t.scale&&1!==t.scale&&(e.transform="scale("+t.scale+") translate("+Math.round(t.offsetX)+"px, "+Math.round(t.offsetY)+"px)"),this.css(e),this},MAPJS.DOMRender.curvedPath=function(t,e){"use strict";var n,i,r,o=function(t,e,n,i,r,o,s,a){var u=t<r?.1:.9;return{from:{x:t+(1-u)*n,y:e+.5*i},to:{x:r+u*s,y:o+.5*a},controlPointOffset:0}},s=function(t,e){var n,i=10,r=e.top+.5*e.height,s=t.top+.5*t.height;return Math.abs(s-r)+i<Math.max(e.height,.75*t.height)?o(t.left,t.top,t.width,t.height,e.left,e.top,e.width,e.height):(n=t.left<e.left?0:1,{from:{x:t.left+.5*t.width,y:t.top+.5*t.height},to:{x:e.left+n*e.width,y:e.top+.5*e.height},controlPointOffset:.75})},a={left:Math.min(t.left,e.left),top:Math.min(t.top,e.top)};return a.width=Math.max(t.left+t.width,e.left+e.width,a.left+1)-a.left,a.height=Math.max(t.top+t.height,e.top+e.height,a.top+1)-a.top,i=(n=s(t,e)).controlPointOffset*(n.from.y-n.to.y),r=1.5*Math.min(e.height,t.height),i=Math.max(-r,Math.min(r,i)),{d:"M"+Math.round(n.from.x-a.left)+","+Math.round(n.from.y-a.top)+"Q"+Math.round(n.from.x-a.left)+","+Math.round(n.to.y-i-a.top)+" "+Math.round(n.to.x-a.left)+","+Math.round(n.to.y-a.top),position:a}},MAPJS.DOMRender.straightPath=function(t,e){"use strict";var n=function(t,e){var n,i,r,o,s,a,u,d=[{x:t.left+.5*t.width,y:t.top},{x:t.left+t.width,y:t.top+.5*t.height},{x:t.left+.5*t.width,y:t.top+t.height},{x:t.left,y:t.top+.5*t.height}],l=[{x:e.left+.5*e.width,y:e.top},{x:e.left+e.width,y:e.top+.5*e.height},{x:e.left+.5*e.width,y:e.top+e.height},{x:e.left,y:e.top+.5*e.height}],c=Infinity;for(n=0;n<d.length;n+=1)for(i=0;i<l.length;i+=1)(u=(s=d[n].x-l[i].x)*s+(a=d[n].y-l[i].y)*a)<c&&(r=n,o=i,c=u);return{from:d[r],to:l[o]}},i={left:Math.min(t.left,e.left),top:Math.min(t.top,e.top)},r=n(t,e);return i.width=Math.max(t.left+t.width,e.left+e.width,i.left+1)-i.left,i.height=Math.max(t.top+t.height,e.top+e.height,i.top+1)-i.top,{d:"M"+Math.round(r.from.x-i.left)+","+Math.round(r.from.y-i.top)+"L"+Math.round(r.to.x-i.left)+","+Math.round(r.to.y-i.top),conn:r,position:i}},MAPJS.DOMRender.nodeConnectorPath=MAPJS.DOMRender.curvedPath,MAPJS.DOMRender.linkConnectorPath=MAPJS.DOMRender.straightPath,jQuery.fn.updateConnector=function(t){"use strict";return jQuery.each(this,function(){var e,n,i,r,o,s=jQuery(this),a=s.data("nodeFrom"),u=s.data("nodeTo");a&&u&&0!==a.length&&0!==u.length?(t?(i=a.getDataBox(),r=u.getDataBox()):(i=a.getBox(),r=u.getBox()),o={from:i,to:r},_.isEqual(o,s.data("changeCheck"))||(s.data("changeCheck",o),e=MAPJS.DOMRender.nodeConnectorPath(i,r),n=s.find("path"),s.css(e.position),0===n.length&&(n=MAPJS.createSVG("path").attr("class","mapjs-connector").appendTo(s)),n.attr("d",e.d))):s.hide()})},jQuery.fn.updateLink=function(){"use strict";return jQuery.each(this,function(){var t,e,n,i,r,o,s,a,u,d,l,c,h,p=jQuery(this),f=p.data("nodeFrom"),y=p.data("nodeTo"),g=p.find("path.mapjs-link"),m=p.find("path.mapjs-link-hit"),v=p.find("path.mapjs-arrow"),w=Math.tan(Math.PI/9),b={dashed:"8, 8",solid:""},M=_.pick(p.data(),"lineStyle","arrow","color");f&&y&&0!==f.length&&0!==y.length?(i={from:e=f.getBox(),to:n=y.getBox(),attrs:M},_.isEqual(i,p.data("changeCheck"))||(p.data("changeCheck",i),t=MAPJS.DOMRender.linkConnectorPath(e,n),p.css(t.position),0===g.length&&(g=MAPJS.createSVG("path").attr("class","mapjs-link").appendTo(p)),g.attr({d:t.d,"stroke-dasharray":b[M.lineStyle]}).css("stroke",M.color),0===m.length&&(m=MAPJS.createSVG("path").attr("class","mapjs-link-hit").appendTo(p)),m.attr({d:t.d}),M.arrow?(0===v.length&&(v=MAPJS.createSVG("path").attr("class","mapjs-arrow").appendTo(p)),u=14,c=t.conn.to.x-t.conn.from.x,h=t.conn.to.y-t.conn.from.y,0===c?(d=h<0?-1:1,r=t.conn.to.x+u*Math.sin(w)*d,s=t.conn.to.x-u*Math.sin(w)*d,o=t.conn.to.y-u*Math.cos(w)*d,a=t.conn.to.y-u*Math.cos(w)*d):(l=h/c,t.conn.from.x<t.conn.to.x&&(u=-u),r=t.conn.to.x+(1-l*w)*u/Math.sqrt((1+l*l)*(1+w*w)),o=t.conn.to.y+(l+w)*u/Math.sqrt((1+l*l)*(1+w*w)),s=t.conn.to.x+(1+l*w)*u/Math.sqrt((1+l*l)*(1+w*w)),a=t.conn.to.y+(l-w)*u/Math.sqrt((1+l*l)*(1+w*w))),v.attr("d","M"+Math.round(r-t.position.left)+","+Math.round(o-t.position.top)+"L"+Math.round(t.conn.to.x-t.position.left)+","+Math.round(t.conn.to.y-t.position.top)+"L"+Math.round(s-t.position.left)+","+Math.round(a-t.position.top)+"Z").css("fill",M.color).show()):v.hide())):p.hide()})},jQuery.fn.addNodeCacheMark=function(t){"use strict";this.data("nodeCacheMark",MAPJS.DOMRender.nodeCacheMark(t))},jQuery.fn.updateNodeContent=function(t,e){"use strict";var n=25,i=jQuery(this),r=function(){var t=i.find("[data-mapjs-role=title]");return 0===t.length&&(t=jQuery("<span>").attr("data-mapjs-role","title").appendTo(i)),t},o=function(t){var e=MAPJS.URLHelper.getLink(t),n=i.find("a.mapjs-hyperlink");e?(0===n.length&&(n=jQuery('<a target="_blank" class="mapjs-hyperlink"></a>').appendTo(i)),n.attr("href",e).show()):n.hide()},s=function(t){var e=i.find(".mapjs-label");t||0===t?(0===e.length&&(e=jQuery('<span class="mapjs-label"></span>').appendTo(i)),e.text(t).show()):e.hide()},a=function(){var e=t.attr&&t.attr.attachment,n=i.find("a.mapjs-attachment");e?(0===n.length&&(n=jQuery('<a href="#" class="mapjs-attachment"></a>').appendTo(i).click(function(){i.trigger("attachment-click")})),n.show()):n.hide()},u=function(t){var e,o=MAPJS.URLHelper.stripLink(t)||(t.length<n?t:t.substring(0,n)+"..."),s=MAPJS.DOMRender.nodeTextPadding||11,a=r(),u=a[0];a.text(o.trim()),i.data("title",t),a.css({"max-width":"","min-width":""}),u.scrollWidth-s>u.offsetWidth?a.css("max-width",u.scrollWidth+"px"):(e=u.offsetHeight,a.css("min-width",a.css("max-width")),u.offsetHeight===e&&a.css("min-width",""))},d=function(){t.attr&&t.attr.collapsed?i.addClass("collapsed"):i.removeClass("collapsed")},l=function(t){var e=Color(t).mix(Color("#EEEEEE")).luminosity();return e<.5?"mapjs-node-dark":e<.9?"mapjs-node-light":"mapjs-node-white"},c=function(){var e=t.attr&&t.attr.style&&t.attr.style.background;"false"!==e&&"transparent"!==e||(e=!1),i.removeClass("mapjs-node-dark mapjs-node-white mapjs-node-light"),e?(i.css("background-color",e),i.addClass(l(e))):i.css("background-color","")},h=function(t){var n,o,s,a,u=r(),d={"min-height":"","min-width":"","background-image":"","background-repeat":"","background-size":"","background-position":""},l={"margin-top":"","margin-left":""};i.css({padding:""}),t&&(a=parseInt(i.css("padding-left"),10),n=u.outerHeight(),o=u.outerWidth(),s=parseInt(u.css("max-width"),10),_.extend(d,{"background-image":'url("'+(e?e(t.url):t.url)+'")',"background-repeat":"no-repeat","background-size":t.width+"px "+t.height+"px","background-position":"center center"}),"top"===t.position||"bottom"===t.position?("top"===t.position?d["background-position"]="center "+a+"px":MAPJS.DOMRender.fixedLayout?d["background-position"]="center "+(a+n)+"px":d["background-position"]="center "+t.position+" "+a+"px",d["padding-"+t.position]=t.height+2*a,d["min-width"]=t.width,t.width>s&&(l["margin-left"]=(t.width-s)/2)):"left"===t.position||"right"===t.position?("left"===t.position?d["background-position"]=a+"px center":MAPJS.DOMRender.fixedLayout?d["background-position"]=o+2*a+"px center ":d["background-position"]=t.position+" "+a+"px center",d["padding-"+t.position]=t.width+2*a,t.height>n&&(l["margin-top"]=(t.height-n)/2,d["min-height"]=t.height)):(t.height>n&&(l["margin-top"]=(t.height-n)/2,d["min-height"]=t.height),d["min-width"]=t.width,t.width>s&&(l["margin-left"]=(t.width-s)/2))),i.css(d),u.css(l)};return i.attr("mapjs-level",t.level),u(t.title),o(t.title),s(t.label),a(),i.data({x:Math.round(t.x),y:Math.round(t.y),width:Math.round(t.width),height:Math.round(t.height),nodeId:t.id}).addNodeCacheMark(t),c(),h(t.attr&&t.attr.icon),d(),i},jQuery.fn.placeCaretAtEnd=function(){"use strict";var t,e,n,i=this[0];window.getSelection&&document.createRange?((t=document.createRange()).selectNodeContents(i),t.collapse(!1),(e=window.getSelection()).removeAllRanges(),e.addRange(t)):document.body.createTextRange&&((n=document.body.createTextRange()).moveToElementText(i),n.collapse(!1),n.select())},jQuery.fn.selectAll=function(){"use strict";var t,e,n,i=this[0];window.getSelection&&document.createRange?((t=document.createRange()).selectNodeContents(i),(e=window.getSelection()).removeAllRanges(),e.addRange(t)):document.body.createTextRange&&((n=document.body.createTextRange()).moveToElementText(i),n.select())},jQuery.fn.innerText=function(){"use strict";var t=this.html(),e=/<br\/?>/.test(t);return/<div>/.test(t)&&this[0].innerText?this[0].innerText.trim():e?t.replace(/<br\/?>/gi,"\n").replace(/(<([^>]+)>)/gi,""):this.text()},jQuery.fn.editNode=function(t){"use strict";var e=this,n=this.find("[data-mapjs-role=title]"),i=this.data("title"),r=n.text(),o=jQuery.Deferred(),s=function(){l(),n.css("word-break",""),n.removeAttr("contenteditable"),e.removeClass("mindmup-node--renaming"),e.shadowDraggable()},a=function(){var t=n.innerText();if(t===i)return u();s(),o.resolve(t)},u=function(){s(),n.text(r),o.reject()},d=function(t){var e=13,r=27,o=9,s=83,d=90;t.shiftKey&&t.which===e||(t.which===e?(a(),t.stopPropagation()):t.which===r?(u(),t.stopPropagation()):t.which===o||t.which===s&&(t.metaKey||t.ctrlKey)&&!t.altKey?(a(),t.preventDefault()):t.shiftKey||t.which!==d||!t.metaKey&&!t.ctrlKey||t.altKey||(n.text()===i&&u(),t.stopPropagation()))},l=function(){n.off("blur",a).off("keydown",d)};return function(){n.on("blur",a).on("keydown",d)}(),i!==r&&n.css("word-break","break-all"),n.text(i).attr("contenteditable",!0).focus(),t?n.selectAll():i&&n.placeCaretAtEnd(),e.addClass("mindmup-node--renaming"),e.shadowDraggable({disable:!0}),o.promise()},jQuery.fn.updateReorderBounds=function(t,e){"use strict";var n=this;t?(n.show(),n.attr("mapjs-edge",t.edge),n.css({top:e.y+e.height/2-n.height()/2,left:t.x-("left"===t.edge?n.width():0)})):n.hide()},function(){"use strict";var t=function(t){return t.replace(/[^A-Za-z0-9_-]/g,"_")},e=function(e){return t("connector_"+e.from+"_"+e.to)},n=function(e){return t("link_"+e.ideaIdFrom+"_"+e.ideaIdTo)},i=function(e){return t("node_"+e)};jQuery.fn.createNode=function(t){return jQuery("<div>").attr({id:i(t.id),tabindex:0,"data-mapjs-role":"node"}).css({display:"block",position:"absolute"}).addClass("mapjs-node").appendTo(this)},jQuery.fn.createConnector=function(t){return MAPJS.createSVG().attr({id:e(t),"data-mapjs-role":"connector","class":"mapjs-draw-container"}).data({nodeFrom:this.nodeWithId(t.from),nodeTo:this.nodeWithId(t.to)}).appendTo(this)},jQuery.fn.createLink=function(t){var e=_.extend({color:"red",lineStyle:"dashed"},t.attr&&t.attr.style);return MAPJS.createSVG().attr({id:n(t),"data-mapjs-role":"link","class":"mapjs-draw-container"}).data({nodeFrom:this.nodeWithId(t.ideaIdFrom),nodeTo:this.nodeWithId(t.ideaIdTo)}).data(e).appendTo(this)},jQuery.fn.nodeWithId=function(t){return this.find("#"+i(t))},jQuery.fn.findConnector=function(t){return this.find("#"+e(t))},jQuery.fn.findLink=function(t){return this.find("#"+n(t))},jQuery.fn.createReorderBounds=function(){return jQuery("<div>").attr({"data-mapjs-role":"reorder-bounds","class":"mapjs-reorder-bounds"}).hide().css("position","absolute").appendTo(this)}}(),MAPJS.DOMRender.viewController=function(t,e,n,i,r,o){"use strict";var s,a=e.parent(),u=[],d=[],l={duration:400,queue:"nodeQueue",easing:"linear"},c=t.isEditingEnabled()?e.createReorderBounds():jQuery("<div>"),h=r.$menu.outerHeight(),p=function(){return s||(s={left:a.scrollLeft(),top:a.scrollTop(),innerWidth:a.innerWidth(),innerHeight:a.innerHeight()})},f=function(t,n){var i=e.data(),r=p();return{x:i.scale*(t+i.offsetX)-r.left,y:i.scale*(n+i.offsetY)-r.top}},y=function(t){var n=e.data();return n.scale*(t+n.offsetY)-$(document).scrollTop()+a.offset().top},g=function(t,n){var i=e.data(),r=p();return{x:(r.left+t)/i.scale-i.offsetX,y:(r.top+n)/i.scale-i.offsetY}},m=[],v=function(){var t=jQuery(this);e.data("dirty")?m.push(t):t.css({left:t.data("x"),top:t.data("y")}).trigger("mapjs:move")},w=function(){e.data("dirty")&&(e.updateStage(),e.data("dirty",!1)),_.each(m,function(t){t.css({left:t.data("x"),top:t.data("y")}).trigger("mapjs:move")}),m=[]},b=function(){var t=jQuery(this);t.clearQueue(l.queue).animate({left:t.data("x"),top:t.data("y"),opacity:1},_.extend({complete:function(){t.css("opacity",""),t.each(v)}},l)).trigger("mapjs:animatemove")},M=function(t,n){var i=e.data();t<-1*i.offsetX&&(i.width=i.width-i.offsetX-t,i.offsetX=-1*t,i.dirty=!0),n<-1*i.offsetY&&(i.height=i.height-i.offsetY-n,i.offsetY=-1*n,i.dirty=!0),t>i.width-i.offsetX&&(i.width=i.offsetX+t,i.dirty=!0),n>i.height-i.offsetY&&(i.height=i.offsetY+n,i.dirty=!0)},x=function(){return jQuery(this).each(function(){var t=jQuery(this).data(),e=MAPJS.DOMRender.stageMargin||{top:0,left:0,bottom:0,right:0};M(t.x-e.left,t.y-e.top),M(t.x+t.width+e.right,t.y+t.height+e.bottom)})},S=function(t,n,i){var r,o,s=e.data(),u=Math.max(document.documentElement.clientHeight,window.innerHeight||0),d={x:a.innerWidth()/2,y:u/2-a.offset().top},l=MAPJS.DOMRender.stageVisibilityMargin||{top:0,left:0,bottom:0,right:0};M(t-d.x/s.scale,n-d.y/s.scale),M(t+d.x/s.scale-l.left,n+d.y/s.scale-l.top),w(),r=s.scale*(t+s.offsetX)-d.x,o=s.scale*(n+s.offsetY)-d.y,a.finish(),i?(a.animate({scrollLeft:r},{duration:400}),$("html, body").animate({scrollTop:o},{duration:400})):(a.scrollLeft(r),$(document).scrollTop(o))},C=function(){return g(a.innerWidth()/2,a.innerHeight()/2)},k=function(t){if(t&&0!==t.length){a.finish();var e=t.data(),n=f(e.x,e.y),i=f(e.x+e.width,e.y+e.height),r=Math.max(document.documentElement.clientHeight,window.innerHeight||0),o=null,s=null,u=MAPJS.DOMRender.stageVisibilityMargin||{top:10,left:10,bottom:10,right:10};n.y=y(e.y),i.y=y(e.y+e.height),n.x-u.left<0?o=a.scrollLeft()+n.x-u.left:i.x+u.right>a.innerWidth()&&(o=a.scrollLeft()+i.x-a.innerWidth()+u.right),n.y-u.top<h?s=$(document).scrollTop()+n.y-u.top-h:i.y+u.bottom>r&&(s=$(document).scrollTop()+i.y-r+u.bottom),null!==o&&(a[0].scrollLeft=o),null!==s&&$("html, body").scrollTop(s)}},E=function(t){if(t){var e,n=a.offset();if(t.gesture){var i=t.gesture.center;e={x:i.x-n.left,y:i.y+window.pageYOffset-n.top}}else e={x:t.pageX-n.left,y:t.pageY-n.top};return e.x>=0&&e.x<=a.innerWidth()&&e.y>=0&&e.y<=a.innerHeight()?e:void 0}},T=function(t){var e=E(t);if(e)return g(e.x,e.y)},I=function(){
(P||!1===P)&&(jQuery(".mapjs-node").removeClass("droppable"),P=undefined)},A=function(t){e.nodeWithId(t).addClass("droppable"),P=t},P=!1,D=function(t,e){if(_.isEmpty(t))return!1;if(!e)return!1;var n=function(t){var n=e.x;return"right"===t.edge&&(n+=e.width),Math.abs(n-t.x)<2*t.margin&&e.y<t.maxY&&e.y>t.minY};return _.find(t,n)};a.on("scroll",function(){s=undefined}),i&&i.addEventListener("imageInserted",function(e,n,i,r){var o=T(r);t.dropImage(e,n,i,o&&o.x,o&&o.y)}),t.addEventListener("nodeCreated",function(i){var o,s=e.createNode(i).queueFadeIn(l).updateNodeContent(i,r).on("tap",function(e){var n=e.gesture&&e.gesture.srcEvent||e;n.button&&-1!==n.button||(t.clickNode(i.id,n),e&&e.stopPropagation())}).on("doubletap",function(e){e&&e.stopPropagation(),t.isEditingEnabled()?t.editNode("mouse"):t.toggleCollapse("mouse")}).on("attachment-click",function(){t.openAttachment("mouse",i.id)}).each(x).each(v).on("mm:start-dragging mm:start-dragging-shadow",function(){t.selectNode(i.id),o=t.getReorderBoundary(i.id),s.addClass("dragging")}).on("mm:drag",function(e){var n,r,a=T(e),u=e.currentPosition&&T({pageX:e.currentPosition.left,pageY:e.currentPosition.top}),d=e&&e.gesture&&e.gesture.srcEvent&&e.gesture.srcEvent.shiftKey;a?(n=t.getNodeIdAtPosition(a.x,a.y),d||n||!u?c.hide():(u.width=s.outerWidth(),u.height=s.outerHeight(),r=D(o,u),c.updateReorderBounds(r,u)),n&&n!==i.id?n!==P&&(I(),n&&A(n)):I()):I()}).on("contextmenu",function(e){if(t.selectNode(i.id,!1,e.shiftKey||e.ctrlKey),t.requestContextMenu(e.pageX,e.pageY))return e.preventDefault(),!1}).on("mm:stop-dragging",function(e){s.removeClass("dragging"),c.hide();var n,r,a,u,d,l=e&&e.gesture&&e.gesture.srcEvent&&e.gesture.srcEvent.shiftKey,h=T(e);if(I(),h)return n=t.getNodeIdAtPosition(h.x,h.y),!!(r=T({pageX:e.finalPosition.left,pageY:e.finalPosition.top}))&&(n&&n!==i.id?a=t.dropNode(i.id,n,!!l):i.level>1?(r.width=s.outerWidth(),r.height=s.outerHeight(),u=!!l||!D(o,r),a=t.positionNodeAt(i.id,r.x,r.y,u)):1===i.level&&e.gesture?((d=C()).x-=e.gesture.deltaX||0,d.y-=e.gesture.deltaY||0,S(d.x,d.y,!0),a=!0):a=!1,a)}).on("mm:cancel-dragging",function(){I(),s.removeClass("dragging"),c.hide()});n&&s.on("hold",function(e){var n=e.gesture&&e.gesture.srcEvent||e;if(t.clickNode(i.id,n),t.requestContextMenu(e.gesture.center.pageX,e.gesture.center.pageY))return e.preventDefault(),e.gesture&&(e.gesture.preventDefault(),e.gesture.stopPropagation()),!1}),t.isEditingEnabled()&&s.shadowDraggable()}),t.addEventListener("nodeSelectionChanged",function(t,n){var i=e.nodeWithId(t);n?(i.addClass("selected"),k(i)):i.removeClass("selected")}),t.addEventListener("nodeRemoved",function(t){e.nodeWithId(t.id).queueFadeOut(l)}),t.addEventListener("nodeMoved",function(t){var n=p(),i=e.nodeWithId(t.id).data({x:Math.round(t.x),y:Math.round(t.y)}).each(x),r=f(Math.round(t.x),Math.round(t.y)),o=f(Math.round(t.x+t.width),Math.round(t.y+t.height));o.x<0||o.y<0||r.x>n.innerWidth||r.y>n.innerHeight?i.each(v):i.each(b)}),t.addEventListener("nodeTitleChanged nodeAttrChanged nodeLabelChanged",function(t){e.nodeWithId(t.id).updateNodeContent(t,r)}),t.addEventListener("connectorCreated",function(t){var n=e.createConnector(t).queueFadeIn(l).updateConnector(!0);e.nodeWithId(t.from).add(e.nodeWithId(t.to)).on("mapjs:move",function(){n.updateConnector(!0)}).on("mm:drag",function(){n.updateConnector()}).on("mapjs:animatemove",function(){u.push(n)})}),t.addEventListener("connectorRemoved",function(t){e.findConnector(t).queueFadeOut(l)}),t.addEventListener("linkCreated",function(n){var i=e.createLink(n).queueFadeIn(l).updateLink();i.find(".mapjs-link-hit").on("tap",function(e){t.selectLink("mouse",n,{x:e.gesture.center.pageX,y:e.gesture.center.pageY}),e.stopPropagation(),e.gesture.stopPropagation()}),e.nodeWithId(n.ideaIdFrom).add(e.nodeWithId(n.ideaIdTo)).on("mapjs:move mm:drag",function(){i.updateLink()}).on("mapjs:animatemove",function(){d.push(i)})}),t.addEventListener("linkRemoved",function(t){e.findLink(t).queueFadeOut(l)}),t.addEventListener("mapScaleChanged",function(t){var n=e.data("scale"),i=Math.max(Math.min(n*t,5),.2),r=C();n!==i&&(e.data("scale",i).updateStage(),S(r.x,r.y))}),t.addEventListener("nodeVisibilityRequested",function(n){var i=n||t.getCurrentlySelectedIdeaId(),r=e.nodeWithId(i);r&&(k(r),a.finish())}),t.addEventListener("nodeFocusRequested",function(t){var n=e.nodeWithId(t).data(),i=n.x+n.width/2,r=n.y+n.height/2;1!==e.data("scale")&&e.data("scale",1).updateStage(),S(i,r,!0)}),t.addEventListener("mapViewResetRequested",function(){e.data({scale:1,height:0,width:0,offsetX:0,offsetY:0}).updateStage(),e.children().addBack().finish(l.queue),jQuery(e).find(".mapjs-node").each(x),w(),jQuery(e).find("[data-mapjs-role=connector]").updateConnector(!0),jQuery(e).find("[data-mapjs-role=link]").updateLink(),S(0,0),a.focus()}),t.addEventListener("layoutChangeStarting",function(){s=undefined,e.children().finish(l.queue),e.finish(l.queue)}),t.addEventListener("layoutChangeComplete",function(){var n=[],i=[];_.each(u,function(t){jQuery(t).animateConnectorToPosition(l,2)||n.push(t)}),_.each(d,function(t){jQuery(t).animateConnectorToPosition(l,2)||i.push(t)}),u=[],d=[],e.animate({opacity:1},_.extend({progress:function(){$(n).updateConnector(),$(i).updateLink()}},l)),k(e.nodeWithId(t.getCurrentlySelectedIdeaId())),w(),e.children().dequeue(l.queue),e.dequeue(l.queue)}),o&&o.inlineEditingDisabled||t.addEventListener("nodeEditRequested",function(n,i,r){var o=e.nodeWithId(n);t.setInputEnabled(!1),a.finish(),o.editNode(i).done(function(e){t.setInputEnabled(!0),t.updateTitle(n,e,r),o.focus()}).fail(function(){t.setInputEnabled(!0),r&&t.undo("internal"),o.focus()})}),t.addEventListener("addLinkModeToggled",function(t){t?e.addClass("mapjs-add-link"):e.removeClass("mapjs-add-link")}),t.addEventListener("linkAttrChanged",function(t){var n=_.extend({arrow:!1},t.attr&&t.attr.style);e.findLink(t).data(n).updateLink()}),t.addEventListener("activatedNodesChanged",function(t,n){_.each(t,function(t){e.nodeWithId(t).addClass("activated")}),_.each(n,function(t){e.nodeWithId(t).removeClass("activated")})})}},"jQuery"),EASY.schedule.require(function(){jQuery.fn.scrollWhenDragging=function(t){"use strict";return this.each(function(){var e,n=$(this);n.on("dragstart",function(){t()&&(e={top:n.scrollTop(),left:n.scrollLeft()})}).on("drag",function(t){t.gesture&&e&&(n.scrollTop(e.top-t.gesture.deltaY),n.scrollLeft(e.left-t.gesture.deltaX))}).on("dragend",function(){e=undefined})})},$.fn.domMapWidget=function(t,e,n,i,r,o,s,a){"use strict";var u={"return":"addSiblingIdea","shift+return":"addSiblingIdeaBefore","del backspace":"removeSubIdea","tab insert":"addSubIdea",left:"selectNodeLeft",up:"selectNodeUp",right:"selectNodeRight","shift+right":"activateNodeRight","shift+left":"activateNodeLeft","meta+right ctrl+right meta+left ctrl+left":"flip","shift+up":"activateNodeUp","shift+down":"activateNodeDown",down:"selectNodeDown","space f2":"editNode","shift+space":"editNodeData",f:"toggleCollapse","c meta+x ctrl+x":"cut","p meta+v ctrl+v":"paste","y meta+c ctrl+c":"copy","u meta+z ctrl+z":"undo","shift+tab":"insertIntermediate","Esc 0 meta+0 ctrl+0":"resetView","r meta+shift+z ctrl+shift+z meta+y ctrl+y":"redo","meta++ ctrl++ z":"scaleUp","meta+- ctrl+- shift+z":"scaleDown","meta+up ctrl+up":"moveUp","meta+down ctrl+down":"moveDown",Esc:"cancelCurrentAction","ctrl+s meta+s":"save",k:"requestContextMenu",i:"modalIncome",e:"modalExpense",o:"modalOverview"},d={"[":"activateChildren","{":"activateNodeAndChildren","=":"activateSiblingNodes",".":"activateSelectedNode","/":"toggleCollapse"},l=!0,c=this;return e.addEventListener("inputEnabledChanged",function(t,e){l=t,t&&!e&&c.focus()}),this.each(function(){var t=$(this),c=$("<div>").css({position:"relative"}).attr("data-mapjs-role","stage").appendTo(t).data({offsetX:t.innerWidth()/2,offsetY:t.innerHeight()/2,width:t.innerWidth()-20,height:t.innerHeight()-20,scale:1}).updateStage(),h=!1;t.hammer(),t.css("overflow","auto").attr("tabindex",1),e.isEditingEnabled()&&(r||t).simpleDraggableContainer(),n?t.on("doubletap",function(t){if(e.requestContextMenu(t.gesture.center.pageX,t.gesture.center.pageY))return t.preventDefault(),t.gesture.preventDefault(),!1}).on("pinch",function(t){if(t&&t.gesture&&t.gesture.scale){t.preventDefault(),t.gesture.preventDefault();var n=t.gesture.scale;h&&(n/=h),Math.abs(n-1)<.05||(h=t.gesture.scale,e.scale("touch",n,{x:t.gesture.center.pageX-c.data("offsetX"),y:t.gesture.center.pageY-c.data("offsetY")}))}}).on("gestureend",function(){h=!1}):(MAPJS.enableVerticalPan(t),t.scrollWhenDragging(e.getInputEnabled),t.on("mousedown",function(e){e.target!==t[0]&&t.css("overflow","hidden")}),jQuery(document).on("mouseup",function(){"auto"!==t.css("overflow")&&t.css("overflow","auto")})),MAPJS.DOMRender.viewController(e,c,n,i,o,a),_.each(u,function(n,i){t.keydown(i,function(t){e.getYsy().log.debug("keydown "+i+" => "+n,"keys"),l&&(t.stopImmediatePropagation(),t.preventDefault(),e[n]("keyboard"))})}),n||jQuery(window).on("resize",function(){e.resetView()}),jQuery(window).on("orientationchange",function(){s?e.centerOnNode(e.getSelectedNodeId()):e.resetView()}),jQuery("#container").on("keydown",function(t){var n,i={"U+003D":"scaleUp","U+002D":"scaleDown",61:"scaleUp",173:"scaleDown"};t&&!t.altKey&&(t.ctrlKey||t.metaKey)&&(t.originalEvent&&t.originalEvent.keyIdentifier?n=i[t.originalEvent.keyIdentifier]:"MozPrintableKey"===t.key&&(n=i[t.which]),n&&(e.getYsy().log.debug("keydown => "+n,"keys"),l&&(t.preventDefault(),e[n]("keyboard"))))}).on("wheel mousewheel",function(e){var n=e.originalEvent.deltaX||-1*e.originalEvent.wheelDeltaX;n<0&&0===t.scrollLeft()&&e.preventDefault(),n>0&&t[0].scrollWidth-t.width()-t.scrollLeft()==0&&e.preventDefault()}),t.on("keypress",function(t){if(l&&!/INPUT|TEXTAREA/.test(t&&t.target&&t.target.tagName)){var n=t.charCode||t.keyCode,i=String.fromCharCode(n),r=d[i];e.getYsy().log.debug("keydown "+i+" => "+r,"keys"),r?(t.preventDefault(),e[r]("keyboard")):Number(i)<=9&&Number(i)>=1&&(t.preventDefault(),e.activateLevel("keyboard",Number(i)+1))}})})}},"jQuery"),EASY.schedule.require(function(t){"use strict";t.fn.simpleDraggableContainer=function(){var e,n,i,r=this,o=function(r){if(e&&r.gesture){var o=t(document).scrollTop(),s={top:Math.round(n.top+r.gesture.deltaY-i+o),left:Math.round(n.left+r.gesture.deltaX)};return e.offset(s).trigger(t.Event("mm:drag",{currentPosition:s,gesture:r.gesture})),!1}},s=function(i){var r=e;"shadow"!==r.attr("mapjs-drag-role")?r.animate(n,{complete:function(){r.trigger(t.Event("mm:cancel-dragging",{gesture:i.gesture}))},progress:function(){r.trigger("mm:drag")}}):r.trigger(t.Event("mm:cancel-dragging",{gesture:i.gesture}))};return this.on("mm:start-dragging",function(r){e||(e=t(r.relatedTarget),i=t(document).scrollTop(),n=e.offset(),t(this).on("panmove",o))}).on("mm:start-dragging-shadow",function(s){var a=t(s.relatedTarget);e||(e=function(){var t=a.clone().addClass("drag-shadow").appendTo(r).offset(a.offset()).data(a.data()).attr("mapjs-drag-role","shadow"),e=a.parent().data("scale")||1;return 0!==e&&t.css({transform:"scale("+e+")","transform-origin":"top left"}),t}(),i=t(document).scrollTop(),n=e.offset(),e.on("mm:stop-dragging mm:cancel-dragging",function(e){t(this).remove(),e.stopPropagation(),e.stopImmediatePropagation();var n=t.Event(e.type,{gesture:e.gesture,finalPosition:e.finalPosition});a.trigger(n)}).on("mm:drag",function(t){a.trigger(t)}),t(this).on("panmove",o))}).on("panend",function(n){if(t(this).off("panmove",o),e){var i=t.Event("mm:stop-dragging",{gesture:n.gesture,finalPosition:e.offset()});e.trigger(i),!1===i.result&&s(n),e=undefined}}).on("mouseleave",function(n){e&&(t(this).off("panmove",o),s(n),e=undefined)}).attr("data-drag-role","container")};var e=function(e){t(this).trigger(t.Event("mm:start-dragging",{relatedTarget:this,gesture:e.gesture})),e.stopPropagation(),e.preventDefault()},n=function(e){t(this).trigger(t.Event("mm:start-dragging-shadow",{relatedTarget:this,gesture:e.gesture})),e.stopPropagation(),e.preventDefault()};t.fn.simpleDraggable=function(t){return t&&t.disable?this.off("panstart",e):MAPJS.enableVerticalPan(this.hammer()).on("panstart",e)},t.fn.shadowDraggable=function(t){return t&&t.disable?this.off("panstart",n):MAPJS.enableVerticalPan(this.hammer()).on("panstart",n)}},"jQuery"),MAPJS.defaultStyles={},MAPJS.layoutLinks=function(t,e){"use strict";var n={};return _.each(t.links,function(t){e[t.ideaIdFrom]&&e[t.ideaIdTo]&&(n[t.ideaIdFrom+"_"+t.ideaIdTo]={ideaIdFrom:t.ideaIdFrom,ideaIdTo:t.ideaIdTo,attr:_.clone(t.attr)})}),n},MAPJS.calculateFrame=function(t,e){"use strict";e=e||0;var n={top:_.min(t,function(t){return t.y}).y-e,left:_.min(t,function(t){return t.x}).x-e};return n.width=e+_.max(_.map(t,function(t){return t.x+t.width}))-n.left,n.height=e+_.max(_.map(t,function(t){return t.y+t.height}))-n.top,n},MAPJS.contrastForeground=function(t){"use strict";var e=Color(t).luminosity();return e<.5?"#EEEEEE":e<.9?"#4F4F4F":"#000000"},MAPJS.Outline=function(t,e){"use strict";var n=function(t,e){return _.map(t,function(t){return{l:t.l,h:t.h+e}})};this.initialHeight=function(){return this.bottom[0].h-this.top[0].h},this.borders=function(){return _.pick(this,"top","bottom")},this.spacingAbove=function(t){for(var e=0,n=0,i=0,r=0,o=0;e<this.bottom.length&&n<t.top.length;)i=Math.max(i,this.bottom[e].h-t.top[n].h),r+this.bottom[e].l<o+t.top[n].l?(r+=this.bottom[e].l,e+=1):r+this.bottom[e].l===o+t.top[n].l?(r+=this.bottom[e].l,e+=1,o+=t.top[n].l,n+=1):(o+=t.top[n].l,n+=1);return i},this.indent=function(t,e){if(!t)return this;var n=this.top.slice(),i=this.bottom.slice(),r=(i[0].h+n[0].h)/2;return n.unshift({h:r-e/2,l:t}),i.unshift({h:r+e/2,l:t}),new MAPJS.Outline(n,i)},this.stackBelow=function(t,e){var i=t.spacingAbove(this),r=MAPJS.Outline.extendBorder(t.top,n(this.top,i+e)),o=MAPJS.Outline.extendBorder(n(this.bottom,i+e),t.bottom);return new MAPJS.Outline(r,o)},this.expand=function(t,e){var i=t-this.top[0].h,r=e-this.bottom[0].h,o=n(this.top,i),s=n(this.bottom,r);return new MAPJS.Outline(o,s)},this.insertAtStart=function(t,e){var i=0,r=n(this.top,i),o=n(this.bottom,i),s=function(t){t[0].l*=.5,t[1].l+=t[0].l};return r[0].l+=e,o[0].l+=e,r.unshift({h:-.5*t.height,l:t.width}),o.unshift({h:.5*t.height,l:t.width}),r[0].h>r[1].h&&s(r),o[0].h<o[1].h&&s(o),new MAPJS.Outline(r,o)},this.top=t.slice(),this.bottom=e.slice()},MAPJS.Outline.borderLength=function(t){"use strict";return _.reduce(t,function(t,e){return t+e.l},0)},MAPJS.Outline.borderSegmentIndexAt=function(t,e){"use strict";for(var n=0,i=-1;n<=e;){if((i+=1)>=t.length)return-1;n+=t[i].l}return i},MAPJS.Outline.extendBorder=function(t,e){"use strict";var n,i=t.slice(),r=MAPJS.Outline.borderLength(t),o=MAPJS.Outline.borderSegmentIndexAt(e,r);return o>=0&&(n=MAPJS.Outline.borderLength(e.slice(0,o+1)),i.push({h:e[o].h,l:n-r}),i=i.concat(e.slice(o+1))),i},MAPJS.Tree=function(t){"use strict";_.extend(this,t),this.toLayout=function(t,e,n){t=t||0,e=e||0;var i,r={nodes:{},connectors:{}};return(i=_.pick(this,"id","title","attr","width","height","level")).attr.data=_.extend({},i.attr.data),1===i.level?(i.x=-.5*this.width,i.y=-.5*this.height):(i.x=t+this.deltaX||0,i.y=e+this.deltaY||0),i.attr.style||(i.attr.style={}),r.nodes[this.id]=i,n!==undefined&&(r.connectors[i.id]={from:n,to:i.id}),this.subtrees&&this.subtrees.forEach(function(t){var e=t.toLayout(i.x,i.y,i.id);_.extend(r.nodes,e.nodes),_.extend(r.connectors,e.connectors)}),r}},MAPJS.Outline.fromDimensions=function(t){"use strict";return new MAPJS.Outline([{h:-.5*t.height,l:t.width}],[{h:.5*t.height,l:t.width}])},MAPJS.calculateTree=function(t,e,n,i,r){"use strict";var o={id:t.id,title:t.title,attr:$.extend({},t.attr,{hasChildren:!_.isEmpty(t.ideas)}),deltaY:0,deltaX:0,level:r||1},s=function(t,e){var n,i,r,o,s,a,u=_.map(t,function(t){return _.pick(t,"deltaX","deltaY")});for(n=0;n<t.length;n+=1)(i=t[n]).attr&&i.attr.position?(i.deltaY=i.attr.position[1],(s===undefined||i.attr.position[2]>t[s].attr.position[2])&&(s=n)):i.deltaY+=e,n>0&&(r=u[n].deltaY-u[n-1].deltaY,(o=t[n].deltaY-t[n-1].deltaY)<r&&(i.deltaY+=r-o));if(a=s&&t[s].attr.position[1]-t[s].deltaY)for(n=0;n<t.length;n+=1)t[n].deltaY+=a},a=function(){return!(_.isEmpty(t.ideas)||t.attr&&t.attr.collapsed)},u=function(){var e=_.map(_.keys(t.ideas),parseFloat),n=i?_.filter(e,function(e){return i(e,t.id)}):e;return _.sortBy(n,Math.abs)},d=function(){var e=[];return _.each(u(),function(n){e.push(t.ideas[n])}),e},l=e(t,o.level),c=function(t){var e,i,r,a,u;_.each(t,function(t){t.deltaX=l.width+n,(r=t.attr&&t.attr.position&&t.attr.position[0])&&r>t.deltaX?(a=r-t.deltaX,t.deltaX=r):a=0,e?(u=t.outline.indent(a,n),i=u.initialHeight(),e=u.stackBelow(e,n),t.deltaY=e.initialHeight()-i/2-t.height/2):e=t.outline.indent(a,n)}),t&&t.length&&(s(t,.5*(l.height-e.initialHeight())),e=e.expand(t[0].deltaY-.5*l.height,t[t.length-1].deltaY+t[t.length-1].height-.5*l.height)),o.outline=e.insertAtStart(l,n)};return _.extend(o,l),o.outline=new MAPJS.Outline.fromDimensions(l),a()&&(o.subtrees=_.map(d(),function(t){return MAPJS.calculateTree(t,e,n,i,o.level+1)}),_.isEmpty(o.subtrees)||c(o.subtrees)),new MAPJS.Tree(o)},MAPJS.calculateLayout=function(t,e,n){"use strict";var i,r,o,s,a=function(t){_.each(t,function(t){t.attr=t.attr||{},t.attr.style=_.extend({},MAPJS.defaultStyles[1===t.level?"root":"nonRoot"],t.attr.style)})},u=function(e,n){return n!==t.id||e>0},d=function(e,n){return n!==t.id||e<0};return n=n||20,i=MAPJS.calculateTree(t,e,n,u),r=MAPJS.calculateTree(t,e,n,d),o=i.toLayout(),s=r.toLayout(),_.each(s.nodes,function(t){t.x=-1*t.x-t.width}),_.extend(s.nodes,o.nodes),_.extend(s.connectors,o.connectors),a(s.nodes),s.links=MAPJS.layoutLinks(t,s.nodes),s.rootNodeId=t.id,s},MAPJS.MapModel=function(t,e,n,i){"use strict";var r,o,s,a,u,d,l,c,h,p,f,y=this,g=t,m=i||20,v=n||new MAPJS.MemoryClipboard,w={nodes:{},connectors:{}},b=!0,M=!0,x=[],S=function(t){var e=_.clone(x);x=0===t.length?[a]:t,y.dispatchEvent("activatedNodesChanged",_.difference(x,e),_.difference(e,x))},C=300,k=function(t){var e;s&&(e=s(o),_.each(t.nodes,function(t,n){(e[n]||0===e[n])&&(t.label=e[n])}))},E=function(t,e){y.getYsy().log.debug("updateCurrentLayout","redraw"),y.dispatchEvent("layoutChangeStarting",_.size(t.nodes)-_.size(w.nodes)),k(t),_.each(w.connectors,function(e,n){var i=t.connectors[n];i&&i.from===e.from&&i.to===e.to||y.dispatchEvent("connectorRemoved",e)}),_.each(w.links,function(e,n){t.links&&t.links[n]||y.dispatchEvent("linkRemoved",e)}),_.each(w.nodes,function(n,i){var r;t.nodes[i]||(i==a&&y.selectNode(o.id),(r=_.reject(x,function(t){return t==i})).length!==x.length&&S(r),y.dispatchEvent("nodeRemoved",n,i,e))}),_.each(t.nodes,function(t,n){var i=w.nodes[n];i?(t.x===i.x&&t.y===i.y||y.dispatchEvent("nodeMoved",t,e),t.title!==i.title&&y.dispatchEvent("nodeTitleChanged",t,e),_.isEqual(t.attr||{},i.attr||{})||y.dispatchEvent("nodeAttrChanged",t,e),t.label!==i.label&&y.dispatchEvent("nodeLabelChanged",t,e)):y.dispatchEvent("nodeCreated",t,e)}),_.each(t.connectors,function(t,n){var i=w.connectors[n];i&&t.from===i.from&&t.to===i.to||y.dispatchEvent("connectorCreated",t,e)}),_.each(t.links,function(t,n){var i=w.links&&w.links[n];i?_.isEqual(t.attr||{},i&&i.attr||{})||y.dispatchEvent("linkAttrChanged",t,e):y.dispatchEvent("linkCreated",t,e)}),w=t,y.isInCollapse||y.dispatchEvent("layoutChangeComplete")},T=function(t){d=a,l=x.slice(0),y.selectNode(t)},I=function(t){T(t),y.editNode(!1,!0,!0)},A=function(){return a||o.id},P=!1,D=function(t,e,n){P||(d=!1,l=!1,y.rebuildRequired(n))},F=function(){return o.findSubIdeaById(a)||o},O=function(t,e){(o.findSubIdeaById(e)||o).getAttr("collapsed")&&o.updateAttr(e,"collapsed",!1)};observable(this),r=y.dispatchEvent.bind(y,"analytic","mapModel"),y.pause=function(){P=!0},y.resume=function(){P=!1,y.rebuildRequired()},y.getIdea=function(){return o},y.isEditingEnabled=function(){return M},y.getCurrentLayout=function(){return w},y.analytic=r,y.getCurrentlySelectedIdeaId=A,y.rebuildRequired=function(t){o&&E(y.reactivate(g(o)),t)},this.setIdea=function(t){o&&(o.removeEventListener("changed",D),P=!1,S([]),y.dispatchEvent("nodeSelectionChanged",a,!1),a=undefined),(o=t).addEventListener("changed",D),D(),y.selectNode(o.id,!0),y.dispatchEvent("mapViewResetRequested")},this.setEditingEnabled=function(t){M=t},this.getEditingEnabled=function(){return M},this.setInputEnabled=function(t,e){b!==t&&(b=t,y.dispatchEvent("inputEnabledChanged",t,!!e))},this.getInputEnabled=function(){return b},this.selectNode=function(t,e,n){(e||b&&(t!==a||!y.isActivated(t)))&&(a&&y.dispatchEvent("nodeSelectionChanged",a,!1),a=t,n?y.activateNode("internal",t):S([t]),y.dispatchEvent("nodeSelectionChanged",t,!0))},this.clickNode=function(t,e){var n=e&&e.button&&-1!==e.button;e&&e.altKey?y.followURL(t):e&&(e.shiftKey||e.ctrlKey)?y.toggleActivationOnNode("mouse",t):u&&!n?(this.toggleLink("mouse",t),this.toggleAddLinkMode()):(this.selectNode(t),n&&-1!==n&&b&&y.dispatchEvent("contextMenuRequested",t,e.layerX,e.layerY))},this.findIdeaById=function(t){return o.id==t?o:o.findSubIdeaById(t)},this.getSelectedStyle=function(t){return this.getStyleForId(a,t)},this.getStyleForId=function(t,e){var n=w.nodes&&w.nodes[t];return n&&n.attr&&n.attr.style&&n.attr.style[e]},this.toggleCollapse=function(t){var e,n=F();e=y.isActivated(n.id)&&_.size(n.ideas)>0?n.getAttr("collapsed"):y.everyActivatedIs(function(t){var e=y.findIdeaById(t);return!(e&&_.size(e.ideas)>0)||e.getAttr("collapsed")}),this.collapse(t,!e)},this.collapse=function(t,e){var n,i,s=A(),a=function(){return s&&w&&w.nodes&&w.nodes[s]},u=function(t,e,n){(e||n)&&_.each(t,function(t){t.x+=e,t.y+=n,y.dispatchEvent("nodeMoved",t,"scroll")})};r("collapse:"+e,t),y.isInCollapse=!0,n=a(),b&&y.applyToActivated(function(t){var n=y.findIdeaById(t);n&&(!e||n.ideas&&_.size(n.ideas)>0)&&o.updateAttr(t,"collapsed",e)}),i=a(),n&&i&&u(w.nodes,n.x-i.x,n.y-i.y),y.isInCollapse=!1,y.dispatchEvent("layoutChangeComplete")},this.updateStyle=function(t,e,n){if(!M)return!1;b&&(r("updateStyle:"+e,t),y.applyToActivated(function(t){y.getStyleForId(t,e)!=n&&o.mergeAttrProperty(t,"style",e,n)}))},this.updateLinkStyle=function(t,e,n,i,s){var a=_.extend({},o.getLinkAttr(e,n,"style"));if(!M)return!1;b&&(r("updateLinkStyle:"+i,t),a[i]=s,o.updateLinkAttr(e,n,"style",a))},this.addSubIdea=function(t,e,n){var i,s=e||a;if(!M)return!1;r("addSubIdea",t),b&&(o.batch(function(){O(t,s),i=n?o.addSubIdea(s,n):o.addSubIdea(s)}),i&&(n?T(i):I(i)))},this.insertIntermediate=function(t){var e,n=[];return!!M&&(!(!b||a===o.id)&&(r("insertIntermediate",t),y.applyToActivated(function(t){n.push(t)}),void((e=o.insertIntermediateMultiple(n))&&I(e))))},this.flip=function(t){var e=w&&w.nodes&&w.nodes[a];return!!M&&(r("flip",t),!(!b||a===o.id)&&(!(!e||2!==e.level)&&o.flip(a)))},this.addSiblingIdeaBefore=function(t){var e,n,i,s;return!!M&&(r("addSiblingIdeaBefore",t),!!b&&(n=o.findParent(a)||o,o.batch(function(){O(t,n.id),(e=o.addSubIdea(n.id))&&a!==o.id&&(i=n.findChildRankById(a),s=n.findChildRankById(e),i*s<0&&o.flip(e),o.positionBefore(e,a))}),void(e&&I(e))))},this.addSiblingIdea=function(t,e,n){var i,s,u,d,l,c;if(c=e||a,!M)return!1;r("addSiblingIdea",t),b&&(u=o.findParent(c)||o,o.batch(function(){O(t,u.id),(i=n?o.addSubIdea(u.id,n):o.addSubIdea(u.id))&&c!==o.id&&(s=o.nextSiblingId(c),d=u.findChildRankById(c),l=u.findChildRankById(i),d*l<0&&o.flip(i),s&&o.positionBefore(i,s))}),i&&(n?T(i):I(i)))},this.removeSubIdea=function(t){var e;return!!M&&(r("removeSubIdea",t),b&&y.applyToActivated(function(t){var n;a==t&&(n=o.findParent(a))&&y.selectNode(n.id),e=o.removeSubIdea(t)}),e)},this.updateTitle=function(t,e,n){n?o.initialiseTitle(t,e):o.updateTitle(t,e)},this.editNode=function(t,n,i){var o;if(!M)return!1;if(t&&r("editNode",t),!b)return!1;var s=F();if(!y.getYsy().validator.validate("nodeRename",s))return!1;o=s.title,_.include(e,o)&&(n=!0),y.dispatchEvent("nodeEditRequested",a,n,!!i)},this.editIcon=function(t){return!!M&&(t&&r("editIcon",t),!!b&&void y.dispatchEvent("nodeIconEditRequested",a))},this.scaleUp=function(t){y.scale(t,1.25)},this.scaleDown=function(t){y.scale(t,.8)},this.scale=function(t,e,n){b&&(y.dispatchEvent("mapScaleChanged",e,n),r(e<1?"scaleDown":"scaleUp",t))},this.move=function(t,e,n){b&&(y.dispatchEvent("mapMoveRequested",e,n),r("move",t))},this.resetView=function(t){b&&o&&(y.selectNode(o.id),y.dispatchEvent("mapViewResetRequested"),r("resetView",t))},this.openAttachment=function(t,e){var n,i;r("openAttachment",t),e=e||a,i=(n=w&&w.nodes&&w.nodes[e])&&n.attr&&n.attr.attachment,n&&y.dispatchEvent("attachmentOpened",e,i)},this.setAttachment=function(t,e,n){var i=!(!n||!n.content);if(!M)return!1;r("setAttachment",t),o.updateAttr(e,"attachment",i&&n)},this.toggleLink=function(t,e){var n=_.find(o.links,function(t){return String(t.ideaIdFrom)===String(e)&&String(t.ideaIdTo)===String(a)||String(t.ideaIdTo)===String(e)&&String(t.ideaIdFrom)===String(a)});n?y.removeLink(t,n.ideaIdFrom,n.ideaIdTo):y.addLink(t,e)},this.addLink=function(t,e){if(!M)return!1;r("addLink",t),o.addLink(a,e)},this.selectLink=function(t,e,n){return!!M&&(r("selectLink",t),!!e&&void y.dispatchEvent("linkSelected",e,n,o.getLinkAttr(e.ideaIdFrom,e.ideaIdTo,"style")))},this.removeLink=function(t,e,n){if(!M)return!1;r("removeLink",t),o.removeLink(e,n)},this.toggleAddLinkMode=function(t){return!!M&&(!!b&&(r("toggleAddLinkMode",t),u=!u,void y.dispatchEvent("addLinkModeToggled",u)))},this.cancelCurrentAction=function(t){return!!b&&(!!M&&void(u&&this.toggleAddLinkMode(t)))},y.undo=function(t){var e=d,n=l;if(!M)return!1;r("undo",t),b&&(o.undo(),e&&y.selectNode(e),n&&S(n))},y.redo=function(t){if(!M)return!1;r("redo",t),b&&o.redo()},y.moveRelative=function(t,e){if(!M)return!1;r("moveRelative",t),b&&o.moveRelative(a,e)},y.cut=function(t){var e,n=[],i=[];if(!M)return!1;r("cut",t),b&&(y.applyToActivated(function(t){n.push(t),i.push(o.findParent(t).id)}),v.put(o.cloneMultiple(n)),o.removeMultiple(n),e=_.find(i,o.findSubIdeaById),y.selectNode(e||o.id))},y.contextForNode=function(t){var e=y.findIdeaById(t),n=e&&e.ideas&&_.size(e.ideas)>0,i=o.hasSiblings(t),r=e&&e.getAttr("collapsed"),s=e&&M&&v&&v.get();if(e)return{hasChildren:!!n,hasSiblings:!!i,canPaste:!!s,notRoot:o.id!=t,canUndo:o.canUndo(),canRedo:o.canRedo(),canCollapse:n&&!r,canExpand:n&&r}},y.copy=function(t){var e=[];if(!M)return!1;r("copy",t),b&&(y.applyToActivated(function(t){e.push(t)}),v.put(o.cloneMultiple(e)))},y.paste=function(t){var e;if(!M)return!1;r("paste",t),b&&(e=o.pasteMultiple(a,v.get()))&&e[0]&&y.selectNode(e[0])},y.pasteStyle=function(t){var e,n=v.get();if(!M)return!1;r("pasteStyle",t),b&&n&&n[0]&&(e=n[0].attr&&n[0].attr.style,y.applyToActivated(function(t){o.updateAttr(t,"style",e)}))},y.getIcon=function(t){var e=w.nodes[t||a];return!!e&&(e.attr&&e.attr.icon)},y.setIcon=function(t,e,n,i,s,u,d){var l,c;return!!M&&(r("setIcon",t),u=u||a,!!(l=y.findIdeaById(u))&&void(e?(c={url:e,width:n,height:i,position:s},d&&(c.metaData=d),o.updateAttr(u,"icon",c)):l.title||u===o.id?o.updateAttr(u,"icon",!1):o.removeSubIdea(u)))},y.moveUp=function(t){y.moveRelative(t,-1)},y.moveDown=function(t){y.moveRelative(t,1)},y.getSelectedNodeId=function(){return A()},y.centerOnNode=function(t){w.nodes[t]||(o.startBatch(),_.each(o.calculatePath(t),function(t){o.updateAttr(t.id,"collapsed",!1)}),o.endBatch()),y.dispatchEvent("nodeFocusRequested",t),y.selectNode(t)},y.search=function(t){var e=[];return t=t.toLocaleLowerCase(),o.traverse(function(n){n.title&&n.title.toLocaleLowerCase().indexOf(t)>=0&&e.push({id:n.id,title:n.title})}),e},c=function(t){return w.nodes[t].x>=w.nodes[o.id].x},h=function(t){return w.nodes[t].x<=w.nodes[o.id].x},p=function(){return _.map(w.nodes,function(t,e){return _.extend({id:parseInt(e,10)},t)})},f={Left:function(t,e,n){var i,s,u=a===o.id,d=u?-Infinity:Infinity;if(b)if(r(e,t),h(a)){for(s in i=o.id===a?o:o.findSubIdeaById(a),O(t,i.id),i.ideas)s=parseFloat(s),(u&&s<0&&s>d||!u&&s>0&&s<d)&&(d=s);d!==Infinity&&d!==-Infinity&&n.apply(y,[i.ideas[d].id])}else n.apply(y,[o.findParent(a).id])},Up:function(t,e,n){var i,s,u=o.previousSiblingId(a),d=w.nodes[a];if(b)if(r(e,t),u)n.apply(y,[u]);else{if(!d)return;if(i=_.reject(p(),function(t){return t.y>=d.y||Math.abs(t.x-d.x)>C}),0===_.size(i))return;s=_.min(i,function(t){return Math.pow(t.x-d.x,2)+Math.pow(t.y-d.y,2)}),n.apply(y,[s.id])}},Down:function(t,e,n){var i,s,u=o.nextSiblingId(a),d=w.nodes[a];if(b)if(r(e,t),u)n.apply(y,[u]);else{if(!d)return;if(i=_.reject(p(),function(t){return t.y<=d.y||Math.abs(t.x-d.x)>C}),0===_.size(i))return;s=_.min(i,function(t){return Math.pow(t.x-d.x,2)+Math.pow(t.y-d.y,2)}),n.apply(y,[s.id])}},Right:function(t,e,n){var i,s,u=Infinity;if(b)if(r(e,t),c(a)){for(s in i=o.id===a?o:o.findSubIdeaById(a),O(t,i.id),i.ideas)(s=parseFloat(s))>0&&s<u&&(u=s);u!==Infinity&&n.apply(y,[i.ideas[u].id])}else n.apply(y,[o.findParent(a).id])}},y.getActivatedNodeIds=function(){return x.slice(0)},y.activateSiblingNodes=function(t){var e,n=o.findParent(a);r("activateSiblingNodes",t),n&&n.ideas&&(e=_.map(n.ideas,function(t){return t.id}),S(e))},y.activateNodeAndChildren=function(t){var e=A(),n=o.getSubTreeIds(e);r("activateNodeAndChildren",t),n.push(e),S(n)},_.each(["Left","Right","Up","Down"],function(t){y["activateNode"+t]=function(e){f[t](e,"activateNode"+t,function(t){y.selectNode(t,!1,!0)})},y["selectNode"+t]=function(e){f[t](e,"selectNode"+t,y.selectNode)}}),y.toggleActivationOnNode=function(t,e){r("toggleActivated",t),y.isActivated(e)?S(_.without(x,e)):S([e].concat(x))},y.activateNode=function(t,e){r("activateNode",t),y.isActivated(e)||(x.push(e),y.dispatchEvent("activatedNodesChanged",[e],[]))},y.activateChildren=function(t){var e=F();r("activateChildren",t),!e||_.isEmpty(e.ideas)||e.getAttr("collapsed")||S(o.getSubTreeIds(e.id))},y.activateSelectedNode=function(t){r("activateSelectedNode",t),S([A()])},y.isActivated=function(t){return _.find(x,function(e){return t==e})},y.applyToActivated=function(t){o.batch(function(){_.each(x,t)})},y.everyActivatedIs=function(t){return _.every(x,t)},y.activateLevel=function(t,e){var n=_.map(_.filter(w.nodes,function(t){return t.level==e}),function(t){return t.id});r("activateLevel",t),_.isEmpty(n)||S(n)},y.reactivate=function(t){return _.each(t.nodes,function(t){_.contains(x,t.id)&&(t.activated=!0)}),t},y.getNodeIdAtPosition=function(t,e){var n=function(n){return t>=n.x&&e>=n.y&&t<=n.x+n.width&&e<=n.y+n.height},i=_.find(w.nodes,n);return i&&i.id},y.autoPosition=function(t){return o.updateAttr(t,"position",!1)},y.positionNodeAt=function(t,e,n,i){var s,a=w.nodes[o.id],u={id:null,y:Infinity},d=o.findParent(t),l=w.nodes[d.id],c=w.nodes[t],h=function(e,n,i){var r=e.x<n.x&&i<e.x,s=e.x>n.x&&e.x<i;return!(!r&&!s)&&o.flip(t)},p=1,f=function(){return 2===c.level||(c.x-l.x)*(e-l.x)>0},g=!1;return o.startBatch(),2===w.nodes[t].level&&(g=h(a,c,e)),_.each(o.sameSideSiblingIds(t),function(t){var e=w.nodes[t];n<e.y&&e.y<u.y&&(u=e)}),!i&&f()&&y.autoPosition(t),g=o.positionBefore(t,u.id)||g,i&&f()&&(s=e<l.x?l.x-e-c.width+l.width:e-l.x,r("nodeManuallyPositioned"),p=_.max(_.map(d.ideas,function(e){return e.id!==t&&e.attr&&e.attr.position&&e.attr.position[2]||0})),g=o.updateAttr(t,"position",[s,n-l.y,p+1])||g),o.endBatch(),g},y.dropNode=function(t,e,n){var i,r=o.findParent(t);return e!==t&&(n?((i=o.clone(t))&&o.paste(e,i),!1):e===r.id?y.autoPosition(t):(O(t,e),o.changeParent(t,e)))},y.setLayoutCalculator=function(t){g=t},y.dropImage=function(t,e,n,i,r,s){var u,d=function(i,r){var a=Math.min(e,300)/e,u=Math.min(n,300)/n,d=Math.min(a,u),l=o.getAttrById(i,"icon");y.setIcon("drag and drop",t,Math.round(e*d),Math.round(n*d),l&&l.position||r,i,s)},l=function(){var t;o.startBatch(),t=o.addSubIdea(a),d(t,"center"),o.endBatch(),y.selectNode(t)};if(u=y.getNodeIdAtPosition(i,r))return d(u,"left");l()},y.setLabelGenerator=function(t){s=t,y.rebuildRequired()},y.getReorderBoundary=function(t){var e,n,i,r,s,a,u=function(){return e.id===o.id},d=function(t){return w.nodes[t].x>=w.nodes[o.id].x},l=function(e,i){var r=_.map(e,function(t){return t.y}),o=_.map(e,function(t){return t.y+t.height}),s={minY:_.min(r)-m-w.nodes[t].height,maxY:_.max(o)+m,margin:m};return s.edge=i,s.x="left"===i?n.x+n.width+m:n.x-m,s},c=function(e){var i={minY:n.y-m-w.nodes[t].height,maxY:n.y+n.height+m,margin:m};return i.edge=e,i.x="left"===e?n.x+n.width+m:n.x-m,i},h=function(){var n=_.map(e.ideas,function(t){return w.nodes[t.id]});return n=_.without(n,w.nodes[t]),_.isEmpty(i)||(n=_.difference(n,i)),n},p=[];return!function(){return t==o.id}(t)&&(e=o.findParent(t),n=w.nodes[e.id],s=d(t)?"left":"right",a=d(t)?"right":"left",i=_.map(o.sameSideSiblingIds(t),function(t){return w.nodes[t]}),_.isEmpty(i)||p.push(l(i,s)),p.push(c(s)),u()&&(r=h(),_.isEmpty(r)||p.push(l(r,a)),p.push(c(a))),p)},y.focusAndSelect=function(t){y.selectNode(t),
y.dispatchEvent("nodeFocusRequested",t)},y.requestContextMenu=function(t,e){return!(!b||!M)&&(y.dispatchEvent("contextMenuRequested",a,t,e),!0)}},EASY.schedule.require(function(t){t.fn.mapToolbarWidget=function(e,n){"use strict";var i=["insertIntermediate","scaleUp","scaleDown","addSubIdea","followURL","editNode","editNodeData","removeSubIdea","toggleCollapse","showBudget","addSiblingIdea","undo","redo","copy","cut","paste","resetView","openAttachment","toggleAddLinkMode","activateChildren","activateNodeAndChildren","activateSiblingNodes","editIcon","toggleOneSide","save"],r=["updateStyle"];return this.each(function(){var o=t(this),s=!1;i.forEach(function(t){o.find("."+t).click(function(){$(this).hasClass("mindmup__button--disabled")||(e[t]&&e[t]("toolbar"),n.toolbar.redraw(t))})}),r.forEach(function(n){o.find("."+n).change(function(){if(!s){var i=t(this);i.data("mm-target-property")&&e[n]("toolbar",i.data("mm-target-property"),i.val())}})})})}},"jQuery");var observable=function(t){"use strict";var e=[];return t.addEventListener=function(t,n,i){t.split(" ").forEach(function(t){t&&e.push({type:t,listener:n,priority:i||0})})},t.listeners=function(t){return e.filter(function(e){return e.type===t}).map(function(t){return t.listener})},t.removeEventListener=function(t,n){e=e.filter(function(t){return t.listener!==n})},t.dispatchEvent=function(n){var i=Array.prototype.slice.call(arguments,1);t.getYsy().log.debug("Event "+n+" "+JSON.stringify(i),"events"),"changed"===n&&t.getYsy().log.debug("Event "+n+" "+JSON.stringify(i),"changedEvent"),e.filter(function(t){return t.type===n}).sort(function(t,e){return e.priority-t.priority}).some(function(t){return!1===t.listener.apply(undefined,i)})},t};Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,i=function(){},r=function(){return n.apply(this instanceof i?this:t,e.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(i.prototype=this.prototype),r.prototype=new i,r}),function(){function t(t){this.ysy=t,this.init()}t.prototype.init=function(){var t=this,e=function(e,n){if(t[e])return t[e].apply(t,n)};this.ysy.eventBus.register("TreeLoaded",function(t){t.addEventListener("changed",function(t,n){if("batch"===t){if(n&&n.length)for(var i=0;i<n.length;i++){var r=n[i];r&&r.length&&e(r[0],r.slice(1))}}else e(t,n)},5)})},t.prototype.removeSubIdea=function(t){var e=this.ysy.getLayoutNode(t);if(e){var n=this.ysy.saver;n.deleteStack&&n.deleteStack.push((new window.easyMindMupClasses.ModelEntity).extend(e))}},t.prototype.paste=function(t,e,n){this._upgradeToModelEntity(n)},t.prototype.insertIntermediate=function(t,e,n){this._upgradeToModelEntity(n).attr.isFresh=!0},t.prototype.addSubIdea=function(t,e,n){this._upgradeToModelEntity(n).attr.isFresh=!0},t.prototype._upgradeToModelEntity=function(t){var e=this.ysy,n=e.util.findWhere(e.idea,function(e){return e.id===t});return e.upgradeToModelEntity(n)},window.easyMindMupClasses.AfterChange=t}(),function(){function t(t){this.phase=null,this.ysy=t,this.shortTimeout=0,this.longTimeout=0,this.init(),this.initVisibility()}t.prototype.testing=!1,t.prototype.longPeriod=6e5,t.prototype.shortPeriod=12e4,t.prototype.init=function(){var t=this,e=this.ysy,n=function(){"short"===t.phase&&(e.idea.removeEventListener("changed",t.changeWatcher),t.testing?(e.log.debug((new Date).toISOString()+" saving","autosave"),r()):e.saver.save("autosave"))};this.changeWatcher=n;var i=function(){"short"!==t.phase&&(t.longTimeout&&(window.clearTimeout(t.longTimeout),t.longTimeout=0),t.phase="short",e.log.debug("short period","autosave"),e.idea.removeEventListener("changed",n),e.idea.addEventListener("changed",n),t.shortTimeout=setTimeout(n,t.shortPeriod))},r=function(){t.shortTimeout&&(window.clearTimeout(t.shortTimeout),t.shortTimeout=0),t.longTimeout&&window.clearTimeout(t.longTimeout),t.phase="long",e.log.debug("long period","autosave"),t.longTimeout=setTimeout(i,t.longPeriod)};this.testing&&(this.startLongPhase=r),e.eventBus.register("IdeaConstructed",function(){r()})},t.prototype.initVisibility=function(){var t="hidden",e="visibilitychange";if("undefined"==typeof document.hidden)if("undefined"!=typeof document.msHidden)t="msHidden",e="msvisibilitychange";else{if("undefined"==typeof document.webkitHidden)return;t="webkitHidden",e="webkitvisibilitychange"}var n=this,i=this.ysy,r=function(){document[t]?n.testing&&(i.log.debug((new Date).toISOString()+" loading by off-site","autosave"),n.startLongPhase()):(window.clearTimeout(n.shortTimeout),window.clearTimeout(n.longTimeout),i.log.debug("off-site period","autosave"),n.testing?i.log.debug((new Date).toISOString()+" saving by off-site","autosave"):i.saver.save("off-site"))};$(document).on(e,r)},window.easyMindMupClasses.Autosave=t}(),function(){function t(t){this.ysy=t,this.patch(t)}t.prototype.patch=function(t){var e=this;t.eventBus.register("TreeLoaded",function(n){var i=n.getCommandProcessors();n.clone=function(e){var i=e&&e!=n.id&&n.findSubIdeaById(e)||n,r=JSON.parse(JSON.stringify(i));return t.util.traverse(r,function(e){t.getData(e).id=null}),r},i.setData=function(e,n,i){t.setData(n,i)},i.setCustomData=function(e,n,i){t.setCustomData(n,i)},n.updateOneSide=$.proxy(e.updateOneSide,e)})},t.prototype.updateOneSide=function(t,e=!1){var n,i=this.ysy.settings.oneSideOn;if((e||this.ysy.firstLoad)&&(this.ysy.firstLoad=!1,i!==t.oneSideOn)){var r=Object.getOwnPropertyNames(t.ideas).map(function(t){return parseFloat(t)}).sort(function(t,e){return t-e});if(0!==r.length){var o={};if(i){var s=_.findIndex(r,function(t){return t>0}),a=1;for(n=s;n<r.length;n++)o[a++]=t.ideas[r[n]];for(n=0;n<s;n++)o[a++]=t.ideas[r[n]]}else{if(r[0]<0)return;var u=Math.ceil(r.length/2);for(n=0;n<u;n++)o[n+1]=t.ideas[r[n]];for(n=u;n<r.length;n++)o[n-r.length]=t.ideas[r[n]]}t.oneSideOn=i,t.ideas=o,t.dispatchEvent&&t.dispatchEvent("changed")}}},window.easyMindMupClasses.ContentPatch=t}(),function(){function t(t){this.ysy=t,this.dataArrays={}}t.prototype.save=function(t,e){e=e||[],this.dataArrays[t]=e,this.ysy.eventBus.fireEvent("dataFilled",t,e)},t.prototype.get=function(t){return this.dataArrays[t]},window.easyMindMupClasses.DataStorage=t}(),function(){function t(t){this.ysy=t,this.patch(t),this.deltaX=0,this.deltaY=0,this.init(t)}t.prototype.patch=function(t){jQuery.fn.scrollWhenDragging=function(t){"use strict";return this.each(function(){var e,n,i,r=$(this),o=function(o){if(t()){$("body").addClass("mindmup-noselect");var s=$(o.gesture.target).closest(".mapjs-node");e={top:$(window).scrollTop(),left:r.scrollLeft(),withNode:s.length},o&&(e.top+=o.gesture.deltaY,e.left+=o.gesture.deltaX),i=!1,r.on("mouseleave.bg_drag",function(){i=!0}).on("mouseenter.bg_drag",function(){i=!1,e={top:$(window).scrollTop()+n.deltaY,left:r.scrollLeft()+n.deltaX,withNode:s.length}})}},s=function(t){if(t.gesture&&t.gesture.srcEvent){if(i)return void(n=t.gesture);if(!e&&t.gesture.srcEvent.ctrlKey&&o(t),!e)return;if(!e.withNode){var s=$(t.gesture.target).closest(".mapjs-node");e.withNode=s.length}if(e.withNode&&!t.gesture.srcEvent.ctrlKey)return a();$("html, body").scrollTop(e.top-t.gesture.deltaY),r.scrollLeft(e.left-t.gesture.deltaX)}},a=function(){i=!1,$("body").removeClass("mindmup-noselect"),r.off("mouseleave.bg_drag").off("mouseenter.bg_drag"),e=undefined};r.on("panstart",o).on("panmove",s).on("panend",a)})},jQuery.fn.updateStage=function(){"use strict";var e=this.data(),n={"min-width":Math.floor(e.width-e.offsetX),"min-height":Math.floor(e.height-e.offsetY),width:Math.floor(e.width-e.offsetX),height:Math.floor(e.height-e.offsetY),"transform-origin":"top left",transform:"translate3d("+Math.floor(e.offsetX)+"px, "+Math.floor(e.offsetY)+"px, 0)"};e.scale&&1!==e.scale&&(n.transform="scale("+e.scale+") translate("+Math.floor(e.offsetX)+"px, "+Math.floor(e.offsetY)+"px)"),this.css(n);var i=Math.floor(e.height)*e.scale;return t.$container.height(i),this}},t.prototype.init=function(t){var e=this;t.eventBus.register("MapInited",function(n){n.addEventListener("nodeCreated",function(n){var i=t.getNodeElement(n);1===n.level&&i.on("mm:stop-dragging",function(n){n.fakedEvent||!n.gesture||n.isPropagationStopped()||(e.deltaX-=n.gesture.deltaX,e.deltaY-=n.gesture.deltaY,t.storage.extra.save(t.idea))})},-1)}),t.eventBus.register("TreeLoaded",function(){0===e.deltaX&&0===e.deltaY||e.focusOnCenter()})},t.prototype.loadRootPosition=function(t){t&&(t.deltaX&&(this.deltaX=parseFloat(t.deltaX)),t.deltaY&&(this.deltaY=parseFloat(t.deltaY)))},t.prototype.resetRootPosition=function(){this.deltaX=0,this.deltaY=0,this.ysy.storage.extra.save(this.ysy.idea)},t.prototype.focusOnCenter=function(){var t=this.ysy.$container.find('[data-mapjs-role="stage"]'),e=t.find("#node_central");0===e.length&&(e=$('<div id="node_central"></div>').appendTo(t)),e.css({left:this.deltaX,top:this.deltaY}),e.data({x:this.deltaX,y:this.deltaY,height:40,width:100}),this.ysy.mapModel.dispatchEvent("nodeFocusRequested",["central"])},t.prototype.curvedPath=function(t,e){"use strict";var n,i=function(t,e){var n=t.left<e.left?0:1;return{from:{x:t.left+.5*t.width,y:t.top+.5*t.height},to:{x:e.left+n*e.width,y:e.top+.5*e.height}}},r={left:Math.min(t.left,e.left),top:Math.min(t.top,e.top)};return r.width=Math.max(t.left+t.width,e.left+e.width,r.left+1)-r.left,r.height=Math.max(t.top+t.height,e.top+e.height,r.top+1)-r.top,n=i(t,e),{d:"M"+Math.round(n.from.x-r.left)+","+Math.round(n.from.y-r.top)+"Q"+Math.round(n.from.x-r.left)+","+Math.round(n.to.y-r.top)+" "+Math.round(n.to.x-r.left)+","+Math.round(n.to.y-r.top),position:r}},window.easyMindMupClasses.DomPatch=t}(),function(){function t(t){this.ysy=t,this.registeredMap={}}t.prototype.fireEvent=function(t){var e=this.registeredMap[t];if(e)for(var n=Array.prototype.slice.call(arguments,1),i=0;i<e.length;i++)e[i].apply(this,n)},t.prototype.register=function(t,e){var n=this.registeredMap[t];n||(this.registeredMap[t]=n=[]);for(var i=0;i<n.length;i++)if(n[i]===e)return;n.push(e)},t.prototype.unregister=function(t,e){var n=this.registeredMap[t];if(n)for(var i=0;i<n.length;i++)if(n[i]===e)return void n.splice(i,1)},window.easyMindMupClasses.EventBus=t}(),function(){function t(t,e){this.expanded=!!t.storage.settings._load("wbsCollapsed"),this.ysy=t,this.init(t,e)}t.prototype.id="expandAllButton",t.prototype.init=function(t,e){var n=this;return t.repainter.redrawMe(this),this.$element=e.find(".mindmup-expand-all"),this.$element.click(function(){n.expanded=!n.expanded,n.expanded?n.collapseAll():n.expandAll(),t.storage.settings._save({wbsCollapsed:n.expanded}),t.repainter.redrawMe(n)}),this},t.prototype.expandAll=function(){this.ysy.util.traverse(this.ysy.idea,function(t){_.isEmpty(t.ideas)||(t.attr.collapsed=!1)}),this.ysy.idea.dispatchEvent("changed")},t.prototype.collapseAll=function(){var t=this.ysy.idea;this.ysy.util.traverse(t,function(t){_.isEmpty(t.ideas)||(t.attr.collapsed=!0)}),t.attr.collapsed=!1,t.dispatchEvent("changed")},t.prototype._render=function(){this.$element.find(".mindmup-button-collapse-all").toggleClass("active")},window.easyMindMupClasses.ExpandAllButton=t}(),function(){function t(t){this.ysy=t,this.allowedValues=[],this.init(t)}t.prototype.init=function(t){var e=this;t.eventBus.register("nodeStyleChanged",function(){e.reset()})},t.prototype.className="mindmup-node-filtered",t.prototype.pushAllowed=function(t){this.allowedValues.push(t||0),this.sweepNodes()},t.prototype.isOn=function(){return!!this.allowedValues.length},t.prototype.removeAllowed=function(t){this.allowedValues=_.without(this.allowedValues,t),this.sweepNodes()},t.prototype.toggleAllowed=function(t){var e=this.ysy.styles.getCurrentStyle();e&&(this.store=e),_.contains(this.allowedValues,t)?this.removeAllowed(t):this.pushAllowed(t)},t.prototype.cssByBannedValue=function(t){return this.allowedValues.length?_.contains(this.allowedValues,t)?"":" "+this.className:""},t.prototype.reset=function(){this.ysy.$container.find("."+this.className).removeClass(this.className),this.allowedValues=[]},t.prototype.isBanned=function(t){if(!this.allowedValues.length)return!1;if(t.attr.isFresh)return!1;var e=this.ysy.getData(t),n=this.store.value(e);return-1===this.allowedValues.indexOf(n)},t.prototype.sweepNodes=function(){this.recursiveBanner(this.ysy.idea)},t.prototype.recursiveBanner=function(t){var e=this.isBanned(t),n=this.ysy.getNodeElement(t);n.length&&n.toggleClass(this.className,e),t.ideas&&_.each(t.ideas,this.recursiveBanner,this)},window.easyMindMupClasses.Filter=t}(),function(t,e,n,i){"use strict";function r(t,e){return t===i?e:t}function o(t,e){for(var n=void 0,r=void 0,o=e[0].toUpperCase()+e.slice(1),s=0;s<J.length;){if((r=(n=J[s])?n+o:e)in t)return r;s++}return i}function s(){if(!et)return!1;var e={},n=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(i){return e[i]=!n||t.CSS.supports("touch-action",i)}),e}function a(){return $t++}function u(t,e,n){var r=void 0;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==i)for(r=0;r<t.length;)e.call(n,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r,t)}function d(t,e,n){return!!Array.isArray(t)&&(u(t,n[e],n),!0)}function l(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var i=0;i<t.length;){if(n&&t[i][n]==e||!n&&t[i]===e)return i;i++}return-1}function c(t,e){return(void 0===t?"undefined":Yt(t))===Q?t.apply(e&&e[0]||i,e):t}function h(t,e){var n=e.manager;return n?n.get(t):t}function p(t){return t&Lt?"cancel":t&Bt?"end":t&Ot?"move":t&Ft?"start":""}function f(t){return t===kt?"down":t===Ct?"up":t===xt?"left":t===St?"right":""}function y(t,e){return function(){return t.apply(e,arguments)}}function g(t,e,n){return setTimeout(y(t,n),e)}function m(t,e,n){n||(n=At);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return Math.sqrt(i*i+r*r)}function v(t,e){return t.indexOf(e)>-1}function w(t){if(v(t,ot))return ot;var e=v(t,st),n=v(t,at);return e&&n?ot:e||n?e?st:at:v(t,rt)?rt:it}function b(t,e){for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function _(t){var e=t.length;if(1===e)return{x:K(t[0].clientX),y:K(t[0].clientY)};for(var n=0,i=0,r=0;r<e;)n+=t[r].clientX,i+=t[r].clientY,r++;return{x:K(n/e),y:K(i/e)}}function M(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:K(t.pointers[n].clientX),clientY:K(t.pointers[n].clientY)},n++;return{timeStamp:Z(),pointers:e,center:_(e),deltaX:t.deltaX,deltaY:t.deltaY}}function x(t,e,n){n||(n=At);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return 180*Math.atan2(r,i)/Math.PI}function S(t,e){return t===e?Mt:G(t)>=G(e)?t<0?xt:St:e<0?Ct:kt}function C(t,e){var n=e.center,i=t.offsetDelta||{},r=t.prevDelta||{},o=t.prevInput||{};e.eventType!==vt&&o.eventType!==bt||(r=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=t.offsetDelta={x:n.x,y:n.y}),e.deltaX=r.x+(n.x-i.x),e.deltaY=r.y+(n.y-i.y)}function k(t,e,n){return{x:e/t||0,y:n/t||0}}function E(t,e){return m(e[0],e[1],Pt)/m(t[0],t[1],Pt)}function T(t,e){return x(e[1],e[0],Pt)+x(t[1],t[0],Pt)}function I(t,e){var n=t.lastInterval||e,r=e.timeStamp-n.timeStamp,o=void 0,s=void 0,a=void 0,u=void 0;if(e.eventType!==_t&&(r>mt||n.velocity===i)){var d=e.deltaX-n.deltaX,l=e.deltaY-n.deltaY,c=k(r,d,l);s=c.x,a=c.y,o=G(c.x)>G(c.y)?c.x:c.y,u=S(d,l),t.lastInterval=e}else o=n.velocity,s=n.velocityX,a=n.velocityY,u=n.direction;e.velocity=o,e.velocityX=s,e.velocityY=a,e.direction=u}function A(t,e){var n=t.session,i=e.pointers,r=i.length;n.firstInput||(n.firstInput=M(e)),r>1&&!n.firstMultiple?n.firstMultiple=M(e):1===r&&(n.firstMultiple=!1);var o=n.firstInput,s=n.firstMultiple,a=s?s.center:o.center,u=e.center=_(i);e.timeStamp=Z(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=x(a,u),e.distance=m(a,u),C(n,e),e.offsetDirection=S(e.deltaX,e.deltaY);var d=k(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=d.x,e.overallVelocityY=d.y,e.overallVelocity=G(d.x)>G(d.y)?d.x:d.y,e.scale=s?E(s.pointers,i):1,e.rotation=s?T(s.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,I(n,e);var l=t.element;b(e.srcEvent.target,l)&&(l=e.srcEvent.target),e.target=l}function P(t,e,n){var i=n.pointers.length,r=n.changedPointers.length,o=e&vt&&i-r==0,s=e&(bt|_t)&&i-r==0;n.isFirst=!!o,n.isFinal=!!s,o&&(t.session={}),n.eventType=e,A(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function D(t){return t.trim().split(/\s+/g)}function F(t,e,n){u(D(e),function(e){t.addEventListener(e,n,!1)})}function O(t,e,n){u(D(e),function(e){t.removeEventListener(e,n,!1)})}function B(e){var n=e.ownerDocument||e;return n.defaultView||n.parentWindow||t}function j(t){return Array.prototype.slice.call(t,0)}function L(t,e,n){for(var i=[],r=[],o=0;o<t.length;){var s=e?t[o][e]:t[o];l(r,s)<0&&i.push(t[o]),r[o]=s,o++}return n&&(i=e?i.sort(function(t,n){return t[e]>n[e]}):i.sort()),i}function N(t,e){var n=j(t.touches),i=this.targetIds;if(e&(vt|wt)&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r=void 0,o=void 0,s=j(t.changedTouches),a=[],u=this.target;if(o=n.filter(function(t){return b(t.target,u)}),e===vt)for(r=0;r<o.length;)i[o[r].identifier]=!0,r++;for(r=0;r<s.length;)i[s[r].identifier]&&a.push(s[r]),e&(bt|_t)&&delete i[s[r].identifier],r++;return a.length?[L(o.concat(a),"identifier",!0),a]:void 0}function R(t,e){t&vt?(this.primaryTouch=e.changedPointers[0].identifier,$.call(this,e)):t&(bt|_t)&&$.call(this,e)}function $(t){var e=this,n=zt(t.changedPointers,1)[0];n.identifier===this.primaryTouch&&function(){var t={x:n.clientX,y:n.clientY};e.lastTouches.push(t);var i=e.lastTouches;setTimeout(function(){var e=i.indexOf(t);e>-1&&i.splice(e,1)},ge)}()}function Y(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],o=Math.abs(e-r.x),s=Math.abs(n-r.y);if(o<=me&&s<=me)return!0}return!1}function q(t){var e=t.options.inputClass;return new(e||(ct?ue:ht?ce:lt?ve:ye))(t,P)}function H(t,e){var n=t.element;if(n.style){var i=void 0;u(t.options.cssProps,function(r,s){i=o(n.style,s),e?(t.oldCssProps[i]=n.style[i],n.style[i]=r):n.style[i]=t.oldCssProps[i]||""}),e||(t.oldCssProps={})}}function W(t,n){var i=e.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=n,n.target.dispatchEvent(i)}function X(t,e){var n=j(t.touches),i=j(t.changedTouches);return e&(bt|_t)&&(n=L(n.concat(i),"identifier",!0)),[n,i]}function V(e,n,i){var r="DEPRECATED METHOD: "+n+"\n"+i+" AT \n";return function(){var n=new Error("get-stack-trace"),i=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=t.console&&(t.console.warn||t.console.log);return o&&o.call(t.console,r,i),e.apply(this,arguments)}}function z(t,e,n){var i=e.prototype,r=void 0;(r=t.prototype=Object.create(i)).constructor=t,r._super=i,n&&Rt(r,n)}var J=["","webkit","Moz","MS","ms","o"],U=e.createElement("div"),Q="function",K=Math.round,G=Math.abs,Z=Date.now,tt=o(U.style,"touchAction"),et=tt!==i,nt="compute",it="auto",rt="manipulation",ot="none",st="pan-x",at="pan-y",ut=s(),dt=/mobile|tablet|ip(ad|hone|od)|android/i,lt="ontouchstart"in t,ct=o(t,"PointerEvent")!==i,ht=lt&&dt.test(navigator.userAgent),pt="touch",ft="pen",yt="mouse",gt="kinect",mt=25,vt=1,wt=2,bt=4,_t=8,Mt=1,xt=2,St=4,Ct=8,kt=16,Et=xt|St,Tt=Ct|kt,It=Et|Tt,At=["x","y"],Pt=["clientX","clientY"],Dt=1,Ft=2,Ot=4,Bt=8,jt=Bt,Lt=16,Nt=32,Rt="function"!=typeof Object.assign?function(t){if(t===i||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==i&&null!==r)for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])}return e}:Object.assign,$t=1,Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qt=(function(){function t(t){this.value=t}function e(e){function n(t,e){return new Promise(function(n,i){var o={key:t,arg:e,resolve:n,reject:i,next:null};a?a=a.next=o:(s=a=o,r(t,e))})}function r(n,i){try{var s=e[n](i),a=s.value;a instanceof t?Promise.resolve(a.value).then(function(t){r("next",t)},function(t){r("throw",t)}):o(s.done?"return":"normal",s.value)}catch(u){o("throw",u)}}function o(t,e){switch(t){case"return":s.resolve({value:e,done:!0});break;case"throw":s.reject(e);break;default:s.resolve({value:e,done:!1})}(s=s.next)?r(s.key,s.arg):a=null}var s,a;this._invoke=n,"function"!=typeof e["return"]&&(this["return"]=i)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype["throw"]=function(t){return this._invoke("throw",t)},e.prototype["return"]=function(t){return this._invoke("return",t)}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),Ht=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Wt=function Ie(t,e,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(r===i){var o=Object.getPrototypeOf(t);return null===o?i:Ie(o,e,n)}if("value"in r)return r.value;var s=r.get;return s===i?i:s.call(n)},Xt=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},Vt=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},zt=function(){function t(t,e){var n=[],r=!0,o=!1,s=i;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(d){o=!0,s=d}finally{try{!r&&u["return"]&&u["return"]()}finally{if(o)throw s}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),Jt=function(){function t(e){qt(this,t),this.options=Rt({},this.defaults,e||{}),this.id=a(),this.manager=null,this.options.enable=r(this.options.enable,!0),this.state=Dt,this.simultaneous={},this.requireFail=[]}return Ht(t,[{key:"set",value:function(t){return Rt(this.options,t),this.manager&&this.manager.touchAction.update(),this}},{key:"recognizeWith",value:function(t){if(d(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=h(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this}},{key:"dropRecognizeWith",value:function(t){return d(t,"dropRecognizeWith",this)?this:(t=h(t,this),delete this.simultaneous[t.id],this)}},{key:"requireFailure",value:function(t){if(d(t,"requireFailure",this))return this;var e=this.requireFail;return-1===l(e,t=h(t,this))&&(e.push(t),t.requireFailure(this)),this}},{key:"dropRequireFailure",value:function(t){if(d(t,"dropRequireFailure",this))return this;t=h(t,this);var e=l(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this}},{key:"hasRequireFailures",value:function(){return this.requireFail.length>0}},{key:"canRecognizeWith",value:function(t){return!!this.simultaneous[t.id]}},{key:"emit",value:function(t){function e(e){n.manager.emit(e,t)}var n=this,i=this.state;i<Bt&&e(n.options.event+p(i)),e(n.options.event),t.additionalEvent&&e(t.additionalEvent),i>=Bt&&e(n.options.event+p(i))}},{key:"tryEmit",value:function(t){if(this.canEmit())return this.emit(t);this.state=Nt}},{key:"canEmit",value:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(Nt|Dt)))return!1;t++}return!0}},{key:"recognize",value:function(t){var e=Rt({},t);if(!c(this.options.enable,[this,e]))return this.reset(),void(this.state=Nt);this.state&(jt|Lt|Nt)&&(this.state=Dt),this.state=this.process(e),this.state&(Ft|Ot|Bt|Lt)&&this.tryEmit(e)}},{key:"process",value:function(){}},{key:"getTouchAction",value:function(){}},{key:"reset",value:function(){}}]),t}();Jt.prototype.defaults={};var Ut=function(){function t(){return qt(this,t),Vt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Xt(t,Jt),Ht(t,[{key:"attrTest",value:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e}},{key:"process",value:function(t){var e=this.state,n=t.eventType,i=e&(Ft|Ot),r=this.attrTest(t);return i&&(n&_t||!r)?e|Lt:i||r?n&bt?e|Bt:e&Ft?e|Ot:Ft:Nt}}]),t}();Ut.prototype.defaults={pointers:1};var Qt=function(){function t(){return qt(this,t),Vt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Xt(t,Ut),Ht(t,[{key:"getTouchAction",value:function(){return[ot]}},{key:"attrTest",value:function(e){return Wt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"attrTest",this).call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&Ft)}}]),t}();Qt.prototype.defaults={event:"rotate",threshold:0,pointers:2};var Kt=function(){function t(){return qt(this,t),Vt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Xt(t,Ut),Ht(t,[{key:"getTouchAction",value:function(){return[ot]}},{key:"attrTest",value:function(e){return Wt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"attrTest",this).call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&Ft)}},{key:"emit",value:function(e){if(1!==e.scale){var n=e.scale<1?"in":"out";e.additionalEvent=this.options.event+n}Wt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"emit",this).call(this,e)}}]),t}();Kt.prototype.defaults={event:"pinch",threshold:0,pointers:2};var Gt=function(){function t(){qt(this,t);var e=Vt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.pX=null,e.pY=null,e}return Xt(t,Ut),Ht(t,[{key:"getTouchAction",value:function(){var t=this.options.direction,e=[];return t&Et&&e.push(at),t&Tt&&e.push(st),e}},{key:"directionTest",value:function(t){var e=this.options,n=!0,i=t.distance,r=t.direction,o=t.deltaX,s=t.deltaY;return r&e.direction||(e.direction&Et?(r=0===o?Mt:o<0?xt:St,n=o!==this.pX,i=Math.abs(t.deltaX)):(r=0===s?Mt:s<0?Ct:kt,n=s!==this.pY,i=Math.abs(t.deltaY))),t.direction=r,n&&i>e.threshold&&r&e.direction}},{key:"attrTest",value:function(t){return Ut.prototype.attrTest.call(this,t)&&(this.state&Ft||!(this.state&Ft)&&this.directionTest(t))}},{key:"emit",value:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var n=f(e.direction);n&&(e.additionalEvent=this.options.event+n),Wt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"emit",this).call(this,e)}}]),t}();Gt.prototype.defaults={event:"pan",threshold:10,pointers:1,direction:It};var Zt=function(){function t(){return qt(this,t),Vt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Xt(t,Ut),Ht(t,[{key:"getTouchAction",value:function(){return Gt.prototype.getTouchAction.call(this)}},{key:"attrTest",value:function(e){var n=this.options.direction,i=void 0;return n&(Et|Tt)?i=e.overallVelocity:n&Et?i=e.overallVelocityX:n&Tt&&(i=e.overallVelocityY),Wt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"attrTest",this).call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers===this.options.pointers&&G(i)>this.options.velocity&&e.eventType&bt}},{key:"emit",value:function(t){var e=f(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}]),t}();Zt.prototype.defaults={event:"swipe",threshold:10,velocity:.3,direction:Et|Tt,pointers:1};var te=function(){function t(){qt(this,t);var e=Vt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.pTime=!1,e.pCenter=!1,e._timer=null,e._input=null,e.count=0,e}return Xt(t,Jt),Ht(t,[{key:"getTouchAction",value:function(){return[rt]}},{key:"process",value:function(t){var e=this,n=this.options,i=t.pointers.length===n.pointers,r=t.distance<n.threshold,o=t.deltaTime<n.time;if(this.reset(),t.eventType&vt&&0===this.count)return this.failTimeout();if(r&&o&&i){if(t.eventType!==bt)return this.failTimeout();var s=!this.pTime||t.timeStamp-this.pTime<n.interval,a=!this.pCenter||m(this.pCenter,t.center)<n.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,a&&s?this.count+=1:this.count=1,this._input=t,0===this.count%n.taps)return this.hasRequireFailures()?(this._timer=g(function(){e.state=jt,e.tryEmit()},n.interval,this),Ft):jt}return Nt}},{key:"failTimeout",value:function(){var t=this;return this._timer=g(function(){t.state=Nt},this.options.interval,this),Nt}},{key:"reset",value:function(){clearTimeout(this._timer)}},{key:"emit",value:function(){this.state===jt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}]),t}();te.prototype.defaults={event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10};var ee=function(){function t(){qt(this,t);var e=Vt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e._timer=null,e._input=null,e}return Xt(t,Jt),Ht(t,[{key:"getTouchAction",value:function(){return[it]}},{key:"process",value:function(t){var e=this,n=this.options,i=t.pointers.length===n.pointers,r=t.distance<n.threshold,o=t.deltaTime>n.time;if(this._input=t,!r||!i||t.eventType&(bt|_t)&&!o)this.reset();else if(t.eventType&vt)this.reset(),this._timer=g(function(){e.state=jt,e.tryEmit()},n.time,this);else if(t.eventType&bt)return jt;return Nt}},{key:"reset",value:function(){clearTimeout(this._timer)}},{key:"emit",value:function(t){this.state===jt&&(t&&t.eventType&bt?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=Z(),this.manager.emit(this.options.event,this._input)))}}]),t}();ee.prototype.defaults={event:"press",pointers:1,time:251,threshold:9};var ne=function(){function t(e,n){qt(this,t),this.manager=e,this.set(n)}return Ht(t,[{key:"set",value:function(t){t===nt&&(t=this.compute()),et&&this.manager.element.style&&ut[t]&&(this.manager.element.style[tt]=t),this.actions=t.toLowerCase().trim()}},{key:"update",value:function(){this.set(this.manager.options.touchAction)}},{key:"compute",value:function(){var t=[];return u(this.manager.recognizers,function(e){c(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),w(t.join(" "))}},{key:"preventDefaults",value:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var i=this.actions,r=v(i,ot)&&!ut[ot],o=v(i,at)&&!ut[at],s=v(i,st)&&!ut[st];if(r){var a=1===t.pointers.length,u=t.distance<2,d=t.deltaTime<250;if(a&&u&&d)return}if(!s||!o)return r||o&&n&Et||s&&n&Tt?this.preventSrc(e):void 0}}},{key:"preventSrc",value:function(t){this.manager.session.prevented=!0,t.preventDefault()}}]),t}(),ie=function(){function t(e,n){qt(this,t);var i=this;this.manager=e,this.callback=n,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){c(e.options.enable,[e])&&i.handler(t)},this.init()}return Ht(t,[{key:"handler",value:function(){}},{key:"init",value:function(){this.evEl&&F(this.element,this.evEl,this.domHandler),this.evTarget&&F(this.target,this.evTarget,this.domHandler),this.evWin&&F(B(this.element),this.evWin,this.domHandler)}},{key:"destroy",value:function(){this.evEl&&O(this.element,this.evEl,this.domHandler),this.evTarget&&O(this.target,this.evTarget,this.domHandler),this.evWin&&O(B(this.element),this.evWin,this.domHandler)}}]),t}(),re={pointerdown:vt,pointermove:wt,pointerup:bt,pointercancel:_t,pointerout:_t},oe={2:pt,3:ft,4:yt,5:gt},se="pointerdown",ae="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(se="MSPointerDown",ae="MSPointerMove MSPointerUp MSPointerCancel");var ue=function(){function t(){qt(this,t);var e=Vt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.evEl=se,e.evWin=ae,e.store=e.manager.session.pointerEvents=[],e}return Xt(t,ie),Ht(t,[{key:"handler",value:function(t){var e=this.store,n=!1,i=t.type.toLowerCase().replace("ms",""),r=re[i],o=oe[t.pointerType]||t.pointerType,s=o===pt,a=l(e,t.pointerId,"pointerId");r&vt&&(0===t.button||s)?a<0&&(e.push(t),a=e.length-1):r&(bt|_t)&&(n=!0),a<0||(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),n&&e.splice(a,1))}}]),t}(),de={touchstart:vt,touchmove:wt,touchend:bt,touchcancel:_t},le="touchstart touchmove touchend touchcancel",ce=function(){function t(){qt(this,t),t.prototype.evTarget=le,t.prototype.targetIds={};var e=Vt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.evTarget=le,
e.targetIds={},e}return Xt(t,ie),Ht(t,[{key:"handler",value:function(t){var e=de[t.type],n=N.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:pt,srcEvent:t})}}]),t}(),he={mousedown:vt,mousemove:wt,mouseup:bt},pe="mousedown",fe="mousemove mouseup",ye=function(){function t(){qt(this,t);var e=Vt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.evEl=pe,e.evWin=fe,e.pressed=!1,e}return Xt(t,ie),Ht(t,[{key:"handler",value:function(t){var e=he[t.type];e&vt&&0===t.button&&(this.pressed=!0),e&wt&&1!==t.which&&(e=bt),this.pressed&&(e&bt&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:yt,srcEvent:t}))}}]),t}(),ge=2500,me=25,ve=function(){function t(){qt(this,t);var e=Vt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments)),n=y(e.handler,e);return e.touch=new ce(e.manager,n),e.mouse=new ye(e.manager,n),e.primaryTouch=null,e.lastTouches=[],e}return Xt(t,ie),Ht(t,[{key:"handler",value:function(t,e,n){var i=n.pointerType===pt,r=n.pointerType===yt;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)R.call(this,e,n);else if(r&&Y.call(this,n))return;this.callback(t,e,n)}}},{key:"destroy",value:function(){this.touch.destroy(),this.mouse.destroy()}}]),t}(),we=1,be=2,_e=function(){function t(e,n){var i=this;qt(this,t),this.options=Rt({},Me.defaults,n||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=q(this),this.touchAction=new ne(this,this.options.touchAction),H(this,!0),u(this.options.recognizers,function(t){var e=i.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}return Ht(t,[{key:"set",value:function(t){return Rt(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this}},{key:"stop",value:function(t){this.session.stopped=t?be:we}},{key:"recognize",value:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var n=void 0,i=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&jt)&&(r=e.curRecognizer=null);for(var o=0;o<i.length;)n=i[o],e.stopped===be||r&&n!==r&&!n.canRecognizeWith(r)?n.reset():n.recognize(t),!r&&n.state&(Ft|Ot|Bt)&&(r=e.curRecognizer=n),o++}}},{key:"get",value:function(t){if(t instanceof Jt)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event===t)return e[n];return null}},{key:"add",value:function(t){if(d(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t}},{key:"remove",value:function(t){if(d(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=l(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this}},{key:"on",value:function(t,e){if(t!==i&&e!==i){var n=this.handlers;return u(D(t),function(t){n[t]=n[t]||[],n[t].push(e)}),this}}},{key:"off",value:function(t,e){if(t!==i){var n=this.handlers;return u(D(t),function(t){e?n[t]&&n[t].splice(l(n[t],e),1):delete n[t]}),this}}},{key:"emit",value:function(t,e){this.options.domEvents&&W(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](e),i++}}},{key:"destroy",value:function(){this.element&&H(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}}]),t}(),Me=function Ae(t,e){return qt(this,Ae),(e=e||{}).recognizers=r(e.recognizers,Ae.defaults.preset),new _e(t,e)};Me.VERSION="2.0.8",Me.defaults={domEvents:!1,touchAction:nt,enable:!0,inputTarget:null,inputClass:null,preset:[[Qt,{enable:!1}],[Kt,{enable:!1},["rotate"]],[Zt,{direction:Et}],[Gt,{direction:Et},["swipe"]],[te],[te,{event:"doubletap",taps:2},["tap"]],[ee]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var xe={touchstart:vt,touchmove:wt,touchend:bt,touchcancel:_t},Se="touchstart",Ce="touchstart touchmove touchend touchcancel",ke=function(){function t(){qt(this,t);var e=Vt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.evTarget=Se,e.evWin=Ce,e.started=!1,ie.apply(e,arguments),e}return Xt(t,ie),Ht(t,[{key:"handler",value:function(t){var e=xe[t.type];if(e===vt&&(this.started=!0),this.started){var n=X.call(this,t,e);e&(bt|_t)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:pt,srcEvent:t})}}}]),t}(),Ee=V(function(t,e,n){for(var r=Object.keys(e),o=0;o<r.length;)(!n||n&&t[r[o]]===i)&&(t[r[o]]=e[r[o]]),o++;return t},"extend","Use `assign`."),Te=V(function(t,e){return Ee(t,e,!0)},"merge","Use `assign`.");Rt(Me,{INPUT_START:vt,INPUT_MOVE:wt,INPUT_END:bt,INPUT_CANCEL:_t,STATE_POSSIBLE:Dt,STATE_BEGAN:Ft,STATE_CHANGED:Ot,STATE_ENDED:Bt,STATE_RECOGNIZED:jt,STATE_CANCELLED:Lt,STATE_FAILED:Nt,DIRECTION_NONE:Mt,DIRECTION_LEFT:xt,DIRECTION_RIGHT:St,DIRECTION_UP:Ct,DIRECTION_DOWN:kt,DIRECTION_HORIZONTAL:Et,DIRECTION_VERTICAL:Tt,DIRECTION_ALL:It,Manager:_e,Input:ie,TouchAction:ne,TouchInput:ce,MouseInput:ye,PointerEventInput:ue,TouchMouseInput:ve,SingleTouchInput:ke,Recognizer:Jt,AttrRecognizer:Ut,Tap:te,Pan:Gt,Swipe:Zt,Pinch:Kt,Rotate:Qt,Press:ee,on:F,off:O,each:u,merge:Te,extend:Ee,assign:Rt,inherit:z,bindFn:y,prefixed:o,toArray:j,inArray:l,uniqueArray:L,splitStr:D,boolOrFn:c,hasParent:b,addEventListeners:F,removeEventListeners:O}),"function"==typeof define&&define.amd?define(function(){return Me}):"undefined"!=typeof module&&module.exports?module.exports=Me:t[n]=Me}(window,document,"Hammer"),function(){function t(t){this.ysy=t,this.init(),this.buttonsInited=!1,this.saveButton=null,this.undoButton=null,this.redoButton=null,this.historyIsPushed=!0,this.redoIsPushed=!0}function e(t,e){this.ysy=t,this.isDisabled=!1,this.$element=e.find(this.elementClass)}function n(t,n){e.call(this,t,n)}function i(t,n){e.call(this,t,n)}function r(t,n){e.call(this,t,n)}t.prototype.init=function(){var t=this;this.ysy.eventBus.register("TreeLoaded",function(e){e.addEventListener("changed",$.proxy(t.historyChanged,t)),t.historyChanged()}),this.ysy.eventBus.register("BeforeServerClassInit",function(){t.saveButton=t.ysy.toolbar.children.save,t.undoButton=t.ysy.toolbar.children.undo,t.redoButton=t.ysy.toolbar.children.redo,t.buttonsInited=!0})},t.prototype.historyChanged=function(){var t=this.ysy.idea;t.canUndo()?this.historyPushed():this.historyEmpty(),t.canRedo()?this.redoPushed():this.redoEmpty()},t.prototype.historyEmpty=function(){this.historyIsPushed&&(this.historyIsPushed=!1,$(window).unbind("beforeunload"),$(window).unbind("unload"),this.buttonsInited&&(this.saveButton.setDisabled(!0),this.undoButton.setDisabled(!0)),this.ysy.log.debug("History Empty","history"))},t.prototype.historyPushed=function(){this.historyIsPushed||(this.historyIsPushed=!0,$(window).bind("beforeunload",function(t){var e="Some changes are not saved!";return t.returnValue=e,e}),this.buttonsInited&&(this.saveButton.setDisabled(!1),this.undoButton.setDisabled(!1)),this.ysy.log.debug("History Pushed","history"))},t.prototype.redoEmpty=function(){this.redoIsPushed&&(this.redoIsPushed=!1,this.buttonsInited&&this.redoButton.setDisabled(!0),this.ysy.log.debug("Redo Empty","history"))},t.prototype.redoPushed=function(){this.redoIsPushed||(this.redoIsPushed=!0,this.buttonsInited&&this.redoButton.setDisabled(!1),this.ysy.log.debug("Redo Pushed","history"))},window.easyMindMupClasses.History=t,e.prototype.elementClass="",e.prototype.setDisabled=function(t){this.isDisabled=t,this.ysy.repainter.redrawMe(this)},e.prototype._render=function(){this.$element.toggleClass("mindmup__button--disabled",this.isDisabled)};var o=window.easyMindMupClasses;o.extendClass(n,e),n.prototype.elementClass=".mindmup__menu-save",n.prototype.id="save",window.easyMindMupClasses.SaveButton=n,o.extendClass(i,e),i.prototype.id="undo",i.prototype.elementClass=".mindmup-button-undo",window.easyMindMupClasses.UndoButton=i,o.extendClass(r,e),r.prototype.id="redo",r.prototype.elementClass=".mindmup-button-redo",window.easyMindMupClasses.RedoButton=r}(),function(){function t(t){this.nodeCacheMarks={},this.ysy=t,this.patch(t)}t.prototype.patch=function(t){var e=this;e.layoutCalculator=function(n){return e.preComputeDimensions(n,e,t),MAPJS.calculateLayout(n,function(t){return e.nodeCacheMarks[t.id]},e.getMargin(t))},jQuery.fn.queueFadeOut=function(t){var e=this;return e.animate({opacity:0},_.extend({complete:function(){e.remove()}},t))}},t.prototype.getMargin=function(){return 20},t.prototype.preComputeDimensions=function(t,e,n){var i=e.nodeCacheMarks,r=[];n.util.traverse(t,function(t){t.attr&&t.attr.entityType||n.upgradeToModelEntity(t),i[t.id]&&i[t.id].title===t.title&&i[t.id].collapsed===t.attr.collapsed||r.push(t)});for(var o='<div id="dimension_compute_cont">',s=0;s<r.length;s++){var a=r[s],u=n.util.escapeHtml(n.nodePatch.getNodeText(a));o+='<div id="compute_node_'+a.id+'" class="mapjs-node" style="visibility: hidden;position: absolute"><span>'+u+"</span></div>"}for(o+="</div>",$(o).appendTo("body"),s=0;s<r.length;s++){a=r[s];var d=$("#compute_node_"+a.id);i[a.id]={title:a.title,collapsed:a.attr.collapsed,width:d.outerWidth(!0),height:d.outerHeight(!0)}}$("#dimension_compute_cont").remove()},window.easyMindMupClasses.LayoutPatch=t}(),function(){function t(t){this.opened=!0,this.headerHidden=!1,this.lastHeaderHidden=!0,this.otherBuilders=["project"],this.usedActive=!1,this.ysy=t,this.itemBuilders=new e(t),this.init(t)}function e(t){this.ysy=t,this.filter=t.filter,this.styles=t.styles.styles,this.projectLabel=t.settings.labels.types.project}t.prototype.init=function(t){var e=this,n=t.$menu;t.eventBus.register("TreeLoaded",function(t){t.addEventListener("changed",function(){e.draw()}),e.draw()}),t.eventBus.register("nodeStyleChanged",$.proxy(this.draw,this)),this.$container=n.find(".mindmup__legend-container"),this.$element=n.find(".mindmup-legend"),this.$header=n.find(".mindmup__legend-header"),this.$usedToggle=this.$header.find(".mindmup__legend-used-toggle"),this.$openToggle=this.$header.find(".mindmup__legend-toggler"),this.opened=!t.storage.settings.loadLegendHidden(),this.$headerToggle=n.find(".mindmup__legend-cont-toggler"),this.opened=!t.storage.settings.loadLegendHidden(),this.headerHidden=t.storage.settings.loadLegendHeaderHidden(),this.lastHeaderHidden=!this.headerHidden},t.prototype.headerToggle=function(){this.headerHidden=!this.headerHidden,this.ysy.repainter.redrawMe(this),this.ysy.eventBus.fireEvent("legendHeaderToggled",this.headerHidden)},t.prototype.toggle=function(){this.opened=!this.opened,this.ysy.repainter.redrawMe(this),this.ysy.eventBus.fireEvent("legendToggled",this.opened)},t.prototype.getItemBuilder=function(t){return this.itemBuilders[t.builderType]},t.prototype.hotkeysBuilder=function(t){var e=this.ysy;t.find(".hotkey_link").click(function(){var t=e.util.getModal("info-modal","90%");t.html(e.$container.find(".mindmup-hotkeys-source").html()),showModal("info-modal"),t.dialog({buttons:[{"class":"button-2 button",text:e.settings.labels.buttons.close,click:function(){t.dialog("close")}}]})})},t.prototype.draw=function(){this.ysy.repainter.redrawMe(this)},t.prototype._render=function(){var t=this.ysy,e=this;if(this.headerHidden)this.lastHeaderHidden||(this.$container.addClass("mindmup__legend-container--hidden"),this.$headerToggle.toggleClass("active",!1).find("a").toggleClass("active",!1),this.lastHeaderHidden=!0);else if(this.lastHeaderHidden&&(this.$container.removeClass("mindmup__legend-container--hidden"),this.$headerToggle.find("a").toggleClass("active",!0),this.lastHeaderHidden=!1),this.$openToggle.toggleClass("active",this.opened),this.opened){this.resize(),this.$openToggle.toggleClass("active",this.opened);for(var n,i=this.$element.show(),r=t.styles.setting,o=t.styles.getCurrentStyle(),s=o.options(this.usedActive),a=this.getItemBuilder(o)||_.noop,u={active:this.usedActive?"used":"all",filter:t.filter.isOn()},d=[],l=0;l<this.otherBuilders.length;l++){var c=this.itemBuilders[this.otherBuilders[l]];c&&((n=c.call(this.itemBuilders))&&d.push(n))}for(u.items=d,l=0;l<s.length;l++)n=a.call(this.itemBuilders,s[l],r),d.push(n);i.html(Mustache.render(t.settings.templates.legendTemplate,u)),i.find(".mindmup-legend__filter_cont").click(function(){t.filter.reset(),e.draw()}),this.hotkeysBuilder(i)}else this.$element.hide()},t.prototype.resize=function(){if(this.opened){var t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,e=this.$element.offset().top,n=$(document).scrollTop();this.$element.css("max-height",t+n-e-25+"px")}},window.easyMindMupClasses.Legend=t,e.prototype.assigneeTemplate='          <div data-item_id="{{item.id}}" class="mindmup-legend-item-cont">            <div class="mindmup-legend-color-box{{banned}}{{scheme}} {{#avatar}}mindmup-legend-color-box-assignee{{/avatar}}"></div>            {{#avatar}}             <span class="avatar-container">              <img width="64" height="64" alt="{{item.name}}" class="gravatar" src="{{{avatarUrl}}}">              </span>            {{/avatar}}            {{item.name}}          </div>',e.prototype.percentTemplate='<div data-item_id="{{percent}}" class="mindmup-legend-item-cont">            <div class="mindmup-legend-color-box{{banned}}{{scheme}}"></div>            {{percent}} %            </div>',e.prototype.spentTimeTemplate='<div data-item_id="{{spentTime}}" class="mindmup-legend-item-cont">            <div non-draggable="true" class="mindmup-legend-color-box{{banned}}{{scheme}}"></div>            {{spentTime}}            %            {{#last}}              +            {{/last}}          </div>',e.prototype.dataBasedTemplate='<div data-item_id="{{item.id}}" class="mindmup-legend-item-cont">            <div class="mindmup-legend-color-box{{banned}}{{scheme}}"></div>            {{item.name}}          </div>',e.prototype.projectTemplate='<div data-item_id="project" class="mindmup-legend-item-cont">            <div class="mindmup-legend-color-box mindmup-scheme-project{{banned}}"></div>            {{label}}            </div>',e.prototype.assignee=function(t,e){return Mustache.render(this.assigneeTemplate,{item:t,banned:this.filter.cssByBannedValue(t.id),scheme:this.styles[e].addSchemeClass(t.id),avatar:0!==t.id,avatarUrl:t.avatar_url?t.avatar_url:"/plugin_assets/easy_extensions/images/avatar.jpg"})},e.prototype.percent=function(t,e){return Mustache.render(this.percentTemplate,{percent:t,banned:this.filter.cssByBannedValue(t),scheme:this.styles[e].addSchemeClass(t)})},e.prototype.spentTimeRatio=function(t,e){var n=180;return Mustache.render(this.spentTimeTemplate,{spentTime:t,banned:this.filter.cssByBannedValue(t),scheme:this.styles[e].addSchemeClass(t),last:t===n})},e.prototype.dataBased=function(t,e){return Mustache.render(this.dataBasedTemplate,{item:t,banned:this.filter.cssByBannedValue(t.id),scheme:this.styles[e].addSchemeClass(t.id)})},e.prototype.project=function(){return Mustache.render(this.projectTemplate,{label:this.projectLabel,banned:this.filter.cssByBannedValue("project")})}}(),function(){function t(t){this.legend=t.legends,this.$element=this.legend.$element,this.ysy=t,this.init(t),this.possibleTargets=[]}function e(t,e){this.ysy=t,this.init(e),this.legendItemId=e.data("item_id")}t.prototype.maxDistanceToClick=30,t.prototype.domain="easy-mindmup-legend",t.prototype.draggedSelector=".mindmup-legend-item-cont:not([data-item_id='project'])",t.prototype.filterSelector=".mindmup-legend-item-cont[data-item_id='project']",t.prototype.usedToggleSelector=".mindmup-legend-used",t.prototype.legendHeaderTogglerSelector=".mindmup__legend-cont-toggler",t.prototype.hoverClass="mindmup-legend-drag-hover droppable",t.prototype.init=function(t){var e=this,n=this.legend;t.$menu.find(".mindmup__legend-trigger").on("click",function(){n.toggle()}),t.$menu.find(this.legendHeaderTogglerSelector).on("click",function(){n.headerToggle()}),this.$element.off("click.legend-used").on("click.legend-used",this.usedToggleSelector,function(){n.usedActive=!n.usedActive,t.repainter.redrawMe(n)}).off("mousedown."+this.domain).on("mousedown."+this.domain,this.draggedSelector,function(t){return e.shiftKey=t.shiftKey,"A"===t.target.parentElement.tagName&&(e.aTouched=!0),t.preventDefault(),3!==t.which&&(e.actualX=t.pageX-window.scrollX,e.actualY=t.pageY-window.scrollY,e.down($(this),t.pageX,t.pageY),!1)}).off("touchstart."+this.domain).on("touchstart."+this.domain,this.draggedSelector,function(t){t.preventDefault();var n=t.originalEvent.touches[0];return!!n&&(e.actualX=n.pageX-window.scrollX,e.actualY=n.pageY-window.scrollY,e.down($(this),n.pageX,n.pageY),!1)}).off("touchend."+this.domain).on("touchend."+this.domain,function(t){return t.preventDefault(),e.up(),!1}).off("touchmove."+this.domain).on("touchmove."+this.domain,this.draggedSelector,function(t){t.preventDefault();var n=t.originalEvent.touches[0];return!!n&&(e.move(n.pageX,n.pageY),!1)}).off("click."+this.domain).on("click."+this.domain,this.filterSelector,function(){var e=$(this).data("item_id");t.filter.toggleAllowed(e),t.repainter.redrawMe(t.legends)}),t.eventBus.register("resize",$.proxy(n.resize,n))},t.prototype.down=function(t,e,n){this.maxDistance=0;var i=this.ysy.$container.children('[data-mapjs-role="stage"]');this.stageData=i.data(),this.stageOffset=i.offset(),this.startX=e-window.scrollX,this.startY=n-window.scrollY,this.actionActive=!0;var r=this;if(this.$sourceElement=t,!0!==this.$sourceElement[0].children[0].getAttribute("non-draggable")){this.$overlay=$('<div class="mindmup-legend-drag-overlay">').css({width:window.innerWidth,height:window.innerHeight});var o=this.$element[0].className.replace("mindmup-legend ","");this.$overlay.addClass(o),$(document.body).append(this.$overlay),this.$overlay.on("mouseup."+this.domain,function(t){t.preventDefault(),r.up()}),this.$overlay.on("mousemove."+this.domain,function(t){t.preventDefault(),r.move(t.pageX,t.pageY)})}},t.prototype.move=function(t,n){if(this.actionActive){if(this.actualX=t-window.scrollX,this.actualY=n-window.scrollY,this.moveDistance()>this.maxDistanceToClick&&!this.avatar){if(this.avatar=new e(this.ysy,this.$sourceElement),this.changeObject=this.avatar.getChangeObject(),!this.changeObject)return this.up();this.possibleTargets=this.findPossibleTargets(),this.$overlay.append(this.avatar.$cont)}if(this.avatar){this.avatar.moveAvatar(this.actualX,this.actualY);var i=this.currentDropTarget;this.currentDropTarget=this.getCurrentTarget(t,n),this.currentDropTarget!==i&&(i&&i.removeClass(this.hoverClass),this.currentDropTarget&&this.currentDropTarget.addClass(this.hoverClass))}}},t.prototype.up=function(){if(this.possibleTargets=null,this.actionActive=!1,this.moveDistance()<this.maxDistanceToClick){var t=this.$sourceElement.data("item_id");this.ysy.filter.toggleAllowed(t),this.ysy.repainter.redrawMe(this.legend)}else this._drop();this.$overlay&&(this.avatar&&this.avatar.destroy(),this.avatar=null,this.$overlay.remove()),this.currentDropTarget&&this.currentDropTarget.removeClass(this.hoverClass),this.currentDropTarget=null},t.prototype.findPossibleTargets=function(){for(var t=this.ysy.$container.find(".mapjs-node"),e=[],n=0;n<t.length;n++)e.push($(t[n]));return e},t.prototype.getCurrentTarget=function(t,e){for(var n=this.possibleTargets,i=0;i<n.length;i++){var r=n[i],o=r.data(),s=(t-this.stageOffset.left)/this.stageData.scale;if(!(s<o.x)&&!(s>o.x+o.width)){var a=(e-this.stageOffset.top)/this.stageData.scale;if(!(a<o.y||a>o.y+o.height))return r}}return null},t.prototype._drop=function(){if(this.currentDropTarget){var t=this.ysy,e=t.mapModel.findIdeaById(this.currentDropTarget.attr("id").split("_")[1]);t.setData(e,this.changeObject)&&(t.mapModel.selectNode(e.id),t.idea.dispatchEvent("changed"))}},t.prototype.moveDistance=function(){if(null==this.actualX)return 0;var t=Math.sqrt(Math.pow(this.actualX-this.startX,2)+Math.pow(this.actualY-this.startY,2));return t>this.maxDistance&&(this.maxDistance=t),t},window.easyMindMupClasses.LegendEvents=t,e.prototype.init=function(t){var e=t.children(".mindmup-legend-color-box")[0].className;this.$cont=$('<div class="mindmup-legend-drag-avatar '+e+'"></div>')},e.prototype.moveAvatar=function(t,e){this.$cont.css({left:t,top:e})},e.prototype.destroy=function(){this.$cont.remove()},e.prototype.getChangeObject=function(){return this.ysy.styles.getCurrentStyle().changeObject(this.legendItemId)}}(),function(){function t(t){this.ysy=t,this.init(t)}t.prototype.init=function(t){var e=this;t.eventBus.register("MapInited",function(t){e._prepareWidget(t)})},t.prototype._prepareWidget=function(t){var e,n,i,r,o=this.ysy,s=o.$container.find(".link-edit-widget");s.hide(),r=s.find(".link-edit-type-actual"),t.addEventListener("linkSelected",function(t,a){e=t,r.text(o.settings.labels.links[t.attr.data.type]),s.show();var u=o.$container.offset();n=n||s.width(),i=i||s.height(),s.css({top:a.y-u.top-5+"px",left:a.x-u.left-5+"px"})}),t.addEventListener("mapMoveRequested",function(){s.hide()}),s.find(".delete").click(function(){t.removeLink("mouse",e.ideaIdFrom,e.ideaIdTo),s.hide()}),s.mouseleave(s.hide.bind(s))},window.easyMindMupClasses.LinkEdit=t}(),function(){function t(t){this.ysy=t,this.linkArray=[],this.disabled=!1,this.showLinks=!!t.storage.settings._load("showLinks")}function e(t,e){this.ysy=t,this.init(t,e)}t.prototype.commonLinkStyle={color:"#0000FF",lineStyle:"dashed",arrow:!1},t.prototype.precedesLinkStyle={color:"#00FF00",lineStyle:"solid",arrow:!0},t.prototype.convertRelations=function(t,e){if(!t.relations)return this.disabled=!0,null;for(var n=t.relations,i={},r=1;r<e.length;r++){var o=e[r];"issue"===o.attr.entityType&&(i[o.attr.data.id]=o)}var s=[];for(r=0;r<n.length;r++){var a=n[r],u=i[a.source_id],d=i[a.target_id];if(u&&d){var l=this.getLinkStyleFromType(a.type),c={ideaIdFrom:u.id,ideaIdTo:d.id,attr:{style:l,data:a}};s.push(c)}}return s},t.prototype.getLinkStyleFromType=function(t){var e=this.commonLinkStyle;return"precedes"!==t&&"start_to_start"!==t&&"finish_to_finish"!==t&&"start_to_finish"!==t||(e=this.precedesLinkStyle),$.extend({},e)},t.prototype.attachLinks=function(t,e){this.disabled||(this.linkArray=e,t.links=null,this.showLinks&&(t.links=e))},t.prototype.outerPath=function(t,e){"use strict";var n=125,i=250,r=75,o=t.left<0,s=e.left<0,a={left:Math.min(t.left,e.left),top:Math.min(t.top,e.top)};a.width=Math.max(t.left+t.width,e.left+e.width,a.left+1)-a.left,a.height=Math.max(t.top+t.height,e.top+e.height,a.top+1)-a.top;var u={x:t.left-a.left+(o?0:t.width),y:t.top-a.top+.5*t.height},d={x:e.left-a.left+(s?0:e.width),y:e.top-a.top+.5*e.height};if(o===s&&Math.abs(u.y-d.y)>50){var l={y:(u.y+d.y)/2,x:(Math.max(Math.abs(u.x),Math.abs(d.x))+n)*(o?-1:1)};return{d:"M"+Math.round(u.x)+","+Math.round(u.y)+"Q"+Math.round(l.x)+","+Math.round(l.y)+","+Math.round(d.x)+","+Math.round(d.y),conn:{from:{x:l.x+a.left,y:l.y+a.top},to:{x:d.x+a.left,y:d.y+a.top}},position:a}}o!==s&&(n=i);var c={x:u.x+n*(o?-1:1)},h={x:d.x+n*(s?-1:1)};if(Math.abs(u.y-d.y)<50)c.y=u.y+r*(u.y>-a.top?1:-1),h.y=d.y+r*(d.y>-a.top?1:-1);else{var p=d.y-u.y;c.y=u.y+p/4,h.y=d.y-p/4}return{d:"M"+Math.round(u.x)+","+Math.round(u.y)+"C"+Math.round(c.x)+","+Math.round(c.y)+","+Math.round(h.x)+","+Math.round(h.y)+","+Math.round(d.x)+","+Math.round(d.y),conn:{from:{x:h.x+a.left,y:h.y+a.top},to:{x:d.x+a.left,y:d.y+a.top}},position:a}},window.easyMindMupClasses.Links=t,e.prototype.id="ShowLinksButton",e.prototype.init=function(t,e){this.$element=e.find(".show-links-toggler");var n=this.ysy.links;return this.$element.click($.proxy(function(){n.showLinks=!n.showLinks,n.showLinks?t.idea.links=t.links.linkArray:delete t.idea.links,t.storage.settings._save({showLinks:n.showLinks}),t.idea.dispatchEvent("changed"),t.repainter.redrawMe(this)},this)),this},e.prototype._render=function(){var t=this.ysy.links;t.disabled&&this.$element.hide();var e=t.showLinks||!1;this.$element.find("a").toggleClass("active",e)},window.easyMindMupClasses.ShowLinksButton=e}(),function(){function t(t){this.ysy=t,this._rootId=1}function e(t,e){this.type=t,this.id=e}t.prototype.load=function(){if(this.ysy.storage.clear(),this.ysy.idea&&this.ysy.idea.resetHistory(),this.ysy.settings.mindmupData){if("firstLoad"===this.ysy.settings.mindmupData){var t=this;this.ysy.settings.mindmupData=function(e){delete t.ysy.settings.mindmupData,t._handleData(e)}}else{var e=this.ysy.settings.mindmupData;delete this.ysy.settings.mindmupData,this._handleData(e)}return this}return $.getJSON(this.ysy.settings.paths.data,$.proxy(this._handleData,this)),this},t.prototype._handleData=function(t){var e=this.extractData(t);if(this.loadSideData(e),this.ysy.idea)return this._updateIdeaByData(this.ysy.idea,e);var n=this.convertData(e);this.ysy.storage.extra.setLayout(e.layout);var i=this.ysy.storage.extra.enhanceData(n,n[this._rootId]),r=this.ysy.links.convertRelations(e,i),o=this.rearrangeData(i);this.ysy.links.attachLinks(o,r);var s=MAPJS.content(o);this.ysy.eventBus.fireEvent("IdeaConstructed",s),this.setIdea(s)},t.prototype._updateIdeaByData=function(t,e){this.changedIdea(t,e);var n=this.convertData(e);this.ysy.storage.extra.setLayout(e.layout);var i=this.ysy.storage.extra.enhanceData(n,n[this._rootId]),r=this.ysy.links.convertRelations(e,i),o=this.rearrangeData(i,t),s=MAPJS.content(o);t.ideas=s.ideas,this.ysy.links.attachLinks(t,r),this.ysy.eventBus.fireEvent("IdeaConstructed",t),this.ysy.eventBus.fireEvent("TreeUpdated",t),this.ysy.fireChangedEvent("TreeUpdated","")},t.prototype.extractData=function(t){throw t.cosi=!0,"extractData is not defined"},t.prototype.changedIdea=function(t,e){const n=t.attr.data.id;let i;e.projects.forEach(t=>{n===t.id&&(i=t)}),!i||t.title===i.name&&t.attr.data.name===i.name||(t.title=i.name,t.attr.data.name=i.name,this.setIdea(t))},t.prototype.loadSideData=function(t){throw t.dom=!0,"loadSideData is not defined"},t.prototype.convertData=function(t){var e,n=t.projects,i=t.issues,r=[{}],o={root:null,project:{},issue:{}},s=this.nodeGenerator("project",o,r);for(e=0;e<n.length;e++){var a=n[e];a.id===this.ysy.settings.rootID&&(this._rootId=r.length),a.isProject=!0,s(a,a.name,!1)}var u=this.nodeGenerator("issue",o,r);for(e=0;e<i.length;e++){var d=i[e];u(d,d.subject,!d.filtered_out)}var l=new easyMindMupClasses.RootIdea(this.ysy).upgrade(r[this._rootId]);return o.root=l,r[this._rootId]=l,o[l.attr.entityType][this.ysy.settings.rootID]=l,this.assignParents(r,o),r},t.prototype.nodeGenerator=function(t,e,n){return function(i,r,o){var s=(new window.easyMindMupClasses.ModelEntity).fromServer(n.length,r,t,o,i);e[t][i.id]=s,n.push(s)}},t.prototype.getParentFromSource=function(t,e){throw t.title=e.toString(),"getParentFromSource is not defined"},t.prototype.assignParents=function(t,e){for(var n=1;n<t.length;n++)if(n!==this._rootId){var i=t[n],r=this.getParentFromSource(i,!1);if(null!==r){var o=e[r.type][r.id];o||null!==(r=this.getParentFromSource(i,!0))&&(o=e[r.type][r.id])}i.parent=o||e.root}},t.prototype.rearrangeData=function(t,e){var n,i,r,o=[],s=t[this._rootId];if(e){for(var a={},u=this.ysy.getIdOfIdea,d=1;d<t.length;d++)d!==this._rootId&&(n=t[d],a[u(n)]=n);this.rearrangeByIdea(e,t[this._rootId],a),r=Object.getOwnPropertyNames(a).map(function(t){return a[t]})}else r=t.slice(1);for(var l=0;l<r.length;l++)if(i=(n=r[l]).parent){var c=i.ideas;if(n.rank){if(c[n.rank]){var h=c[n.rank];for(c[n.rank]=n;0===i.nextChildIndex||c[i.nextChildIndex];)i.nextChildIndex++;c[i.nextChildIndex++]=h,delete n.rank;continue}0===i.nextChildIndex&&(i.nextChildIndex=1),c[n.rank]=n,delete n.rank}else if(i.id===this._rootId)o.push(n);else{for(;0===i.nextChildIndex||c[i.nextChildIndex];)i.nextChildIndex++;c[i.nextChildIndex++]=n}}for(this._fillRootChildren(s,o),d=1;d<t.length;d++){if(delete(n=t[d]).parent,n.attr.collapsed===undefined){if(d===this._rootId)continue;n.nextChildIndex&&(n.attr.collapsed=!0)}delete n.nextChildIndex}return s},t.prototype._fillRootChildren=function(t,e){if(0!==e.length){var n=t.ideas,i=Object.getOwnPropertyNames(t.ideas).map(function(t){return parseInt(t)}).sort(function(t,e){return t-e}),r=1,o=function(){for(;n[r];)r++;return r};if(this.ysy.settings.oneSideOn){var s=_.findIndex(i,function(t){return t>0});for(l=0;l<e.length;l++)n[o()]=e[l];for(l=0;l<s;l++)n[o()]=n[i[l]],delete n[i[l]]}for(var a=Math.ceil((i.length+e.length)/2),u=0,d=-1,l=0;l<i.length;l++)i[l]>0&&u++;for(l=0;l<e.length;l++)if(a>=u)n[o()]=e[l],u++;else{for(;n[d];)d--;n[d]=e[l],d--}}else this.ysy.contentPatch.updateOneSide(t)},t.prototype.rearrangeByIdea=function(t,e,n){if(!_.isEmpty(t.ideas))for(var i=Object.getOwnPropertyNames(t.ideas),r=this.ysy.getData(t).id,o=0;o<i.length;o++){var s=i[o],a=t.ideas[s],u=this.ysy.getData(a).id;if(u){var d=n[u];if(d)r===this.ysy.getData(d.parent).id&&(e.ideas||(e.ideas={}),e.ideas[s]=d,e.nextChildIndex||e.nextChildIndex++,e.nextChildIndex++,this.rearrangeByIdea(a,d,n))}}delete n[e.attr.data.id]},t.prototype.setIdea=function(t){this.ysy.idea=t,this.ysy.mapModel.setIdea(t),this.ysy.eventBus.fireEvent("TreeLoaded",t)},window.easyMindMupClasses.Loader=t,window.easyMindMupClasses.ParentPack=e}(),function(){function t(){this.logLevel=2,this.mainDebug="",this.debugTypes=["nothing"]}t.prototype.log=function(t){this.logLevel>=4&&this.print(t)},t.prototype.message=function(t){this.logLevel>=3&&this.print(t)},t.prototype.debug=function(t,e){if(e){if(this.mainDebug===e)return void this.print(t,"debug");for(var n=0;n<this.debugTypes.length;n++)if(this.debugTypes[n]===e)return void this.print(t,e===this.mainDebug?"debug":null)}else this.print(t,"debug")},t.prototype.warning=function(t){this.logLevel>=2&&this.print(t,"warning")},t.prototype.error=function(t){this.logLevel>=1&&this.print(t,"error")},t.prototype.print=function(t,e){"error"===e?console.error(t):"warning"===e?console.warn(t):"debug"===e?console.debug(t):console.log(t)},easyMindMupClasses.Logger=t}(),function(){function t(e){this.settings=e,this.id=e.mindMupId||"mindMup",this.containerDiv=e.containerDiv||"#container",this.menuDiv=e.menuDiv||"#mindmup_menu",this.firstLoad=!0,this.$container=$(this.containerDiv),this.$menu=$(this.menuDiv),t.allMindMups[this.id]=this,this.helperInited=!1}t.allMindMups={},t.prototype.helperInit=function(){this.helperInited=!0;var t=this.settings,e=$("#easy_wbs");e.find("p.nodata").remove(),t.easyRedmine&&0===$("#content").children(".easy-content-page").length&&e.addClass("easy-content-page"),this.util=new easyMindMupClasses.Util(this),this.eventBus=new easyMindMupClasses.EventBus(this),this.log=new easyMindMupClasses.Logger(this),this.repainter=new easyMindMupClasses.Repainter(this),this.tests=easyMindMupClasses.JasmineTests&&new easyMindMupClasses.JasmineTests(this)},t.prototype.init=function(){this.helperInited||this.helperInit(),this.eventBus.fireEvent("BeforePatchClassInit"),this.layoutPatch=this.layoutPatch||new easyMindMupClasses.LayoutPatch(this),this.contentPatch=this.contentPatch||new easyMindMupClasses.ContentPatch(this),this.nodePatch=this.nodePatch||new easyMindMupClasses.NodePatch(this),this.mapModelPatch=this.mapModelPatch||new easyMindMupClasses.MapModelPatch(this),this.eventBus.fireEvent("BeforeDataClassInit"),this.domPatch=this.domPatch||new easyMindMupClasses.DomPatch(this),this.afterChange=this.afterChange||new easyMindMupClasses.AfterChange(this),this.storage=this.storage||new easyMindMupClasses.Storage(this),this.history=this.history||new easyMindMupClasses.History(this),this.validator=this.validator||new easyMindMupClasses.Validator(this),this.links=this.links||new easyMindMupClasses.Links(this),this.dataStorage=this.dataStorage||new easyMindMupClasses.DataStorage(this),this.eventBus.fireEvent("BeforeViewClassInit"),this.mmInitiator=this.mmInitiator||new easyMindMupClasses.MMInitiator(this),this.filter=this.filter||new easyMindMupClasses.Filter(this),this.styles=this.styles||new easyMindMupClasses.Styles(this),this.legends=this.legends||new easyMindMupClasses.Legend(this),this.toolbar=this.toolbar||new easyMindMupClasses.Toolbar(this),this.linksEdit=this.linksEdit||new easyMindMupClasses.LinkEdit(this),this.print=this.print||new easyMindMupClasses.Print(this),this.contextMenu=this.contextMenu||new easyMindMupClasses.ContextMenu(this),this.legendEvents=this.legendEvents||new easyMindMupClasses.LegendEvents(this),this.eventBus.fireEvent("BeforeServerClassInit"),this.loader=this.loader||new easyMindMupClasses.Loader(this),this.saver=this.saver||new easyMindMupClasses.Saver(this),this.autosave=this.autosave||new easyMindMupClasses.Autosave(this),this.saveProgress=this.saveProgress||new easyMindMupClasses.SaveProgress(this),
this.saveInfo=this.saveInfo||new easyMindMupClasses.SaveInfo(this),this.eventBus.fireEvent("beforeMapInit"),this.mmInitiator.init(this),this.eventBus.fireEvent("MapInited",this.mapModel),this.repainter.start(),this.loader.load()},t.prototype.idea=null,t.prototype.mapModel=null,t.prototype.creatingEntity=null,t.prototype.getLayoutNode=function(t){if(!this.mapModel)return null;var e=this.mapModel.getCurrentLayout();return e?e.nodes[t]:null},t.prototype.getData=function(t){return t?(t.attr.data||(t.attr.data=new window.easyMindMupClasses.ModelEntityData),t.attr.data):null},t.prototype.setData=function(t,e,n){if(!t)return!1;t.attr.data||(t.attr.data=new window.easyMindMupClasses.ModelEntityData);var i=t.attr.data;"string"==typeof e&&(e=JSON.parse(e));for(var r=Object.getOwnPropertyNames(e),o=!1,s={},a=0;a<r.length;a++){var u=r[a];if(e[u]!==i[u]){if(!i[u]&&!e[u])continue;i._old||(i._old={}),i._old[u]=i[u],s[u]=i[u],i[u]=e[u],this.afterChange[u+"Func"]&&this.afterChange[u+"Func"](t,e[u],i._old[u]),o=!0}}if(o&&!n){var d=this;this.idea.logChange("setData",[t,e],function(){d.setData(t,s,!0)})}return o},t.prototype.setCustomData=function(t,e,n){if(!t)return!1;t.attr.data||(t.attr.data=new window.easyMindMupClasses.ModelEntityData);var i=t.attr.data,r=i.custom_fields;"string"==typeof e&&(e=JSON.parse(e));var o=Object.getOwnPropertyNames(e);if(!r){i.custom_fields=r=[],i._old||(i._old={}),i._old.custom_fields||(i._old.custom_fields={});for(var s=0;s<o.length;s++)r.push({id:parseInt(o[s]),value:e[o[s]]}),i._old.custom_fields[r.length-1]=null;return n||this.idea.logChange("initCustomData",[t,e],function(){delete t.attr.data.custom_fields}),!0}for(var a=!1,u={},d=0;d<o.length;d++){for(var l=o[d],c=parseInt(l),h=!1,p=0;p<r.length;p++){var f=r[p];if(f.id===c){h=!0,e[l]!==f.value&&(i._old||(i._old={}),i._old.custom_fields||(i._old.custom_fields={}),i._old.custom_fields[p]={value:f.value},u[l]=f.value,f.value=e[l],a=!0);break}}h||(r.push({id:c,value:e[l]}),i._old||(i._old={}),i._old.custom_fields||(i._old.custom_fields={}),i._old.custom_fields[r.length-1]=null,u[l]=null,a=!0)}if(a&&!n){var y=this;this.idea.logChange("setCustomData",[t,e],function(){y.setCustomData(t,u,!0)})}return a},t.prototype.fireChangedEvent=function(t,e){this.mapModel.getInputEnabled()&&this.idea.dispatchEvent("changed",t,e)},t.prototype.getNodeElement=function(t){return this.$container.find("#node_"+t.id)},t.prototype.upgradeToModelEntity=function(t){return t.__proto__=window.easyMindMupClasses.ModelEntity.prototype,t.attr=(new window.easyMindMupClasses.ModelEntityAttr).fromJson(t.attr),t.attr.entityType=this.creatingEntity,t},t.prototype.getIdOfIdea=function(t){return t.attr.data.id},window.easyMindMupClasses=window.easyMindMupClasses||{},window.easyMindMupClasses.MindMup=t}(),function(){function t(t){this.ysy=t,this.init(t),this.selectPersist=new e(t)}function e(t){this.ysy=t,this.preLastSelectedNode=null,this.lastSelectedNode=null}t.prototype.init=function(t){var e=this;t.eventBus.register("MapInited",function(n){e.selectPersist.init(n),n.getYsy=function(){return t},n.save=function(){t.saver.save()},n.modalIncome=function(){this.modalBudget("other_revenue")},n.modalExpense=function(){this.modalBudget("other_expense")},n.modalOverview=function(){this.modalBudget("overview")},n.modalBudget=function(t){var e=this.getYsy();if(e.settings.moneyOn){e.saver.save();var n=this.findIdeaById(this.getSelectedNodeId());e.eventBus.fireEvent("nodeBudgetDetailShow",n,t)}},n.followURL=function(e){"toolbar"===e&&(e=n.getCurrentlySelectedIdeaId());var i=t.mapModel.findIdeaById(e),r=t.getData(i);if(!r.id)return!1;if(r.default_url)window.open(r.default_url);else{var o=t.settings.paths[i.attr.entityType+"Page"];if(o===undefined)throw"entityPage URL is not defined";window.open(o.replace(":"+i.attr.entityType+"ID",r.id))}return!0},n.editNodeData=function(){if(!n.getEditingEnabled()||!n.getInputEnabled())return!1;t.eventBus.fireEvent("nodeEditDataRequested",n.getCurrentlySelectedIdeaId())},n.toggleOneSide=function(){var n=t.idea,i=!e.ysy.settings.oneSideOn;e.ysy.settings.oneSideOn=i,n.updateOneSide(n,!0),e.ysy.eventBus.fireEvent("saveOneSideOn",i)},n.addEventListener("inputEnabledChanged",function(t,e){if(t&&!e)return n.dispatchEvent("inputEnabledChanged",!0,!0),!1},5),n.showBudget=function(){var t=this.getYsy(),e=t.mapModel.findIdeaById(t.mapModel.getCurrentlySelectedIdeaId());t.eventBus.fireEvent("nodeBudgetDetailShow",e,"overview")};var i=n.resetView;n.resetView=function(e){t.domPatch.resetRootPosition(),i(e)};var r=n.dropNode;n.dropNode=function(t,e,i){var o=n.getIdea().findSubIdeaById(e).getAttr("collapsed");n.pause();var s=r(t,e,i);return o&&n.getIdea().updateAttr(e,"collapsed",!0),n.resume(),s}})},window.easyMindMupClasses.MapModelPatch=t,e.prototype.init=function(t){var e=this,n=function(n,i){i&&(e.preLastSelectedNode=e.lastSelectedNode,e.lastSelectedNode=n),t.getYsy().eventBus.fireEvent("nodeSelectionChanged",n,i);var r=t.getCurrentLayout();r.nodes[n]&&$("#node_"+n).updateNodeContent(r.nodes[n])},i=function(){e.preLastSelectedNode=e.preLastSelectedNode||e.ysy.idea.id,e.lastSelectedNode=e.preLastSelectedNode,t.selectNode(e.preLastSelectedNode)};t.addEventListener("nodeSelectionChanged",n),t.addEventListener("mapViewResetRequested",i,5)}}(),function(){function t(t){this.ysy=t}t.prototype.init=function(t){var e=new MAPJS.MapModel(t.layoutPatch.layoutCalculator,[]);jQuery(t.$container).domMapWidget(console,e,!1,null,undefined,t),jQuery(t.$menu).mapToolbarWidget(e,t),MAPJS.DOMRender.stageMargin={top:300,left:300,bottom:300,right:300},MAPJS.DOMRender.linkConnectorPath=t.links.outerPath,MAPJS.DOMRender.nodeConnectorPath=t.domPatch.curvedPath,t.mapModel=e;var n=function(e){t.eventBus.fireEvent("resize",e)};$(document).on("easySidebarToggled",n),$(window).resize(n)},window.easyMindMupClasses.MMInitiator=t}(),function(){function t(t){this.ysy=t,this.$element=null,this.hidden=!0,this.init(t)}t.prototype.init=function(t){t.eventBus.register("MapInited",$.proxy(this.prepare,this))},t.prototype.prepare=function(t){var e=$("#context-menu");0===e.length&&(e=$('<div id="context-menu" class="mindmup__context_menu '+(this.ysy.settings.easyRedmine?"easy":"redmine")+'"></div>').appendTo("#content").hide()),this.$element=e;var n=this;t.addEventListener("mapMoveRequested mapScaleChanged nodeSelectionChanged nodeEditRequested mapViewResetRequested",function(){n.innerHide()}),t.addEventListener("contextMenuRequested",function(t,e,i){n.innerShow(t,e,i)}),e.on("contextmenu",function(t){return t.preventDefault(),t.stopPropagation(),!1})},t.prototype.innerHide=function(){this.hidden||(this.hidden=!0,$("body").off("click.context_out"),this.$element.hide())},t.prototype.innerShow=async function(t,e,n){this.hidden=!1;var i,r=this,o=this.ysy,s=function(){r.innerHide()},a=this.$element;i=1===t?o.idea:o.idea.findSubIdeaById(t);const u=await this.getStructure(i);var d=Mustache.render(this.template,u);if(a.html(d),e===undefined){var l=o.$container.find("#node_"+t).position();e=l.left+30,n=l.top+20}var c=e+2*a.width(),h=n+a.height(),p=this.window_size();c>p.width?(e-=a.width(),a.addClass("reverse-x")):a.removeClass("reverse-x"),h>p.height+$(window).scrollTop()?(n-=a.height(),a.addClass("reverse-y")):a.removeClass("reverse-y"),e<=0&&(e=1),n<=0&&(n=1),this.bindEvents(i,a),a.css({left:e+"px",top:n+"px"}),a.show().focus(),$("body").off("click.context_out").on("click.context_out",s),a.off("tap click",s).on("tap click",s)},t.prototype.bindEvents=function(t,e){var n=this.ysy,i=this,r=n.mapModel;e.mapToolbarWidget(r,n),e.find(".mindmup-data-value-changer:not(.disabled)").on("tap click",function(){var e=$(this),i={};i[e.data("key")]=e.data("value");for(var r=n.mapModel.getActivatedNodeIds(),o=0;o<r.length;o++){var s=n.idea;1!==r[o]&&(s=s.findSubIdeaById(r[o])),s.attr.entityType===t.attr.entityType&&n.setData(s,i)}n.idea.dispatchEvent("changed")}),e.find(".mindmup-data-value-input-link:not(.disabled)").on("tap click",function(){var e=$(this);e.hide();var r=e.parent().find(".mindmup-data-value-input");if(0!==r.length)return r.show().focus(),r.on("change",function(){var e={},o=r.val();"number"===r.attr("type")&&(o=parseFloat(o)),e[r.data("key")]=o;for(var s=n.mapModel.getActivatedNodeIds(),a=0;a<s.length;a++){var u=n.mapModel.findIdeaById(s[a]);u.attr.entityType===t.attr.entityType&&n.setData(u,e)}i.innerHide(),n.idea.dispatchEvent("changed")}),!1})},t.prototype.window_size=function(){var t,e;return window.innerWidth?(t=window.innerWidth,e=window.innerHeight):document.documentElement?(t=document.documentElement.clientWidth,e=document.documentElement.clientHeight):(t=document.body.clientWidth,e=document.body.clientHeight),{width:t,height:e}},t.prototype.template='    <ul>      {{#.}}      {{^skip}}        <li class="{{folderClass}}{{className}}">          <a href="javascript:void(0)" class="{{submenuClass}}{{aClassName}}">{{name}}</a>          {{{subMenu}}}          {{{changer}}}          {{{input}}}        </li>      {{/skip}}      {{/.}}    </ul>',t.prototype.subMenuTemplate='    <ul>      {{#subMenu}}        <li><a href="javascript:void(0)" class="{{className}} mindmup-context-submenu-item" >{{name}}</a></li>      {{/subMenu}}    </ul>  ',t.prototype.changerTemplate='    <ul>      {{#changer}}        <li><a href="javascript:void(0)" class="mindmup-data-value-changer {{className}} mindmup-context-submenu-item {{#previous}}icon-checked easy-mindmup__icon--checked disabled{{/previous}}" data-key="{{key}}" data-value="{{value}}">{{name}}</a></li>      {{/changer}}    </ul>  ',t.prototype.inputTemplate='    <input type="{{input.inputType}}" class="mindmup-data-value-input {{input.className}}" data-key="{{key}}" value="{{input.value}}" style="display: none">  ',t.prototype.getStructure=function(t){throw t.attr.force=!0,"getStructure is not defined!"};var e={skip:!0};t.prototype.prepareOption=function(t,n){if(n)return e;var i=t.call(this);return i.subMenu&&(i.subMenu=Mustache.render(this.subMenuTemplate,i)),i.changer&&(i.changer=Mustache.render(this.changerTemplate,i)),i.input&&(i.input=Mustache.render(this.inputTemplate,i)),(i.subMenu||i.changer)&&(i.submenuClass="submenu ",i.folderClass="folder "),i},window.easyMindMupClasses.ContextMenu=t}(),function(){function t(){this.id=null,this._old=null,this.filtered_out=!1}function e(){this.nonEditable=!1,this.entityType="",this.data=new t,this.isFromServer=!1,this.isFresh=!1}function n(){this.id=0,this.title="No title",this.nextChildIndex=0,this.ideas={},this.attr=new e,this.parent=null,this.rank=0}function i(t){n.prototype.constructor.call(this,t),this.getYsy=function(){return t}}t.prototype.fromServer=function(t){return $.extend(this,t),this},t.prototype.fromJsonString=function(t,e){var n=JSON.parse(t);e?_.defaults(this,n):this.extend(n)},t.prototype.extend=function(t){return $.extend(this,t),this},window.easyMindMupClasses.ModelEntityData=t,e.prototype.fromServer=function(t,e,n){return this.entityType=t,this.isFromServer=!0,this.nonEditable=!e,this.data.fromServer(n),this},e.prototype.fromJson=function(t){return t?($.extend(this,_.omit(t,["data"])),this.data.extend(t.data),this):this},window.easyMindMupClasses.ModelEntityAttr=e,n.prototype.fromServer=function(t,e,n,i,r){return this.id=t,this.title=e,this.attr.fromServer(n,i,r),this},n.prototype.extend=function(t){return $.extend(!0,this,t),this},n.prototype.fromJson=function(t){for(var e in $.extend(this,_.omit(t,["ideas","attr"])),this.attr.fromJson(t.attr),t.ideas)t.ideas.hasOwnProperty(e)&&(this.ideas[e]=(new n).fromJson(t.ideas[e]));return this},window.easyMindMupClasses.ModelEntity=n,window.easyMindMupClasses.extendClass(i,n),i.prototype.upgrade=function(t){return $.extend(this,t),this},i.prototype.removeEventListener=null,i.prototype.addEventListener=null,i.prototype.dispatchEvent=null,i.prototype.findSubIdeaById=null,i.prototype.findParent=null,i.prototype.links=null,i.prototype.oneSideOn=!1,i.prototype.logChange=function(){},i.prototype.resetHistory=function(){},i.prototype.updateOneSide=function(){},window.easyMindMupClasses.RootIdea=i}(),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Mustache=e()}(this,function(){"use strict";function t(t){return"function"==typeof t}function e(t){return y(t)?"array":typeof t}function n(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(t,e){return null!=t&&"object"==typeof t&&e in t}function r(t,e){return null!=t&&"object"!=typeof t&&t.hasOwnProperty&&t.hasOwnProperty(e)}function o(t,e){return g.call(t,e)}function s(t){return!o(m,t)}function a(t){return String(t).replace(/[&<>"'`=\/]/g,function(t){return v[t]})}function u(t,e){function i(){if(m&&!v)for(;g.length;)delete f[g.pop()];else g=[];m=!1,v=!1}function r(t){if("string"==typeof t&&(t=t.split(b,2)),!y(t)||2!==t.length)throw new Error("Invalid tags: "+t);o=new RegExp(n(t[0])+"\\s*"),a=new RegExp("\\s*"+n(t[1])),u=new RegExp("\\s*"+n("}"+t[1]))}if(!t)return[];var o,a,u,h=!1,p=[],f=[],g=[],m=!1,v=!1,C="",k=0;r(e||S.tags);for(var E,T,I,A,P,D,F=new c(t);!F.eos();){if(E=F.pos,I=F.scanUntil(o))for(var O=0,B=I.length;O<B;++O)s(A=I.charAt(O))?(g.push(f.length),C+=A):(v=!0,h=!0,C+=" "),f.push(["text",A,E,E+1]),E+=1,"\n"===A&&(i(),C="",k=0,h=!1);if(!F.scan(o))break;if(m=!0,T=F.scan(x)||"name",F.scan(w),"="===T?(I=F.scanUntil(_),F.scan(_),F.scanUntil(a)):"{"===T?(I=F.scanUntil(u),F.scan(M),F.scanUntil(a),T="&"):I=F.scanUntil(a),!F.scan(a))throw new Error("Unclosed tag at "+F.pos);if(P=">"==T?[T,I,E,F.pos,C,k,h]:[T,I,E,F.pos],k++,f.push(P),"#"===T||"^"===T)p.push(P);else if("/"===T){if(!(D=p.pop()))throw new Error('Unopened section "'+I+'" at '+E);if(D[1]!==I)throw new Error('Unclosed section "'+D[1]+'" at '+E)}else"name"===T||"{"===T||"&"===T?v=!0:"="===T&&r(I)}if(i(),D=p.pop())throw new Error('Unclosed section "'+D[1]+'" at '+F.pos);return l(d(f))}function d(t){for(var e,n,i=[],r=0,o=t.length;r<o;++r)(e=t[r])&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(i.push(e),n=e));return i}function l(t){for(var e,n=[],i=n,r=[],o=0,s=t.length;o<s;++o)switch((e=t[o])[0]){case"#":case"^":i.push(e),r.push(e),i=e[4]=[];break;case"/":r.pop()[5]=e[2],i=r.length>0?r[r.length-1][4]:n;break;default:i.push(e)}return n}function c(t){this.string=t,this.tail=t,this.pos=0}function h(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function p(){this.templateCache={_cache:{},set:function(t,e){this._cache[t]=e},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}var f=Object.prototype.toString,y=Array.isArray||function(t){return"[object Array]"===f.call(t)},g=RegExp.prototype.test,m=/\S/,v={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},w=/\s*/,b=/\s+/,_=/\s*=/,M=/\s*\}/,x=/#|\^|\/|>|\{|&|=|!/;c.prototype.eos=function(){return""===this.tail},c.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},c.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=e.length,e},h.prototype.push=function(t){return new h(t,this)},h.prototype.lookup=function(e){var n,o=this.cache;if(o.hasOwnProperty(e))n=o[e];else{for(var s,a,u,d=this,l=!1;d;){if(e.indexOf(".")>0)for(s=d.view,a=e.split("."),u=0;null!=s&&u<a.length;)u===a.length-1&&(l=i(s,a[u])||r(s,a[u])),s=s[a[u++]];else s=d.view[e],l=i(d.view,e);if(l){n=s;break}d=d.parent}o[e]=n}return t(n)&&(n=n.call(this.view)),n},p.prototype.clearCache=function(){"undefined"!=typeof this.templateCache&&this.templateCache.clear()},p.prototype.parse=function(t,e){var n=this.templateCache,i=t+":"+(e||S.tags).join(":"),r=void 0!==n,o=r?n.get(i):undefined;return o==undefined&&(o=u(t,e),r&&n.set(i,o)),o},p.prototype.render=function(t,e,n,i){var r=this.parse(t,i),o=e instanceof h?e:new h(e,undefined);return this.renderTokens(r,o,n,t,i)},p.prototype.renderTokens=function(t,e,n,i,r){for(var o,s,a,u="",d=0,l=t.length;d<l;++d)a=undefined,"#"===(s=(o=t[d])[0])?a=this.renderSection(o,e,n,i):"^"===s?a=this.renderInverted(o,e,n,i):">"===s?a=this.renderPartial(o,e,n,r):"&"===s?a=this.unescapedValue(o,e):"name"===s?a=this.escapedValue(o,e):"text"===s&&(a=this.rawValue(o)),a!==undefined&&(u+=a);return u},p.prototype.renderSection=function(e,n,i,r){function o(t){return s.render(t,n,i)}var s=this,a="",u=n.lookup(e[1]);if(u){if(y(u))for(var d=0,l=u.length;d<l;++d)a+=this.renderTokens(e[4],n.push(u[d]),i,r);else if("object"==typeof u||"string"==typeof u||"number"==typeof u)a+=this.renderTokens(e[4],n.push(u),i,r);else if(t(u)){if("string"!=typeof r)throw new Error("Cannot use higher-order sections without the original template");null!=(u=u.call(n.view,r.slice(e[3],e[5]),o))&&(a+=u)}else a+=this.renderTokens(e[4],n,i,r);return a}},p.prototype.renderInverted=function(t,e,n,i){var r=e.lookup(t[1]);if(!r||y(r)&&0===r.length)return this.renderTokens(t[4],e,n,i)},p.prototype.indentPartial=function(t,e,n){for(var i=e.replace(/[^ \t]/g,""),r=t.split("\n"),o=0;o<r.length;o++)r[o].length&&(o>0||!n)&&(r[o]=i+r[o]);return r.join("\n")},p.prototype.renderPartial=function(e,n,i,r){if(i){var o=t(i)?i(e[1]):i[e[1]];if(null!=o){var s=e[6],a=e[5],u=e[4],d=o;return 0==a&&u&&(d=this.indentPartial(o,u,s)),this.renderTokens(this.parse(d,r),n,i,d,r)}}},p.prototype.unescapedValue=function(t,e){var n=e.lookup(t[1]);if(null!=n)return n},p.prototype.escapedValue=function(t,e){var n=e.lookup(t[1]);if(null!=n)return S.escape(n)},p.prototype.rawValue=function(t){return t[1]};var S={name:"mustache.js",version:"4.0.1",tags:["{{","}}"],clearCache:undefined,escape:undefined,parse:undefined,render:undefined,Scanner:undefined,Context:undefined,Writer:undefined,set templateCache(t){C.templateCache=t},get templateCache(){return C.templateCache}},C=new p;return S.clearCache=function(){return C.clearCache()},S.parse=function(t,e){return C.parse(t,e)},S.render=function(t,n,i,r){if("string"!=typeof t)throw new TypeError('Invalid template! Template should be a "string" but "'+e(t)+'" was given as the first argument for mustache#render(template, view, partials)');return C.render(t,n,i,r)},S.escape=a,S.Scanner=c,S.Context=h,S.Writer=p,S}),function(){function t(t){this.ysy=t,this.patch(),this.initCoreIcons()}t.prototype.iconsForEntity={},t.prototype._icons={},t.prototype.addIconBuilder=function(t,e){this._icons[t]=e},t.prototype.initCoreIcons=function(){var t=this.ysy;this.addIconBuilder("avatar",function(e){var n=t.dataStorage.get("users"),i=_.findIndex(n,{id:t.getData(e).assigned_to_id});if(i>-1){var r=n[i],o=r.avatar_url?r.avatar_url:"/plugin_assets/easy_extensions/images/avatar.jpg";return'<span class="avatar-container"><img width="64" height="64" alt="'+r.name+'" class="gravatar" src="'+o+'"></span>'}})},t.prototype.extraElements=function(t,e,n,i){var r=t.find(".mindmup__node-control");e?0===r.length&&jQuery('                <div class="mindmup__node-control">                  <div class="easy-mindmup__icon easy-mindmup__icon--edit mindmup__node-control-edit "></div>                  <div class="easy-mindmup__icon easy-mindmup__icon--add mindmup__node-control-add "></div>                </div>').on("click",".mindmup__node-control-edit",function(){window.EASY&&EASY.utils?EASY.utils.toggleSidebar():i.mapModel.editNodeData("nodeControl")}).on("click",".mindmup__node-control-add",function(){i.mapModel.addSubIdea("nodeControl")}).prependTo(t):r.length>0&&r.remove()},t.prototype.nodeBonusCss=function(t){throw t.title="true","nodeBonusCss is not defined!"};var e=function(t){return t.subject?t.subject.trim():t.title.trim()};t.prototype.getNodeText=e,t.prototype.patch=function(){var t=this.ysy,n=this;jQuery.fn.updateNodeContent=function(i,r){"use strict";var o=jQuery(this),s=e(i),a=function(t){var e=o.find("[data-mapjs-role=title]");0===e.length&&(e=jQuery("<span>").attr("data-mapjs-role","title").appendTo(o)),e.text(t)},u=function(){var e=o.find(".mapjs-collapsor"),r=o[0].className;o[0].className="mapjs-node"+(r.indexOf("activated")>-1?" activated":"")+(r.indexOf("selected")>-1?" selected":"")+t.styles.cssClasses(i)+(i.x&&i.x+i.width<0?" mindmup-node-left":"")+(i.attr.collapsed&&i.attr.hasChildren?" collapsed":"")+t.nodePatch.nodeBonusCss(i)+(i.attr.data.filtered_out?" mindmup__node--filtered_out":"")+(t.filter.isBanned(i)?" "+t.filter.className:"")+(i.attr.isFromServer?"":" mindmup__node--not-saved"),i.attr.hasChildren?0===e.length&&jQuery('<div class="mapjs-collapsor"></div>').hammer().on("tap",function(){var e=t.mapModel;return e.selectNode(i.id),e.toggleCollapse(),!1}).appendTo(o):e.length>0&&e.remove(),n.extraElements(o,o[0].className.indexOf("selected")>0,i,t)},d=function(t){const e=t&&t.hasOwnProperty("idea")?t.idea:null;e&&e.getSubTreeIds(i.id).forEach(t=>{const e=$(`#node_${t}`);i.x+i.width<0?e.addClass(" mindmup-node-left"):e.removeClass(" mindmup-node-left")})},l=function(e){var n,r,o,s=t.nodePatch.iconsForEntity[i.attr.entityType];if(!s)return;var a=t.nodePatch,u=e.find(".mindmup-node-icons-all");let d=e.find(".mindmup-node-icons-all_temp-icons");0===u.length&&(u=$('<div class="mindmup-node-icons-all"></div>'),e.append(u)),0===d.length&&(d=$('<div class="mindmup-node-icons-all_temp-icons"></div>'),u.append(d));for(var l=null,c=0;c<s.length;c++)if(n=s[c],(r=a._icons[n])&&("issue"!==i.attr.entityType||"avatar"===n||t.settings.allIcons)){var h=r(i);o=u.find(".mindmup-node-icon-"+n),h?(o.length||(o=$('<div class="mindmup-node-icon mindmup-node-icon-'+n+'"></div>'),l||"avatar"!==n?d.prepend(o):u.find(o).length||u.prepend(o)),"string"==typeof h?o.html(h):o.clear().append(h),l=n):o.remove()}};if(!o.is(":focus")){var c=o.parent();o.detach();var h=!0}a(s),o.data({x:Math.round(i.x),y:Math.round(i.y),width:Math.round(i.width),height:Math.round(i.height),nodeId:i.id,title:s}),u(),d(r);var p=o.find(".mindmup-node-icons");if(0===p.length){p=$('<div class="mindmup-node-icons"></div>');var f=!0}return l(p),f&&p.appendTo(o),i.attr.force&&delete i.attr.force,h&&c.append(o),o}},window.easyMindMupClasses.NodePatch=t}(),function(){function t(t){this.printReady=!1,this.$area=null,this.ysy=t,this.patch(t)}function e(t,e){this.$element=null,this.ysy=t,this.init(t,e)}t.prototype.margins={left:10,right:10,top:20,bottom:10},t.prototype.patch=function(t){var e=this;window.matchMedia("print").addListener(function(t){t.matches?e.beforePrint():e.afterPrint()}),window.onbeforeprint=$.proxy(this.beforePrint,this),window.onafterprint=$.proxy(this.afterPrint,this),t.settings.paths.print&&(window.easyModel=window.easyModel||{},window.easyModel.print=window.easyModel.print||{},window.easyModel.print.functions=window.easyModel.print.functions||[],window.easyModel.print.functions.push(this.prepareForTemplate.bind(this)),this.initControls())},t.prototype.directPrint=function(){this.beforePrint(),window.print(),this.afterPrint()},t.prototype.beforePrint=function(t){if(!this.printReady)return this.ysy.mapModel.resetView(),this.$area=t?this.createCompactArea():this.createPrintArea(),$("body").append(this.$area),$("#wrapper").hide(),this.printReady=!0,this.$area},t.prototype.afterPrint=function(){this.printReady&&(this.$area.remove(),$("#wrapper").show(),this.ysy.mapModel.resetView(),this.printReady=!1)},t.prototype.createPrintArea=function(){for(var t=330,e=this.ysy.$container.children().children(":not(:hidden)"),n=this.getStageDims(e),i=$('<div id="mindmup__print-area" class="mindmup__print-area mindmup__print-area--stripped scheme-by-'+this.ysy.styles.setting+'"></div>'),r=n.left-this.margins.left;r<n.right+this.margins.right;r+=t)i.append(this.createStrip(e,n,r,r+t));return i},t.prototype.createStrip=function(t,e,n,i){if(i<=n)return null;for(var r=$('<div class="mindmup__print-strip" style="height:'+(e.bottom-e.top+this.margins.top+this.margins.bottom)+"px;width:"+(i-n)+'px"></div>'),o=0,s=e.top-this.margins.top,a=0;a<t.length;a++){var u=t[a],d=parseInt(u.style.left),l=u.offsetWidth;d>i+5||(d+l<n-5||(o++,r.append($(u).clone().css({left:d-n,top:parseInt(u.style.top)-s,width:l}))))}return o?r:null},t.prototype.getStageDims=function(t){for(var e={left:Infinity,top:Infinity,right:-Infinity,bottom:-Infinity},n=0;n<t.length;n++){var i=t[n],r=parseInt(i.style.left),o=parseInt(i.style.top),s=i.offsetWidth,a=i.offsetHeight;r<e.left&&(e.left=r),o<e.top&&(e.top=o),r+s>e.right&&(e.right=r+s),o+a>e.bottom&&(e.bottom=o+a)}return e},t.prototype.createCompactArea=function(){for(var t=this.ysy.$container.children().children(":not(:hidden)"),e=this.getStageDims(t),n=e.left-this.margins.left,i=e.top-this.margins.top,r=$('<div id="mindmup__print-area" class="mindmup__print-area mindmup__print-area--compact scheme-by-'+this.ysy.styles.setting+'" style="height:'+(e.bottom-e.top+this.margins.top+this.margins.bottom)+"px;width:"+(e.right-n+this.margins.right)+'px"></div>'),o=0;o<t.length;o++){var s=t[o];r.append($(s).clone().css({left:parseInt(s.style.left)-n,top:parseInt(s.style.top)-i,width:s.offsetWidth+1}))}return r},t.prototype.initControls=function(){var t=$("#easy_mindmup__print_controls");this.$templateSelector=t.find(".mindmup__print-template-selector"),t.find(".mindmup__print-button").click(this.printableTemplatePrint.bind(this))},t.prototype.prepareForTemplate=function(){var t=!0,e=this.beforePrint(t),n=e.width(),i=this.ysy.settings.templates.printIncludes,r=document.createElement("head");r.innerHTML=i,r.querySelectorAll("link").forEach(function(t){t.href=t.href});var o=e[0].outerHTML+r.innerHTML;t&&(o='<div class="easy-print-page-fitting">'+o+"</div>"),window.easyModel.print.tokens.easy_wbs_current=o,window.easyModel.print.setWidth(n)},t.prototype.printableTemplatePrint=function(){var t=this.$templateSelector.val();if(""===t)return!1;var e=this.ysy.settings.paths.print.replace(":id",t);window.easyModel.print.preview({href:e})},window.easyMindMupClasses.Print=t,e.prototype.id="PrintButton",e.prototype.init=function(t,e){this.$element=e.find(".mindmup-button-print");var n=this;return this.$element.click(function(){n.ysy.print.directPrint()}),this},e.prototype._render=function(){},window.easyMindMupClasses.PrintButton=e}(),function(){function t(t){this.ysy=t,this.onRepaint=[];var e=this,n=function(){var t=e.onRepaint;if(t.length>0){e.onRepaint=[];for(var i=0;i<t.length;i++){var r=t[i];r._redrawRequested=!1,r._render()}}requestAnimationFrame(n)};this.animationLoop=n}t.prototype.start=function(){this.animationLoop()},t.prototype.redrawMe=function(t){t._redrawRequested||(t._redrawRequested=!0,this.onRepaint.push(t))},t.prototype.forceRedraw=function(t){var e=this.ysy.idea;this.ysy.util.traverse(e,function(t){t.attr.force=!0}),t||e.dispatchEvent("changed")},window.easyMindMupClasses.Repainter=t}(),function(){function t(t){this.ysy=t,this.init(t),this.state="initial",this.lastTime=new Date}t.prototype.init=function(t){if(this.$parent=t.toolbar.$menu,t.toolbar.addChild(this),this.$element=this.$parent.find(".mindmup__menu-save"),window.moment){var e=this;this.interval=window.setInterval(function(){t.repainter.redrawMe(e)},6e4)}},t.prototype.saveFinished=function(t){this.$element.length&&(this.lastTime=new Date,this.state="classic"===t?"saved":"autosaved",this.ysy.repainter.redrawMe(this))},t.prototype._render=function(){if(this.$element.length){var t,e=this.ysy.settings.labels.save_info;t=window.moment?e[this.state]+" "+moment(this.lastTime).fromNow():e[this.state]+" "+e.at+" "+this.lastTime.toTimeString().split(" ")[0],this.$element.attr("title",t)}},window.easyMindMupClasses.SaveInfo=t}(),function(){function t(t){this.ysy=t,this.currentScore=0,this.fullScore=0,this.$element=$(t.settings.templates.saveProgressModal),this.$element.hide(),this.$element.appendTo("body"),this.$progressBar=this.$element.find(".mindmup-progress-bar"),this.hidden=!0}t.prototype.scoreForSequential=1,t.prototype.scoreForParallel=.25,t.prototype.scoreForLayout=.25,t.prototype.estimateProgress=function(t){for(var e=0,n=0;n<t.length;n++)t[n].isSafe&&e++;return t.length-e*(this.scoreForSequential-this.scoreForParallel)},t.prototype.startProgress=function(t){this.fullScore=this.estimateProgress(t),this.fullScore<=1||(this.currentScore=0,this.hidden=!1,this.$element.show(),this.ysy.repainter.redrawMe(this))},t.prototype.requestFinished=function(t){this.hidden||(t?(t.isSafe?this.currentScore+=this.scoreForParallel:this.currentScore+=this.scoreForSequential,this.currentScore>=this.fullScore?this.hide():this.ysy.repainter.redrawMe(this)):this.hide())},t.prototype._render=function(){this.$progressBar.width(100*this.currentScore/(this.fullScore+1e-4)+"%")},t.prototype.hide=function(){this.$element.hide()},window.easyMindMupClasses.SaveProgress=t}(),function(){function t(t){this.ysy=t,this.temp=null,this.deleteStack=[],this.delaying=500,this.saveType="classic"}function e(t,e,n){this.method=null,this.url="",this.node=t,this.parent=e,this.project=n,this.nodeData=null,this.data={},this.response=null,this.saver=null,this.isSame=!1,this.isSafe=!1,this.needInclusion=!1,this.evaluated=!1}t.prototype.layoutKey=null,t.prototype.save=function(t){var e=this.ysy.idea;if(e&&e.canUndo()){this.saveType=t||"classic";var n=[];this.linearizeTree(e,null,null,n,!1),this.temp={fails:[],layoutSend:!1,onWay:0,unsafeOnWay:!1,updatesDone:!1,deletesDone:!1,deletesStarted:!1,sendPacks:n,doneCounter:0,pointer:0},this.ysy.saveProgress.startProgress(n),this.saveLayout(),this.sendNextNode()}else"off-site"!==this.saveType&&this.ysy.loader.load()},t.prototype.linearizeTree=function(t,e,n,i,r){if(t){if(!t.attr.nonEditable){var o=this.createSendPack(t,e,n);r?i.push(o):(o.evaluate(this.ysy),o.isSame||(i.push(o),o.isSafe||(r=!0)))}if(t.ideas){t&&"project"===t.attr.entityType&&(n=t);for(var s=_.values(t.ideas),a=0;a<s.length;a++)this.linearizeTree(s[a],t,n,i,r)}}},t.prototype.sendNextNode=function(t){var e=this.temp,n=e.pointer;if(t&&n%10==9)setTimeout($.proxy(this.sendNextNode,this),0);else{var i=this.temp.sendPacks;if(e.doneCounter===i.length)return this.temp.updatesDone=!0,void this.finishCheck();var r=i[n];if(r)if(r.evaluate(this.ysy),r.isSame)e.pointer++,e.doneCounter++,this.sendNextNode(!0);else if(r.isSafe)r.sendRequest(),e.pointer++,this.sendNextNode(!0);else if(r.needInclusion){if(e.unsafeOnWay)return;r.sendInclusion(),e.doneCounter--}else{if(e.unsafeOnWay)return;e.pointer++,r.sendRequest()}}},t.prototype.sendDeletes=function(){var t=this.ysy;t.log.debug("sendDeletes","send");var e=this.temp;e.deletesStarted=!0,e.pointer=0,e.doneCounter=0,e.sendPacks=[];for(var n=0;n<this.deleteStack.length;n++){var i=this.deleteStack[n];if(i.attr.isFromServer){var r=t.getData(i).id;if(r)if(!t.util.findWhere(t.idea,function(e){return t.getData(e).id===r})){var o=this.createSendPack(i);o.makeDelete(this.ysy),e.sendPacks.push(o)}}}this.ysy.saveProgress.startProgress(e.sendPacks),this.sendNextNode(),this.deleteStack=[]},t.prototype.requestFinished=function(t){this.temp.doneCounter++,this.ysy.saveProgress.requestFinished(t),this.sendNextNode()},t.prototype.finishCheck=function(){this.temp.unsafeOnWay||this.temp.sendPacks.length===this.temp.doneCounter&&this.temp.layoutSend&&this.temp.updatesDone&&(this.temp.deletesStarted?(this.ysy.saveProgress.requestFinished(null),this.afterSave()):this.sendDeletes())},t.prototype.afterSave=function(){this.ysy.log.debug("afterSave","send");var t=this.ysy,e=this.temp.fails,n=this.saveType,i=this;if(this.ysy.saveInfo.saveFinished(this.saveType),e.length>0){var r=_.map(e,function(t){return i.createErrorNotice(t)});t.util.showMessage(t.settings.labels.gateway.multiFail+"<br>"+r.join("<br>"),"error"),this.saveType="error",t.eventBus.fireEvent("saveError")}else t.util.showMessage(t.settings.labels.gateway.multiSuccess,"notice",1e3);"off-site"!==this.saveType&&"error"!==this.saveType?t.loader.load():this.saveType=n},t.prototype.createErrorNotice=function(t){var e=t.method,n=t.node.title,i=403===t.response.status?this.ysy.settings.labels.gateway.response_403:null;try{var r=JSON.parse(t.response.responseText);r.errors&&(i=r.errors.join(", "))}catch(s){}var o=this.ysy.settings.labels;return o.types[t.node.attr.entityType]+" "+n+" "+o.gateway[e+"fail"]+": "+(i||t.response.statusText)},t.prototype.saveLayout=function(){if(!this.layoutKey)throw"Missing layoutKey";var t=this,e=this.ysy.storage.extra.getLayout();if(!e)return t.temp.layoutSend=!0,void t.finishCheck();var n={easy_setting:{}};n.easy_setting[this.layoutKey]=e,$.ajax({method:"PUT",url:this.ysy.settings.paths.updateLayout,dataType:"json",data:n}).always(function(){t.temp.layoutSend=!0,t.finishCheck()})},window.easyMindMupClasses.Saver=t,e.prototype.makeDelete=function(t){this.ysy=t,this.method="DELETE",
this.nodeData=this.node.attr.data,this.evaluated=!0},e.prototype.evaluate=function(t){if(!this.evaluated){this.evaluated=!0,this.ysy=t;var e=this.node;if(this.updateNodeData(),this.nodeData=this.node.attr.data,e.attr.nonEditable)this.isSame=!0;else if(e.attr.isFromServer&&this.nodeData.id){if(!this.nodeData._old)return void(this.isSame=!0);if(this.method="PUT",this.isSafeCheck())return void(this.isSafe=!0);this.needInclusionCheck()&&(this.needInclusion=!0)}else this.method="POST"}},e.prototype.generateUrl=function(){var t=this.node.attr.entityType,e=this.ysy.settings.paths[t+this.method];e||(e=""),this.url=e.replace(new RegExp("(:|%3A)"+t+"ID",""),this.nodeData.id)},e.prototype.needInclusionCheck=function(){throw"needInclusionCheck not implemented"},e.prototype.isSafeCheck=function(){throw"isSafeCheck not implemented"},e.prototype.updateNodeData=function(){throw"updateNodeData not implemented"},e.prototype.print=function(){return'{"node":'+this.node.title+',"flags":"'+(this.isSame?"isSame":"")+(this.isSafe?"isSafe":"")+(this.needInclusion?"Inclusion":"")+'"}'},e.prototype.sendRequest=function(){var t=this.saver.temp;this.generateUrl(),this.ysy.log.debug("send for "+(this.nodeData.subject||this.nodeData.name),"send"),"POST"===this.method?this.data[this.node.attr.entityType]=this.filterPostData(this.nodeData):"PUT"===this.method&&(this.data[this.node.attr.entityType]=this.filterPutData(this.nodeData,this.nodeData._old));var e=this;if(this.isSafe||(t.unsafeOnWay=!0),this.ysy.settings.noSave)return e.saver.delaying+=150,e.ysy.log.debug(e.method+" "+e.url+" "+JSON.stringify(e.data)),void setTimeout(function(){e.isSafe||(t.unsafeOnWay=!1),e.response='{"'+e.node.attr.entityType+'":{"id":'+e.node.id+"}}","POST"===e.method&&e.updateByPOST(),e.ysy.log.debug("DONE "+e.method+" "+e.url+" "+JSON.stringify(e.data)),e.saver.requestFinished(e)},e.saver.delaying);var n=$.ajax({method:this.method,url:this.url,dataType:"text",data:this.data});n.done(function(t){e.response=t,"POST"===e.method&&e.updateByPOST()}),n.fail(function(n){e.response=n,t.fails.push(e)}),n.always(function(){e.isSafe||(t.unsafeOnWay=!1),e.saver.requestFinished(e)})},e.prototype.updateByPOST=function(){var t=JSON.parse(this.response)[this.node.attr.entityType],e=this.ysy.mapModel.getCurrentLayout();if(t){this.nodeData.id=t.id,this.updateByPOSTAdditional(t),this.node.attr.isFromServer=!0;for(let t in e.nodes)if(e.nodes[t]){var n=e.nodes[t];this.node.id===n.id&&($("#node_"+n.id).updateNodeContent(this.node),this.ysy.repainter.forceRedraw(!1))}}},e.prototype.updateByPOSTAdditional=function(){throw"updateByPOSTAdditional not implemented"},e.prototype.sendInclusion=function(){var t=this.node,e=(new window.easyMindMupClasses.ModelEntity).fromServer(t.id,t.title+" inclusion",t.attr.entityType,!0,this.getInclusionData());e.ideas={1:t};var n=this.saver.createSendPack(e);n.ysy=this.ysy,n.nodeData=n.node.attr.data,n.method="PUT",this.needInclusion=!1,n.sendRequest()},e.prototype.getInclusionData=function(){throw"getInclusionData"},e.prototype.filterPutData=function(t,e){for(var n={},i=Object.getOwnPropertyNames(e),r=0;r<i.length;r++){var o=i[r];"_"!==o.substring(0,1)&&("custom_fields"!==o?n[o]=t[o]:n.custom_field_values=this.transformCustomValues(t.custom_fields,e.custom_fields))}return n},e.prototype.filterPostData=function(t){for(var e={},n=this.ysy.util,i=Object.getOwnPropertyNames(t),r=0;r<i.length;r++){var o=i[r];"id"!==o&&(n.startsWith(o,"_")||"function"!=typeof t[o]&&("custom_fields"!==o?e[o]=t[o]:e.custom_field_values=this.transformCustomValues(t.custom_fields,null)))}return e},e.prototype.transformCustomValues=function(t,e){var n={};if(e){for(var i=this.ysy.util,r=Object.getOwnPropertyNames(e),o=0;o<r.length;o++)if(!i.startsWith(r[o],"_")){var s=t[parseInt(r[o])];if("easy_lookup"===s.field_format&&"undefined"!=typeof s.value.length){for(var a=[],u=0;u<s.value.length-2;u+=3)a.push(s.value[u]);s.multiple?n[s.id]=a:0===a.length?n[s.id]=null:n[s.id]=a[0]}else n[s.id]=s.value}}else for(o=0;o<t.length;o++)n[(s=t[o]).id]=s.value;return n},window.easyMindMupClasses.SendPack=e,t.prototype.createSendPack=function(t,n,i){var r=new e(t,n,i);return r.saver=this,r}}(),function(){"use strict";function t(t){this._scope=t.id+"-",this.ysy=t,this.extra=new e(this);var r=new n(this),o=new i(this);this.lastState=r,this.settings=o;var s=this;t.eventBus.register("TreeLoaded",function(t){t.addEventListener("changed",function(){r.remove(),s.save(t)})})}function e(t){this.positionExtract=null,this.collapseExtract=null,this.storage=t,this.ysy=t.ysy,r=t.ysy.getIdOfIdea}function n(t){this.storage=t,this._binded=!1,this.ysy=t.ysy}function i(t){this.storage=t,this.ysy=t.ysy,this.init(t.ysy)}var r;t.prototype.getSessionData=function(t){return window.sessionStorage.getItem(this._scope+t)},t.prototype.saveSessionData=function(t,e){window.sessionStorage.setItem(this._scope+t,e)},t.prototype.resetSessionData=function(t){window.sessionStorage.removeItem(this._scope+t)},t.prototype.getPersistentData=function(t){return window.localStorage.getItem(this._scope+t)},t.prototype.savePersistentData=function(t,e){window.localStorage.setItem(this._scope+t,e)},t.prototype.resetPersistentData=function(t){window.localStorage.removeItem(this._scope+t)},t.prototype.save=function(t){this.extra.save(t),this.lastState.save(t)},t.prototype.clear=function(){this.lastState.remove(),this.extra.positionExtract=null},window.easyMindMupClasses=window.easyMindMupClasses||{},window.easyMindMupClasses.Storage=t,e.prototype._key="extra-",e.prototype.save=function(t){if(t){var e=this._extractFromNode(t);this.positionExtract=e.positions,this.collapseExtract=e.collapses;var n={collapses:this.collapseExtract,rootPos:{deltaX:this.ysy.domPatch.deltaX,deltaY:this.ysy.domPatch.deltaY}};this.storage.savePersistentData(this._key+r(t),JSON.stringify(n))}},e.prototype.getLocalProjectData=function(t){var e=this.storage.getPersistentData(this._key+r(t));if(null===e||""===e)return{};var n=JSON.parse(e)||{};return n.collapses?n:{collapses:n}},e.prototype.enhanceData=function(t,e){var n=this.positionExtract,i=this.getLocalProjectData(e),o=i.collapses;if(this.ysy.domPatch.loadRootPosition(i.rootPos),n)for(var s=1;s<t.length;s++){var a=n[r(t[s])];if(a){if(a.position){for(var u=[],d=0;d<a.position.length;d++)u.push(parseFloat(a.position[d]));t[s].attr.position=u}t[s].rank=a.rank}}if(o)for(s=1;s<t.length;s++)t[s].attr.collapsed=!!o[r(t[s])];return t},e.prototype.setLayout=function(t){this.positionExtract=this._decodeLayout(t)},e.prototype.getLayout=function(){return this._encodeLayout(this.positionExtract)},e.prototype._encodeLayout=function(t){if(!t)return null;var e=Object.getOwnPropertyNames(t);if(e.length<=50)return t;var n,i,r,o="";if(e.length>2e3){for(n=0;n<e.length;n++)if(r=t[i=e[n]].position?"["+t[i].position+"]":"",(o+=i+"{"+(t[i].rank||"")+r+"}").length>6e4)return{code:o}}else for(n=0;n<e.length;n++)r=t[i=e[n]].position?"["+t[i].position+"]":"",o+=i+"{"+(t[i].rank||"")+r+"}";return{code:o}},e.prototype._decodeLayout=function(t){if(!t)return null;if(!t.code)return t;for(var e=t.code.split("}"),n={},i=0;i<e.length;i++){var r=e[i],o=r.indexOf("{");if(-1!==o){var s={};n[r.substring(0,o)]=s;var a,u=r.indexOf("[");if(u>-1){var d=r.substring(u);s.position=JSON.parse(d),a=r.substring(o+1,u)}else a=r.substring(o+1);a&&(s.rank=parseInt(a))}}return n},e.prototype._extractFromNode=function(t,e,n){n===undefined&&(n={positions:{},collapses:{}});var i={};if(i.rank=e,t.attr.position&&(i.position=t.attr.position),t.attr.collapsed&&!_.isEmpty(t.ideas)&&(n.collapses[r(t)]=!0),t.ideas)for(var o=this.ysy.util.getSortedRanks(t.ideas),s=this.ysy.util.correctRanks(o),a=0;a<s.length;a++)this._extractFromNode(t.ideas[o[a]],s[a],n);return n.positions[r(t)]=i,n},n.prototype._dataKey="last-data",n.prototype._idKey="last-id",n.prototype.save=function(){},n.prototype.getSavedIdea=function(){var t=this.storage.getPersistentData(this._idKey);t&&parseInt(t)!==this.ysy.settings.rootID&&this.remove();var e=this.storage.getPersistentData(this._dataKey);if(!e)return null;var n=new window.easyMindMupClasses.RootIdea(this.ysy).fromJson(JSON.parse(e));return MAPJS.content(n)},n.prototype.remove=function(){this.storage.resetPersistentData(this._dataKey),this.storage.resetPersistentData(this._idKey),this._binded&&($(window).unbind("beforeunload"),$(window).unbind("unload"),this._binded=!1)},n.prototype.compareIdea=function(t,e,n){return n||null!==(n=this.getSavedIdea())?o(n,t,{softParams:"all"===e||"soft"===e,data:"all"===e||"data"===e||"server"===e,structure:"all"===e||"structure"===e||"server"===e}):null};var o=function(t,e,n){for(var i=!1,r={},s={},a=["title"],u=0;u<a.length;u++){var d=a[u];t[d]!==e[d]&&(r[d]=t[d],s[d]=e[d],i=!0)}if(n.data){var l=this.ysy.getData(t),c=this.ysy.getData(e);for(a=_.union(Object.getOwnPropertyNames(l),Object.getOwnPropertyNames(c)),u=0;u<a.length;u++)"object"!=typeof l[d=a[u]]&&"object"!=typeof c[d]&&l[d]!==c[d]&&(r.attr===undefined&&(r.attr={data:{}},s.attr={data:{}}),r.attr.data[d]=l[d],s.attr.data[d]=c[d],i=!0)}if(n.softParams)for(a=["collapsed","position"],u=0;u<a.length;u++)d=a[u],t.attr[d]!==e.attr[d]&&(r.attr===undefined&&(r.attr={},s.attr={}),r.attr[d]=t.attr[d],s.attr[d]=e.attr[d],i=!0);if(_.isEmpty(t.ideas)&&!_.isEmpty(e.ideas))s.ideas=e.ideas,i=!0;else if(_.isEmpty(e.ideas)&&!_.isEmpty(t.ideas))r.ideas=t.ideas,i=!0;else{for(var h=$.extend({},t.ideas),p=$.extend({},e.ideas),f=Object.getOwnPropertyNames(h),y=Object.getOwnPropertyNames(p),g=0;g<f.length;g++){for(var m=f[g],v=t.ideas[m],w=this.ysy.getData(v).id,b=0;b<y.length;b++){var M=y[b];if(p.hasOwnProperty(M)){var x=e.ideas[M];if(w===this.ysy.getData(x).id){var S=o(v,x,n);S&&S.oldDiff&&(r.ideas===undefined&&(r.ideas={}),r.ideas[m]=S.oldDiff,i=!0),S&&S.newDiff&&(s.ideas===undefined&&(s.ideas={}),s.ideas[M]=S.newDiff,i=!0),delete h[m],delete p[M]}}}h[m]&&(r.ideas||(r.ideas={}),r.ideas[m]=h[m],i=!0)}for(M in p)p.hasOwnProperty(M)&&(s.ideas||(s.ideas={}),s.ideas[M]=p[M],i=!0)}if(!i)return null;var C={};return _.isEmpty(r)||(C.oldDiff=r),_.isEmpty(s)||(C.newDiff=s),C};i.prototype._key="settings",i.prototype.init=function(t){var e=this;t.eventBus.register("saveOneSideOn",function(t){e.saveOneSide(t)}),t.eventBus.register("nodeStyleChanged",function(){e.saveStyle()}),t.eventBus.register("legendToggled",function(t){e._save({legendHidden:!t},!1,null)}),t.eventBus.register("legendHeaderToggled",function(t){e._save({legendHeaderHidden:t},!1,null)}),t.eventBus.register("BeforeServerClassInit",function(){e.load()})},i.prototype.load=function(){this.ysy.settings.oneSideOn=this._load("oneSideOn",null),this.ysy.toolbar.redraw("toggleOneSide")},i.prototype.loadStyle=function(){return this._load("defaultStyle",this.ysy.settings.rootID)},i.prototype.loadLegendHidden=function(){return this._load("legendHidden",null)},i.prototype.loadLegendHeaderHidden=function(){return this._load("legendHeaderHidden",null)},i.prototype._load=function(t,e){e=e?this._key+"-"+e:this._key;var n=this.storage.getPersistentData(e);if(n){var i=JSON.parse(n);return"string"==typeof t?i[t]:_.pick(i,t)}},i.prototype.saveOneSide=function(t){this._save({oneSideOn:t},!1,null)},i.prototype.saveStyle=function(){var t=this.ysy.styles;this._save({defaultStyle:t.setting===t.defaultStyle?undefined:t.setting},!1,this.ysy.settings.rootID)},i.prototype._save=function(t,e,n){n=n?this._key+"-"+n:this._key;var i=this.storage.getPersistentData(n);if(i){var r=JSON.parse(i);o=_.clone(r)}else var o={};var s=_.keys(t);if(e)for(var a=0;a<s.length;a++){var u=s[a];t[u]===undefined?delete o[u]:o[u]=t[u]}else for(a=0;a<s.length;a++)t[u=s[a]]?o[u]=t[u]:delete o[u];_.isEqual(r,o)||(_.isEmpty(o)?this.storage.resetPersistentData(n):this.storage.savePersistentData(n,JSON.stringify(o)))}}(),function(){function t(t){this.ysy=t,this.setting=null,this.styles={},this.init()}function e(t){this.ysy=t,this.key=null;var e=this;t.eventBus.register("dataFilled",function(t,n){e.dataArray===t&&e.initAttribute(n)})}t.prototype.defaultStyle=null,t.prototype.addStyle=function(t,e){e.key=t,e.init(),this.styles[t]=e},t.prototype.init=function(){if(!this.defaultStyle)throw"default style is not defined";var t=this,e=this.ysy.$menu.find(".mindmup-color-select");this.ysy.eventBus.register("BeforeServerClassInit",function(){var n=t.ysy.storage.settings.loadStyle();n||(n=t.defaultStyle),e.val(n),t.setColor(n)}),e.change(function(){var e=$(this).val();t.setColor(e)})},t.prototype.setColor=function(t){var e="scheme-by-";$(this.ysy.containerDiv+","+this.ysy.menuDiv+" .mindmup-legend").removeClass(e+this.setting).addClass(e+t),this.setting=t,this.ysy.eventBus.fireEvent("nodeStyleChanged",t)},t.prototype.getCurrentStyle=function(){return this.styles[this.setting]},t.prototype.cssClasses=function(t){throw t.title="","cssClasses is not defined"},t.prototype.createStyles=function(t){for(var n in t)if(t.hasOwnProperty(n)){var i=new e(this.ysy).fromSource(t[n]);this.addStyle(n,i)}},window.easyMindMupClasses.Styles=t;var n=function(){};e.prototype.fromSource=function(t){return $.extend(this,t),this},e.prototype.init=n,e.prototype.dataArray="",e.prototype.value=n,e.prototype.changeObject=function(t){var e={};return e[this.key+"_id"]=t,e},e.prototype.builderType="dataBased",e.oneKeyObjectConstructorBuilder=function(t){return function(e){var n={};return n[t]=e,n}},e.oneKeyObjectConstructor=function(t,e){var n={};return n[t]=e,n},e.prototype.options=function(t){return this.data?t?this.findUsed():this.nullAllowed?[{id:0,name:"---"}].concat(this.data):this.data:[]},e.prototype.initAttribute=function(t){this.count=1,this.colors={};for(var e=0;e<t.length;e++)this.colors[t[e].id]=this.count++,this.count>24&&(this.count=1);this.data=t},e.prototype.addSchemeClassFromData=function(t){var e=this.value(t);return this.addSchemeClass(e)},e.prototype.addSchemeClass=function(t){return this.colors&&this.colors[t]!==undefined?" scheme-"+this.key+"-"+this.colors[t]:""},e.prototype.findUsed=function(){if(!this.ysy.idea)return[];var t={};this.recursiveUsed(this.ysy.idea,t);var e=[];t[0]&&"spentTimeRatio"!==this.builderType&&"percent"!==this.builderType&&e.push({id:0,name:"---"});for(var n=this.data,i=0;i<n.length;i++)(t[n[i].id]||t[n[i]])&&e.push(n[i]);return e},e.prototype.recursiveUsed=function(t,e){e[this.value(this.ysy.getData(t))]=!0;var n=t.ideas;for(var i in n)if(n.hasOwnProperty(i)){var r=n[i];this.recursiveUsed(r,e)}},window.easyMindMupClasses.Style=e}(),function(){function t(t){this.$menu=t.$menu,this.ysy=t,this.children={},this.init(t)}function e(t,e){this.ysy=t,this.$element=e.find(".toggleOneSide")}function n(t,e){this.$element=null,this.ysy=t,this.init(t,e)}function i(t,e){this.$element=null,this.ysy=t,this.isFixed=!1,this.init(t,e)}t.prototype.init=function(t){t.eventBus.register("TreeLoaded",$.proxy(this.redraw,this)),this.initChildren(t)},t.prototype.initChildren=function(t){this.addChild(new e(t,this.$menu)),this.addChild(new n(t,this.$menu)),this.addChild(new i(t,this.$menu)),this.addChild(new window.easyMindMupClasses.ExpandAllButton(t,this.$menu)),this.addChild(new window.easyMindMupClasses.ShowLinksButton(t,this.$menu)),this.addChild(new window.easyMindMupClasses.PrintButton(t,this.$menu)),this.addChild(new window.easyMindMupClasses.SaveButton(t,this.$menu)),this.addChild(new window.easyMindMupClasses.UndoButton(t,this.$menu)),this.addChild(new window.easyMindMupClasses.RedoButton(t,this.$menu))},t.prototype.addChild=function(t){var e=t.triggerName||t.id;this.children[e]=t,this.redraw(e)},t.prototype._render=function(){for(var t in this.children)this.children.hasOwnProperty(t)&&this.children[t]._render()},t.prototype.redraw=function(t){if(!t)return this.ysy.repainter.redrawMe(this);if(this.children[t]){var e=this.children[t];this.ysy.repainter.redrawMe(e)}},window.easyMindMupClasses.Toolbar=t,e.prototype.triggerName="toggleOneSide",e.prototype._render=function(){var t=this.ysy.settings.oneSideOn;t||(t=!1),this.$element.find("a").toggleClass("active",t)},n.prototype.id="allIconButton",n.prototype.init=function(t,e){this.$element=e.find(".all-icon-toggler");var n=this;return this.ysy.settings.allIcons=!!t.storage.settings._load("showIcons"),this.$element.click(function(){t.settings.allIcons=!t.settings.allIcons,t.settings.allIcons?(t.$container.addClass("mindmup-node-icons--with_icons"),t.repainter.forceRedraw()):(t.$container.find(".mindmup-node-icons-all_temp-icons").remove(),t.$container.removeClass("mindmup-node-icons--with_icons")),t.storage.settings._save({showIcons:t.settings.allIcons}),t.repainter.redrawMe(n)}),this},n.prototype._render=function(){var t=this.ysy.settings.allIcons;this.$element.find("a").toggleClass("active",t)},i.prototype.id="StickyMenu",i.prototype.init=function(t,e){this.$element=e,this.$cont=e.parent(),this.$placeholder=$("<div id='mindmup_menu_placeholder' style='height:0'></div>"),this.$cont.prepend(this.$placeholder),this.$document=$(document),this.offset=0,t.settings.easyRedmine&&(this.offset+=$("#top-menu").outerHeight());var n=this,i=function(){t.repainter.redrawMe(n)};return $(document).on("scroll",i),t.eventBus.register("resize",i),t.eventBus.register("sidebarResized",i),$("#top-menu-container-control").click(function(){i()}),i(),this},i.prototype._render=function(){this.$document.scrollTop()+this.offset-this.$cont.offset().top>0?(this.$element.css("width",this.$cont.width()),this.isFixed||(this.$element.css({position:"fixed",top:this.offset+"px"}),this.$placeholder.height(this.$element.outerHeight()),this.isFixed=!0)):this.isFixed&&(this.$element.css({position:"relative",top:"0",width:""}),this.$placeholder.height(0),this.isFixed=!1)}}(),function(){function t(t){this.ysy=t,this._removeConfirm=new e(t)}function e(t){this.ysy=t,this._removeStack=[],this._timeout=0,this._leaking=!1}t.prototype.changeParent=function(t){return!t.attr.nonEditable},t.prototype.removeSubIdea=function(t,e,n){if(!n){var i=this.ysy.idea;if(!i)return!1;n=i.findSubIdeaById(t)}return!!n&&(!n.attr.nonEditable&&(!this.hasSpentTime(n)&&this._removeConfirm.removeIdea(n)))},t.prototype.paste=function(t,e){return!e.attr.nonEditable},t.prototype.nodeRename=function(t){return!t.attr.nonEditable},t.prototype.validate=function(t){return!this[t]||this[t].apply(this,Array.prototype.slice.call(arguments,1))},t.prototype.hasSpentTime=function(t){let e=!1;return this.ysy.util.traverse(t,function(t){t.attr.data.spent_hours&&(e=!0)}),e},window.easyMindMupClasses.Validator=t,e.prototype.removeIdea=function(t){if(this._leaking)return!0;this._removeStack.push(t);var e=this;return this._timeout||(this._timeout=window.setTimeout(function(){e._showConfirm()?e._deleteStacked():e._removeStack=[],e._timeout=0},0)),!1},e.prototype._deleteStacked=function(){this._leaking=!0;var t=this.ysy.idea;_.each(this._removeStack,function(e){t.removeSubIdea(e.id)}),this._leaking=!1,this._removeStack=[]},e.prototype._showConfirm=function(){if(0===this._removeStack.length)return!0;if(1===this._removeStack.length){var t=this._removeStack[0];return window.confirm(this.ysy.settings.labels.errors.warning_delete_node.replace("{{name}}",'"'+t.title+'"'))}for(var e="\n",n=0;n<this._removeStack.length;n++)e+="\u2022 "+(t=this._removeStack[n]).title+"\n";return window.confirm(this.ysy.settings.labels.errors.warning_delete_nodes+e)}}();