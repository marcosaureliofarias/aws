!function(t,e){function a(){var t=-1;if("Microsoft Internet Explorer"==navigator.appName){var e=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(e)&&(t=parseFloat(RegExp.$1))}else if("Netscape"==navigator.appName){e=navigator.userAgent;null!=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(e)&&(t=parseFloat(RegExp.$1))}return t}function n(){var e=navigator.userAgent.match(/(firefox|webkit)\/?\s*(\.?\d+(\.\d+)*)/i);if(e){var n=parseInt(e[2],10);e[1]=e[1].toLowerCase();var i="webkit"==e[1]&&"object"==typeof window.chrome&&n>=t.cbp_min_chrome_ver;if(C=i||"firefox"==e[1]&&n>=50,i||"firefox"==e[1]&&n>=t.cbp_min_firefox_ver)return!0}return a()>=t.cbp_min_ie_ver}function i(t,a){const n=e("#cbp_image_link"),i=e("#cbp_thumbnail_link");n.val("!"+a.val()+"!"),i.val('attachment:"'+a.val()+'"'),n.attr("data-value",n.val()),i.attr("data-value",i.val()),e("#cbp_link_dlg").dialog({closeOnEscape:!0,modal:!0,resizable:!1,dialogClass:"cbp_drop_shadow cbp_dlg_small",position:{my:"left top",at:"left bottom",of:t},minHeight:0,width:"auto"})}function c(){u(),p("print"),e(window).bind("resize",r),r(),e(E).dialog("option","position","center")}function o(){_(),e(window).unbind("resize",r)}function r(){E&&e(E).dialog("isOpen")&&(e(E).dialog("option","width",e(window).width()-100),e(E).dialog("option","height",e(window).height()-100),l())}function l(){var t=5;e("#cbp_panel_box").css("height",e(E).height()-e("#cbp_header_box").height()-2*t-10+"px"),y&&s()}function s(){M&&(M.destroy(),M=null),e("#cbp_panel_box").empty();var t=e("#cbp_panel_box").width(),a=e("#cbp_panel_box").height();if(y.width>t||y.height>a)if(y.height/y.width<=a/t){var n=t/y.width;t=Math.round(y.width*n),a=Math.round(y.height*n)}else{n=a/y.height;t=Math.round(y.width*n),a=Math.round(y.height*n)}else t=y.width,a=y.height;var i=document.createElement("canvas");i.width=t,i.height=a;var c=i.getContext("2d");c.clearRect(0,0,c.canvas.width,c.canvas.height),c.drawImage(y,0,0,c.canvas.width,c.canvas.height),e("#cbp_panel_box").append(i),e(i).Jcrop({onChange:d,onSelect:d,aspectRatio:0,trueSize:[y.width,y.height]},function(){M=this}),d()}function h(t){var e=arguments;return t.replace(/{(\d+)}/g,function(t,a){return"undefined"!=typeof e[a]?e[a]:t})}function d(e){e&&0!=e.w&&0!=e.h?p("box",h(t.cbp_txt_crop_box,Math.round(e.x),Math.round(e.y),Math.round(e.w),Math.round(e.h))):(p("select"),e={x:0,y:0,w:y.width,h:y.height}),k=e;var a=document.getElementById("cbp_thumbnail");if(a){var n=a.getContext("2d");n.clearRect(0,0,n.canvas.width,n.canvas.height),n.drawImage(y,e.x,e.y,e.w,e.h,0,0,n.canvas.width,n.canvas.height)}}function p(a,n){if("box"===a)return e("#cbp_instructions").html(t.cbp_txt_deselect+"<br>"+n),void(L=a);L!==a&&(L=a,"select"===a?e("#cbp_instructions").html(t.cbp_txt_select):"print"===a&&e("#cbp_instructions").html(t.cbp_txt_print),e("#cbp_instructions").animate({backgroundColor:"#FF8000"},"slow"),e("#cbp_instructions").animate({backgroundColor:"white"},2e3))}function u(){C||((z=document.createElement("div")).setAttribute("contenteditable",""),z.setAttribute("id","cbp_paste_catcher"),E.appendChild(z),document.addEventListener("click",g,!1),setTimeout(g,50)),window.addEventListener("paste",b,!1)}function _(){window.removeEventListener("paste",b,!1),z&&(document.removeEventListener("click",g,!1),E.removeChild(z),z=null)}function g(){z&&z.focus()}function b(e){if(C&&e.clipboardData){var a=e.clipboardData.items;if(a){for(var n=0;n<a.length;n++)if(-1!==a[n].type.indexOf("image")){var i=a[n].getAsFile();return void v((window.URL||window.webkitURL).createObjectURL(i))}alert(t.cbp_txt_no_image_cb)}else alert(t.cbp_txt_empty_cb)}else setTimeout(f,1)}function f(){var e=z.childNodes[0];z.innerHTML="",e&&("IMG"===e.tagName?v(e.src):alert(t.cbp_txt_no_image_cb))}function v(t){(y=new Image).onload=function(){s()},y.src=t}function m(){if(y){var a=x();if(!a)return!1;var n=w();if(n.length>t.cbp_max_attach_size)alert(t.cbp_txt_too_big_image);else{F++;var c=t.cbp_act_update_id+"-"+F,o="attachments["+(O+F)+"]",r=A.clone();r.css("display","block");var l=r.find("#cbp_attach_thumbnail");l.attr("src",n),n=n.substring(n.indexOf("iVBOR")),(l=r.children("#cbp_image_data")).attr("name",o+"[data]").val(""),l.attr("value",n).val(n),(l=r.children("input.name")).attr("name",o+"[name]").val("");var s="picture"+c+".png";l.attr("value",s).val(s),l.each(function(){e(this).blur(function(){this.value=this.value.replace(/^\s+|\s+$/g,""),""==this.value?this.value=this.defaultValue:this.value.search(/\.png$/)<1&&(this.value+=".png"),this.value=this.value.replace(/[\/\\!%\?\*:'"\|<>&]/g,"-"),this.value=this.value.replace(/ /g,"_")})}),(l=r.children("input.description")).attr("name",o+"[description]").val(""),(l=r.children("#cbp_link_btn")).each(function(){e(this).click(function(){return i(e(this),e(this).prev()),!1})}),a.append(r),e(E).dialog("close")}}else alert(t.cbp_txt_no_image_pst)}function w(){var t=document.createElement("canvas");return t.width=Math.round(k.w),t.height=Math.round(k.h),t.getContext("2d").drawImage(y,Math.round(k.x),Math.round(k.y),t.width,t.height,0,0,t.width,t.height),t.toDataURL("image/png")}function x(){var e=I.closest(".attachments-container").find("#attachments_fields"),a=I.closest("#cbp_images_form").find("#cbp_image_fields");if(e&&a&&!(e.children().length+a.children().length>=t.cbp_max_attachments))return a}var y,E,M,k,C,I,R,L,z;t.showPasteDialog=function(a){if(I=e(a),!n())return alert(t.cbp_txt_wrong_browser),!1;if(!x())return alert(t.cbp_txt_too_many_files),!1;var i={};i[t.cbp_txt_btn_ok]=m,i[t.cbp_txt_btn_cancel]=function(){e(this).dialog("close")},e("#cbp_paste_dlg").dialog({buttons:i,closeOnEscape:!0,modal:!0,resizable:!1,width:400,minWidth:400,height:500,minHeight:500,dialogClass:"cbp_drop_shadow",create:function(){E=this},open:function(){c()},close:function(){o()},resize:function(){l()}})};var A,O=1e4,F=0;t.removeImageField=function(t){e(t).parents("span").first().remove()},t.adjustCbpImageParts=function(t){var a=e(t?t+" #attachments_fields:not(.already_attached)":"#attachments_fields:not(.already_attached)");if(a[0]){var n=a.next("span.add_attachment");n[0]&&(a.addClass("already_attached"),n.after(R.clone().css("display","block")))}},EASY.schedule.late(function(){(A=e("#cbp_image_field"))&&A.detach(),(R=e("#cbp_images_form"))&&(t.adjustCbpImageParts(),R.detach())})}(window.cbImagePaste=window.cbImagePaste||{},jQuery);