# Easy Docker
This file introduce usage of our Docker images.

## Build image
If your working directory contains `config/database.yml` build use your file, if not will be generated. Same with `config/secrets.yml` and `config/configuration.yml`.

```bash
docker build . -t easy
```
For example build with args:
```bash
docker build --build-arg BUNDLE_GEMS__EASYSOFTWARE__COM --build-arg DB=mysql . -t easy
```
## Dependencies
By default are easy images builded against mariadb.

## ENV variables
In default you need pass database setup in following env variables:

* `APP_IMAGE` = docker image name (if you have build it by recemendations above use easy:latest)
* `MYSQL_ROOT_PASSWORD` = if you wanna use dockerized database, this parameter is required!!!
* `DB_HOST` = ip to your database server. (default: `host.docker.internal`)
* `DB_PORT` = port of mysql database (default: 3306)
* `MYSQL_DATABASE` = name of your database
* `MYSQL_USER` = user name to your mysql server (see official mariadb docker)
* `MYSQL_PASSWORD` (if not specified `MYSQL_ROOT_PASSWORD` will used)
* `SECRET_KEY_BASE` = session key for persistence do not forget to specify it (default is generated by /dev/urandom)
* `REDIS_HOST` = hostname of redis server
* `REDIS_PORT` = port of redis server (default: 6379)

## Mount points
* `/opt/easy/files` = users uploads & attachments
* `/opt/easy/log` = application logs


## Running 


### docker-compose way
This way contains whole stack and migrations, so there are no additional steps. After you set .env file (lets see example in .env.EXAMPLE), you can manage whole stack simple by `docker-compose`

```Bash
docker-compose up -d                    # start
docker-compose log -f                   # see all logs
docker-compose ps -a                    # see containers state
docker-compose restart container_name   # restart container
docker compose down -v                  # stop whole stack and REMOVE data!!!
```

Each part of docker-compose.yml file can be replaced by local running service. In this case just replace HOST_XX variable.



### Raw docker way
In case you run it by raw docker, please continue by following steps:


* before start first time you need run database migration:

```bash
docker run -v ${PWD}/files:/opt/easy/files -e MYSQL_DATABASE=easy -e MYSQL_USER=root -e MYSQL_PASSWORD=root easy install
```

* than run the application at port `3000`
```bash
docker run -p 3000:3000 -v ${PWD}/files:/opt/easy/files -e MYSQL_DATABASE=easy -e MYSQL_USER=root -e MYSQL_PASSWORD=root --name easyproject.hostname easy server
```

`PWD` - is path to your current working directory, you need to mount it because during first commands you will genereate assets and you will need them in second command.

### SMTP configuration

SMTP configuration can be set using environment variables:

* `SMTP_HOST` (default: `host.docker.internal`)
* `SMTP_PORT` (default: `25`)
* `SMTP_AUTHENTICATION` (default: `:none`)
* `SMTP_USER_NAME` (default: ``)
* `SMTP_PASSWORD` (default: ``)
* `SMTP_TLS` (default: `false`)
* `SMTP_ENABLE_STARTTLS_AUTO` (default: `false`)
* `SMTP_OPENSSL_VERIFY_MODE` (default: `"NONE"`)